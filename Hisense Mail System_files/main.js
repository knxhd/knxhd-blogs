!function(){require.config({paths:{cui:"../../../framework/796e441f/cui",components:"../../../framework/796e441f/components",template:"../template",component:"./component",widget:"./widget",jquery:"../../../framework/796e441f/components/jquery/dist/jquery","jquery.ui":"../../../framework/796e441f/components/jquery.ui/ui",kindEditor:"../../../framework/796e441f/components/kindeditor/kindeditor-all","kindEditor.lineheight":"../../../framework/796e441f/components/kindeditor/plugins/lineheight/lineheight",qrcode:"../../../framework/796e441f/components/qrcode/qrcode"},map:{"*":{i18n:"util/i18n","jquery.ui.widget":"jquery.ui/widget",text:"components/requirejs-text/text",handlebars:"components/handlebars/handlebars",moment:"components/moment/min/moment-with-locales",xss:"components/xss/dist/xss","socket-io-client":"components/socket.io-client/socket.io",desktopNotify:"components/html5-desktop-notifications/desktop-notify",base64:"components/js-base64/base64",datetime:"widget/datetime/datetime","jquery.ztree":"components/zTree/js/jquery.ztree.all","jquery.caret":"components/caret/dist/jquery.caret-1.5.2","jquery.scrollTo":"components/jquery.scrollTo/jquery.scrollTo","jquery.imageCropper":"components/cropper/dist/cropper","jquery.dotdotdot":"components/jquery.dotdotdot/src/jquery.dotdotdot","jquery.validate":"widget/validate/validate","jquery.datepicker":"widget/datepicker/datepicker","jquery.iframeTransport":"widget/iframeTransport/jquery.iframe-transport","es5-shim":"components/es5-shim/es5-shim","store-js":"components/store-js/store",imagesloaded:"components/imagesloaded/imagesloaded",ResizeSensor:"components/css-element-queries/src/ResizeSensor"}},shim:{bas64:{exports:"base64"},kindEditor:{exports:"KindEditor"},"es5-shim":{exports:"es5"},qrcode:{exports:"QRCode"}},waitSeconds:15})}(),define("requireConfig",function(){}),function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function n(e){var t=e.length,n=ae.type(e);return"function"===n||ae.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function i(e,t,n){if(ae.isFunction(t))return ae.grep(e,function(e,i){return!!t.call(e,i,e)!==n});if(t.nodeType)return ae.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(pe.test(t))return ae.filter(t,e,n);t=ae.filter(t,e)}return ae.grep(e,function(e){return ae.inArray(e,t)>=0!==n})}function a(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function r(e){var t=be[e]={};return ae.each(e.match(ye)||[],function(e,n){t[n]=!0}),t}function s(){fe.addEventListener?(fe.removeEventListener("DOMContentLoaded",o,!1),e.removeEventListener("load",o,!1)):(fe.detachEvent("onreadystatechange",o),e.detachEvent("onload",o))}function o(){(fe.addEventListener||"load"===event.type||"complete"===fe.readyState)&&(s(),ae.ready())}function l(e,t,n){if(void 0===n&&1===e.nodeType){var i="data-"+t.replace(xe,"-$1").toLowerCase();if(n=e.getAttribute(i),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:Le.test(n)?ae.parseJSON(n):n}catch(a){}ae.data(e,t,n)}else n=void 0}return n}function c(e){var t;for(t in e)if(("data"!==t||!ae.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function d(e,t,n,i){if(ae.acceptData(e)){var a,r,s=ae.expando,o=e.nodeType,l=o?ae.cache:e,c=o?e[s]:e[s]&&s;if(c&&l[c]&&(i||l[c].data)||void 0!==n||"string"!=typeof t)return c||(c=o?e[s]=$.pop()||ae.guid++:s),l[c]||(l[c]=o?{}:{toJSON:ae.noop}),("object"==typeof t||"function"==typeof t)&&(i?l[c]=ae.extend(l[c],t):l[c].data=ae.extend(l[c].data,t)),r=l[c],i||(r.data||(r.data={}),r=r.data),void 0!==n&&(r[ae.camelCase(t)]=n),"string"==typeof t?(a=r[t],null==a&&(a=r[ae.camelCase(t)])):a=r,a}}function u(e,t,n){if(ae.acceptData(e)){var i,a,r=e.nodeType,s=r?ae.cache:e,o=r?e[ae.expando]:ae.expando;if(s[o]){if(t&&(i=n?s[o]:s[o].data)){ae.isArray(t)?t=t.concat(ae.map(t,ae.camelCase)):t in i?t=[t]:(t=ae.camelCase(t),t=t in i?[t]:t.split(" ")),a=t.length;for(;a--;)delete i[t[a]];if(n?!c(i):!ae.isEmptyObject(i))return}(n||(delete s[o].data,c(s[o])))&&(r?ae.cleanData([e],!0):ne.deleteExpando||s!=s.window?delete s[o]:s[o]=null)}}}function p(){return!0}function h(){return!1}function f(){try{return fe.activeElement}catch(e){}}function m(e){var t=Fe.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function g(e,t){var n,i,a=0,r=typeof e.getElementsByTagName!==Te?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==Te?e.querySelectorAll(t||"*"):void 0;if(!r)for(r=[],n=e.childNodes||e;null!=(i=n[a]);a++)!t||ae.nodeName(i,t)?r.push(i):ae.merge(r,g(i,t));return void 0===t||t&&ae.nodeName(e,t)?ae.merge([e],r):r}function v(e){Ye.test(e.type)&&(e.defaultChecked=e.checked)}function _(e,t){return ae.nodeName(e,"table")&&ae.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function y(e){return e.type=(null!==ae.find.attr(e,"type"))+"/"+e.type,e}function b(e){var t=Qe.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function w(e,t){for(var n,i=0;null!=(n=e[i]);i++)ae._data(n,"globalEval",!t||ae._data(t[i],"globalEval"))}function M(e,t){if(1===t.nodeType&&ae.hasData(e)){var n,i,a,r=ae._data(e),s=ae._data(t,r),o=r.events;if(o){delete s.handle,s.events={};for(n in o)for(i=0,a=o[n].length;a>i;i++)ae.event.add(t,n,o[n][i])}s.data&&(s.data=ae.extend({},s.data))}}function T(e,t){var n,i,a;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!ne.noCloneEvent&&t[ae.expando]){a=ae._data(t);for(i in a.events)ae.removeEvent(t,i,a.handle);t.removeAttribute(ae.expando)}"script"===n&&t.text!==e.text?(y(t).text=e.text,b(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),ne.html5Clone&&e.innerHTML&&!ae.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Ye.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function L(t,n){var i,a=ae(n.createElement(t)).appendTo(n.body),r=e.getDefaultComputedStyle&&(i=e.getDefaultComputedStyle(a[0]))?i.display:ae.css(a[0],"display");return a.detach(),r}function x(e){var t=fe,n=Ve[e];return n||(n=L(e,t),"none"!==n&&n||(Ke=(Ke||ae("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(Ke[0].contentWindow||Ke[0].contentDocument).document,t.write(),t.close(),n=L(e,t),Ke.detach()),Ve[e]=n),n}function C(e,t){return{get:function(){var n=e();if(null!=n)return n?void delete this.get:(this.get=t).apply(this,arguments)}}}function S(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),i=t,a=pt.length;a--;)if(t=pt[a]+n,t in e)return t;return i}function k(e,t){for(var n,i,a,r=[],s=0,o=e.length;o>s;s++)i=e[s],i.style&&(r[s]=ae._data(i,"olddisplay"),n=i.style.display,t?(r[s]||"none"!==n||(i.style.display=""),""===i.style.display&&ke(i)&&(r[s]=ae._data(i,"olddisplay",x(i.nodeName)))):(a=ke(i),(n&&"none"!==n||!a)&&ae._data(i,"olddisplay",a?n:ae.css(i,"display"))));for(s=0;o>s;s++)i=e[s],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?r[s]||"":"none"));return e}function D(e,t,n){var i=lt.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function Y(e,t,n,i,a){for(var r=n===(i?"border":"content")?4:"width"===t?1:0,s=0;4>r;r+=2)"margin"===n&&(s+=ae.css(e,n+Se[r],!0,a)),i?("content"===n&&(s-=ae.css(e,"padding"+Se[r],!0,a)),"margin"!==n&&(s-=ae.css(e,"border"+Se[r]+"Width",!0,a))):(s+=ae.css(e,"padding"+Se[r],!0,a),"padding"!==n&&(s+=ae.css(e,"border"+Se[r]+"Width",!0,a)));return s}function j(e,t,n){var i=!0,a="width"===t?e.offsetWidth:e.offsetHeight,r=et(e),s=ne.boxSizing&&"border-box"===ae.css(e,"boxSizing",!1,r);if(0>=a||null==a){if(a=tt(e,t,r),(0>a||null==a)&&(a=e.style[t]),it.test(a))return a;i=s&&(ne.boxSizingReliable()||a===e.style[t]),a=parseFloat(a)||0}return a+Y(e,t,n||(s?"border":"content"),i,r)+"px"}function N(e,t,n,i,a){return new N.prototype.init(e,t,n,i,a)}function P(){return setTimeout(function(){ht=void 0}),ht=ae.now()}function E(e,t){var n,i={height:e},a=0;for(t=t?1:0;4>a;a+=2-t)n=Se[a],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function A(e,t,n){for(var i,a=(yt[t]||[]).concat(yt["*"]),r=0,s=a.length;s>r;r++)if(i=a[r].call(n,t,e))return i}function F(e,t,n){var i,a,r,s,o,l,c,d,u=this,p={},h=e.style,f=e.nodeType&&ke(e),m=ae._data(e,"fxshow");n.queue||(o=ae._queueHooks(e,"fx"),null==o.unqueued&&(o.unqueued=0,l=o.empty.fire,o.empty.fire=function(){o.unqueued||l()}),o.unqueued++,u.always(function(){u.always(function(){o.unqueued--,ae.queue(e,"fx").length||o.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],c=ae.css(e,"display"),d="none"===c?ae._data(e,"olddisplay")||x(e.nodeName):c,"inline"===d&&"none"===ae.css(e,"float")&&(ne.inlineBlockNeedsLayout&&"inline"!==x(e.nodeName)?h.zoom=1:h.display="inline-block")),n.overflow&&(h.overflow="hidden",ne.shrinkWrapBlocks()||u.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]}));for(i in t)if(a=t[i],mt.exec(a)){if(delete t[i],r=r||"toggle"===a,a===(f?"hide":"show")){if("show"!==a||!m||void 0===m[i])continue;f=!0}p[i]=m&&m[i]||ae.style(e,i)}else c=void 0;if(ae.isEmptyObject(p))"inline"===("none"===c?x(e.nodeName):c)&&(h.display=c);else{m?"hidden"in m&&(f=m.hidden):m=ae._data(e,"fxshow",{}),r&&(m.hidden=!f),f?ae(e).show():u.done(function(){ae(e).hide()}),u.done(function(){var t;ae._removeData(e,"fxshow");for(t in p)ae.style(e,t,p[t])});for(i in p)s=A(f?m[i]:0,i,u),i in m||(m[i]=s.start,f&&(s.end=s.start,s.start="width"===i||"height"===i?1:0))}}function I(e,t){var n,i,a,r,s;for(n in e)if(i=ae.camelCase(n),a=t[i],r=e[n],ae.isArray(r)&&(a=r[1],r=e[n]=r[0]),n!==i&&(e[i]=r,delete e[n]),s=ae.cssHooks[i],s&&"expand"in s){r=s.expand(r),delete e[i];for(n in r)n in e||(e[n]=r[n],t[n]=a)}else t[i]=a}function H(e,t,n){var i,a,r=0,s=_t.length,o=ae.Deferred().always(function(){delete l.elem}),l=function(){if(a)return!1;for(var t=ht||P(),n=Math.max(0,c.startTime+c.duration-t),i=n/c.duration||0,r=1-i,s=0,l=c.tweens.length;l>s;s++)c.tweens[s].run(r);return o.notifyWith(e,[c,r,n]),1>r&&l?n:(o.resolveWith(e,[c]),!1)},c=o.promise({elem:e,props:ae.extend({},t),opts:ae.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:ht||P(),duration:n.duration,tweens:[],createTween:function(t,n){var i=ae.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(i),i},stop:function(t){var n=0,i=t?c.tweens.length:0;if(a)return this;for(a=!0;i>n;n++)c.tweens[n].run(1);return t?o.resolveWith(e,[c,t]):o.rejectWith(e,[c,t]),this}}),d=c.props;for(I(d,c.opts.specialEasing);s>r;r++)if(i=_t[r].call(c,e,d,c.opts))return i;return ae.map(d,A,c),ae.isFunction(c.opts.start)&&c.opts.start.call(e,c),ae.fx.timer(ae.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function Z(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,a=0,r=t.toLowerCase().match(ye)||[];if(ae.isFunction(n))for(;i=r[a++];)"+"===i.charAt(0)?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function R(e,t,n,i){function a(o){var l;return r[o]=!0,ae.each(e[o]||[],function(e,o){var c=o(t,n,i);return"string"!=typeof c||s||r[c]?s?!(l=c):void 0:(t.dataTypes.unshift(c),a(c),!1)}),l}var r={},s=e===Jt;return a(t.dataTypes[0])||!r["*"]&&a("*")}function O(e,t){var n,i,a=ae.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((a[i]?e:n||(n={}))[i]=t[i]);return n&&ae.extend(!0,e,n),e}function X(e,t,n){for(var i,a,r,s,o=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===a&&(a=e.mimeType||t.getResponseHeader("Content-Type"));if(a)for(s in o)if(o[s]&&o[s].test(a)){l.unshift(s);break}if(l[0]in n)r=l[0];else{for(s in n){if(!l[0]||e.converters[s+" "+l[0]]){r=s;break}i||(i=s)}r=r||i}return r?(r!==l[0]&&l.unshift(r),n[r]):void 0}function J(e,t,n,i){var a,r,s,o,l,c={},d=e.dataTypes.slice();if(d[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];for(r=d.shift();r;)if(e.responseFields[r]&&(n[e.responseFields[r]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=r,r=d.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(s=c[l+" "+r]||c["* "+r],!s)for(a in c)if(o=a.split(" "),o[1]===r&&(s=c[l+" "+o[0]]||c["* "+o[0]])){s===!0?s=c[a]:c[a]!==!0&&(r=o[0],d.unshift(o[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(u){return{state:"parsererror",error:s?u:"No conversion from "+l+" to "+r}}}return{state:"success",data:t}}function B(e,t,n,i){var a;if(ae.isArray(t))ae.each(t,function(t,a){n||Qt.test(e)?i(e,a):B(e+"["+("object"==typeof a?t:"")+"]",a,n,i)});else if(n||"object"!==ae.type(t))i(e,t);else for(a in t)B(e+"["+a+"]",t[a],n,i)}function W(){try{return new e.XMLHttpRequest}catch(t){}}function q(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Q(e){return ae.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var $=[],z=$.slice,U=$.concat,G=$.push,K=$.indexOf,V={},ee=V.toString,te=V.hasOwnProperty,ne={},ie=".",ae=function(e,t){return new ae.fn.init(e,t)},re=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,se=/^-ms-/,oe=/-([\da-z])/gi,le=function(e,t){return t.toUpperCase()};ae.fn=ae.prototype={jquery:ie,constructor:ae,selector:"",length:0,toArray:function(){return z.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:z.call(this)},pushStack:function(e){var t=ae.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return ae.each(this,e,t)},map:function(e){return this.pushStack(ae.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(z.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:G,sort:$.sort,splice:$.splice},ae.extend=ae.fn.extend=function(){var e,t,n,i,a,r,s=arguments[0]||{},o=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[o]||{},o++),"object"==typeof s||ae.isFunction(s)||(s={}),o===l&&(s=this,o--);l>o;o++)if(null!=(a=arguments[o]))for(i in a)e=s[i],n=a[i],s!==n&&(c&&n&&(ae.isPlainObject(n)||(t=ae.isArray(n)))?(t?(t=!1,r=e&&ae.isArray(e)?e:[]):r=e&&ae.isPlainObject(e)?e:{},s[i]=ae.extend(c,r,n)):void 0!==n&&(s[i]=n));return s},ae.extend({expando:"jQuery"+(ie+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===ae.type(e)},isArray:Array.isArray||function(e){return"array"===ae.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!ae.isArray(e)&&e-parseFloat(e)>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==ae.type(e)||e.nodeType||ae.isWindow(e))return!1;try{if(e.constructor&&!te.call(e,"constructor")&&!te.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(ne.ownLast)for(t in e)return te.call(e,t);for(t in e);return void 0===t||te.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?V[ee.call(e)]||"object":typeof e},globalEval:function(t){t&&ae.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(se,"ms-").replace(oe,le)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var a,r=0,s=e.length,o=n(e);if(i){if(o)for(;s>r&&(a=t.apply(e[r],i),a!==!1);r++);else for(r in e)if(a=t.apply(e[r],i),a===!1)break}else if(o)for(;s>r&&(a=t.call(e[r],r,e[r]),a!==!1);r++);else for(r in e)if(a=t.call(e[r],r,e[r]),a===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(re,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(n(Object(e))?ae.merge(i,"string"==typeof e?[e]:e):G.call(i,e)),i},inArray:function(e,t,n){var i;if(t){if(K)return K.call(t,e,n);for(i=t.length,n=n?0>n?Math.max(0,i+n):n:0;i>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){for(var n=+t.length,i=0,a=e.length;n>i;)e[a++]=t[i++];if(n!==n)for(;void 0!==t[i];)e[a++]=t[i++];return e.length=a,e},grep:function(e,t,n){for(var i,a=[],r=0,s=e.length,o=!n;s>r;r++)i=!t(e[r],r),i!==o&&a.push(e[r]);return a},map:function(e,t,i){var a,r=0,s=e.length,o=n(e),l=[];if(o)for(;s>r;r++)a=t(e[r],r,i),null!=a&&l.push(a);else for(r in e)a=t(e[r],r,i),null!=a&&l.push(a);return U.apply([],l)},guid:1,proxy:function(e,t){var n,i,a;return"string"==typeof t&&(a=e[t],t=e,e=a),ae.isFunction(e)?(n=z.call(arguments,2),i=function(){return e.apply(t||this,n.concat(z.call(arguments)))},i.guid=e.guid=e.guid||ae.guid++,i):void 0},now:function(){return+new Date},support:ne}),ae.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){V["[object "+t+"]"]=t.toLowerCase()});var ce=function(e){function t(e,t,n,i){var a,r,s,o,l,c,u,h,f,m;if((t?t.ownerDocument||t:R)!==N&&j(t),t=t||N,n=n||[],!e||"string"!=typeof e)return n;if(1!==(o=t.nodeType)&&9!==o)return[];if(E&&!i){if(a=_e.exec(e))if(s=a[1]){if(9===o){if(r=t.getElementById(s),!r||!r.parentNode)return n;if(r.id===s)return n.push(r),n}else if(t.ownerDocument&&(r=t.ownerDocument.getElementById(s))&&H(t,r)&&r.id===s)return n.push(r),n}else{if(a[2])return V.apply(n,t.getElementsByTagName(e)),n;if((s=a[3])&&w.getElementsByClassName&&t.getElementsByClassName)return V.apply(n,t.getElementsByClassName(s)),n}if(w.qsa&&(!A||!A.test(e))){if(h=u=Z,f=t,m=9===o&&e,1===o&&"object"!==t.nodeName.toLowerCase()){for(c=x(e),(u=t.getAttribute("id"))?h=u.replace(be,"\\$&"):t.setAttribute("id",h),h="[id='"+h+"'] ",l=c.length;l--;)c[l]=h+p(c[l]);f=ye.test(e)&&d(t.parentNode)||t,m=c.join(",")}if(m)try{return V.apply(n,f.querySelectorAll(m)),n}catch(g){}finally{u||t.removeAttribute("id")}}}return S(e.replace(le,"$1"),t,n,i)}function n(){function e(n,i){return t.push(n+" ")>M.cacheLength&&delete e[t.shift()],e[n+" "]=i}var t=[];return e}function i(e){return e[Z]=!0,e}function a(e){var t=N.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function r(e,t){for(var n=e.split("|"),i=e.length;i--;)M.attrHandle[n[i]]=t}function s(e,t){var n=t&&e,i=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||$)-(~e.sourceIndex||$);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function o(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function l(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function c(e){return i(function(t){return t=+t,i(function(n,i){for(var a,r=e([],n.length,t),s=r.length;s--;)n[a=r[s]]&&(n[a]=!(i[a]=n[a]))})})}function d(e){return e&&typeof e.getElementsByTagName!==Q&&e}function u(){}function p(e){for(var t=0,n=e.length,i="";n>t;t++)i+=e[t].value;return i}function h(e,t,n){var i=t.dir,a=n&&"parentNode"===i,r=X++;return t.first?function(t,n,r){for(;t=t[i];)if(1===t.nodeType||a)return e(t,n,r)}:function(t,n,s){var o,l,c=[O,r];if(s){for(;t=t[i];)if((1===t.nodeType||a)&&e(t,n,s))return!0}else for(;t=t[i];)if(1===t.nodeType||a){if(l=t[Z]||(t[Z]={}),(o=l[i])&&o[0]===O&&o[1]===r)return c[2]=o[2];if(l[i]=c,c[2]=e(t,n,s))return!0}}}function f(e){return e.length>1?function(t,n,i){for(var a=e.length;a--;)if(!e[a](t,n,i))return!1;return!0}:e[0]}function m(e,n,i){for(var a=0,r=n.length;r>a;a++)t(e,n[a],i);return i}function g(e,t,n,i,a){for(var r,s=[],o=0,l=e.length,c=null!=t;l>o;o++)(r=e[o])&&(!n||n(r,i,a))&&(s.push(r),c&&t.push(o));return s}function v(e,t,n,a,r,s){return a&&!a[Z]&&(a=v(a)),r&&!r[Z]&&(r=v(r,s)),i(function(i,s,o,l){var c,d,u,p=[],h=[],f=s.length,v=i||m(t||"*",o.nodeType?[o]:o,[]),_=!e||!i&&t?v:g(v,p,e,o,l),y=n?r||(i?e:f||a)?[]:s:_;if(n&&n(_,y,o,l),a)for(c=g(y,h),a(c,[],o,l),d=c.length;d--;)(u=c[d])&&(y[h[d]]=!(_[h[d]]=u));if(i){if(r||e){if(r){for(c=[],d=y.length;d--;)(u=y[d])&&c.push(_[d]=u);r(null,y=[],c,l)}for(d=y.length;d--;)(u=y[d])&&(c=r?te.call(i,u):p[d])>-1&&(i[c]=!(s[c]=u))}}else y=g(y===s?y.splice(f,y.length):y),r?r(null,s,y,l):V.apply(s,y)})}function _(e){for(var t,n,i,a=e.length,r=M.relative[e[0].type],s=r||M.relative[" "],o=r?1:0,l=h(function(e){return e===t},s,!0),c=h(function(e){return te.call(t,e)>-1},s,!0),d=[function(e,n,i){return!r&&(i||n!==k)||((t=n).nodeType?l(e,n,i):c(e,n,i))}];a>o;o++)if(n=M.relative[e[o].type])d=[h(f(d),n)];else{if(n=M.filter[e[o].type].apply(null,e[o].matches),n[Z]){for(i=++o;a>i&&!M.relative[e[i].type];i++);return v(o>1&&f(d),o>1&&p(e.slice(0,o-1).concat({value:" "===e[o-2].type?"*":""})).replace(le,"$1"),n,i>o&&_(e.slice(o,i)),a>i&&_(e=e.slice(i)),a>i&&p(e))}d.push(n)}return f(d)}function y(e,n){var a=n.length>0,r=e.length>0,s=function(i,s,o,l,c){var d,u,p,h=0,f="0",m=i&&[],v=[],_=k,y=i||r&&M.find.TAG("*",c),b=O+=null==_?1:Math.random()||.1,w=y.length;for(c&&(k=s!==N&&s);f!==w&&null!=(d=y[f]);f++){if(r&&d){for(u=0;p=e[u++];)if(p(d,s,o)){l.push(d);break}c&&(O=b)}a&&((d=!p&&d)&&h--,i&&m.push(d))}if(h+=f,a&&f!==h){for(u=0;p=n[u++];)p(m,v,s,o);if(i){if(h>0)for(;f--;)m[f]||v[f]||(v[f]=G.call(l));v=g(v)}V.apply(l,v),c&&!i&&v.length>0&&h+n.length>1&&t.uniqueSort(l)}return c&&(O=b,k=_),m};return a?i(s):s}var b,w,M,T,L,x,C,S,k,D,Y,j,N,P,E,A,F,I,H,Z="sizzle"+-new Date,R=e.document,O=0,X=0,J=n(),B=n(),W=n(),q=function(e,t){return e===t&&(Y=!0),0},Q="undefined",$=1<<31,z={}.hasOwnProperty,U=[],G=U.pop,K=U.push,V=U.push,ee=U.slice,te=U.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},ne="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",ae="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",re=ae.replace("w","w#"),se="\\["+ie+"*("+ae+")(?:"+ie+"*([*^$|!~]?=)"+ie+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ie+"*\\]",oe=":("+ae+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+se+")*)|.*)\\)|)",le=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),ce=new RegExp("^"+ie+"*,"+ie+"*"),de=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),ue=new RegExp("="+ie+"*([^\\]'\"]*?)"+ie+"*\\]","g"),pe=new RegExp(oe),he=new RegExp("^"+re+"$"),fe={ID:new RegExp("^#("+ae+")"),CLASS:new RegExp("^\\.("+ae+")"),TAG:new RegExp("^("+ae.replace("w","w*")+")"),ATTR:new RegExp("^"+se),PSEUDO:new RegExp("^"+oe),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+ne+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},me=/^(?:input|select|textarea|button)$/i,ge=/^h\d$/i,ve=/^[^{]+\{\s*\[native \w/,_e=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,be=/'|\\/g,we=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),Me=function(e,t,n){var i="0x"+t-65536;return i!==i||n?t:0>i?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)};try{V.apply(U=ee.call(R.childNodes),R.childNodes),U[R.childNodes.length].nodeType}catch(Te){V={apply:U.length?function(e,t){K.apply(e,ee.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}w=t.support={},L=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},j=t.setDocument=function(e){var t,n=e?e.ownerDocument||e:R,i=n.defaultView;return n!==N&&9===n.nodeType&&n.documentElement?(N=n,P=n.documentElement,E=!L(n),i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",function(){j()},!1):i.attachEvent&&i.attachEvent("onunload",function(){j()})),w.attributes=a(function(e){return e.className="i",!e.getAttribute("className")}),w.getElementsByTagName=a(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),w.getElementsByClassName=ve.test(n.getElementsByClassName)&&a(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),w.getById=a(function(e){return P.appendChild(e).id=Z,!n.getElementsByName||!n.getElementsByName(Z).length}),w.getById?(M.find.ID=function(e,t){if(typeof t.getElementById!==Q&&E){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},M.filter.ID=function(e){var t=e.replace(we,Me);return function(e){return e.getAttribute("id")===t}}):(delete M.find.ID,M.filter.ID=function(e){var t=e.replace(we,Me);return function(e){var n=typeof e.getAttributeNode!==Q&&e.getAttributeNode("id");return n&&n.value===t}}),M.find.TAG=w.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==Q?t.getElementsByTagName(e):void 0}:function(e,t){var n,i=[],a=0,r=t.getElementsByTagName(e);if("*"===e){for(;n=r[a++];)1===n.nodeType&&i.push(n);return i}return r},M.find.CLASS=w.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==Q&&E?t.getElementsByClassName(e):void 0},F=[],A=[],(w.qsa=ve.test(n.querySelectorAll))&&(a(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&A.push("[*^$]="+ie+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||A.push("\\["+ie+"*(?:value|"+ne+")"),e.querySelectorAll(":checked").length||A.push(":checked")}),a(function(e){var t=n.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&A.push("name"+ie+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||A.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),A.push(",.*:")})),(w.matchesSelector=ve.test(I=P.matches||P.webkitMatchesSelector||P.mozMatchesSelector||P.oMatchesSelector||P.msMatchesSelector))&&a(function(e){w.disconnectedMatch=I.call(e,"div"),I.call(e,"[s!='']:x"),F.push("!=",oe)}),A=A.length&&new RegExp(A.join("|")),F=F.length&&new RegExp(F.join("|")),t=ve.test(P.compareDocumentPosition),H=t||ve.test(P.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},q=t?function(e,t){if(e===t)return Y=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i?i:(i=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&i||!w.sortDetached&&t.compareDocumentPosition(e)===i?e===n||e.ownerDocument===R&&H(R,e)?-1:t===n||t.ownerDocument===R&&H(R,t)?1:D?te.call(D,e)-te.call(D,t):0:4&i?-1:1)}:function(e,t){if(e===t)return Y=!0,0;var i,a=0,r=e.parentNode,o=t.parentNode,l=[e],c=[t];if(!r||!o)return e===n?-1:t===n?1:r?-1:o?1:D?te.call(D,e)-te.call(D,t):0;if(r===o)return s(e,t);for(i=e;i=i.parentNode;)l.unshift(i);for(i=t;i=i.parentNode;)c.unshift(i);for(;l[a]===c[a];)a++;return a?s(l[a],c[a]):l[a]===R?-1:c[a]===R?1:0},n):N},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==N&&j(e),n=n.replace(ue,"='$1']"),w.matchesSelector&&E&&(!F||!F.test(n))&&(!A||!A.test(n)))try{var i=I.call(e,n);if(i||w.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(a){}return t(n,N,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==N&&j(e),H(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==N&&j(e);var n=M.attrHandle[t.toLowerCase()],i=n&&z.call(M.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==i?i:w.attributes||!E?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],i=0,a=0;if(Y=!w.detectDuplicates,D=!w.sortStable&&e.slice(0),e.sort(q),Y){for(;t=e[a++];)t===e[a]&&(i=n.push(a));for(;i--;)e.splice(n[i],1)}return D=null,e},T=t.getText=function(e){var t,n="",i=0,a=e.nodeType;if(a){if(1===a||9===a||11===a){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=T(e)}else if(3===a||4===a)return e.nodeValue}else for(;t=e[i++];)n+=T(t);return n},M=t.selectors={cacheLength:50,createPseudo:i,match:fe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(we,Me),e[3]=(e[3]||e[4]||e[5]||"").replace(we,Me),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return fe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&pe.test(n)&&(t=x(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(we,Me).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=J[e+" "];return t||(t=new RegExp("(^|"+ie+")"+e+"("+ie+"|$)"))&&J(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==Q&&e.getAttribute("class")||"")})},ATTR:function(e,n,i){return function(a){var r=t.attr(a,e);return null==r?"!="===n:n?(r+="","="===n?r===i:"!="===n?r!==i:"^="===n?i&&0===r.indexOf(i):"*="===n?i&&r.indexOf(i)>-1:"$="===n?i&&r.slice(-i.length)===i:"~="===n?(" "+r+" ").indexOf(i)>-1:"|="===n?r===i||r.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(e,t,n,i,a){var r="nth"!==e.slice(0,3),s="last"!==e.slice(-4),o="of-type"===t;return 1===i&&0===a?function(e){return!!e.parentNode}:function(t,n,l){var c,d,u,p,h,f,m=r!==s?"nextSibling":"previousSibling",g=t.parentNode,v=o&&t.nodeName.toLowerCase(),_=!l&&!o;if(g){if(r){for(;m;){for(u=t;u=u[m];)if(o?u.nodeName.toLowerCase()===v:1===u.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?g.firstChild:g.lastChild],s&&_){for(d=g[Z]||(g[Z]={}),c=d[e]||[],h=c[0]===O&&c[1],p=c[0]===O&&c[2],u=h&&g.childNodes[h];u=++h&&u&&u[m]||(p=h=0)||f.pop();)if(1===u.nodeType&&++p&&u===t){d[e]=[O,h,p];break}}else if(_&&(c=(t[Z]||(t[Z]={}))[e])&&c[0]===O)p=c[1];else for(;(u=++h&&u&&u[m]||(p=h=0)||f.pop())&&((o?u.nodeName.toLowerCase()!==v:1!==u.nodeType)||!++p||(_&&((u[Z]||(u[Z]={}))[e]=[O,p]),u!==t)););return p-=a,p===i||p%i===0&&p/i>=0}}},PSEUDO:function(e,n){var a,r=M.pseudos[e]||M.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return r[Z]?r(n):r.length>1?(a=[e,e,"",n],M.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,t){for(var i,a=r(e,n),s=a.length;s--;)i=te.call(e,a[s]),e[i]=!(t[i]=a[s])}):function(e){return r(e,0,a)}):r}},pseudos:{not:i(function(e){var t=[],n=[],a=C(e.replace(le,"$1"));return a[Z]?i(function(e,t,n,i){for(var r,s=a(e,null,i,[]),o=e.length;o--;)(r=s[o])&&(e[o]=!(t[o]=r))}):function(e,i,r){return t[0]=e,a(t,null,r,n),!n.pop()}}),has:i(function(e){return function(n){return t(e,n).length>0}}),contains:i(function(e){return function(t){return(t.textContent||t.innerText||T(t)).indexOf(e)>-1}}),lang:i(function(e){return he.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(we,Me).toLowerCase(),function(t){var n;do if(n=E?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;
return n&&n.slice(1)===t.id},root:function(e){return e===P},focus:function(e){return e===N.activeElement&&(!N.hasFocus||N.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!M.pseudos.empty(e)},header:function(e){return ge.test(e.nodeName)},input:function(e){return me.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,n){return[0>n?n+t:n]}),even:c(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:c(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:c(function(e,t,n){for(var i=0>n?n+t:n;--i>=0;)e.push(i);return e}),gt:c(function(e,t,n){for(var i=0>n?n+t:n;++i<t;)e.push(i);return e})}},M.pseudos.nth=M.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})M.pseudos[b]=o(b);for(b in{submit:!0,reset:!0})M.pseudos[b]=l(b);return u.prototype=M.filters=M.pseudos,M.setFilters=new u,x=t.tokenize=function(e,n){var i,a,r,s,o,l,c,d=B[e+" "];if(d)return n?0:d.slice(0);for(o=e,l=[],c=M.preFilter;o;){(!i||(a=ce.exec(o)))&&(a&&(o=o.slice(a[0].length)||o),l.push(r=[])),i=!1,(a=de.exec(o))&&(i=a.shift(),r.push({value:i,type:a[0].replace(le," ")}),o=o.slice(i.length));for(s in M.filter)!(a=fe[s].exec(o))||c[s]&&!(a=c[s](a))||(i=a.shift(),r.push({value:i,type:s,matches:a}),o=o.slice(i.length));if(!i)break}return n?o.length:o?t.error(e):B(e,l).slice(0)},C=t.compile=function(e,t){var n,i=[],a=[],r=W[e+" "];if(!r){for(t||(t=x(e)),n=t.length;n--;)r=_(t[n]),r[Z]?i.push(r):a.push(r);r=W(e,y(a,i)),r.selector=e}return r},S=t.select=function(e,t,n,i){var a,r,s,o,l,c="function"==typeof e&&e,u=!i&&x(e=c.selector||e);if(n=n||[],1===u.length){if(r=u[0]=u[0].slice(0),r.length>2&&"ID"===(s=r[0]).type&&w.getById&&9===t.nodeType&&E&&M.relative[r[1].type]){if(t=(M.find.ID(s.matches[0].replace(we,Me),t)||[])[0],!t)return n;c&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(a=fe.needsContext.test(e)?0:r.length;a--&&(s=r[a],!M.relative[o=s.type]);)if((l=M.find[o])&&(i=l(s.matches[0].replace(we,Me),ye.test(r[0].type)&&d(t.parentNode)||t))){if(r.splice(a,1),e=i.length&&p(r),!e)return V.apply(n,i),n;break}}return(c||C(e,u))(i,t,!E,n,ye.test(e)&&d(t.parentNode)||t),n},w.sortStable=Z.split("").sort(q).join("")===Z,w.detectDuplicates=!!Y,j(),w.sortDetached=a(function(e){return 1&e.compareDocumentPosition(N.createElement("div"))}),a(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||r("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),w.attributes&&a(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||r("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),a(function(e){return null==e.getAttribute("disabled")})||r(ne,function(e,t,n){var i;return n?void 0:e[t]===!0?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),t}(e);ae.find=ce,ae.expr=ce.selectors,ae.expr[":"]=ae.expr.pseudos,ae.unique=ce.uniqueSort,ae.text=ce.getText,ae.isXMLDoc=ce.isXML,ae.contains=ce.contains;var de=ae.expr.match.needsContext,ue=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,pe=/^.[^:#\[\.,]*$/;ae.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?ae.find.matchesSelector(i,e)?[i]:[]:ae.find.matches(e,ae.grep(t,function(e){return 1===e.nodeType}))},ae.fn.extend({find:function(e){var t,n=[],i=this,a=i.length;if("string"!=typeof e)return this.pushStack(ae(e).filter(function(){for(t=0;a>t;t++)if(ae.contains(i[t],this))return!0}));for(t=0;a>t;t++)ae.find(e,i[t],n);return n=this.pushStack(a>1?ae.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(i(this,e||[],!1))},not:function(e){return this.pushStack(i(this,e||[],!0))},is:function(e){return!!i(this,"string"==typeof e&&de.test(e)?ae(e):e||[],!1).length}});var he,fe=e.document,me=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ge=ae.fn.init=function(e,t){var n,i;if(!e)return this;if("string"==typeof e){if(n="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:me.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||he).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof ae?t[0]:t,ae.merge(this,ae.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:fe,!0)),ue.test(n[1])&&ae.isPlainObject(t))for(n in t)ae.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}if(i=fe.getElementById(n[2]),i&&i.parentNode){if(i.id!==n[2])return he.find(e);this.length=1,this[0]=i}return this.context=fe,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):ae.isFunction(e)?"undefined"!=typeof he.ready?he.ready(e):e(ae):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),ae.makeArray(e,this))};ge.prototype=ae.fn,he=ae(fe);var ve=/^(?:parents|prev(?:Until|All))/,_e={children:!0,contents:!0,next:!0,prev:!0};ae.extend({dir:function(e,t,n){for(var i=[],a=e[t];a&&9!==a.nodeType&&(void 0===n||1!==a.nodeType||!ae(a).is(n));)1===a.nodeType&&i.push(a),a=a[t];return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),ae.fn.extend({has:function(e){var t,n=ae(e,this),i=n.length;return this.filter(function(){for(t=0;i>t;t++)if(ae.contains(this,n[t]))return!0})},closest:function(e,t){for(var n,i=0,a=this.length,r=[],s=de.test(e)||"string"!=typeof e?ae(e,t||this.context):0;a>i;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&ae.find.matchesSelector(n,e))){r.push(n);break}return this.pushStack(r.length>1?ae.unique(r):r)},index:function(e){return e?"string"==typeof e?ae.inArray(this[0],ae(e)):ae.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ae.unique(ae.merge(this.get(),ae(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ae.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ae.dir(e,"parentNode")},parentsUntil:function(e,t,n){return ae.dir(e,"parentNode",n)},next:function(e){return a(e,"nextSibling")},prev:function(e){return a(e,"previousSibling")},nextAll:function(e){return ae.dir(e,"nextSibling")},prevAll:function(e){return ae.dir(e,"previousSibling")},nextUntil:function(e,t,n){return ae.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return ae.dir(e,"previousSibling",n)},siblings:function(e){return ae.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return ae.sibling(e.firstChild)},contents:function(e){return ae.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:ae.merge([],e.childNodes)}},function(e,t){ae.fn[e]=function(n,i){var a=ae.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(a=ae.filter(i,a)),this.length>1&&(_e[e]||(a=ae.unique(a)),ve.test(e)&&(a=a.reverse())),this.pushStack(a)}});var ye=/\S+/g,be={};ae.Callbacks=function(e){e="string"==typeof e?be[e]||r(e):ae.extend({},e);var t,n,i,a,s,o,l=[],c=!e.once&&[],d=function(r){for(n=e.memory&&r,i=!0,s=o||0,o=0,a=l.length,t=!0;l&&a>s;s++)if(l[s].apply(r[0],r[1])===!1&&e.stopOnFalse){n=!1;break}t=!1,l&&(c?c.length&&d(c.shift()):n?l=[]:u.disable())},u={add:function(){if(l){var i=l.length;!function r(t){ae.each(t,function(t,n){var i=ae.type(n);"function"===i?e.unique&&u.has(n)||l.push(n):n&&n.length&&"string"!==i&&r(n)})}(arguments),t?a=l.length:n&&(o=i,d(n))}return this},remove:function(){return l&&ae.each(arguments,function(e,n){for(var i;(i=ae.inArray(n,l,i))>-1;)l.splice(i,1),t&&(a>=i&&a--,s>=i&&s--)}),this},has:function(e){return e?ae.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],a=0,this},disable:function(){return l=c=n=void 0,this},disabled:function(){return!l},lock:function(){return c=void 0,n||u.disable(),this},locked:function(){return!c},fireWith:function(e,n){return!l||i&&!c||(n=n||[],n=[e,n.slice?n.slice():n],t?c.push(n):d(n)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!i}};return u},ae.extend({Deferred:function(e){var t=[["resolve","done",ae.Callbacks("once memory"),"resolved"],["reject","fail",ae.Callbacks("once memory"),"rejected"],["notify","progress",ae.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return a.done(arguments).fail(arguments),this},then:function(){var e=arguments;return ae.Deferred(function(n){ae.each(t,function(t,r){var s=ae.isFunction(e[t])&&e[t];a[r[1]](function(){var e=s&&s.apply(this,arguments);e&&ae.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[r[0]+"With"](this===i?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?ae.extend(e,i):i}},a={};return i.pipe=i.then,ae.each(t,function(e,r){var s=r[2],o=r[3];i[r[1]]=s.add,o&&s.add(function(){n=o},t[1^e][2].disable,t[2][2].lock),a[r[0]]=function(){return a[r[0]+"With"](this===a?i:this,arguments),this},a[r[0]+"With"]=s.fireWith}),i.promise(a),e&&e.call(a,a),a},when:function(e){var t,n,i,a=0,r=z.call(arguments),s=r.length,o=1!==s||e&&ae.isFunction(e.promise)?s:0,l=1===o?e:ae.Deferred(),c=function(e,n,i){return function(a){n[e]=this,i[e]=arguments.length>1?z.call(arguments):a,i===t?l.notifyWith(n,i):--o||l.resolveWith(n,i)}};if(s>1)for(t=new Array(s),n=new Array(s),i=new Array(s);s>a;a++)r[a]&&ae.isFunction(r[a].promise)?r[a].promise().done(c(a,i,r)).fail(l.reject).progress(c(a,n,t)):--o;return o||l.resolveWith(i,r),l.promise()}});var we;ae.fn.ready=function(e){return ae.ready.promise().done(e),this},ae.extend({isReady:!1,readyWait:1,holdReady:function(e){e?ae.readyWait++:ae.ready(!0)},ready:function(e){if(e===!0?!--ae.readyWait:!ae.isReady){if(!fe.body)return setTimeout(ae.ready);ae.isReady=!0,e!==!0&&--ae.readyWait>0||(we.resolveWith(fe,[ae]),ae.fn.triggerHandler&&(ae(fe).triggerHandler("ready"),ae(fe).off("ready")))}}}),ae.ready.promise=function(t){if(!we)if(we=ae.Deferred(),"complete"===fe.readyState)setTimeout(ae.ready);else if(fe.addEventListener)fe.addEventListener("DOMContentLoaded",o,!1),e.addEventListener("load",o,!1);else{fe.attachEvent("onreadystatechange",o),e.attachEvent("onload",o);var n=!1;try{n=null==e.frameElement&&fe.documentElement}catch(i){}n&&n.doScroll&&!function a(){if(!ae.isReady){try{n.doScroll("left")}catch(e){return setTimeout(a,50)}s(),ae.ready()}}()}return we.promise(t)};var Me,Te="undefined";for(Me in ae(ne))break;ne.ownLast="0"!==Me,ne.inlineBlockNeedsLayout=!1,ae(function(){var e,t,n,i;n=fe.getElementsByTagName("body")[0],n&&n.style&&(t=fe.createElement("div"),i=fe.createElement("div"),i.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(i).appendChild(t),typeof t.style.zoom!==Te&&(t.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",ne.inlineBlockNeedsLayout=e=3===t.offsetWidth,e&&(n.style.zoom=1)),n.removeChild(i))}),function(){var e=fe.createElement("div");if(null==ne.deleteExpando){ne.deleteExpando=!0;try{delete e.test}catch(t){ne.deleteExpando=!1}}e=null}(),ae.acceptData=function(e){var t=ae.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return 1!==n&&9!==n?!1:!t||t!==!0&&e.getAttribute("classid")===t};var Le=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,xe=/([A-Z])/g;ae.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?ae.cache[e[ae.expando]]:e[ae.expando],!!e&&!c(e)},data:function(e,t,n){return d(e,t,n)},removeData:function(e,t){return u(e,t)},_data:function(e,t,n){return d(e,t,n,!0)},_removeData:function(e,t){return u(e,t,!0)}}),ae.fn.extend({data:function(e,t){var n,i,a,r=this[0],s=r&&r.attributes;if(void 0===e){if(this.length&&(a=ae.data(r),1===r.nodeType&&!ae._data(r,"parsedAttrs"))){for(n=s.length;n--;)s[n]&&(i=s[n].name,0===i.indexOf("data-")&&(i=ae.camelCase(i.slice(5)),l(r,i,a[i])));ae._data(r,"parsedAttrs",!0)}return a}return"object"==typeof e?this.each(function(){ae.data(this,e)}):arguments.length>1?this.each(function(){ae.data(this,e,t)}):r?l(r,e,ae.data(r,e)):void 0},removeData:function(e){return this.each(function(){ae.removeData(this,e)})}}),ae.extend({queue:function(e,t,n){var i;return e?(t=(t||"fx")+"queue",i=ae._data(e,t),n&&(!i||ae.isArray(n)?i=ae._data(e,t,ae.makeArray(n)):i.push(n)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=ae.queue(e,t),i=n.length,a=n.shift(),r=ae._queueHooks(e,t),s=function(){ae.dequeue(e,t)};"inprogress"===a&&(a=n.shift(),i--),a&&("fx"===t&&n.unshift("inprogress"),delete r.stop,a.call(e,s,r)),!i&&r&&r.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return ae._data(e,n)||ae._data(e,n,{empty:ae.Callbacks("once memory").add(function(){ae._removeData(e,t+"queue"),ae._removeData(e,n)})})}}),ae.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?ae.queue(this[0],e):void 0===t?this:this.each(function(){var n=ae.queue(this,e,t);ae._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&ae.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ae.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,a=ae.Deferred(),r=this,s=this.length,o=function(){--i||a.resolveWith(r,[r])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)n=ae._data(r[s],e+"queueHooks"),n&&n.empty&&(i++,n.empty.add(o));return o(),a.promise(t)}});var Ce=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Se=["Top","Right","Bottom","Left"],ke=function(e,t){return e=t||e,"none"===ae.css(e,"display")||!ae.contains(e.ownerDocument,e)},De=ae.access=function(e,t,n,i,a,r,s){var o=0,l=e.length,c=null==n;if("object"===ae.type(n)){a=!0;for(o in n)ae.access(e,t,o,n[o],!0,r,s)}else if(void 0!==i&&(a=!0,ae.isFunction(i)||(s=!0),c&&(s?(t.call(e,i),t=null):(c=t,t=function(e,t,n){return c.call(ae(e),n)})),t))for(;l>o;o++)t(e[o],n,s?i:i.call(e[o],o,t(e[o],n)));return a?e:c?t.call(e):l?t(e[0],n):r},Ye=/^(?:checkbox|radio)$/i;!function(){var e=fe.createElement("input"),t=fe.createElement("div"),n=fe.createDocumentFragment();if(t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",ne.leadingWhitespace=3===t.firstChild.nodeType,ne.tbody=!t.getElementsByTagName("tbody").length,ne.htmlSerialize=!!t.getElementsByTagName("link").length,ne.html5Clone="<:nav></:nav>"!==fe.createElement("nav").cloneNode(!0).outerHTML,e.type="checkbox",e.checked=!0,n.appendChild(e),ne.appendChecked=e.checked,t.innerHTML="<textarea>x</textarea>",ne.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,n.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",ne.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,ne.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){ne.noCloneEvent=!1}),t.cloneNode(!0).click()),null==ne.deleteExpando){ne.deleteExpando=!0;try{delete t.test}catch(i){ne.deleteExpando=!1}}}(),function(){var t,n,i=fe.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(ne[t+"Bubbles"]=n in e)||(i.setAttribute(n,"t"),ne[t+"Bubbles"]=i.attributes[n].expando===!1);i=null}();var je=/^(?:input|select|textarea)$/i,Ne=/^key/,Pe=/^(?:mouse|pointer|contextmenu)|click/,Ee=/^(?:focusinfocus|focusoutblur)$/,Ae=/^([^.]*)(?:\.(.+)|)$/;ae.event={global:{},add:function(e,t,n,i,a){var r,s,o,l,c,d,u,p,h,f,m,g=ae._data(e);if(g){for(n.handler&&(l=n,n=l.handler,a=l.selector),n.guid||(n.guid=ae.guid++),(s=g.events)||(s=g.events={}),(d=g.handle)||(d=g.handle=function(e){return typeof ae===Te||e&&ae.event.triggered===e.type?void 0:ae.event.dispatch.apply(d.elem,arguments)},d.elem=e),t=(t||"").match(ye)||[""],o=t.length;o--;)r=Ae.exec(t[o])||[],h=m=r[1],f=(r[2]||"").split(".").sort(),h&&(c=ae.event.special[h]||{},h=(a?c.delegateType:c.bindType)||h,c=ae.event.special[h]||{},u=ae.extend({type:h,origType:m,data:i,handler:n,guid:n.guid,selector:a,needsContext:a&&ae.expr.match.needsContext.test(a),namespace:f.join(".")},l),(p=s[h])||(p=s[h]=[],p.delegateCount=0,c.setup&&c.setup.call(e,i,f,d)!==!1||(e.addEventListener?e.addEventListener(h,d,!1):e.attachEvent&&e.attachEvent("on"+h,d))),c.add&&(c.add.call(e,u),u.handler.guid||(u.handler.guid=n.guid)),a?p.splice(p.delegateCount++,0,u):p.push(u),ae.event.global[h]=!0);e=null}},remove:function(e,t,n,i,a){var r,s,o,l,c,d,u,p,h,f,m,g=ae.hasData(e)&&ae._data(e);if(g&&(d=g.events)){for(t=(t||"").match(ye)||[""],c=t.length;c--;)if(o=Ae.exec(t[c])||[],h=m=o[1],f=(o[2]||"").split(".").sort(),h){for(u=ae.event.special[h]||{},h=(i?u.delegateType:u.bindType)||h,p=d[h]||[],o=o[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=r=p.length;r--;)s=p[r],!a&&m!==s.origType||n&&n.guid!==s.guid||o&&!o.test(s.namespace)||i&&i!==s.selector&&("**"!==i||!s.selector)||(p.splice(r,1),s.selector&&p.delegateCount--,u.remove&&u.remove.call(e,s));l&&!p.length&&(u.teardown&&u.teardown.call(e,f,g.handle)!==!1||ae.removeEvent(e,h,g.handle),delete d[h])}else for(h in d)ae.event.remove(e,h+t[c],n,i,!0);ae.isEmptyObject(d)&&(delete g.handle,ae._removeData(e,"events"))}},trigger:function(t,n,i,a){var r,s,o,l,c,d,u,p=[i||fe],h=te.call(t,"type")?t.type:t,f=te.call(t,"namespace")?t.namespace.split("."):[];if(o=d=i=i||fe,3!==i.nodeType&&8!==i.nodeType&&!Ee.test(h+ae.event.triggered)&&(h.indexOf(".")>=0&&(f=h.split("."),h=f.shift(),f.sort()),s=h.indexOf(":")<0&&"on"+h,t=t[ae.expando]?t:new ae.Event(h,"object"==typeof t&&t),t.isTrigger=a?2:3,t.namespace=f.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:ae.makeArray(n,[t]),c=ae.event.special[h]||{},a||!c.trigger||c.trigger.apply(i,n)!==!1)){if(!a&&!c.noBubble&&!ae.isWindow(i)){for(l=c.delegateType||h,Ee.test(l+h)||(o=o.parentNode);o;o=o.parentNode)p.push(o),d=o;d===(i.ownerDocument||fe)&&p.push(d.defaultView||d.parentWindow||e)}for(u=0;(o=p[u++])&&!t.isPropagationStopped();)t.type=u>1?l:c.bindType||h,r=(ae._data(o,"events")||{})[t.type]&&ae._data(o,"handle"),r&&r.apply(o,n),r=s&&o[s],r&&r.apply&&ae.acceptData(o)&&(t.result=r.apply(o,n),t.result===!1&&t.preventDefault());if(t.type=h,!a&&!t.isDefaultPrevented()&&(!c._default||c._default.apply(p.pop(),n)===!1)&&ae.acceptData(i)&&s&&i[h]&&!ae.isWindow(i)){d=i[s],d&&(i[s]=null),ae.event.triggered=h;try{i[h]()}catch(m){}ae.event.triggered=void 0,d&&(i[s]=d)}return t.result}},dispatch:function(e){e=ae.event.fix(e);var t,n,i,a,r,s=[],o=z.call(arguments),l=(ae._data(this,"events")||{})[e.type]||[],c=ae.event.special[e.type]||{};if(o[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=ae.event.handlers.call(this,e,l),t=0;(a=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=a.elem,r=0;(i=a.handlers[r++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,n=((ae.event.special[i.origType]||{}).handle||i.handler).apply(a.elem,o),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,i,a,r,s=[],o=t.delegateCount,l=e.target;if(o&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(a=[],r=0;o>r;r++)i=t[r],n=i.selector+" ",void 0===a[n]&&(a[n]=i.needsContext?ae(n,this).index(l)>=0:ae.find(n,this,null,[l]).length),a[n]&&a.push(i);a.length&&s.push({elem:l,handlers:a})}return o<t.length&&s.push({elem:this,handlers:t.slice(o)}),s},fix:function(e){if(e[ae.expando])return e;var t,n,i,a=e.type,r=e,s=this.fixHooks[a];for(s||(this.fixHooks[a]=s=Pe.test(a)?this.mouseHooks:Ne.test(a)?this.keyHooks:{}),i=s.props?this.props.concat(s.props):this.props,e=new ae.Event(r),t=i.length;t--;)n=i[t],e[n]=r[n];return e.target||(e.target=r.srcElement||fe),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,i,a,r=t.button,s=t.fromElement;return null==e.pageX&&null!=t.clientX&&(i=e.target.ownerDocument||fe,a=i.documentElement,n=i.body,e.pageX=t.clientX+(a&&a.scrollLeft||n&&n.scrollLeft||0)-(a&&a.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(a&&a.scrollTop||n&&n.scrollTop||0)-(a&&a.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?t.toElement:s),e.which||void 0===r||(e.which=1&r?1:2&r?3:4&r?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==f()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===f()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return ae.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return ae.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,i){var a=ae.extend(new ae.Event,n,{type:e,isSimulated:!0,originalEvent:{}});i?ae.event.trigger(a,null,t):ae.event.dispatch.call(t,a),a.isDefaultPrevented()&&n.preventDefault()}},ae.removeEvent=fe.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var i="on"+t;e.detachEvent&&(typeof e[i]===Te&&(e[i]=null),e.detachEvent(i,n))},ae.Event=function(e,t){return this instanceof ae.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?p:h):this.type=e,t&&ae.extend(this,t),this.timeStamp=e&&e.timeStamp||ae.now(),void(this[ae.expando]=!0)):new ae.Event(e,t)},ae.Event.prototype={isDefaultPrevented:h,isPropagationStopped:h,isImmediatePropagationStopped:h,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=p,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=p,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=p,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},ae.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){ae.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,a=e.relatedTarget,r=e.handleObj;return(!a||a!==i&&!ae.contains(i,a))&&(e.type=r.origType,n=r.handler.apply(this,arguments),e.type=t),n}}}),ne.submitBubbles||(ae.event.special.submit={setup:function(){return ae.nodeName(this,"form")?!1:void ae.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=ae.nodeName(t,"input")||ae.nodeName(t,"button")?t.form:void 0;n&&!ae._data(n,"submitBubbles")&&(ae.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),ae._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&ae.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return ae.nodeName(this,"form")?!1:void ae.event.remove(this,"._submit")}}),ne.changeBubbles||(ae.event.special.change={setup:function(){return je.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(ae.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),ae.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),ae.event.simulate("change",this,e,!0)})),!1):void ae.event.add(this,"beforeactivate._change",function(e){var t=e.target;je.test(t.nodeName)&&!ae._data(t,"changeBubbles")&&(ae.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||ae.event.simulate("change",this.parentNode,e,!0)}),ae._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return ae.event.remove(this,"._change"),!je.test(this.nodeName)}}),ne.focusinBubbles||ae.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){ae.event.simulate(t,e.target,ae.event.fix(e),!0)};ae.event.special[t]={setup:function(){var i=this.ownerDocument||this,a=ae._data(i,t);a||i.addEventListener(e,n,!0),ae._data(i,t,(a||0)+1)},teardown:function(){var i=this.ownerDocument||this,a=ae._data(i,t)-1;a?ae._data(i,t,a):(i.removeEventListener(e,n,!0),ae._removeData(i,t))}}}),ae.fn.extend({on:function(e,t,n,i,a){var r,s;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(r in e)this.on(r,t,n,e[r],a);return this}if(null==n&&null==i?(i=t,n=t=void 0):null==i&&("string"==typeof t?(i=n,n=void 0):(i=n,n=t,t=void 0)),i===!1)i=h;else if(!i)return this;return 1===a&&(s=i,i=function(e){return ae().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=ae.guid++)),this.each(function(){ae.event.add(this,e,i,n,t)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,t,n){var i,a;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,ae(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(a in e)this.off(a,t,e[a]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=h),this.each(function(){ae.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){ae.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?ae.event.trigger(e,t,n,!0):void 0}});var Fe="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Ie=/ jQuery\d+="(?:null|\d+)"/g,He=new RegExp("<(?:"+Fe+")[\\s/>]","i"),Ze=/^\s+/,Re=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Oe=/<([\w:]+)/,Xe=/<tbody/i,Je=/<|&#?\w+;/,Be=/<(?:script|style|link)/i,We=/checked\s*(?:[^=]|=\s*.checked.)/i,qe=/^$|\/(?:java|ecma)script/i,Qe=/^true\/(.*)/,$e=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ze={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ne.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Ue=m(fe),Ge=Ue.appendChild(fe.createElement("div"));ze.optgroup=ze.option,ze.tbody=ze.tfoot=ze.colgroup=ze.caption=ze.thead,ze.th=ze.td,ae.extend({clone:function(e,t,n){var i,a,r,s,o,l=ae.contains(e.ownerDocument,e);if(ne.html5Clone||ae.isXMLDoc(e)||!He.test("<"+e.nodeName+">")?r=e.cloneNode(!0):(Ge.innerHTML=e.outerHTML,Ge.removeChild(r=Ge.firstChild)),!(ne.noCloneEvent&&ne.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ae.isXMLDoc(e)))for(i=g(r),o=g(e),s=0;null!=(a=o[s]);++s)i[s]&&T(a,i[s]);if(t)if(n)for(o=o||g(e),i=i||g(r),s=0;null!=(a=o[s]);s++)M(a,i[s]);else M(e,r);return i=g(r,"script"),i.length>0&&w(i,!l&&g(e,"script")),i=o=a=null,r},buildFragment:function(e,t,n,i){for(var a,r,s,o,l,c,d,u=e.length,p=m(t),h=[],f=0;u>f;f++)if(r=e[f],r||0===r)if("object"===ae.type(r))ae.merge(h,r.nodeType?[r]:r);else if(Je.test(r)){for(o=o||p.appendChild(t.createElement("div")),l=(Oe.exec(r)||["",""])[1].toLowerCase(),d=ze[l]||ze._default,o.innerHTML=d[1]+r.replace(Re,"<$1></$2>")+d[2],a=d[0];a--;)o=o.lastChild;if(!ne.leadingWhitespace&&Ze.test(r)&&h.push(t.createTextNode(Ze.exec(r)[0])),!ne.tbody)for(r="table"!==l||Xe.test(r)?"<table>"!==d[1]||Xe.test(r)?0:o:o.firstChild,a=r&&r.childNodes.length;a--;)ae.nodeName(c=r.childNodes[a],"tbody")&&!c.childNodes.length&&r.removeChild(c);for(ae.merge(h,o.childNodes),o.textContent="";o.firstChild;)o.removeChild(o.firstChild);o=p.lastChild}else h.push(t.createTextNode(r));for(o&&p.removeChild(o),ne.appendChecked||ae.grep(g(h,"input"),v),f=0;r=h[f++];)if((!i||-1===ae.inArray(r,i))&&(s=ae.contains(r.ownerDocument,r),o=g(p.appendChild(r),"script"),s&&w(o),n))for(a=0;r=o[a++];)qe.test(r.type||"")&&n.push(r);return o=null,p},cleanData:function(e,t){for(var n,i,a,r,s=0,o=ae.expando,l=ae.cache,c=ne.deleteExpando,d=ae.event.special;null!=(n=e[s]);s++)if((t||ae.acceptData(n))&&(a=n[o],r=a&&l[a])){if(r.events)for(i in r.events)d[i]?ae.event.remove(n,i):ae.removeEvent(n,i,r.handle);l[a]&&(delete l[a],c?delete n[o]:typeof n.removeAttribute!==Te?n.removeAttribute(o):n[o]=null,$.push(a))}}}),ae.fn.extend({text:function(e){return De(this,function(e){return void 0===e?ae.text(this):this.empty().append((this[0]&&this[0].ownerDocument||fe).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=_(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=_(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,i=e?ae.filter(e,this):this,a=0;null!=(n=i[a]);a++)t||1!==n.nodeType||ae.cleanData(g(n)),n.parentNode&&(t&&ae.contains(n.ownerDocument,n)&&w(g(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&ae.cleanData(g(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&ae.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return ae.clone(this,e,t)})},html:function(e){return De(this,function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(Ie,""):void 0;if("string"==typeof e&&!Be.test(e)&&(ne.htmlSerialize||!He.test(e))&&(ne.leadingWhitespace||!Ze.test(e))&&!ze[(Oe.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Re,"<$1></$2>");try{for(;i>n;n++)t=this[n]||{},1===t.nodeType&&(ae.cleanData(g(t,!1)),t.innerHTML=e);t=0}catch(a){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,ae.cleanData(g(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=U.apply([],e);var n,i,a,r,s,o,l=0,c=this.length,d=this,u=c-1,p=e[0],h=ae.isFunction(p);if(h||c>1&&"string"==typeof p&&!ne.checkClone&&We.test(p))return this.each(function(n){var i=d.eq(n);h&&(e[0]=p.call(this,n,i.html())),i.domManip(e,t)});if(c&&(o=ae.buildFragment(e,this[0].ownerDocument,!1,this),
n=o.firstChild,1===o.childNodes.length&&(o=n),n)){for(r=ae.map(g(o,"script"),y),a=r.length;c>l;l++)i=o,l!==u&&(i=ae.clone(i,!0,!0),a&&ae.merge(r,g(i,"script"))),t.call(this[l],i,l);if(a)for(s=r[r.length-1].ownerDocument,ae.map(r,b),l=0;a>l;l++)i=r[l],qe.test(i.type||"")&&!ae._data(i,"globalEval")&&ae.contains(s,i)&&(i.src?ae._evalUrl&&ae._evalUrl(i.src):ae.globalEval((i.text||i.textContent||i.innerHTML||"").replace($e,"")));o=n=null}return this}}),ae.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ae.fn[e]=function(e){for(var n,i=0,a=[],r=ae(e),s=r.length-1;s>=i;i++)n=i===s?this:this.clone(!0),ae(r[i])[t](n),G.apply(a,n.get());return this.pushStack(a)}});var Ke,Ve={};!function(){var e;ne.shrinkWrapBlocks=function(){if(null!=e)return e;e=!1;var t,n,i;return n=fe.getElementsByTagName("body")[0],n&&n.style?(t=fe.createElement("div"),i=fe.createElement("div"),i.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(i).appendChild(t),typeof t.style.zoom!==Te&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(fe.createElement("div")).style.width="5px",e=3!==t.offsetWidth),n.removeChild(i),e):void 0}}();var et,tt,nt=/^margin/,it=new RegExp("^("+Ce+")(?!px)[a-z%]+$","i"),at=/^(top|right|bottom|left)$/;e.getComputedStyle?(et=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},tt=function(e,t,n){var i,a,r,s,o=e.style;return n=n||et(e),s=n?n.getPropertyValue(t)||n[t]:void 0,n&&(""!==s||ae.contains(e.ownerDocument,e)||(s=ae.style(e,t)),it.test(s)&&nt.test(t)&&(i=o.width,a=o.minWidth,r=o.maxWidth,o.minWidth=o.maxWidth=o.width=s,s=n.width,o.width=i,o.minWidth=a,o.maxWidth=r)),void 0===s?s:s+""}):fe.documentElement.currentStyle&&(et=function(e){return e.currentStyle},tt=function(e,t,n){var i,a,r,s,o=e.style;return n=n||et(e),s=n?n[t]:void 0,null==s&&o&&o[t]&&(s=o[t]),it.test(s)&&!at.test(t)&&(i=o.left,a=e.runtimeStyle,r=a&&a.left,r&&(a.left=e.currentStyle.left),o.left="fontSize"===t?"1em":s,s=o.pixelLeft+"px",o.left=i,r&&(a.left=r)),void 0===s?s:s+""||"auto"}),function(){function t(){var t,n,i,a;n=fe.getElementsByTagName("body")[0],n&&n.style&&(t=fe.createElement("div"),i=fe.createElement("div"),i.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(i).appendChild(t),t.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",r=s=!1,l=!0,e.getComputedStyle&&(r="1%"!==(e.getComputedStyle(t,null)||{}).top,s="4px"===(e.getComputedStyle(t,null)||{width:"4px"}).width,a=t.appendChild(fe.createElement("div")),a.style.cssText=t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",a.style.marginRight=a.style.width="0",t.style.width="1px",l=!parseFloat((e.getComputedStyle(a,null)||{}).marginRight)),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=t.getElementsByTagName("td"),a[0].style.cssText="margin:0;border:0;padding:0;display:none",o=0===a[0].offsetHeight,o&&(a[0].style.display="",a[1].style.display="none",o=0===a[0].offsetHeight),n.removeChild(i))}var n,i,a,r,s,o,l;n=fe.createElement("div"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=n.getElementsByTagName("a")[0],i=a&&a.style,i&&(i.cssText="float:left;opacity:.5",ne.opacity="0.5"===i.opacity,ne.cssFloat=!!i.cssFloat,n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",ne.clearCloneStyle="content-box"===n.style.backgroundClip,ne.boxSizing=""===i.boxSizing||""===i.MozBoxSizing||""===i.WebkitBoxSizing,ae.extend(ne,{reliableHiddenOffsets:function(){return null==o&&t(),o},boxSizingReliable:function(){return null==s&&t(),s},pixelPosition:function(){return null==r&&t(),r},reliableMarginRight:function(){return null==l&&t(),l}}))}(),ae.swap=function(e,t,n,i){var a,r,s={};for(r in t)s[r]=e.style[r],e.style[r]=t[r];a=n.apply(e,i||[]);for(r in t)e.style[r]=s[r];return a};var rt=/alpha\([^)]*\)/i,st=/opacity\s*=\s*([^)]*)/,ot=/^(none|table(?!-c[ea]).+)/,lt=new RegExp("^("+Ce+")(.*)$","i"),ct=new RegExp("^([+-])=("+Ce+")","i"),dt={position:"absolute",visibility:"hidden",display:"block"},ut={letterSpacing:"0",fontWeight:"400"},pt=["Webkit","O","Moz","ms"];ae.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=tt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ne.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,r,s,o=ae.camelCase(t),l=e.style;if(t=ae.cssProps[o]||(ae.cssProps[o]=S(l,o)),s=ae.cssHooks[t]||ae.cssHooks[o],void 0===n)return s&&"get"in s&&void 0!==(a=s.get(e,!1,i))?a:l[t];if(r=typeof n,"string"===r&&(a=ct.exec(n))&&(n=(a[1]+1)*a[2]+parseFloat(ae.css(e,t)),r="number"),null!=n&&n===n&&("number"!==r||ae.cssNumber[o]||(n+="px"),ne.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),!(s&&"set"in s&&void 0===(n=s.set(e,n,i)))))try{l[t]=n}catch(c){}}},css:function(e,t,n,i){var a,r,s,o=ae.camelCase(t);return t=ae.cssProps[o]||(ae.cssProps[o]=S(e.style,o)),s=ae.cssHooks[t]||ae.cssHooks[o],s&&"get"in s&&(r=s.get(e,!0,n)),void 0===r&&(r=tt(e,t,i)),"normal"===r&&t in ut&&(r=ut[t]),""===n||n?(a=parseFloat(r),n===!0||ae.isNumeric(a)?a||0:r):r}}),ae.each(["height","width"],function(e,t){ae.cssHooks[t]={get:function(e,n,i){return n?ot.test(ae.css(e,"display"))&&0===e.offsetWidth?ae.swap(e,dt,function(){return j(e,t,i)}):j(e,t,i):void 0},set:function(e,n,i){var a=i&&et(e);return D(e,n,i?Y(e,t,i,ne.boxSizing&&"border-box"===ae.css(e,"boxSizing",!1,a),a):0)}}}),ne.opacity||(ae.cssHooks.opacity={get:function(e,t){return st.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,i=e.currentStyle,a=ae.isNumeric(t)?"alpha(opacity="+100*t+")":"",r=i&&i.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===ae.trim(r.replace(rt,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||i&&!i.filter)||(n.filter=rt.test(r)?r.replace(rt,a):r+" "+a)}}),ae.cssHooks.marginRight=C(ne.reliableMarginRight,function(e,t){return t?ae.swap(e,{display:"inline-block"},tt,[e,"marginRight"]):void 0}),ae.each({margin:"",padding:"",border:"Width"},function(e,t){ae.cssHooks[e+t]={expand:function(n){for(var i=0,a={},r="string"==typeof n?n.split(" "):[n];4>i;i++)a[e+Se[i]+t]=r[i]||r[i-2]||r[0];return a}},nt.test(e)||(ae.cssHooks[e+t].set=D)}),ae.fn.extend({css:function(e,t){return De(this,function(e,t,n){var i,a,r={},s=0;if(ae.isArray(t)){for(i=et(e),a=t.length;a>s;s++)r[t[s]]=ae.css(e,t[s],!1,i);return r}return void 0!==n?ae.style(e,t,n):ae.css(e,t)},e,t,arguments.length>1)},show:function(){return k(this,!0)},hide:function(){return k(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ke(this)?ae(this).show():ae(this).hide()})}}),ae.Tween=N,N.prototype={constructor:N,init:function(e,t,n,i,a,r){this.elem=e,this.prop=n,this.easing=a||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=r||(ae.cssNumber[n]?"":"px")},cur:function(){var e=N.propHooks[this.prop];return e&&e.get?e.get(this):N.propHooks._default.get(this)},run:function(e){var t,n=N.propHooks[this.prop];return this.options.duration?this.pos=t=ae.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):N.propHooks._default.set(this),this}},N.prototype.init.prototype=N.prototype,N.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=ae.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){ae.fx.step[e.prop]?ae.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[ae.cssProps[e.prop]]||ae.cssHooks[e.prop])?ae.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},N.propHooks.scrollTop=N.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ae.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},ae.fx=N.prototype.init,ae.fx.step={};var ht,ft,mt=/^(?:toggle|show|hide)$/,gt=new RegExp("^(?:([+-])=|)("+Ce+")([a-z%]*)$","i"),vt=/queueHooks$/,_t=[F],yt={"*":[function(e,t){var n=this.createTween(e,t),i=n.cur(),a=gt.exec(t),r=a&&a[3]||(ae.cssNumber[e]?"":"px"),s=(ae.cssNumber[e]||"px"!==r&&+i)&&gt.exec(ae.css(n.elem,e)),o=1,l=20;if(s&&s[3]!==r){r=r||s[3],a=a||[],s=+i||1;do o=o||".5",s/=o,ae.style(n.elem,e,s+r);while(o!==(o=n.cur()/i)&&1!==o&&--l)}return a&&(s=n.start=+s||+i||0,n.unit=r,n.end=a[1]?s+(a[1]+1)*a[2]:+a[2]),n}]};ae.Animation=ae.extend(H,{tweener:function(e,t){ae.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,i=0,a=e.length;a>i;i++)n=e[i],yt[n]=yt[n]||[],yt[n].unshift(t)},prefilter:function(e,t){t?_t.unshift(e):_t.push(e)}}),ae.speed=function(e,t,n){var i=e&&"object"==typeof e?ae.extend({},e):{complete:n||!n&&t||ae.isFunction(e)&&e,duration:e,easing:n&&t||t&&!ae.isFunction(t)&&t};return i.duration=ae.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in ae.fx.speeds?ae.fx.speeds[i.duration]:ae.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){ae.isFunction(i.old)&&i.old.call(this),i.queue&&ae.dequeue(this,i.queue)},i},ae.fn.extend({fadeTo:function(e,t,n,i){return this.filter(ke).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var a=ae.isEmptyObject(e),r=ae.speed(t,n,i),s=function(){var t=H(this,ae.extend({},e),r);(a||ae._data(this,"finish"))&&t.stop(!0)};return s.finish=s,a||r.queue===!1?this.each(s):this.queue(r.queue,s)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,a=null!=e&&e+"queueHooks",r=ae.timers,s=ae._data(this);if(a)s[a]&&s[a].stop&&i(s[a]);else for(a in s)s[a]&&s[a].stop&&vt.test(a)&&i(s[a]);for(a=r.length;a--;)r[a].elem!==this||null!=e&&r[a].queue!==e||(r[a].anim.stop(n),t=!1,r.splice(a,1));(t||!n)&&ae.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=ae._data(this),i=n[e+"queue"],a=n[e+"queueHooks"],r=ae.timers,s=i?i.length:0;for(n.finish=!0,ae.queue(this,e,[]),a&&a.stop&&a.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;s>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish})}}),ae.each(["toggle","show","hide"],function(e,t){var n=ae.fn[t];ae.fn[t]=function(e,i,a){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(E(t,!0),e,i,a)}}),ae.each({slideDown:E("show"),slideUp:E("hide"),slideToggle:E("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ae.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),ae.timers=[],ae.fx.tick=function(){var e,t=ae.timers,n=0;for(ht=ae.now();n<t.length;n++)e=t[n],e()||t[n]!==e||t.splice(n--,1);t.length||ae.fx.stop(),ht=void 0},ae.fx.timer=function(e){ae.timers.push(e),e()?ae.fx.start():ae.timers.pop()},ae.fx.interval=13,ae.fx.start=function(){ft||(ft=setInterval(ae.fx.tick,ae.fx.interval))},ae.fx.stop=function(){clearInterval(ft),ft=null},ae.fx.speeds={slow:600,fast:200,_default:400},ae.fn.delay=function(e,t){return e=ae.fx?ae.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})},function(){var e,t,n,i,a;t=fe.createElement("div"),t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",i=t.getElementsByTagName("a")[0],n=fe.createElement("select"),a=n.appendChild(fe.createElement("option")),e=t.getElementsByTagName("input")[0],i.style.cssText="top:1px",ne.getSetAttribute="t"!==t.className,ne.style=/top/.test(i.getAttribute("style")),ne.hrefNormalized="/a"===i.getAttribute("href"),ne.checkOn=!!e.value,ne.optSelected=a.selected,ne.enctype=!!fe.createElement("form").enctype,n.disabled=!0,ne.optDisabled=!a.disabled,e=fe.createElement("input"),e.setAttribute("value",""),ne.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),ne.radioValue="t"===e.value}();var bt=/\r/g;ae.fn.extend({val:function(e){var t,n,i,a=this[0];{if(arguments.length)return i=ae.isFunction(e),this.each(function(n){var a;1===this.nodeType&&(a=i?e.call(this,n,ae(this).val()):e,null==a?a="":"number"==typeof a?a+="":ae.isArray(a)&&(a=ae.map(a,function(e){return null==e?"":e+""})),t=ae.valHooks[this.type]||ae.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,a,"value")||(this.value=a))});if(a)return t=ae.valHooks[a.type]||ae.valHooks[a.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(a,"value"))?n:(n=a.value,"string"==typeof n?n.replace(bt,""):null==n?"":n)}}}),ae.extend({valHooks:{option:{get:function(e){var t=ae.find.attr(e,"value");return null!=t?t:ae.trim(ae.text(e))}},select:{get:function(e){for(var t,n,i=e.options,a=e.selectedIndex,r="select-one"===e.type||0>a,s=r?null:[],o=r?a+1:i.length,l=0>a?o:r?a:0;o>l;l++)if(n=i[l],(n.selected||l===a)&&(ne.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!ae.nodeName(n.parentNode,"optgroup"))){if(t=ae(n).val(),r)return t;s.push(t)}return s},set:function(e,t){for(var n,i,a=e.options,r=ae.makeArray(t),s=a.length;s--;)if(i=a[s],ae.inArray(ae.valHooks.option.get(i),r)>=0)try{i.selected=n=!0}catch(o){i.scrollHeight}else i.selected=!1;return n||(e.selectedIndex=-1),a}}}}),ae.each(["radio","checkbox"],function(){ae.valHooks[this]={set:function(e,t){return ae.isArray(t)?e.checked=ae.inArray(ae(e).val(),t)>=0:void 0}},ne.checkOn||(ae.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var wt,Mt,Tt=ae.expr.attrHandle,Lt=/^(?:checked|selected)$/i,xt=ne.getSetAttribute,Ct=ne.input;ae.fn.extend({attr:function(e,t){return De(this,ae.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ae.removeAttr(this,e)})}}),ae.extend({attr:function(e,t,n){var i,a,r=e.nodeType;if(e&&3!==r&&8!==r&&2!==r)return typeof e.getAttribute===Te?ae.prop(e,t,n):(1===r&&ae.isXMLDoc(e)||(t=t.toLowerCase(),i=ae.attrHooks[t]||(ae.expr.match.bool.test(t)?Mt:wt)),void 0===n?i&&"get"in i&&null!==(a=i.get(e,t))?a:(a=ae.find.attr(e,t),null==a?void 0:a):null!==n?i&&"set"in i&&void 0!==(a=i.set(e,n,t))?a:(e.setAttribute(t,n+""),n):void ae.removeAttr(e,t))},removeAttr:function(e,t){var n,i,a=0,r=t&&t.match(ye);if(r&&1===e.nodeType)for(;n=r[a++];)i=ae.propFix[n]||n,ae.expr.match.bool.test(n)?Ct&&xt||!Lt.test(n)?e[i]=!1:e[ae.camelCase("default-"+n)]=e[i]=!1:ae.attr(e,n,""),e.removeAttribute(xt?n:i)},attrHooks:{type:{set:function(e,t){if(!ne.radioValue&&"radio"===t&&ae.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),Mt={set:function(e,t,n){return t===!1?ae.removeAttr(e,n):Ct&&xt||!Lt.test(n)?e.setAttribute(!xt&&ae.propFix[n]||n,n):e[ae.camelCase("default-"+n)]=e[n]=!0,n}},ae.each(ae.expr.match.bool.source.match(/\w+/g),function(e,t){var n=Tt[t]||ae.find.attr;Tt[t]=Ct&&xt||!Lt.test(t)?function(e,t,i){var a,r;return i||(r=Tt[t],Tt[t]=a,a=null!=n(e,t,i)?t.toLowerCase():null,Tt[t]=r),a}:function(e,t,n){return n?void 0:e[ae.camelCase("default-"+t)]?t.toLowerCase():null}}),Ct&&xt||(ae.attrHooks.value={set:function(e,t,n){return ae.nodeName(e,"input")?void(e.defaultValue=t):wt&&wt.set(e,t,n)}}),xt||(wt={set:function(e,t,n){var i=e.getAttributeNode(n);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(n)),i.value=t+="","value"===n||t===e.getAttribute(n)?t:void 0}},Tt.id=Tt.name=Tt.coords=function(e,t,n){var i;return n?void 0:(i=e.getAttributeNode(t))&&""!==i.value?i.value:null},ae.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:void 0},set:wt.set},ae.attrHooks.contenteditable={set:function(e,t,n){wt.set(e,""===t?!1:t,n)}},ae.each(["width","height"],function(e,t){ae.attrHooks[t]={set:function(e,n){return""===n?(e.setAttribute(t,"auto"),n):void 0}}})),ne.style||(ae.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var St=/^(?:input|select|textarea|button|object)$/i,kt=/^(?:a|area)$/i;ae.fn.extend({prop:function(e,t){return De(this,ae.prop,e,t,arguments.length>1)},removeProp:function(e){return e=ae.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(t){}})}}),ae.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var i,a,r,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return r=1!==s||!ae.isXMLDoc(e),r&&(t=ae.propFix[t]||t,a=ae.propHooks[t]),void 0!==n?a&&"set"in a&&void 0!==(i=a.set(e,n,t))?i:e[t]=n:a&&"get"in a&&null!==(i=a.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=ae.find.attr(e,"tabindex");return t?parseInt(t,10):St.test(e.nodeName)||kt.test(e.nodeName)&&e.href?0:-1}}}}),ne.hrefNormalized||ae.each(["href","src"],function(e,t){ae.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),ne.optSelected||(ae.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),ae.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ae.propFix[this.toLowerCase()]=this}),ne.enctype||(ae.propFix.enctype="encoding");var Dt=/[\t\r\n\f]/g;ae.fn.extend({addClass:function(e){var t,n,i,a,r,s,o=0,l=this.length,c="string"==typeof e&&e;if(ae.isFunction(e))return this.each(function(t){ae(this).addClass(e.call(this,t,this.className))});if(c)for(t=(e||"").match(ye)||[];l>o;o++)if(n=this[o],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Dt," "):" ")){for(r=0;a=t[r++];)i.indexOf(" "+a+" ")<0&&(i+=a+" ");s=ae.trim(i),n.className!==s&&(n.className=s)}return this},removeClass:function(e){var t,n,i,a,r,s,o=0,l=this.length,c=0===arguments.length||"string"==typeof e&&e;if(ae.isFunction(e))return this.each(function(t){ae(this).removeClass(e.call(this,t,this.className))});if(c)for(t=(e||"").match(ye)||[];l>o;o++)if(n=this[o],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Dt," "):"")){for(r=0;a=t[r++];)for(;i.indexOf(" "+a+" ")>=0;)i=i.replace(" "+a+" "," ");s=e?ae.trim(i):"",n.className!==s&&(n.className=s)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):ae.isFunction(e)?this.each(function(n){ae(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var t,i=0,a=ae(this),r=e.match(ye)||[];t=r[i++];)a.hasClass(t)?a.removeClass(t):a.addClass(t);else(n===Te||"boolean"===n)&&(this.className&&ae._data(this,"__className__",this.className),this.className=this.className||e===!1?"":ae._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Dt," ").indexOf(t)>=0)return!0;return!1}}),ae.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){ae.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),ae.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var Yt=ae.now(),jt=/\?/,Nt=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;ae.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,i=null,a=ae.trim(t+"");return a&&!ae.trim(a.replace(Nt,function(e,t,a,r){return n&&t&&(i=0),0===i?e:(n=a||t,i+=!r-!a,"")}))?Function("return "+a)():ae.error("Invalid JSON: "+t)},ae.parseXML=function(t){var n,i;if(!t||"string"!=typeof t)return null;try{e.DOMParser?(i=new DOMParser,n=i.parseFromString(t,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(a){n=void 0}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||ae.error("Invalid XML: "+t),n};var Pt,Et,At=/#.*$/,Ft=/([?&])_=[^&]*/,It=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ht=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Zt=/^(?:GET|HEAD)$/,Rt=/^\/\//,Ot=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Xt={},Jt={},Bt="*/".concat("*");try{Et=location.href}catch(Wt){Et=fe.createElement("a"),Et.href="",Et=Et.href}Pt=Ot.exec(Et.toLowerCase())||[],ae.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et,type:"GET",isLocal:Ht.test(Pt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Bt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ae.parseJSON,"text xml":ae.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?O(O(e,ae.ajaxSettings),t):O(ae.ajaxSettings,e)},ajaxPrefilter:Z(Xt),ajaxTransport:Z(Jt),ajax:function(e,t){function n(e,t,n,i){var a,d,v,_,b,M=t;2!==y&&(y=2,o&&clearTimeout(o),c=void 0,s=i||"",w.readyState=e>0?4:0,a=e>=200&&300>e||304===e,n&&(_=X(u,w,n)),_=J(u,_,w,a),a?(u.ifModified&&(b=w.getResponseHeader("Last-Modified"),b&&(ae.lastModified[r]=b),b=w.getResponseHeader("etag"),b&&(ae.etag[r]=b)),204===e||"HEAD"===u.type?M="nocontent":304===e?M="notmodified":(M=_.state,d=_.data,v=_.error,a=!v)):(v=M,(e||!M)&&(M="error",0>e&&(e=0))),w.status=e,w.statusText=(t||M)+"",a?f.resolveWith(p,[d,M,w]):f.rejectWith(p,[w,M,v]),w.statusCode(g),g=void 0,l&&h.trigger(a?"ajaxSuccess":"ajaxError",[w,u,a?d:v]),m.fireWith(p,[w,M]),l&&(h.trigger("ajaxComplete",[w,u]),--ae.active||ae.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,a,r,s,o,l,c,d,u=ae.ajaxSetup({},t),p=u.context||u,h=u.context&&(p.nodeType||p.jquery)?ae(p):ae.event,f=ae.Deferred(),m=ae.Callbacks("once memory"),g=u.statusCode||{},v={},_={},y=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===y){if(!d)for(d={};t=It.exec(s);)d[t[1].toLowerCase()]=t[2];t=d[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===y?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return y||(e=_[n]=_[n]||e,v[e]=t),this},overrideMimeType:function(e){return y||(u.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>y)for(t in e)g[t]=[g[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||b;return c&&c.abort(t),n(0,t),this}};if(f.promise(w).complete=m.add,w.success=w.done,w.error=w.fail,u.url=((e||u.url||Et)+"").replace(At,"").replace(Rt,Pt[1]+"//"),u.type=t.method||t.type||u.method||u.type,u.dataTypes=ae.trim(u.dataType||"*").toLowerCase().match(ye)||[""],null==u.crossDomain&&(i=Ot.exec(u.url.toLowerCase()),u.crossDomain=!(!i||i[1]===Pt[1]&&i[2]===Pt[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(Pt[3]||("http:"===Pt[1]?"80":"443")))),u.data&&u.processData&&"string"!=typeof u.data&&(u.data=ae.param(u.data,u.traditional)),R(Xt,u,t,w),2===y)return w;l=u.global,l&&0===ae.active++&&ae.event.trigger("ajaxStart"),u.type=u.type.toUpperCase(),u.hasContent=!Zt.test(u.type),r=u.url,u.hasContent||(u.data&&(r=u.url+=(jt.test(r)?"&":"?")+u.data,delete u.data),u.cache===!1&&(u.url=Ft.test(r)?r.replace(Ft,"$1_="+Yt++):r+(jt.test(r)?"&":"?")+"_="+Yt++)),u.ifModified&&(ae.lastModified[r]&&w.setRequestHeader("If-Modified-Since",ae.lastModified[r]),ae.etag[r]&&w.setRequestHeader("If-None-Match",ae.etag[r])),(u.data&&u.hasContent&&u.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",u.contentType),w.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+Bt+"; q=0.01":""):u.accepts["*"]);for(a in u.headers)w.setRequestHeader(a,u.headers[a]);if(u.beforeSend&&(u.beforeSend.call(p,w,u)===!1||2===y))return w.abort();b="abort";for(a in{success:1,error:1,complete:1})w[a](u[a]);if(c=R(Jt,u,t,w)){w.readyState=1,l&&h.trigger("ajaxSend",[w,u]),u.async&&u.timeout>0&&(o=setTimeout(function(){w.abort("timeout")},u.timeout));try{y=1,c.send(v,n)}catch(M){if(!(2>y))throw M;n(-1,M)}}else n(-1,"No Transport");return w},getJSON:function(e,t,n){return ae.get(e,t,n,"json")},getScript:function(e,t){return ae.get(e,void 0,t,"script")}}),ae.each(["get","post"],function(e,t){ae[t]=function(e,n,i,a){return ae.isFunction(n)&&(a=a||i,i=n,n=void 0),ae.ajax({url:e,type:t,dataType:a,data:n,success:i})}}),ae.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ae.fn[t]=function(e){return this.on(t,e)}}),ae._evalUrl=function(e){return ae.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},ae.fn.extend({wrapAll:function(e){if(ae.isFunction(e))return this.each(function(t){ae(this).wrapAll(e.call(this,t))});if(this[0]){var t=ae(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return ae.isFunction(e)?this.each(function(t){ae(this).wrapInner(e.call(this,t))}):this.each(function(){var t=ae(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=ae.isFunction(e);return this.each(function(n){ae(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){ae.nodeName(this,"body")||ae(this).replaceWith(this.childNodes)}).end()}}),ae.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!ne.reliableHiddenOffsets()&&"none"===(e.style&&e.style.display||ae.css(e,"display"))},ae.expr.filters.visible=function(e){return!ae.expr.filters.hidden(e)};var qt=/%20/g,Qt=/\[\]$/,$t=/\r?\n/g,zt=/^(?:submit|button|image|reset|file)$/i,Ut=/^(?:input|select|textarea|keygen)/i;ae.param=function(e,t){var n,i=[],a=function(e,t){t=ae.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=ae.ajaxSettings&&ae.ajaxSettings.traditional),ae.isArray(e)||e.jquery&&!ae.isPlainObject(e))ae.each(e,function(){a(this.name,this.value)});else for(n in e)B(n,e[n],t,a);return i.join("&").replace(qt,"+")},ae.fn.extend({serialize:function(){return ae.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ae.prop(this,"elements");return e?ae.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ae(this).is(":disabled")&&Ut.test(this.nodeName)&&!zt.test(e)&&(this.checked||!Ye.test(e))}).map(function(e,t){var n=ae(this).val();return null==n?null:ae.isArray(n)?ae.map(n,function(e){return{name:t.name,value:e.replace($t,"\r\n")}}):{name:t.name,value:n.replace($t,"\r\n")}}).get()}}),ae.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&W()||q()}:W;var Gt=0,Kt={},Vt=ae.ajaxSettings.xhr();e.ActiveXObject&&ae(e).on("unload",function(){for(var e in Kt)Kt[e](void 0,!0)}),ne.cors=!!Vt&&"withCredentials"in Vt,Vt=ne.ajax=!!Vt,Vt&&ae.ajaxTransport(function(e){if(!e.crossDomain||ne.cors){var t;return{send:function(n,i){var a,r=e.xhr(),s=++Gt;if(r.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)r[a]=e.xhrFields[a];e.mimeType&&r.overrideMimeType&&r.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(a in n)void 0!==n[a]&&r.setRequestHeader(a,n[a]+"");r.send(e.hasContent&&e.data||null),t=function(n,a){var o,l,c;if(t&&(a||4===r.readyState))if(delete Kt[s],t=void 0,r.onreadystatechange=ae.noop,a)4!==r.readyState&&r.abort();else{c={},o=r.status,"string"==typeof r.responseText&&(c.text=r.responseText);try{l=r.statusText}catch(d){l=""}o||!e.isLocal||e.crossDomain?1223===o&&(o=204):o=c.text?200:404}c&&i(o,l,c,r.getAllResponseHeaders())},e.async?4===r.readyState?setTimeout(t):r.onreadystatechange=Kt[s]=t:t()},abort:function(){t&&t(void 0,!0)}}}}),ae.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return ae.globalEval(e),e}}}),ae.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),ae.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=fe.head||ae("head")[0]||fe.documentElement;return{send:function(i,a){t=fe.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){(n||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||a(200,"success"))},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var en=[],tn=/(=)\?(?=&|$)|\?\?/;ae.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=en.pop()||ae.expando+"_"+Yt++;return this[e]=!0,e}}),ae.ajaxPrefilter("json jsonp",function(t,n,i){var a,r,s,o=t.jsonp!==!1&&(tn.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&tn.test(t.data)&&"data");return o||"jsonp"===t.dataTypes[0]?(a=t.jsonpCallback=ae.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o?t[o]=t[o].replace(tn,"$1"+a):t.jsonp!==!1&&(t.url+=(jt.test(t.url)?"&":"?")+t.jsonp+"="+a),t.converters["script json"]=function(){return s||ae.error(a+" was not called"),s[0]},t.dataTypes[0]="json",r=e[a],e[a]=function(){s=arguments},i.always(function(){e[a]=r,t[a]&&(t.jsonpCallback=n.jsonpCallback,en.push(a)),s&&ae.isFunction(r)&&r(s[0]),s=r=void 0}),"script"):void 0}),ae.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||fe;var i=ue.exec(e),a=!n&&[];return i?[t.createElement(i[1])]:(i=ae.buildFragment([e],t,a),a&&a.length&&ae(a).remove(),ae.merge([],i.childNodes))};var nn=ae.fn.load;ae.fn.load=function(e,t,n){if("string"!=typeof e&&nn)return nn.apply(this,arguments);var i,a,r,s=this,o=e.indexOf(" ");return o>=0&&(i=ae.trim(e.slice(o,e.length)),e=e.slice(0,o)),ae.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(r="POST"),s.length>0&&ae.ajax({url:e,type:r,dataType:"html",data:t}).done(function(e){a=arguments,s.html(i?ae("<div>").append(ae.parseHTML(e)).find(i):e)}).complete(n&&function(e,t){s.each(n,a||[e.responseText,t,e])}),this},ae.expr.filters.animated=function(e){return ae.grep(ae.timers,function(t){return e===t.elem}).length};var an=e.document.documentElement;ae.offset={setOffset:function(e,t,n){var i,a,r,s,o,l,c,d=ae.css(e,"position"),u=ae(e),p={};"static"===d&&(e.style.position="relative"),o=u.offset(),r=ae.css(e,"top"),l=ae.css(e,"left"),c=("absolute"===d||"fixed"===d)&&ae.inArray("auto",[r,l])>-1,c?(i=u.position(),s=i.top,a=i.left):(s=parseFloat(r)||0,a=parseFloat(l)||0),ae.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(p.top=t.top-o.top+s),null!=t.left&&(p.left=t.left-o.left+a),"using"in t?t.using.call(e,p):u.css(p);
}},ae.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){ae.offset.setOffset(this,e,t)});var t,n,i={top:0,left:0},a=this[0],r=a&&a.ownerDocument;if(r)return t=r.documentElement,ae.contains(t,a)?(typeof a.getBoundingClientRect!==Te&&(i=a.getBoundingClientRect()),n=Q(r),{top:i.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:i.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):i},position:function(){if(this[0]){var e,t,n={top:0,left:0},i=this[0];return"fixed"===ae.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),ae.nodeName(e[0],"html")||(n=e.offset()),n.top+=ae.css(e[0],"borderTopWidth",!0),n.left+=ae.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-ae.css(i,"marginTop",!0),left:t.left-n.left-ae.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||an;e&&!ae.nodeName(e,"html")&&"static"===ae.css(e,"position");)e=e.offsetParent;return e||an})}}),ae.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);ae.fn[e]=function(i){return De(this,function(e,i,a){var r=Q(e);return void 0===a?r?t in r?r[t]:r.document.documentElement[i]:e[i]:void(r?r.scrollTo(n?ae(r).scrollLeft():a,n?a:ae(r).scrollTop()):e[i]=a)},e,i,arguments.length,null)}}),ae.each(["top","left"],function(e,t){ae.cssHooks[t]=C(ne.pixelPosition,function(e,n){return n?(n=tt(e,t),it.test(n)?ae(e).position()[t]+"px":n):void 0})}),ae.each({Height:"height",Width:"width"},function(e,t){ae.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,i){ae.fn[i]=function(i,a){var r=arguments.length&&(n||"boolean"!=typeof i),s=n||(i===!0||a===!0?"margin":"border");return De(this,function(t,n,i){var a;return ae.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(a=t.documentElement,Math.max(t.body["scroll"+e],a["scroll"+e],t.body["offset"+e],a["offset"+e],a["client"+e])):void 0===i?ae.css(t,n,s):ae.style(t,n,i,s)},t,r?i:void 0,r,null)}})}),ae.fn.size=function(){return this.length},ae.fn.andSelf=ae.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return ae});var rn=e.jQuery,sn=e.$;return ae.noConflict=function(t){return e.$===ae&&(e.$=sn),t&&e.jQuery===ae&&(e.jQuery=rn),ae},typeof t===Te&&(e.jQuery=e.$=ae),ae}),define("cui/util/-browser-hack",[],{load:function(e,t,n,i){i.isBuild||!document.all?n():t(["jquery"],function(){t(["./IE8-hack"],n)})}}),define("cui/util/global-supports",["jquery","./-browser-hack!"],function(){null==window.console&&(window.console={log:function(){}}),null==console.debug&&(console.debug=console.log)}),define("configstore",["jquery"],function(e){var t={},n=function(n){e.isPlainObject(n)&&e.extend(!0,t,n),r(t)},i=function(n){var i,a=t||{};for(n="string"==typeof n?n:"",n=n.split(".");e.isPlainObject(a)&&(i=n.shift());)a=a[i.toLowerCase()];return a},a=function(n,i){var a,s=t||{},o=0;if(!n)return!1;for(n=n.split(".");n.length>1&&(a=n.shift())&&10>=o;)o++,s=s[a],e.isPlainObject(s)||(s={});a=n.shift(),a&&(s[a]=i),r(t)},r=function(t){window.CM=window.CM||{},delete window.CM.config,window.CM.config=e.extend(!0,{},t)};return{initConfig:n,getConfig:i,setConfig:a}}),define("util/common-controls",["require"],function(e){function t(){if("undefined"!=typeof window){i=c.parseUrlQuery(location.search).sid;var t=e.toUrl("../1.js").replace(/\/\w+\/\.\.\//g,"/").replace(/\/\w+\/\.\.\//g,"/").replace(/\/\w+\/\.\.\//g,"/").replace(/\/script\/1.js$/,"");if("/"==t.charAt(0)){var n=t.match(/^(\/.*)\/(\w+)\/(@project\.revision@|\w+)$/);s=n[1],a=n[2],r=n[3]}else{var o=location.pathname.match(/^\/(coremail|%40context.name%40|\w+)\/(\w+)/);s="/"+o[1],a=o[2],r=t.match(/(^|\/)(@project\.revision@|\w+)$/)[2]}console.debug([c.sid(),c.locale(),c.basename(),c.projectRevision(),c.path(),c.assetPath(),c.commonAssetPath(),c.cuiAssetPath(),void 0].join("\n"))}}function n(e,t){return t=t||"",e+(t&&"/"!=t.charAt(0)?"/":"")+t}var i,a,r,s,o="zh_CN",l={sid:function(){return i},basename:function(){return a},locale:function(){return o},localeMM:function(){return o.replace(/_/g,"-").toLowerCase()},setLocale:function(e){o=e},projectRevision:function(){return r},parseUrlQuery:function(e){var t,n,i,a={};for(e.indexOf("?")>=0&&(e=e.split("?")[1]),n=e.split("&"),t=0;t<n.length;t++)i=n[t].split("="),a[i[0]]=i[1];return a},redirection:function(e){location.href=e},redirectionPath:function(e){c.redirection(c.path(e))},redirectLogin:function(e){c.redirectionPath("/login")},redirectMain:function(e){c.redirectionPath("?sid="+e)},path:function(e){return n(s,e)},commonAssetPath:function(e){return n(s+"/common/"+r,e)},cuiAssetPath:function(e){return n(s+"/framework/"+r+"/cui",e)},componentsPath:function(e){return n(s+"/framework/"+r+"/components",e)},basePath:function(e){return n(s+"/"+a,e)},assetPath:function(e){return n(s+"/"+a+"/"+r,e)},pv:function(){return r}},c=l;return t(),l}),define("util/i18n-loader",["require","./common-controls"],function(e){function t(e){return 1==e.length?$.makeArray(e[0]):$.makeArray(e)}function n(e,t,n){function o(e){if(r.length){if(e)return void setTimeout(o);var n=r.join(",");r=[],$.ajax(i.path("/s/json/"+i.basename()+"?func=loadLang&lc="+i.locale()+"&category="+n),{dataType:"json",async:t}).done(function(e,t,n){"S_OK"==e.code?($.each(e["var"].data,function(e,t){a[e]=t}),l.resolve(s)):l.reject(n,t,new Error(e.code))}).fail(function(e,t,n){l.reject(e,t,n)})}else l.resolve(s)}var l=$.Deferred();return $.each(e,function(e,t){!n&&a.hasOwnProperty(t)||-1!=$.inArray(t,r)||r.push(t)}),o(t),l.promise()}var i=e("./common-controls"),a={},r=[],s={get:function(e,t){var n=e.lastIndexOf("/");if(-1==n)return null;var i,r=e.substring(0,n),s=e.substring(n+1);if(t)this.syncLoad(r),i=a[r];else if(i=a[r],null==i)return e;return(i||{})[s]},syncLoad:function(){n(t(arguments),!1)},asyncLoad:function(){return n(t(arguments),!0)},asyncReload:function(){var e=t(arguments);return $.each(a,function(t){~$.inArray(t,e)&&e.push(t)}),n(e,!0,!0)}};return s}),define("util/i18n",["require","./i18n-loader","./common-controls"],function(e){function t(e){return e&&e!=d.locale()?c.asyncReload():$.when(c)}function n(e,t){return u=0,a(e,t)}function i(e){$("[data-i18n]",e).each(function(){var e,t=$(this).attr("data-i18n"),i=$(this).attr("i18n-target");t&&(e=n(t),i?$(this).attr(i,e):$(this).text(e))})}function a(e,t){t=t||{};var i=t.defaultValue||e;if(r(t)){var a=$.extend({},t);delete a.count,a.defaultValue=p.suffixNotFound;var d=e+s(t),u=n(d,a);if(u!=p.suffixNotFound)return o(u,{count:t.count})}var h=c.get(e.replace(/\.|\//,"/"));return h?(h=o(h,t),h=l(h,t)):i}function r(e){return"number"==typeof e.count||"string"==typeof e.count}function s(e){var t=p.getSuffixMethod(e.count);return"string"==typeof t?t:""}function o(e,t){return $.each(t,function(t,n){e=e.split([p.interpolationPrefix,t,p.interpolationSuffix].join("")).join(n)}),e}function l(e,t){for(var n,i,r,s,o;-1!=e.indexOf(p.reusePrefix)&&(u++,!(u>p.maxRecursion));)n=e.indexOf(p.reusePrefix),i=e.indexOf(p.reuseSuffix,n)+p.reuseSuffix.length,r=e.substring(n,i),s=r.replace(p.reusePrefix,"").replace(p.reuseSuffix,""),o=a(s,t),e=e.replace(r,o);return e}var c=e("./i18n-loader"),d=e("./common-controls"),u=0,p={interpolationPrefix:"__",interpolationSuffix:"__",getSuffixMethod:function(e){return e>1||"string"==typeof e?"_plural":""},maxRecursion:50,reusePrefix:"$t(",reuseSuffix:")",suffixNotFound:["suffix_not_found",Math.random()].join("")};return{changeLang:t,t:n,translate:n,translateDataApi:i,load:function(e,t,n,i){i.isBuild?n():c.asyncLoad(e.split(/\s*,\s*/)).always(n)}}}),function(e){"use strict";e.fn.serializeJSON=function(t){var n,i,a,r,s,o,l;return o=e.serializeJSON,l=o.optsWithDefaults(t),o.validateOptions(l),i=this.serializeArray(),o.readCheckboxUncheckedValues(i,this,l),n={},e.each(i,function(e,t){a=o.splitInputNameIntoKeysArray(t.name),r=a.pop(),"skip"!==r&&(s=o.parseValue(t.value,r,l),l.parseWithFunction&&"_"===r&&(s=l.parseWithFunction(s,t.name)),o.deepSet(n,a,s,l))}),n},e.serializeJSON={defaultOptions:{parseNumbers:!1,parseBooleans:!1,parseNulls:!1,parseAll:!1,parseWithFunction:null,checkboxUncheckedValue:void 0,useIntKeysAsArrayIndex:!1},optsWithDefaults:function(t){var n,i;return null==t&&(t={}),n=e.serializeJSON,i=n.optWithDefaults("parseAll",t),{parseNumbers:i||n.optWithDefaults("parseNumbers",t),parseBooleans:i||n.optWithDefaults("parseBooleans",t),parseNulls:i||n.optWithDefaults("parseNulls",t),parseWithFunction:n.optWithDefaults("parseWithFunction",t),checkboxUncheckedValue:n.optWithDefaults("checkboxUncheckedValue",t),useIntKeysAsArrayIndex:n.optWithDefaults("useIntKeysAsArrayIndex",t)}},optWithDefaults:function(t,n){return n[t]!==!1&&""!==n[t]&&(n[t]||e.serializeJSON.defaultOptions[t])},validateOptions:function(e){var t,n;n=["parseNumbers","parseBooleans","parseNulls","parseAll","parseWithFunction","checkboxUncheckedValue","useIntKeysAsArrayIndex"];for(t in e)if(-1===n.indexOf(t))throw new Error("serializeJSON ERROR: invalid option '"+t+"'. Please use one of "+n.join(","))},parseValue:function(t,n,i){var a;return a=e.serializeJSON,"string"==n?t:"number"==n||i.parseNumbers&&a.isNumeric(t)?Number(t):"boolean"==n||i.parseBooleans&&("true"===t||"false"===t)?-1===["false","null","undefined","","0"].indexOf(t):"null"==n||i.parseNulls&&"null"==t?-1!==["false","null","undefined","","0"].indexOf(t)?null:t:"array"==n||"object"==n?JSON.parse(t):"auto"==n?a.parseValue(t,null,{parseNumbers:!0,parseBooleans:!0,parseNulls:!0}):t},isObject:function(e){return e===Object(e)},isUndefined:function(e){return void 0===e},isValidArrayIndex:function(e){return/^[0-9]+$/.test(String(e))},isNumeric:function(e){return e-parseFloat(e)>=0},splitInputNameIntoKeysArray:function(t){var n,i,a,r,s;return s=e.serializeJSON,r=s.extractTypeFromInputName(t),i=r[0],a=r[1],n=i.split("["),n=e.map(n,function(e){return e.replace(/]/g,"")}),""===n[0]&&n.shift(),n.push(a),n},extractTypeFromInputName:function(t){var n,i;if(i=e.serializeJSON,n=t.match(/(.*):([^:]+)$/)){var a=["string","number","boolean","null","array","object","skip","auto"];if(-1!==a.indexOf(n[2]))return[n[1],n[2]];throw new Error("serializeJSON ERROR: Invalid type "+n[2]+" found in input name '"+t+"', please use one of "+a.join(", "))}return[t,"_"]},deepSet:function(t,n,i,a){var r,s,o,l,c,d;if(null==a&&(a={}),d=e.serializeJSON,d.isUndefined(t))throw new Error("ArgumentError: param 'o' expected to be an object or array, found undefined");if(!n||0===n.length)throw new Error("ArgumentError: param 'keys' expected to be an array with least one element");r=n[0],1===n.length?""===r?t.push(i):t[r]=i:(s=n[1],""===r&&(l=t.length-1,c=t[l],r=d.isObject(c)&&(d.isUndefined(c[s])||n.length>2)?l:l+1),""===s?(d.isUndefined(t[r])||!e.isArray(t[r]))&&(t[r]=[]):a.useIntKeysAsArrayIndex&&d.isValidArrayIndex(s)?(d.isUndefined(t[r])||!e.isArray(t[r]))&&(t[r]=[]):(d.isUndefined(t[r])||!d.isObject(t[r]))&&(t[r]={}),o=n.slice(1),d.deepSet(t[r],o,i,a))},readCheckboxUncheckedValues:function(t,n,i){var a,r,s,o,l;null==i&&(i={}),l=e.serializeJSON,a="input[type=checkbox][name]:not(:checked):not([disabled])",r=n.find(a).add(n.filter(a)),r.each(function(n,a){s=e(a),o=s.attr("data-unchecked-value"),o?t.push({name:a.name,value:o}):l.isUndefined(i.checkboxUncheckedValue)||t.push({name:a.name,value:i.checkboxUncheckedValue})})}}}(window.jQuery||window.Zepto||window.$),define("components/jquery.serializeJSON/jquery.serializejson",function(){}),function(e){e.fn.customRadioCheckbox=function(){if(this[0]){var t='<div class="u-switch-onoff"><div class="switch"></div><div class="track"></div></div>',n="-checked",i="rc-hidden",a="rc-disabled",r=function(){var t=e(this);t.closest("label")[0]||t.prev().trigger("change.crc",[!0])},s=function(i){for(var s,o,l,c=i.type,d=i.length;d--;)l=i[d],s=e(l).prop("disabled"),o=e("switchBtn"==e(l).attr("role")&&"checkbox"==c?t:"<i>"),o.addClass(c+(l.checked?" "+c+n:"")),o.bind("click.crc",r),s&&o.addClass(a),l.parentNode.insertBefore(o[0],l.nextSibling)};return this.each(function(){var t,a=e(this),r=a.find("input[type=radio]:not(."+i+")").addClass(i),o=a.find("input[type=checkbox]:not(."+i+")").addClass(i),l={},c=r.length;if(r.length){for(r.type="radio",s(r);c--;)t=r[c],t.checked&&((l[t.name]={}).checked=e(t.nextSibling));r.bind("change.crc",function(t,i){return e(this).prop("disabled")?!1:(i&&this.checked||(l[this.name]||(l[this.name]={}),l[this.name].checked&&l[this.name].checked.removeClass(r.type+n),l[this.name].checked=e(this.nextSibling).addClass(r.type+n)),void(i&&!this.checked&&(this.checked=!0)))})}o.length&&(o.type="checkbox",s(o),o.bind("change.crc",function(t,i){return e(this).prop("disabled")?!1:(i&&(this.checked=!this.checked),void e(this.nextSibling).toggleClass(o.type+n))}))})}},e(function(){e("body").customRadioCheckbox()})}(jQuery),define("widget/customRadioCheckbox/jquery.customRadioCheckbox",function(){}),define("util/email",[],function(){function e(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function t(e){return String.prototype.trim?"string"==typeof e?e.trim():e:"string"==typeof e?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e}function n(e){function n(e){for(var t,n=e.replace(/\\\"/g,"##"),i=[],a=new RegExp('"[^"]*"',"g");null!=(t=a.exec(n));)i[i.length]=t;return i}function i(e,t){var n=e.indexOf(",",t),i=e.indexOf(";",t),a=i>n?n:i;return-1===a&&(a=n>i?n:i),a}for(var a=[],r=n(e),s=r.length,o=0,l=0,c=0;;){var d=i(e,l);if(-1===d)return a[a.length]=t(e.substr(o)),a;if(s>c){var u=r[c],p=u.index,h=u.lastIndex||u.index+u[0].length-1;(p>d||d>h)&&(a[a.length]=t(e.substring(o,d)),o=d+1,d>h&&c++),l=d+1}else a[a.length]=t(e.substring(o,d)),l=o=d+1}}function i(e){if(-1!==e.indexOf(".."))return!1;var t='~`!@#\\$%\\^&\\*\\(\\)=\\+\\{\\}\\[\\]\\|\\\\";:<>,\\?\\/\\u007e\\uff01\\u002b\\u0023\\uffe5\\u0025\\u2026\\u002a\\uff08\\u003d\\uff09\\u2014\\u007b\\u007d\\u007c\\u3010\\u3011\\u3001\\uff1a\\uff1b\\u2018\\u2019\\u300a\\u300b\\uff1f\\uff0c\\u3002\\u201c\\u201d\\u0026',n=new RegExp("^[^"+t+"\\-'\\.][^"+t+"]*(?:\\.[^"+t+"\\-'\\.][^"+t+"]*)*$");return null!=e.match(n)}function a(e){var t="~`!@#\\$%\\^&\\*\\(\\)=_\\+\\{\\}\\[\\]\\|\\\\\";:<>,\\?\\.'\\/\\u007e\\uff01\\u002b\\u0023\\uffe5\\u0025\\u2026\\u002a\\uff08\\u003d\\uff09\\u2014\\u007b\\u007d\\u007c\\u3010\\u3011\\u3001\\uff1a\\uff1b\\u2018\\u2019\\u300a\\u300b\\uff1f\\uff0c\\u3002\\u201c\\u201d\\u0026",n=new RegExp("^[^"+t+"\\-]([^"+t+"]*[^"+t+"\\-])?(?:\\.[^"+t+"\\-]([^"+t+"]*[^"+t+"\\-])?)+$");return null!=e.match(n)}var r=function(e,t){this.trueName=e,this.address=t,t||(this.trueName=r.parseTrueName(e),this.address=r.parseAddress(e))};return r.prototype.getTrueName=function(t){return t="boolean"==typeof t?t:!0,t?e(this.trueName):this.trueName},r.prototype.getAddress=function(){return this.address},r.prototype.toString=function(e){return e&&(this.trueName=this.trueName.replace(/(\s#|^#)/," ").replace(/#$/,""),this.trueName)?t(this.trueName)+" <"+this.address+">":this.trueName?'"'+this.trueName+'" <'+this.address+">":this.address},r.parseTrueName=function(e){if(!e)return"";var n=e.lastIndexOf("<");return n>-1?(e=t(e.substr(0,n)),e=e.replace(/^[\"\']/,"").replace(/[\"\']$/,""),e.replace(/\\\"/g,'"').replace(/\\\\/g,"\\")):""},r.parseAddress=function(e){if(!e)return"";e=e.replace(/\s/gi,"");var t=e.lastIndexOf("<"),n=e.lastIndexOf(">");return t>=0&&n>=0&&n>t?e.substring(t+1,n):t>=0||n>=0?"":e},r.parse=function(e){for(var t=n(e),i=0;i<t.length;i++)t[i]=new r(t[i]);return t},r.test=function(e){var t=r.parseTrueName(e),n=r.parseAddress(e);if(0===t.length&&e!==n&&e!=="<"+n+">")return!1;var s=n.indexOf("@");if(-1===s)return!1;var o=255>=s,l=n.length-s-1<=255;if(!o||!l)return!1;var c=n.substring(0,s),d=n.substring(s+1,n.length);return i(c)&&a(d)},r.isValidDomain=function(e){return a(e)},r}),define("util/html",["require","exports","module","jquery","./email"],function(e,t){function n(e){return"number"==typeof e&&(e=""+e),e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function i(e){return"number"==typeof e&&(e=""+e),e.replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/(&quot;|&#034;|&#34;)/gi,'"').replace(/(&#039;|&#39;)/gi,"'").replace(/&nbsp;/gi," ")}function a(e){return e=e.replace(/&nbsp;|\t/g,""),e=e.replace(/&gt;/g,">").replace(/&lt;/g,"<"),/<.*?>/gi.test(e)&&e?(e=e.replace(/[\n\r]/g,""),e=o.trim(e),e=e.replace(/<(p|div)[^>]*>\s*(<br\s*\/?>|&nbsp;)\s*<\/\1>/gi,"\n"),e=e.replace(/<(?!br)[^>\/]+.*?>\s*/gi,""),e=e.replace(/(\n)?<\/([^>]+)>/g,function(e,t,n){return c[n]?"\n":t||""}),e=e.replace(/<[^>]*?br[^>]*?>\s*/gi,"\n")):e}function r(e){return e?(/<.*?>/gi.test(e)&&(e=e.replace(/<(.*?)>/gi,function(e,t){return l.test(t)?e.replace(/>/g,"&gt;").replace(/</g,"&lt;"):e})),e=e.replace(/\n/gi,"<br>"),e=e.replace(/[ ]/gi,"&nbsp;"),e=o.trim(e)):e}function s(e){return e=a(e),e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var o=e("jquery"),l=e("./email"),c={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};t.encode=n,t.decode=i,t.html2text=a,t.text2html=r,t.escapeRegExp=s}),define("widget/dropdown/dropdown",["require","jquery","../../util/html"],function(e){function t(e){var t,i,a,s,o,l,c,d,u,p,h;t=n(e),o=e.data("dropdown.settings"),s="submenu"===e.attr("role")||"body"!=o.parent,i=t.outerWidth(),a=t.outerHeight(),l=r(window).width(),c=r(window).height(),p=e.outerWidth(),h=e.outerHeight(),d=e.offset().left,u=e.offset().top,d+i+p>l?s?t.addClass("u-menu-right"):t.css({left:d+p-i}):s?t.removeClass("u-menu-right"):t.css({left:d}),u+a+h>c&&u>=a?s?t.addClass("u-menu-top"):t.css({top:u-a}):s?t.removeClass("u-menu-top"):t.css({top:u+h})}function n(e){var t=e.data("dropdown.settings");return e.data("menu")||e.children("."+t.menuClass)}function i(){r('[role="dropdown"]').each(function(){r(this).dropdown("hide")})}function a(e){function t(e){r.each(e,function(e,t){var n=r("<li>").append(r("<a>",{href:"javascript:void(0);",html:s.encode(t.name),tabindex:-1,deepLevel:t.deepLevel}));n.data("node",t).attr("value",t.value),t.classNames&&n.addClass(t.classNames),t.deepLevel&&t.deepLevel>1&&n.find("a").css("padding-left",30+12*(t.deepLevel-1)+"px"),t.icon&&n.prepend(r("<i>",{"class":/\b(left|right)\b/.test(t.icon)?"iconfont "+t.icon:"iconfont left "+t.icon})),t["default"]&&(n.addClass(i.chooseClass),i.chooseHtml&&n.children("i.iconfont").length<=0&&n.append(r(i.chooseHtml).addClass(i.chooseClass))),("array"===r.type(t.children)&&t.children.length>0||r.isPlainObject(t.children)&&!r.isEmptyObject(t.children))&&(n.addClass(i.subMenuClass).append(r("<i>",{"class":"iconfont iconright right"})),n.data("dropdown.settings",r.extend(n.data("dropdown.settings")||{},i,{data:t.children})),n.append(a(n)),o.append(n)),t.hasOwnProperty("children")||o.append(n)})}var n,i=e.data("dropdown.settings"),o=r("<ul>",{"class":i.menuClass+" "+i.hiddenClass});return"array"===r.type(i.data)?t(i.data):r.isPlainObject(i.data)&&r.each(i.data,function(e,n){n.length>0&&(t(n),o.append(r("<li>",{"class":i.menuSepClass})))}),n=o.find("li").last(),n.hasClass(i.menuSepClass)&&n.remove(),e.data("menu",o),o}var r=e("jquery"),s=e("../../util/html"),o={init:function(e){return this.each(function(){var t,i=r(this),a=i.data("dropdown.settings")||{};r.extend(a,{parent:i,menuClass:"u-menu",menuSepClass:"divider",subMenuClass:"u-submenu",hiddenClass:"u-menu-hidden",showClass:"u-menu-show",chooseClass:"u-menu-choose",chooseHtml:'<i class="iconfont iconchoose left"></i>',maxWidth:999999,maxHeight:400,beforeShow:r.noop,beforeClearChoose:r.noop,callback:r.noop,afterHide:r.noop},e),i.data("dropdown.settings",a),a.data?i.dropdown("initNode"):(a.parent=i,i.find('li[role="submenu"]').each(function(){r(this).data("dropdown.settings",a)})),i.attr("role","dropdown"),t=n(i),t.children("."+a.subMenuClass).attr({role:"submenu"}),i.dropdown("initEvent")})},initNode:function(){var e=r(this),t=e.data("dropdown.settings");t.parent=t.parent||"body",r(t.parent).append(a(e))},initEvent:function(){var e=r(this),i=e.data("dropdown.settings"),a=n(e),s=a.children('[role="submenu"]');a.on("click.dropdown",'li[role!="submenu"]',function(t){var n,a;e.dropdown("hide"),r(this).data("trigger",e),n=r(this).hasClass(i.chooseClass),a=r.extend({},r(this).data("node"),{isSame:n,li:this}),i.beforeClearChoose.call(this,a)!==!1&&r(this).dropdown("choose",!1,!0),r(this).dropdown("choose",!0),r.isFunction(i.callback)&&i.callback.call(this,r.extend({},r(this).data("node"),{isSame:n,li:this})),t.preventDefault(),t.stopPropagation()}),e.on("click.dropdown",function(a){var s=n(r(this)),o=!0;s.hasClass(i.showClass)?e.dropdown("hide"):(r(document).trigger("hide.menu"),0!==s.find("."+i.subMenuClass).length||s.hasClass("u-scroll")||s.addClass("u-scroll").css({maxHeight:i.maxHeight+"px",maxWidth:i.maxWidth+"px"}),t(r(this)),r.isFunction(i.beforeShow)&&(o=i.beforeShow.call(this,a)),o!==!1&&r(this).dropdown("show")),a.preventDefault(),a.stopPropagation()}),s.each(function(){r(this).hover(function(e){t(r(this)),r(this).dropdown("show",!0),e.stopPropagation()},function(e){r(this).dropdown("hide",!0),e.stopPropagation()})})},choose:function(e,t){var n,i,a,s;("boolean"===r.type(t)||void 0==t)&&(s=t,t=r(this)),i=t&&t.closest('li[role="submenu"]'),(!i||i.length<=0)&&(i=t&&t.data("trigger")),(!i||i.length<=0)&&(i=r(this)),a=i.data("menu")||i.children("ul"),n=i.data("dropdown.settings"),s?a.children("li."+n.chooseClass).removeClass(n.chooseClass).children("."+n.chooseClass).remove():e?(t.addClass(n.chooseClass),n.chooseHtml&&t.children("i.iconfont").length<=0&&t.append(r(n.chooseHtml).addClass(n.chooseClass))):(t.removeClass(n.chooseClass),t.children("."+n.chooseClass).remove())},show:function(e){var t=r(this).data("dropdown.settings"),i=n(r(this));i.hasClass(t.hiddenClass)&&i.removeClass(t.hiddenClass).addClass(t.showClass),e||r(this).addClass("active")},hide:function(e){var t=r(this).data("dropdown.settings"),i=n(r(this));i.hasClass(t.showClass)&&(i.removeClass(t.showClass).addClass(t.hiddenClass),t.afterHide.call(this)),e||r(this).removeClass("active")},destroy:function(){var e=r(this).data("dropdown.settings");r(this).data("menu")&&r(r(this).data("menu")).remove(),r(this).removeData("dropdown.settings").removeData("menu").removeAttr("role").off(),e&&r(this).find("."+e.menuClass).remove()}};r.fn.dropdown=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):r.isPlainObject(e)?o.init.apply(this,arguments):void r.error("Method"+e+"does not exist on jQuery.dropdown")},r(document).on("click.dropdown",'[role!="dropdown"]',function(){r(document).trigger("hide.menu")}),r(document).on("hide.menu",function(){i()})}),define("widget/mask/mask",["require","jquery"],function(e){var t=e("jquery"),n={init:function(e){var n,i=t(this).children(".u-lmask");return e=t.extend({opacity:.8,backgroundColor:"#fff",loading:!0,message:""},e),i.length>0?(t(this).mask("show"),!0):(i=t("<div/>",{"class":"u-lmask"}).css({opacity:e.opacity,backgroundColor:e.backgroundColor}).append(t("<div/>",{"class":"u-lmask-floater"})).append(t("<div/>",{"class":"u-lmask-content"})),e.loading&&i.children(".u-lmask-content").append(t("<div/>",{"class":"u-lmask-loading"})),e.message&&i.children(".u-lmask-content").append(t("<div/>",{"class":"u-lmask-message",html:e.message})),n=t(this).css("position"),"absolute"!==n&&"relative"!==n&&"fixed"!==n&&t(this).css("position","relative"),t(this).append(i),void t(this).mask("bindHandler"))},show:function(){t(this).children(".u-lmask").show()},hide:function(){t(this).children(".u-lmask").hide()},destroy:function(){t(this).off("scroll.u-lmask"),t(this).children(".u-lmask").remove()},bindHandler:function(){t(this).on("scroll.u-lmask",function(){var e=t(this),n=e.children(".u-lmask");n.css({top:e[0].scrollTop+"px",left:e[0].scrollLeft+"px"})})}};t.fn.mask=function(e){return"string"===t.type(e)&&n[e]?(n[e].call(this),this):t.isPlainObject(e)||!e?(n.init.call(this,e),this):void t.error("Method"+e+"does not exist on jQuery.mask")}}),define("widget/notify/notify",["require","jquery"],function(e){function t(e,t){"string"==typeof e&&(t=t||{},t.body=e,e=t),this.opt=i.extend(!0,{},r,e),this.queueName=this.opt.queue||this._wrapperHash(),this.wrapper=this._wrapper(),this.hash=this._hash()}function n(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?t[2]:null}var i=e("jquery"),a={wrappers:{},lives:{},queue:{}},r={afterClose:void 0,afterOpen:void 0,afterClick:void 0,beforeClose:void 0,beforeOpen:void 0,mouseout:void 0,mouseover:void 0,parentNode:"body",wrapperClass:"u-notify-wrapper",notifyClass:"u-notify",title:void 0,body:void 0,destroy:!1,forever:!1,effect:"slide",showTime:300,hideTime:300,timeout:5e3,max:1,queue:"",noqueue:!0,closeIcon:"&times;",type:"success",position:"top-center",titleIsHTML:!1,bodyIsHTML:!1};t.prototype={constructor:t,_hash:function(){return+new Date},_timeoutKey:function(){return"notify_"+this.hash},_wrapperHash:function(){var e,t,n=this.opt.position,i="";if("string"==typeof n)i=n;else{for(e in n)n.hasOwnProperty(e)&&(i+=e+"="+n[e]+"&");i=i.substring(0,i.length-1)}return t=a.wrappers[i],t=t?t:a.wrappers[i]=this._hash().toFixed().substring(5)},_wrapper:function(){var e=i("div.u-notify-wrapper."+this.queueName);return e.length?e:i("<div />").addClass(this.opt.wrapperClass+" "+this.queueName).appendTo(this.opt.parentNode)},_checkWrapper:function(){this.wrapper.children().length||this.wrapper.remove()},_create:function(){this.item=this._build(),this._bindClick(),this._bindMouseenter(),this.opt.forever||(this._scheduleClose(),this._bindMouseleave()),this._position(this.opt.position),this._open()},_build:function(){var e=i("<div />",{"class":this.opt.notifyClass});return this.opt.title&&e.append('<div class="title">'+(this.opt.titleIsHTML?this.opt.title:this.opt.title.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))+"</div>"),e.append('<div class="body">'+(this.opt.bodyIsHTML?this.opt.body:this.opt.body.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))+"</div>"),this.opt.extendBtn&&e.find("div.body").append('<span class="extend-btn">'+this.opt.extendBtn+"</span>"),this.opt.closeIcon&&(this.opt.title?e.find("div.title").append('<span class="close">'+this.opt.closeIcon+"</span>"):e.find("div.body").append('<span class="close">'+this.opt.closeIcon+"</span>")),"loading"===this.opt.type?e.prepend(i("<div />",{"class":"loading"})).addClass(this.opt.notifyClass):e.addClass(this.opt.notifyClass+"-"+this.opt.type),e},_position:function(e){var t,n,a,r,s;if(a=this.item.clone(),a.css({position:"absolute",left:"-9999px",top:"-9999px"}).appendTo(document.body),r=a.outerWidth(),s=a.outerHeight(),(!this.maxWidth||this.maxWidth<r)&&(this.maxWidth=r),(!this.maxHeight||this.maxHeight<s)&&(this.maxHeight=s),a.remove(),a=null,n=i(this.opt.parentNode)[0].offsetWidth,"string"==typeof e)switch(e){case"top-center":t={top:"2px",left:(n-this.maxWidth)/2+"px"};break;case"top-left":t={top:"2px",left:"2px"};break;case"top-right":t={top:"2px",right:"2px"};break;case"bottom-left":t={bottom:"2px",left:"2px"};break;case"bottom-center":t={bottom:"2px",left:(n-this.maxWidth)/2+"px"};break;case"bottom-right":t={bottom:"2px",right:"2px"}}else t=e;this.wrapper.css(t)},_bindClick:function(){var e=this;e.item.on("click.notify",".close",function(t){e._execute("afterClick"),e._close()}),e.item.on("click.notify",".extend-btn",function(t){e._execute("afterClick"),e.opt.callback&&i.isFunction(e.opt.callback)&&e.opt.callback.call(e,t),e._close()})},_bindMouseenter:function(){var e=this;e.item.on("mouseenter.notify",function(t){e._execute("mouseover",t)&&e._unscheduleClose()})},_bindMouseleave:function(){var e=this;e.item.on("mouseleave.notify",function(t){e._execute("mouseout",t)&&e._scheduleClose()})},_execute:function(e,t){var n;return i.isFunction(this.opt[e])&&(n=this.opt[e].apply(this,Array.prototype.slice.call(arguments,1))),n||void 0===n},_open:function(){this._execute("beforeOpen")&&this._show()},_show:function(){var e=this;switch(e.opt.effect){case"slide":e.item.appendTo(this.wrapper).slideDown(this.opt.showTime,function(){e._execute("afterOpen")});break;case"fade":e.item.appendTo(this.wrapper).fadeIn(this.opt.showTime,function(){e._execute("afterOpen")})}},_hide:function(){switch(this.opt.effect){case"slide":this.item.slideUp(this.opt.hideTime,i.proxy(this._close,this));break;case"fade":this.item.fadeOut(this.opt.hideTime,i.proxy(this._close,this))}},_close:function(e){this.item&&this._execute("beforeClose",e)&&(this.item.remove(),this.item=null,this._pipe(),this.opt.destroy&&this._checkWrapper(),this._execute("afterClose"))},_pipe:function(){var e,t=a.lives[this.queueName],n=a.queue[this.queueName];t&&t.shift(),e=n&&n.shift(),e&&(t?t.push(e):t=[e],e._create())},_scheduleClose:function(){this[this._timeoutKey()]=setTimeout(i.proxy(this._hide,this),this.opt.timeout)},_unscheduleClose:function(){clearTimeout(this[this._timeoutKey()]),this.item.stop().css({opacity:"",height:""})},_push:function(){var e=a.lives[this.queueName]||(a.lives[this.queueName]=[]),t=a.queue[this.queueName]||(a.queue[this.queueName]=[]),n=e.length<this.opt.max;return n?e.push(this):t.push(this),n},close:function(){this._close()},position:function(e){this._position(e)}},i.notify=function(e,n){var a=new t(e,n);return a.opt.noqueue&&(i.notify.clean(null,a.queueName),a.wrapper.empty()),a._push()&&a._create(),a},i.notify.closeLast=function(){var e;i.each(a.lives,function(t,n){return n.length>0&&n[0].opt.extendBtn?(e=n[0],!0):void 0}),e&&(e._unscheduleClose(),e._hide())},i.notify.clean=function(e,t){return e||t?!e&&t?(a.lives[t]&&(a.lives[t]=[]),a.queue[t]&&(a.queue[t]=[])):("queue"===e||"lives"===e)&&(t?a[e][t]&&(a[e][t]=[]):a[e]={}):(a.queue={},a.lives={}),i.notify},i.notify.success=function(e,t){return i.notify(e,i.extend(t,{type:"success"}))},i.notify.info=function(e,t){return i.notify(e,i.extend(t,{type:"info"}))},i.notify.warning=function(e,t){return i.notify(e,i.extend(t,{type:"warning"}))},i.notify.error=function(e,t){return i.notify(e,i.extend(t,{type:"error"}))};var s;i.notify.loading=function(e){var t,a=n("locale")||"zh_CN",r="";"string"==typeof e&&(r=e,e={}),t="zh_CN"===a?"...":"loading...",e=i.extend({wrapperClass:"u-notify-wrapper u-notify-loading",type:"loading",body:t,position:{top:"2px",left:"300px"},forever:!0,closeIcon:!1,extendBtn:!1,showTime:100,hideTime:100},e),"hide"===r?(s&&s._hide(),s=null):s=i.notify(e)}}),define("cui/core/class/class",[],function(){function e(t){return this instanceof e||!l(t)?void 0:n(t)}function t(t){var n,i;for(n in t)i=t[n],e.Mutators.hasOwnProperty(n)?e.Mutators[n].call(this,i):this.prototype[n]=i}function n(n){return n.extend=e.extend,n.implement=t,n}function i(){}function a(e,t,n){for(var i in t)if(t.hasOwnProperty(i)){if(n&&-1===c(n,i))continue;"prototype"!==i&&(e[i]=t[i])}}e.create=function(i,r){function s(){i.apply(this,arguments),this.constructor===s&&this.initialize&&this.initialize.apply(this,arguments)}return l(i)||(r=i,i=null),r||(r={}),i||(i=r.Extends||e),r.Extends=i,i!==e&&a(s,i,i.StaticsWhiteList),t.call(s,r),n(s)},e.extend=function(t){return t||(t={}),t.Extends=this,e.create(t)},e.Mutators={Extends:function(e){var t=this.prototype,n=r(e.prototype);a(n,t),n.constructor=this,this.prototype=n,this.superclass=e.prototype},Implements:function(e){o(e)||(e=[e]);for(var t,n=this.prototype;t=e.shift();)a(n,t.prototype||t)},Statics:function(e){a(this,e)}};var r=Object.__proto__?function(e){return{__proto__:e}}:function(e){return i.prototype=e,new i},s=Object.prototype.toString,o=Array.isArray||function(e){return"[object Array]"===s.call(e)},l=function(e){return"[object Function]"===s.call(e)},c=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1};return e}),define("widget/clipboard/clipboard-action",["require","cui/core/class/class","jquery"],function(e){
var t=e("cui/core/class/class"),n=e("jquery"),i=function(e){var t;if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName)e.focus(),e.setSelectionRange(0,e.value.length),t=e.value;else{e.hasAttribute("contenteditable")&&e.focus();var n=window.getSelection(),i=document.createRange();i.selectNodeContents(e),n.removeAllRanges(),n.addRange(i),t=n.toString()}return t},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n){return n&&e(t,n),t}}(),r=t.create({initialize:function(e){this.resolveOptions(e),this.initSelection(),this.initPropCheck()},resolveOptions:function(e){e=e||{},this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""},initSelection:function(){this.text?this.selectFake():this.target&&this.selectTarget()},initPropCheck:function(){a(this,[{key:"action",set:function(){var e=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}}]),a(this,[{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!=("undefined"==typeof e?"undefined":typeof e)||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}])},selectFake:function(){var e="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandler=document.body.addEventListener("click",n.proxy(this.removeFake,this)),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="fixed",this.fakeElem.style[e?"right":"left"]="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=i(this.fakeElem),this.copyText()},removeFake:function(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},selectTarget:function(){this.selectedText=i(this.target),this.copyText()},copyText:function(){var e;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)},handleResult:function(e){e?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},clearSelection:function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},destroy:function(){this.removeFake()}});return r}),define("cui/core/events/events",[],function(){function e(e){return"[object Function]"===Object.prototype.toString.call(e)}function t(){}function n(e,t,n){var i=!0;if(e){var a=0,r=e.length,s=t[0],o=t[1],l=t[2];switch(t.length){case 0:for(;r>a;a+=2)i=e[a].call(e[a+1]||n)!==!1&&i;break;case 1:for(;r>a;a+=2)i=e[a].call(e[a+1]||n,s)!==!1&&i;break;case 2:for(;r>a;a+=2)i=e[a].call(e[a+1]||n,s,o)!==!1&&i;break;case 3:for(;r>a;a+=2)i=e[a].call(e[a+1]||n,s,o,l)!==!1&&i;break;default:for(;r>a;a+=2)i=e[a].apply(e[a+1]||n,t)!==!1&&i}}return i}var i=/\s+/,a=Object.keys;return a||(a=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),t.prototype.on=function(e,t,n){var a,r,s;if(!t)return this;for(r=this.__events||(this.__events={}),e=e.split(i);a=e.shift();)s=r[a]||(r[a]=[]),s.push(t,n);return this},t.prototype.once=function(e,t,n){var i=this,a=function(){i.off(e,a),t.apply(n||i,arguments)};return this.on(e,a,n)},t.prototype.off=function(e,t,n){var r,s,o,l;if(!(r=this.__events))return this;if(!(e||t||n))return delete this.__events,this;for(e=e?e.split(i):a(r);s=e.shift();)if(o=r[s])if(t||n)for(l=o.length-2;l>=0;l-=2)t&&o[l]!==t||n&&o[l+1]!==n||o.splice(l,2);else delete r[s];return this},t.prototype.trigger=function(e){var t,a,r,s,o,l=[],c=!0;if(!(t=this.__events))return this;for(e=e.split(i),s=1,o=arguments.length;o>s;s++)l[s-1]=arguments[s];for(;a=e.shift();)(r=t[a])&&(r=r.slice()),c=n(r,l,this)&&c;return c},t.prototype.emit=t.prototype.trigger,t.mixTo=function(n){function i(e){n[e]=function(){return r[e].apply(s,Array.prototype.slice.call(arguments)),this}}var a,r=t.prototype;if(e(n))for(a in r)r.hasOwnProperty(a)&&(n.prototype[a]=r[a]);else{var s=new t;for(a in r)r.hasOwnProperty(a)&&i(a)}},t}),define("cui/util/detector/detector",[],function(){function e(e){return Object.prototype.toString.call(e)}function t(t){return"[object Object]"===e(t)}function n(t){return"[object Function]"===e(t)}function i(e,t,n){for(var i=0,a=e.length;a>i&&t.call(e,e[i],i)!==!1;i++);}function a(e){if(!p.test(e))return null;var t,n,i,a,r;if(-1!==e.indexOf("trident/")&&(t=/\btrident\/([0-9.]+)/.exec(e),t&&t.length>=2)){i=t[1];var s=t[1].split(".");s[0]=parseInt(s[0],10)+4,r=s.join(".")}t=p.exec(e),a=t[1];var o=t[1].split(".");return"undefined"==typeof r&&(r=a),o[0]=parseInt(o[0],10)-4,n=o.join("."),"undefined"==typeof i&&(i=n),{browserVersion:r,browserMode:a,engineVersion:i,engineMode:n,compatible:i!==n}}function r(e){if(l)try{var t=l.twGetRunPath.toLowerCase(),n=l.twGetSecurityID(u),i=l.twGetVersion(n);if(t&&-1===t.indexOf(e))return!1;if(i)return{version:i}}catch(a){}}function s(i,a,r){var s=n(a)?a.call(null,r):a;if(!s)return null;var o={name:i,version:d,codename:""},l=e(s);if(s===!0)return o;if("[object String]"===l){if(-1!==r.indexOf(s))return o}else{if(t(s))return s.hasOwnProperty("version")&&(o.version=s.version),o;if(s.exec){var c=s.exec(r);if(c)return c.length>=2&&c[1]?o.version=c[1].replace(/_/g,"."):o.version=d,o}}}function o(e,t,n,a){var r=b;i(t,function(t){var n=s(t[0],t[1],e);return n?(r=n,!1):void 0}),n.call(a,r.name,r.version)}var l,c={},d="-1",u=this,p=/\b(?:msie |ie |trident\/[0-9].*rv[ :])([0-9.]+)/,h=/\bbb10\b.+?\bversion\/([\d.]+)/,f=/\bblackberry\b.+\bversion\/([\d.]+)/,m=/\bblackberry\d+\/([\d.]+)/,g=[["nokia",function(e){return-1!==e.indexOf("nokia ")?/\bnokia ([0-9]+)?/:/\bnokia([a-z0-9]+)?/}],["samsung",function(e){return-1!==e.indexOf("samsung")?/\bsamsung(?:\-gt)?[ \-]([a-z0-9\-]+)/:/\b(?:gt|sch)[ \-]([a-z0-9\-]+)/}],["wp",function(e){return-1!==e.indexOf("windows phone ")||-1!==e.indexOf("xblwp")||-1!==e.indexOf("zunewp")||-1!==e.indexOf("windows ce")}],["pc","windows"],["ipad","ipad"],["ipod","ipod"],["iphone",/\biphone\b|\biph(\d)/],["mac","macintosh"],["mi",/\bmi[ \-]?([a-z0-9 ]+(?= build|\)))/],["hongmi",/\bhm[ \-]?([a-z0-9]+)/],["aliyun",/\baliyunos\b(?:[\-](\d+))?/],["meizu",/\b(?:meizu\/|m)([0-9]+)\b/],["nexus",/\bnexus ([0-9s.]+)/],["huawei",function(e){var t=/\bmediapad (.+?)(?= build\/huaweimediapad\b)/;return-1!==e.indexOf("huawei-huawei")?/\bhuawei\-huawei\-([a-z0-9\-]+)/:t.test(e)?t:/\bhuawei[ _\-]?([a-z0-9]+)/}],["lenovo",function(e){return-1!==e.indexOf("lenovo-lenovo")?/\blenovo\-lenovo[ \-]([a-z0-9]+)/:/\blenovo[ \-]?([a-z0-9]+)/}],["zte",function(e){return/\bzte\-[tu]/.test(e)?/\bzte-[tu][ _\-]?([a-su-z0-9\+]+)/:/\bzte[ _\-]?([a-su-z0-9\+]+)/}],["vivo",/\bvivo(?: ([a-z0-9]+))?/],["htc",function(e){return/\bhtc[a-z0-9 _\-]+(?= build\b)/.test(e)?/\bhtc[ _\-]?([a-z0-9 ]+(?= build))/:/\bhtc[ _\-]?([a-z0-9 ]+)/}],["oppo",/\boppo[_]([a-z0-9]+)/],["konka",/\bkonka[_\-]([a-z0-9]+)/],["sonyericsson",/\bmt([a-z0-9]+)/],["coolpad",/\bcoolpad[_ ]?([a-z0-9]+)/],["lg",/\blg[\-]([a-z0-9]+)/],["android",/\bandroid\b|\badr\b/],["blackberry",function(e){return e.indexOf("blackberry")>=0?/\bblackberry\s?(\d+)/:"bb10"}]],v=[["wp",function(e){return-1!==e.indexOf("windows phone ")?/\bwindows phone (?:os )?([0-9.]+)/:-1!==e.indexOf("xblwp")?/\bxblwp([0-9.]+)/:-1!==e.indexOf("zunewp")?/\bzunewp([0-9.]+)/:"windows phone"}],["windows",/\bwindows nt ([0-9.]+)/],["macosx",/\bmac os x ([0-9._]+)/],["ios",function(e){return/\bcpu(?: iphone)? os /.test(e)?/\bcpu(?: iphone)? os ([0-9._]+)/:-1!==e.indexOf("iph os ")?/\biph os ([0-9_]+)/:/\bios\b/}],["yunos",/\baliyunos ([0-9.]+)/],["android",function(e){return e.indexOf("android")>=0?/\bandroid[ \/-]?([0-9.x]+)?/:e.indexOf("adr")>=0?e.indexOf("mqqbrowser")>=0?/\badr[ ]\(linux; u; ([0-9.]+)?/:/\badr(?:[ ]([0-9.]+))?/:"android"}],["chromeos",/\bcros i686 ([0-9.]+)/],["linux","linux"],["windowsce",/\bwindows ce(?: ([0-9.]+))?/],["symbian",/\bsymbian(?:os)?\/([0-9.]+)/],["blackberry",function(e){var t=e.match(h)||e.match(f)||e.match(m);return t?{version:t[1]}:"blackberry"}]],_=[["trident",p],["blink",function(e){return"chrome"in u&&"CSS"in u&&/\bapplewebkit[\/]?([0-9.+]+)/}],["webkit",/\bapplewebkit[\/]?([0-9.+]+)/],["gecko",function(e){var t;return(t=e.match(/\brv:([\d\w.]+).*\bgecko\/(\d+)/))?{version:t[1]+"."+t[2]}:void 0}],["presto",/\bpresto\/([0-9.]+)/],["androidwebkit",/\bandroidwebkit\/([0-9.]+)/],["coolpadwebkit",/\bcoolpadwebkit\/([0-9.]+)/],["u2",/\bu2\/([0-9.]+)/],["u3",/\bu3\/([0-9.]+)/]],y=[["sogou",function(e){return e.indexOf("sogoumobilebrowser")>=0?/sogoumobilebrowser\/([0-9.]+)/:e.indexOf("sogoumse")>=0?!0:/ se ([0-9.x]+)/}],["theworld",function(e){var t=r("theworld");return"undefined"!=typeof t?t:"theworld"}],["360",function(e){var t=r("360se");return"undefined"!=typeof t?t:-1!==e.indexOf("360 aphone browser")?/\b360 aphone browser \(([^\)]+)\)/:/\b360(?:se|ee|chrome|browser)\b/}],["maxthon",function(e){try{if(l&&(l.mxVersion||l.max_version))return{version:l.mxVersion||l.max_version}}catch(t){}return/\b(?:maxthon|mxbrowser)(?:[ \/]([0-9.]+))?/}],["qq",/\bm?qqbrowser\/([0-9.]+)/],["green","greenbrowser"],["tt",/\btencenttraveler ([0-9.]+)/],["liebao",function(e){if(e.indexOf("liebaofast")>=0)return/\bliebaofast\/([0-9.]+)/;if(-1===e.indexOf("lbbrowser"))return!1;var t;try{l&&l.LiebaoGetVersion&&(t=l.LiebaoGetVersion())}catch(n){}return{version:t||d}}],["tao",/\btaobrowser\/([0-9.]+)/],["coolnovo",/\bcoolnovo\/([0-9.]+)/],["saayaa","saayaa"],["baidu",/\b(?:ba?idubrowser|baiduhd)[ \/]([0-9.x]+)/],["ie",p],["mi",/\bmiuibrowser\/([0-9.]+)/],["opera",function(e){var t=/\bopera.+version\/([0-9.ab]+)/,n=/\bopr\/([0-9.]+)/;return t.test(e)?t:n}],["oupeng",/\boupeng\/([0-9.]+)/],["yandex",/yabrowser\/([0-9.]+)/],["ali-ap",function(e){return e.indexOf("aliapp")>0?/\baliapp\(ap\/([0-9.]+)\)/:/\balipayclient\/([0-9.]+)\b/}],["ali-ap-pd",/\baliapp\(ap-pd\/([0-9.]+)\)/],["ali-am",/\baliapp\(am\/([0-9.]+)\)/],["ali-tb",/\baliapp\(tb\/([0-9.]+)\)/],["ali-tb-pd",/\baliapp\(tb-pd\/([0-9.]+)\)/],["ali-tm",/\baliapp\(tm\/([0-9.]+)\)/],["ali-tm-pd",/\baliapp\(tm-pd\/([0-9.]+)\)/],["uc",function(e){return e.indexOf("ucbrowser/")>=0?/\bucbrowser\/([0-9.]+)/:e.indexOf("ubrowser/")>=0?/\bubrowser\/([0-9.]+)/:/\buc\/[0-9]/.test(e)?/\buc\/([0-9.]+)/:e.indexOf("ucweb")>=0?/\bucweb([0-9.]+)?/:/\b(?:ucbrowser|uc)\b/}],["chrome",/ (?:chrome|crios|crmo)\/([0-9.]+)/],["android",function(e){return-1!==e.indexOf("android")?/\bversion\/([0-9.]+(?: beta)?)/:void 0}],["blackberry",function(e){var t=e.match(h)||e.match(f)||e.match(m);return t?{version:t[1]}:"blackberry"}],["safari",/\bversion\/([0-9.]+(?: beta)?)(?: mobile(?:\/[a-z0-9]+)?)? safari\//],["webview",/\bcpu(?: iphone)? os (?:[0-9._]+).+\bapplewebkit\b/],["firefox",/\bfirefox\/([0-9.ab]+)/],["nokia",/\bnokiabrowser\/([0-9.]+)/]],b={name:"na",version:d},w=function(e){e=(e||"").toLowerCase();var t={};o(e,g,function(e,n){var i=parseFloat(n);t.device={name:e,version:i,fullVersion:n},t.device[e]=i},t),o(e,v,function(e,n){var i=parseFloat(n);t.os={name:e,version:i,fullVersion:n},t.os[e]=i},t);var n=a(e);return o(e,_,function(e,i){var a=i;n&&(i=n.engineVersion||n.engineMode,a=n.engineMode);var r=parseFloat(i);t.engine={name:e,version:r,fullVersion:i,mode:parseFloat(a),fullMode:a,compatible:n?n.compatible:!1},t.engine[e]=r},t),o(e,y,function(e,i){var a=i;n&&("ie"===e&&(i=n.browserVersion),a=n.browserMode);var r=parseFloat(i);t.browser={name:e,version:r,fullVersion:i,mode:parseFloat(a),fullMode:a,compatible:n?n.compatible:!1},t.browser[e]=r},t),t},M=navigator.userAgent||"",T=navigator.appVersion||"",L=navigator.vendor||"";return l=u.external,c=w(M+" "+T+" "+L),c.parse=w,c}),define("util/detector",["require","cui/util/detector/detector"],function(e){function t(){return/detach.jsp$/.test(location.pathname)}function n(){var e,t;return t=window.navigator.userAgent.match(/Chrome\/(\d+)\./),t&&t[1]&&(e=function(){var e,t=/(Java)(\(TM\)| Deployment)/,n=navigator.plugins||[];for(e in n)if(n.hasOwnProperty(e)&&t.exec(n[e].name))return!0;return!1}(),parseInt(t[1],10)>=42&&!e)?!1:!0}function i(){var e=window.navigator.userAgent;return e.indexOf("MSIE ")>-1||e.indexOf("Trident/")>-1}function a(){return i()&&d.version<11}function r(){return"ie"===d.name?d.version>=9?!0:window.clipboardData?"oldie":!1:"chrome"===d.name&&d.version>=42||"firefox"===d.name&&d.version>=41||"opera"===d.name&&d.version>=29}function s(){var e=function(){var e=document.createElement("INPUT");return e.type="file","files"in e}(),t=function(){return!!window.FormData}();return e&&t}function o(){return!!window.URL&&window.URL.createObjectURL}function l(e){var t=function(){var e=-1,t=navigator.userAgent;return"Microsoft Internet Explorer"===navigator.appName?null!==/MSIE ([0-9]+[.0-9]*)/.exec(t)&&(e=parseInt(RegExp.$1,10)):"Netscape"===navigator.appName&&null!==/Trident\/.*rv:([0-9]+[.0-9]*)/.exec(t)&&(e=parseInt(RegExp.$1,10)),e}(),n=t>0,i=/^(1[0-1]|[6-9])([+-])?$/.exec(e);if(void 0===e||null===i||!n)return n;var a=parseInt(i[1],10),r=i[2];switch(r){case"+":return t>=a;case"-":return a>=t;case void 0:return t===a;default:return t===a}}var c=e("cui/util/detector/detector"),d=c.browser;return{isDetachMode:t,isSupportNPAPI:n,isClipboardSupport:r,isIE:i,isLowerIE11:a,supportAjaxUpload:s,supportBlobURL:o,isIEByVersion:l,device:c.device,os:c.os,engine:c.engine,browser:d}}),define("widget/clipboard/clipboard",["require","./clipboard-action","cui/core/class/class","cui/core/events/events","jquery","util/detector"],function(e){function t(e,t){var n="data-clipboard-"+e;if(t.hasAttribute(n))return t.getAttribute(n)}var n=e("./clipboard-action"),i=e("cui/core/class/class"),a=e("cui/core/events/events"),r=e("jquery"),s=e("util/detector"),o=i.create({Implements:a,initialize:function(e,t){this.resolveOptions(t),this.listenClick(e)},resolveOptions:function(e){e=e||{},this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText},listenClick:function(e){this.trigger=r(e).on("click",r.proxy(this.onClick,this))},onClick:function(e){var t=e.delegateTarget||e.currentTarget;if("oldie"===s.isClipboardSupport()){var i=window.clipboardData.setData("Text",this.text(t));return i?this.emit("success"):this.emit("error"),!1}this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new n({action:this.action(t),target:this.target(t),text:this.text(t),trigger:t,emitter:this})},defaultAction:function(e){return t("action",e)},defaultTarget:function(e){var n=t("target",e);return n?document.querySelector(n):void 0},defaultText:function(e){return t("text",e)},destroy:function(){this.trigger.off("click"),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}});return o}),define("init",["require","i18n","components/jquery.serializeJSON/jquery.serializejson","widget/customRadioCheckbox/jquery.customRadioCheckbox","widget/dropdown/dropdown","widget/mask/mask","widget/notify/notify","widget/clipboard/clipboard","util/common-controls","./configstore"],function(e){var t,n;if(e("i18n"),e("components/jquery.serializeJSON/jquery.serializejson"),e("widget/customRadioCheckbox/jquery.customRadioCheckbox"),e("widget/dropdown/dropdown"),e("widget/mask/mask"),e("widget/notify/notify"),e("widget/clipboard/clipboard"),window.CC=e("util/common-controls"),t=e("./configstore"),n=t.getConfig(),!n||!n.context)throw new Error("Load config failed");return CC.setLocale(n.context.locale),CC}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("components/es5-shim/es5-shim",t):"object"==typeof exports?module.exports=t():e.returnExports=t()}(this,function(){var e,t=Array,n=t.prototype,i=Object,a=i.prototype,r=Function.prototype,s=String,o=s.prototype,l=Number,c=l.prototype,d=n.slice,u=n.splice,p=n.push,h=n.unshift,f=n.concat,m=r.call,g=r.apply,v=Math.max,_=Math.min,y=a.toString,b="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,w=Function.prototype.toString,M=function(e){try{return w.call(e),!0}catch(t){return!1}},T="[object Function]",L="[object GeneratorFunction]";e=function(e){if("function"!=typeof e)return!1;if(b)return M(e);var t=y.call(e);return t===T||t===L};var x,C=RegExp.prototype.exec,S=function(e){try{return C.call(e),!0}catch(t){return!1}},k="[object RegExp]";x=function(e){return"object"!=typeof e?!1:b?S(e):y.call(e)===k};var D,Y=String.prototype.valueOf,j=function(e){try{return Y.call(e),!0}catch(t){return!1}},N="[object String]";D=function(e){return"string"==typeof e?!0:"object"!=typeof e?!1:b?j(e):y.call(e)===N};var P=i.defineProperty&&function(){try{var e={};i.defineProperty(e,"x",{enumerable:!1,value:e});for(var t in e)return!1;return e.x===e}catch(n){return!1}}(),E=function(e){var t;return t=P?function(e,t,n,a){!a&&t in e||i.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(e,t,n,i){!i&&t in e||(e[t]=n)},function(n,i,a){for(var r in i)e.call(i,r)&&t(n,r,i[r],a)}}(a.hasOwnProperty),A=function(e){var t=typeof e;return null===e||"object"!==t&&"function"!==t},F=l.isNaN||function(e){return e!==e},I={ToInteger:function(e){var t=+e;return F(t)?t=0:0!==t&&t!==1/0&&t!==-(1/0)&&(t=(t>0||-1)*Math.floor(Math.abs(t))),t},ToPrimitive:function(t){var n,i,a;if(A(t))return t;if(i=t.valueOf,e(i)&&(n=i.call(t),A(n)))return n;if(a=t.toString,e(a)&&(n=a.call(t),A(n)))return n;throw new TypeError},ToObject:function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return i(e)},ToUint32:function(e){return e>>>0}},H=function(){};E(r,{bind:function(t){var n=this;if(!e(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var a,r=d.call(arguments,1),s=function(){if(this instanceof a){var e=n.apply(this,f.call(r,d.call(arguments)));return i(e)===e?e:this}return n.apply(t,f.call(r,d.call(arguments)))},o=v(0,n.length-r.length),l=[],c=0;o>c;c++)p.call(l,"$"+c);return a=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this, arguments); }")(s),n.prototype&&(H.prototype=n.prototype,a.prototype=new H,H.prototype=null),a}});var Z=m.bind(a.hasOwnProperty),R=m.bind(a.toString),O=m.bind(d),X=g.bind(d),J=m.bind(o.slice),B=m.bind(o.split),W=m.bind(o.indexOf),q=m.bind(p),Q=m.bind(a.propertyIsEnumerable),$=m.bind(n.sort),z=t.isArray||function(e){return"[object Array]"===R(e)},U=1!==[].unshift(0);E(n,{unshift:function(){return h.apply(this,arguments),this.length}},U),E(t,{isArray:z});var G=i("a"),K="a"!==G[0]||!(0 in G),V=function(e){var t=!0,n=!0;return e&&(e.call("foo",function(e,n,i){"object"!=typeof i&&(t=!1)}),e.call([1],function(){"use strict";n="string"==typeof this},"x")),!!e&&t&&n};E(n,{forEach:function(t){var n,i=I.ToObject(this),a=K&&D(this)?B(this,""):i,r=-1,s=I.ToUint32(a.length);if(arguments.length>1&&(n=arguments[1]),!e(t))throw new TypeError("Array.prototype.forEach callback must be a function");for(;++r<s;)r in a&&("undefined"==typeof n?t(a[r],r,i):t.call(n,a[r],r,i))}},!V(n.forEach)),E(n,{map:function(n){var i,a=I.ToObject(this),r=K&&D(this)?B(this,""):a,s=I.ToUint32(r.length),o=t(s);if(arguments.length>1&&(i=arguments[1]),!e(n))throw new TypeError("Array.prototype.map callback must be a function");for(var l=0;s>l;l++)l in r&&("undefined"==typeof i?o[l]=n(r[l],l,a):o[l]=n.call(i,r[l],l,a));return o}},!V(n.map)),E(n,{filter:function(t){var n,i,a=I.ToObject(this),r=K&&D(this)?B(this,""):a,s=I.ToUint32(r.length),o=[];if(arguments.length>1&&(i=arguments[1]),!e(t))throw new TypeError("Array.prototype.filter callback must be a function");for(var l=0;s>l;l++)l in r&&(n=r[l],("undefined"==typeof i?t(n,l,a):t.call(i,n,l,a))&&q(o,n));return o}},!V(n.filter)),E(n,{every:function(t){var n,i=I.ToObject(this),a=K&&D(this)?B(this,""):i,r=I.ToUint32(a.length);if(arguments.length>1&&(n=arguments[1]),!e(t))throw new TypeError("Array.prototype.every callback must be a function");for(var s=0;r>s;s++)if(s in a&&!("undefined"==typeof n?t(a[s],s,i):t.call(n,a[s],s,i)))return!1;return!0}},!V(n.every)),E(n,{some:function(t){var n,i=I.ToObject(this),a=K&&D(this)?B(this,""):i,r=I.ToUint32(a.length);if(arguments.length>1&&(n=arguments[1]),!e(t))throw new TypeError("Array.prototype.some callback must be a function");for(var s=0;r>s;s++)if(s in a&&("undefined"==typeof n?t(a[s],s,i):t.call(n,a[s],s,i)))return!0;return!1}},!V(n.some));var ee=!1;n.reduce&&(ee="object"==typeof n.reduce.call("es5",function(e,t,n,i){return i})),E(n,{reduce:function(t){var n=I.ToObject(this),i=K&&D(this)?B(this,""):n,a=I.ToUint32(i.length);if(!e(t))throw new TypeError("Array.prototype.reduce callback must be a function");if(0===a&&1===arguments.length)throw new TypeError("reduce of empty array with no initial value");var r,s=0;if(arguments.length>=2)r=arguments[1];else for(;;){if(s in i){r=i[s++];break}if(++s>=a)throw new TypeError("reduce of empty array with no initial value")}for(;a>s;s++)s in i&&(r=t(r,i[s],s,n));return r}},!ee);var te=!1;n.reduceRight&&(te="object"==typeof n.reduceRight.call("es5",function(e,t,n,i){return i})),E(n,{reduceRight:function(t){var n=I.ToObject(this),i=K&&D(this)?B(this,""):n,a=I.ToUint32(i.length);if(!e(t))throw new TypeError("Array.prototype.reduceRight callback must be a function");if(0===a&&1===arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var r,s=a-1;if(arguments.length>=2)r=arguments[1];else for(;;){if(s in i){r=i[s--];break}if(--s<0)throw new TypeError("reduceRight of empty array with no initial value")}if(0>s)return r;do s in i&&(r=t(r,i[s],s,n));while(s--);return r}},!te);var ne=n.indexOf&&-1!==[0,1].indexOf(1,2);E(n,{indexOf:function(e){var t=K&&D(this)?B(this,""):I.ToObject(this),n=I.ToUint32(t.length);if(0===n)return-1;var i=0;for(arguments.length>1&&(i=I.ToInteger(arguments[1])),i=i>=0?i:v(0,n+i);n>i;i++)if(i in t&&t[i]===e)return i;return-1}},ne);var ie=n.lastIndexOf&&-1!==[0,1].lastIndexOf(0,-3);E(n,{lastIndexOf:function(e){var t=K&&D(this)?B(this,""):I.ToObject(this),n=I.ToUint32(t.length);if(0===n)return-1;var i=n-1;for(arguments.length>1&&(i=_(i,I.ToInteger(arguments[1]))),i=i>=0?i:n-Math.abs(i);i>=0;i--)if(i in t&&e===t[i])return i;return-1}},ie);var ae=function(){var e=[1,2],t=e.splice();return 2===e.length&&z(t)&&0===t.length}();E(n,{splice:function(e,t){return 0===arguments.length?[]:u.apply(this,arguments)}},!ae);var re=function(){var e={};return n.splice.call(e,0,0,1),1===e.length}();E(n,{splice:function(e,t){if(0===arguments.length)return[];var n=arguments;return this.length=v(I.ToInteger(this.length),0),arguments.length>0&&"number"!=typeof t&&(n=O(arguments),n.length<2?q(n,this.length-e):n[1]=I.ToInteger(t)),u.apply(this,n)}},!re);var se=function(){var e=new t(1e5);return e[8]="x",e.splice(1,1),7===e.indexOf("x")}(),oe=function(){var e=256,t=[];return t[e]="a",t.splice(e+1,0,"b"),"a"===t[e]}();E(n,{splice:function(e,t){for(var n,i=I.ToObject(this),a=[],r=I.ToUint32(i.length),o=I.ToInteger(e),l=0>o?v(r+o,0):_(o,r),c=_(v(I.ToInteger(t),0),r-l),d=0;c>d;)n=s(l+d),Z(i,n)&&(a[d]=i[n]),d+=1;var u,p=O(arguments,2),h=p.length;if(c>h){for(d=l;r-c>d;)n=s(d+c),u=s(d+h),Z(i,n)?i[u]=i[n]:delete i[u],d+=1;for(d=r;d>r-c+h;)delete i[d-1],d-=1}else if(h>c)for(d=r-c;d>l;)n=s(d+c-1),u=s(d+h-1),Z(i,n)?i[u]=i[n]:delete i[u],d-=1;d=l;for(var f=0;f<p.length;++f)i[d]=p[f],d+=1;return i.length=r-c+h,a}},!se||!oe);var le,ce=n.join;try{le="1,2,3"!==Array.prototype.join.call("123",",")}catch(de){le=!0}le&&E(n,{join:function(e){var t="undefined"==typeof e?",":e;return ce.call(D(this)?B(this,""):this,t)}},le);var ue="1,2"!==[1,2].join(void 0);ue&&E(n,{join:function(e){var t="undefined"==typeof e?",":e;return ce.call(this,t)}},ue);var pe=function(e){for(var t=I.ToObject(this),n=I.ToUint32(t.length),i=0;i<arguments.length;)t[n+i]=arguments[i],i+=1;return t.length=n+i,n+i},he=function(){var e={},t=Array.prototype.push.call(e,void 0);return 1!==t||1!==e.length||"undefined"!=typeof e[0]||!Z(e,0)}();E(n,{push:function(e){return z(this)?p.apply(this,arguments):pe.apply(this,arguments)}},he);var fe=function(){var e=[],t=e.push(void 0);return 1!==t||1!==e.length||"undefined"!=typeof e[0]||!Z(e,0)}();E(n,{push:pe},fe),E(n,{slice:function(e,t){var n=D(this)?B(this,""):this;return X(n,arguments)}},K);var me=function(){try{return[1,2].sort(null),[1,2].sort({}),!0}catch(e){}return!1}(),ge=function(){try{return[1,2].sort(/a/),!1}catch(e){}return!0}(),ve=function(){try{return[1,2].sort(void 0),!0}catch(e){}return!1}();E(n,{sort:function(t){if("undefined"==typeof t)return $(this);if(!e(t))throw new TypeError("Array.prototype.sort callback must be a function");return $(this,t)}},me||!ve||!ge);var _e=!{toString:null}.propertyIsEnumerable("toString"),ye=function(){}.propertyIsEnumerable("prototype"),be=!Z("x","0"),we=function(e){var t=e.constructor;return t&&t.prototype===e},Me={$window:!0,$console:!0,$parent:!0,$self:!0,$frame:!0,$frames:!0,$frameElement:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$external:!0},Te=function(){if("undefined"==typeof window)return!1;for(var e in window)try{!Me["$"+e]&&Z(window,e)&&null!==window[e]&&"object"==typeof window[e]&&we(window[e])}catch(t){return!0}return!1}(),Le=function(e){if("undefined"==typeof window||!Te)return we(e);try{return we(e)}catch(t){return!1}},xe=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Ce=xe.length,Se=function(e){return"[object Arguments]"===R(e)},ke=function(t){return null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&!z(t)&&e(t.callee)},De=Se(arguments)?Se:ke;E(i,{keys:function(t){var n=e(t),i=De(t),a=null!==t&&"object"==typeof t,r=a&&D(t);if(!a&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var o=[],l=ye&&n;if(r&&be||i)for(var c=0;c<t.length;++c)q(o,s(c));if(!i)for(var d in t)l&&"prototype"===d||!Z(t,d)||q(o,s(d));if(_e)for(var u=Le(t),p=0;Ce>p;p++){var h=xe[p];u&&"constructor"===h||!Z(t,h)||q(o,h)}return o}});var Ye=i.keys&&function(){return 2===i.keys(arguments).length}(1,2),je=i.keys&&function(){var e=i.keys(arguments);return 1!==arguments.length||1!==e.length||1!==e[0]}(1),Ne=i.keys;E(i,{keys:function(e){return Ne(De(e)?O(e):e)}},!Ye||je);var Pe=-621987552e5,Ee="-000001",Ae=Date.prototype.toISOString&&-1===new Date(Pe).toISOString().indexOf(Ee),Fe=Date.prototype.toISOString&&"1969-12-31T23:59:59.999Z"!==new Date(-1).toISOString();E(Date.prototype,{toISOString:function(){var e,t,n,i,a;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(i=this.getUTCFullYear(),a=this.getUTCMonth(),i+=Math.floor(a/12),a=(a%12+12)%12,e=[a+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],i=(0>i?"-":i>9999?"+":"")+J("00000"+Math.abs(i),i>=0&&9999>=i?-4:-6),t=e.length;t--;)n=e[t],10>n&&(e[t]="0"+n);return i+"-"+O(e,0,2).join("-")+"T"+O(e,2).join(":")+"."+J("000"+this.getUTCMilliseconds(),-3)+"Z"}},Ae||Fe);var Ie=function(){try{return Date.prototype.toJSON&&null===new Date(NaN).toJSON()&&-1!==new Date(Pe).toJSON().indexOf(Ee)&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(e){return!1}}();Ie||(Date.prototype.toJSON=function(t){var n=i(this),a=I.ToPrimitive(n);if("number"==typeof a&&!isFinite(a))return null;var r=n.toISOString;if(!e(r))throw new TypeError("toISOString property is not callable");return r.call(n)});var He=1e15===Date.parse("+033658-09-27T01:46:40.000Z"),Ze=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z")),Re=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(Re||Ze||!He){var Oe=Math.pow(2,31)-1,Xe=F(new Date(1970,0,1,0,0,0,Oe+1).getTime());Date=function(e){var t=function(n,i,a,r,o,l,c){var d,u=arguments.length;if(this instanceof e){var p=l,h=c;if(Xe&&u>=7&&c>Oe){var f=Math.floor(c/Oe)*Oe,m=Math.floor(f/1e3);p+=m,h-=1e3*m}d=1===u&&s(n)===n?new e(t.parse(n)):u>=7?new e(n,i,a,r,o,p,h):u>=6?new e(n,i,a,r,o,p):u>=5?new e(n,i,a,r,o):u>=4?new e(n,i,a,r):u>=3?new e(n,i,a):u>=2?new e(n,i):u>=1?new e(n):new e}else d=e.apply(this,arguments);return A(d)||E(d,{constructor:t},!0),d},n=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),i=[0,31,59,90,120,151,181,212,243,273,304,334,365],a=function(e,t){var n=t>1?1:0;return i[t]+Math.floor((e-1969+n)/4)-Math.floor((e-1901+n)/100)+Math.floor((e-1601+n)/400)+365*(e-1970)},r=function(t){var n=0,i=t;if(Xe&&i>Oe){var a=Math.floor(i/Oe)*Oe,r=Math.floor(a/1e3);n+=r,i-=1e3*r}return l(new e(1970,0,1,0,0,n,i))};for(var o in e)Z(e,o)&&(t[o]=e[o]);E(t,{now:e.now,UTC:e.UTC},!0),t.prototype=e.prototype,E(t.prototype,{constructor:t},!0);var c=function(t){var i=n.exec(t);if(i){var s,o=l(i[1]),c=l(i[2]||1)-1,d=l(i[3]||1)-1,u=l(i[4]||0),p=l(i[5]||0),h=l(i[6]||0),f=Math.floor(1e3*l(i[7]||0)),m=Boolean(i[4]&&!i[8]),g="-"===i[9]?1:-1,v=l(i[10]||0),_=l(i[11]||0),y=p>0||h>0||f>0;return(y?24:25)>u&&60>p&&60>h&&1e3>f&&c>-1&&12>c&&24>v&&60>_&&d>-1&&d<a(o,c+1)-a(o,c)&&(s=60*(24*(a(o,c)+d)+u+v*g),s=1e3*(60*(s+p+_*g)+h)+f,m&&(s=r(s)),s>=-864e13&&864e13>=s)?s:NaN}return e.parse.apply(this,arguments)};return E(t,{parse:c}),t}(Date)}Date.now||(Date.now=function(){return(new Date).getTime()});var Je=c.toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==0xde0b6b3a7640080.toFixed(0)),Be={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(e,t){for(var n=-1,i=t;++n<Be.size;)i+=e*Be.data[n],Be.data[n]=i%Be.base,i=Math.floor(i/Be.base)},divide:function(e){for(var t=Be.size,n=0;--t>=0;)n+=Be.data[t],Be.data[t]=Math.floor(n/e),n=n%e*Be.base},numToString:function(){for(var e=Be.size,t="";--e>=0;)if(""!==t||0===e||0!==Be.data[e]){var n=s(Be.data[e]);""===t?t=n:t+=J("0000000",0,7-n.length)+n}return t},pow:function ct(e,t,n){return 0===t?n:t%2===1?ct(e,t-1,n*e):ct(e*e,t/2,n)},log:function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}},We=function(e){var t,n,i,a,r,o,c,d;if(t=l(e),t=F(t)?0:Math.floor(t),0>t||t>20)throw new RangeError("Number.toFixed called with invalid number of decimals");if(n=l(this),F(n))return"NaN";if(-1e21>=n||n>=1e21)return s(n);if(i="",0>n&&(i="-",n=-n),a="0",n>1e-21)if(r=Be.log(n*Be.pow(2,69,1))-69,o=0>r?n*Be.pow(2,-r,1):n/Be.pow(2,r,1),o*=4503599627370496,r=52-r,r>0){for(Be.multiply(0,o),c=t;c>=7;)Be.multiply(1e7,0),c-=7;for(Be.multiply(Be.pow(10,c,1),0),c=r-1;c>=23;)Be.divide(1<<23),c-=23;Be.divide(1<<c),Be.multiply(1,1),Be.divide(2),a=Be.numToString()}else Be.multiply(0,o),Be.multiply(1<<-r,0),a=Be.numToString()+J("0.00000000000000000000",2,2+t);return t>0?(d=a.length,a=t>=d?i+J("0.0000000000000000000",0,t-d+2)+a:i+J(a,0,d-t)+"."+J(a,d-t)):a=i+a,a};E(c,{toFixed:We},Je);var qe=function(){try{return"1"===1..toPrecision(void 0)}catch(e){return!0}}(),Qe=c.toPrecision;E(c,{toPrecision:function(e){return"undefined"==typeof e?Qe.call(this):Qe.call(this,e)}},qe),2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){
var e="undefined"==typeof/()??/.exec("")[1],t=Math.pow(2,32)-1;o.split=function(n,i){var a=String(this);if("undefined"==typeof n&&0===i)return[];if(!x(n))return B(this,n,i);var r,s,o,l,c=[],d=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),u=0,h=new RegExp(n.source,d+"g");e||(r=new RegExp("^"+h.source+"$(?!\\s)",d));var f="undefined"==typeof i?t:I.ToUint32(i);for(s=h.exec(a);s&&(o=s.index+s[0].length,!(o>u&&(q(c,J(a,u,s.index)),!e&&s.length>1&&s[0].replace(r,function(){for(var e=1;e<arguments.length-2;e++)"undefined"==typeof arguments[e]&&(s[e]=void 0)}),s.length>1&&s.index<a.length&&p.apply(c,O(s,1)),l=s[0].length,u=o,c.length>=f)));)h.lastIndex===s.index&&h.lastIndex++,s=h.exec(a);return u===a.length?(l||!h.test(""))&&q(c,""):q(c,J(a,u)),c.length>f?J(c,0,f):c}}():"0".split(void 0,0).length&&(o.split=function(e,t){return"undefined"==typeof e&&0===t?[]:B(this,e,t)});var $e=o.replace,ze=function(){var e=[];return"x".replace(/x(.)?/g,function(t,n){q(e,n)}),1===e.length&&"undefined"==typeof e[0]}();ze||(o.replace=function(t,n){var i=e(n),a=x(t)&&/\)[*?]/.test(t.source);if(i&&a){var r=function(e){var i=arguments.length,a=t.lastIndex;t.lastIndex=0;var r=t.exec(e)||[];return t.lastIndex=a,q(r,arguments[i-2],arguments[i-1]),n.apply(this,r)};return $e.call(this,t,r)}return $e.call(this,t,n)});var Ue=o.substr,Ge="".substr&&"b"!=="0b".substr(-1);E(o,{substr:function(e,t){var n=e;return 0>e&&(n=v(this.length+e,0)),Ue.call(this,n,t)}},Ge);var Ke="	\n\x0B\f\r \u2028\u2029\ufeff",Ve="",et="["+Ke+"]",tt=new RegExp("^"+et+et+"*"),nt=new RegExp(et+et+"*$"),it=o.trim&&(Ke.trim()||!Ve.trim());E(o,{trim:function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");return s(this).replace(tt,"").replace(nt,"")}},it);var at=o.lastIndexOf&&-1!=="abc".lastIndexOf("",2);E(o,{lastIndexOf:function(e){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");for(var t=s(this),n=s(e),i=arguments.length>1?l(arguments[1]):NaN,a=F(i)?1/0:I.ToInteger(i),r=_(v(a,0),t.length),o=n.length,c=r+o;c>0;){c=v(0,c-o);var d=W(J(t,c,r+o),n);if(-1!==d)return c+d}return-1}},at);var rt=o.lastIndexOf;if(E(o,{lastIndexOf:function(e){return rt.apply(this,arguments)}},1!==o.lastIndexOf.length),(8!==parseInt(Ke+"08")||22!==parseInt(Ke+"0x16"))&&(parseInt=function(e){var t=/^[\-+]?0[xX]/;return function(n,i){var a=s(n).trim(),r=l(i)||(t.test(a)?16:10);return e(a,r)}}(parseInt)),"RangeError: test"!==String(new RangeError("test"))){var st=function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");var e=this.name;"undefined"==typeof e?e="Error":"string"!=typeof e&&(e=s(e));var t=this.message;return"undefined"==typeof t?t="":"string"!=typeof t&&(t=s(t)),e?t?e+": "+t:e:t};Error.prototype.toString=st}if(P){var ot=function(e,t){if(Q(e,t)){var n=Object.getOwnPropertyDescriptor(e,t);n.enumerable=!1,Object.defineProperty(e,t,n)}};ot(Error.prototype,"message"),""!==Error.prototype.message&&(Error.prototype.message=""),ot(Error.prototype,"name")}if("/a/gim"!==String(/a/gim)){var lt=function(){var e="/"+this.source+"/";return this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),e};RegExp.prototype.toString=lt}}),define("cui/core/view/viewmanager",["require","jquery"],function(e){function t(e){s=e}function n(e,t){return t?void(e&&"function"===a.type(t)&&("string"===a.type(e)&&(e={name:e}),r[e.name]={meta:e,view:t})):("string"===a.type(e)&&(e={name:e}),new i(e))}function i(e){this.options=e||{},this.instance=null}var a=e("jquery"),r={},s="module";return i.prototype.render=function(t){function n(e){throw l.reject(e),e&&e.requireModules?new Error("Load module '"+e.requireModules+"' failed for: "+o.options.name):e?new Error("Load '"+window.url+"' failed for module: "+o.options.name):new Error("Module not defined (load failed): "+o.options.name)}function i(c){return o.module=r[o.options.name],o.module?(t&&(o.module.meta.parentNode=t),a.extend(o.options,o.module.meta),void function(e,t){o.module.meta.config=e,o.module.meta.template=t;var n=a.extend({},o.module.meta);a.isEmptyObject(e)&&delete n.config,"string"!=typeof t&&a.isEmptyObject(t)&&delete n.template,o.instance=new o.module.view(n),o.instance.render(),l.resolve(o.instance)}(o.options.config,o.options.template)):void(c&&"string"==typeof s?e([s+"/"+o.options.name.replace(/\./g,"/")+"/index"],i,n):n())}var o=this,l=a.Deferred();return i(!0),l.promise()},i.prototype.destroy=function(){this.instance&&(this.instance.destroy(),this.instance=null)},i.prototype.beforedestroy=function(e){this.instance&&this.instance.beforedestroy&&this.instance.beforedestroy(e)},i.prototype.confirmbeforedestroy=function(){return this.instance?this.instance.confirmbeforedestroy&&this.instance.confirmbeforedestroy():!1},i.prototype.refresh=function(){return this.instance?this.instance.refresh&&this.instance.refresh():!1},{setModuleBase:t,module:n}}),define("cui/util/history/hash",["require","exports","module","jquery"],function(e,t){function n(e){return e=e||location.href,"#"+e.replace(/^[^#]*#?(.*)$/,"$1")}function i(){return(100*Math.random()).toFixed(1).replace(/\D/g,"")}var a,r,s=e("jquery"),o="hashchange",l=document,c=s.event.special,d=l.documentMode,u="on"+o in window&&(void 0===d||d>7),p=/(?:msie |trident\/.*; rv:)\d+/i.test(navigator.userAgent);r=n(),s.fn[o]=function(e,i){var a;return"function"===s.type(e)&&(i=e,e=o),"off"===e&&"string"===s.type(i)?this.off(o+"."+i):(e=o+"."+e,a=i,a&&(i=function(e){var i=n();a(e,t.getHash(i),t.getHash(r)),i!==r&&(r=i)}),i?this.bind(e,i):this.trigger(o))},s.fn[o].delay=50,c[o]=s.extend(c[o],{setup:function(){return u?!1:void s(a.start)},teardown:function(){return u?!1:void s(a.stop)}}),a=function(){function e(){var a=n(),l=h(r);a!==r?(d(r=a,l),s(window).trigger(o,[t.getHash(a),t.getHash(l)])):l!==r&&(location.href=location.href.replace(/#.*/,"")+l),i=setTimeout(e,s.fn[o].delay)}var i,a={},r=n(),c=function(e){return e},d=c,h=c;return a.start=function(){i||e()},a.stop=function(){i&&clearTimeout(i),i=void 0},p&&!u&&function(){var t,i;a.start=function(){t||(i=s.fn[o].src,i=i&&i+n(),t=s('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){i||d(n()),e()}).attr("src",i||"javascript:0").insertAfter("body")[0].contentWindow,l.onpropertychange=function(){try{"title"===event.propertyName&&(t.document.title=l.title)}catch(e){}})},a.stop=c,h=function(){return n(t.location.href)},d=function(e,n){var i=t.document;e!==n&&(i.title=l.title,i.open(),i.close(),t.location.hash=e)}}(),a}(),t.stringifyHash=function(e,t){var n;return t="boolean"===s.type(t)?t:!0,"string"===s.type(e)?n=t?encodeURIComponent(e):e:s.isPlainObject(e)&&(n=encodeURIComponent(e.module+(s.isEmptyObject(e.param)?"":"|"+JSON.stringify(e.param)))),n||""},t.addHash=function(e,n,a){a="boolean"==typeof a?a:!1;var r,o;r=a?"string"===s.type(e)?e+"?hid="+i():e.module+"?hid="+i():e,o=t.stringifyHash(r,n),o&&(location.href=location.href.replace(/#.*/,"")+"#"+o)},t.getHash=function(e){var t,i,a,r={};return e=decodeURIComponent((e||n()).substring(1)),t=e.indexOf("|"),t=t>=0?t:e.length,i=e.substring(0,t),a=e.substring(t+1),r.param=a?JSON.parse(a):{},i=i.split("?"),a=i[1],i=i[0],a&&(a=a.split("&"),s.each(a,function(e,t){t=t.split("="),r.param[t[0]]=t[1]})),r.module=i,r}}),define("cui/core/base/aspect",["require","exports","module"],function(e,t,n){function i(e,t,n,i){for(var o,l,c=t.split(s);o=c.shift();)l=a(this,o),l.__isAspected||r.call(this,o),this.on(e+":"+o,n,i);return this}function a(e,t){var n=e[t];if(!n)throw new Error("Invalid method name: "+t);return n}function r(e){var t=this[e];this[e]=function(){var n=Array.prototype.slice.call(arguments),i=["before:"+e].concat(n);if(this.trigger.apply(this,i)!==!1){var a=t.apply(this,arguments),r=["after:"+e,a].concat(n);return this.trigger.apply(this,r),a}},this[e].__isAspected=!0}t.before=function(e,t,n){return i.call(this,"before",e,t,n)},t.after=function(e,t,n){return i.call(this,"after",e,t,n)};var s=/\s+/}),define("cui/core/base/attribute",[],function(){function e(e){return"[object String]"===b.call(e)}function t(e){return"[object Function]"===b.call(e)}function n(e){return null!=e&&e==e.window}function i(e){if(!e||"[object Object]"!==b.call(e)||e.nodeType||n(e))return!1;try{if(e.constructor&&!w.call(e,"constructor")&&!w.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var i;if(_)for(i in e)return w.call(e,i);for(i in e);return void 0===i||w.call(e,i)}function a(e){if(!e||"[object Object]"!==b.call(e)||e.nodeType||n(e)||!e.hasOwnProperty)return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function r(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=s(t[n],e[n]));return e}function s(e,t){return M(e)?e=e.slice():i(e)&&(i(t)||(t={}),e=r(t,e)),e}function o(e,t,n){for(var i=[],r=t.constructor.prototype;r;)r.hasOwnProperty("attrs")||(r.attrs={}),c(n,r.attrs,r),a(r.attrs)||i.unshift(r.attrs),r=r.constructor.superclass;for(var s=0,o=i.length;o>s;s++)f(e,h(i[s]))}function l(e,t){f(e,h(t,!0),!0)}function c(e,t,n,i){for(var a=0,r=e.length;r>a;a++){var s=e[a];n.hasOwnProperty(s)&&(t[s]=i?t.get(s):n[s])}}function d(e,n){for(var i in n)if(n.hasOwnProperty(i)){var a,r=n[i].value;t(r)&&(a=i.match(L))&&(e[a[1]](u(a[2]),r),delete n[i])}}function u(e){var t=e.match(x),n=t[1]?"change:":"";return n+=t[2].toLowerCase()+t[3]}function p(e,t,n){var i={silent:!0};e.__initializingAttrs=!0;for(var a in n)n.hasOwnProperty(a)&&t[a].setter&&e.set(a,n[a],i);delete e.__initializingAttrs}function h(e,t){var n={};for(var a in e){var r=e[a];!t&&i(r)&&m(r,C)?n[a]=r:n[a]={value:r}}return n}function f(e,t,n){var i,a,r;for(i in t)if(t.hasOwnProperty(i)){if(a=t[i],r=e[i],r||(r=e[i]={}),void 0!==a.value&&(r.value=s(a.value,r.value)),n)continue;for(var o in S){var l=S[o];void 0!==a[l]&&(r[l]=a[l])}}return e}function m(e,t){for(var n=0,i=t.length;i>n;n++)if(e.hasOwnProperty(t[n]))return!0;return!1}function g(t){return null==t||(e(t)||M(t))&&0===t.length||a(t)}function v(e,t){if(e===t)return!0;if(g(e)&&g(t))return!0;var n=b.call(e);if(n!=b.call(t))return!1;switch(n){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase;case"[object Array]":var a=e.toString(),r=t.toString();return-1===a.indexOf("[object")&&-1===r.indexOf("[object")&&a===r}if("object"!=typeof e||"object"!=typeof t)return!1;if(i(e)&&i(t)){if(!v(T(e),T(t)))return!1;for(var s in e)if(e[s]!==t[s])return!1;return!0}return!1}var _,y={initAttrs:function(e){var t=this.attrs={},n=this.propsInAttrs||[];o(t,this,n),e&&l(t,e),p(this,t,e),d(this,t),c(n,this,t,!0)},get:function(e){var t=this.attrs[e]||{},n=t.value;return t.getter?t.getter.call(this,n,e):n},set:function(t,n,a){var s={};e(t)?s[t]=n:(s=t,a=n),a||(a={});var o=a.silent,l=a.override,c=this.attrs,d=this.__changedAttrs||(this.__changedAttrs={});for(t in s)if(s.hasOwnProperty(t)){var u=c[t]||(c[t]={});if(n=s[t],u.readOnly)throw new Error("This attribute is readOnly: "+t);u.setter&&(n=u.setter.call(this,n,t));var p=this.get(t);!l&&i(p)&&i(n)&&(n=r(r({},p),n)),c[t].value=n,this.__initializingAttrs||v(p,n)||(o?d[t]=[n,p]:this.trigger("change:"+t,n,p,t))}return this},change:function(){var e=this.__changedAttrs;if(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this.trigger("change:"+t,n[0],n[1],t)}delete this.__changedAttrs}return this},_isPlainObject:i},b=Object.prototype.toString,w=Object.prototype.hasOwnProperty;!function(){function e(){this.x=1}var t=[];e.prototype={valueOf:1,y:1};for(var n in new e)t.push(n);_="x"!==t[0]}();var M=Array.isArray||function(e){return"[object Array]"===b.call(e)},T=Object.keys;T||(T=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t});var L=/^(on|before|after)([A-Z].*)$/,x=/^(Change)?([A-Z])(.*)/,C=["value","getter","setter","readOnly"],S=["setter","getter","readOnly"];return y}),define("cui/core/base/base",["require","exports","module","../class/class","../events/events","./aspect","./attribute"],function(e,t,n){function i(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i="_onChange"+a(n);e[i]&&e.on("change:"+n,e[i])}}function a(e){return e.charAt(0).toUpperCase()+e.substring(1)}var r=e("../class/class"),s=e("../events/events"),o=e("./aspect"),l=e("./attribute");n.exports=r.create({Implements:[s,o,l],initialize:function(e){this.initAttrs(e),i(this,this.attrs)},destroy:function(){this.off();for(var e in this)this.hasOwnProperty(e)&&delete this[e];this.destroy=function(){}}})}),define("cui/core/widget/widget",["require","jquery","../base/base"],function(e){function t(){return"widget-"+y++}function n(e){return"[object String]"===_.call(e)}function i(e){return"[object Function]"===_.call(e)}function a(e){return b(document.documentElement,e)}function r(e){return e.charAt(0).toUpperCase()+e.substring(1)}function s(e){return i(e.events)&&(e.events=e.events()),e.events}function o(e,t){var n=e.match(w),i=n[1]+h+t.cid,a=n[2]||void 0;return a&&a.indexOf("{{")>-1&&(a=l(a,t)),{type:i,selector:a}}function l(e,t){return e.replace(M,function(e,i){for(var a,r=i.split("."),s=t;a=r.shift();)s=s===t.attrs?t.get(a):s[a];return n(s)?s:T})}function c(e){return null===e||void 0===e}function d(e){for(var t=e.length-1;t>=0&&void 0===e[t];t--)e.pop();return e}var u=e("jquery"),p=e("../base/base"),h=".delegate-events-",f="_onRender",m="data-widget-cid",g={},v=p.extend({propsInAttrs:["element","events","config"],element:null,events:null,config:null,attrs:{id:null,className:null,style:null,template:"<div></div>",model:null,parentNode:document.body},initialize:function(e){this.cid=t(),v.superclass.initialize.call(this,e||{}),this.parseElement(),this.initProps(),this.delegateEvents(),this.setup(),this._stamp(),this._isTemplate=!(e&&e.element)},parseElement:function(){var e=this.element;if(e?this.element=u(e):this.get("template")&&this.parseElementFromTemplate(),!this.element||!this.element[0])throw new Error("element is invalid")},parseElementFromTemplate:function(){this.element=u(this.get("template"))},initProps:function(){},delegateEvents:function(e,t,a){var r=d(Array.prototype.slice.call(arguments));if(0===r.length?(t=s(this),e=this.element):1===r.length?(t=e,e=this.element):2===r.length?(a=t,t=e,e=this.element):(e||(e=this.element),this._delegateElements||(this._delegateElements=[]),this._delegateElements.push(u(e))),n(t)&&i(a)){var l={};l[t]=a,t=l}for(var c in t)if(t.hasOwnProperty(c)){var p=o(c,this),h=p.type,f=p.selector;!function(t,n){var a=function(e){i(t)?t.call(n,e,this):n[t](e,this)};f?u(e).on(h,f,a):u(e).on(h,a)}(t[c],this)}return this},undelegateEvents:function(e,t){var n=d(Array.prototype.slice.call(arguments));if(t||(t=e,e=null),0===n.length){var i=h+this.cid;if(this.element&&this.element.off(i),this._delegateElements)for(var a in this._delegateElements)this._delegateElements.hasOwnProperty(a)&&this._delegateElements[a].off(i)}else{var r=o(t,this);e?u(e).off(r.type,r.selector):this.element&&this.element.off(r.type,r.selector)}return this},setup:function(){},render:function(){this.rendered||(this._renderAndBindAttrs(),this.rendered=!0);var e=this.get("parentNode");if(e&&!a(this.element[0])){var t=this.constructor.outerBoxClass;if(t){var n=this._outerBox=u("<div></div>").addClass(t);n.append(this.element).appendTo(e)}else this.element.appendTo(e)}return this},_renderAndBindAttrs:function(){var e=this,t=e.attrs;for(var n in t)if(t.hasOwnProperty(n)){var i=f+r(n);if(this[i]){var a=this.get(n);c(a)||this[i](a,void 0,n),function(t){e.on("change:"+n,function(n,i,a){e[t](n,i,a)})}(i)}}},_onRenderId:function(e){this.element.attr("id",e)},_onRenderClassName:function(e){this.element.addClass(e)},_onRenderStyle:function(e){this.element.css(e)},_stamp:function(){var e=this.cid;this.element.attr(m,e),g[e]=this},$:function(e){return this.element.find(e)},destroy:function(){this.undelegateEvents(),delete g[this.cid],this.element&&this._isTemplate&&(this.element.off(),this._outerBox?this._outerBox.remove():this.element.remove()),this.element=null,v.superclass.destroy.call(this)}});u(window).unload(function(){for(var e in g)g[e].destroy()}),v.query=function(e){var t,n=u(e).eq(0);return n&&(t=n.attr(m)),g[t]};var _=Object.prototype.toString,y=0,b=u.contains||function(e,t){var n=!1;if(e.compareDocumentPosition)n=!!(16&e.compareDocumentPosition(t));else for(;t=t.parentNode;)t===e&&(n=!0);return n},w=/^(\S+)\s*(.*)$/,M=/{{([^}]+)}}/g,T="INVALID_SELECTOR";return v}),define("cui/util/position/position",["require","jquery"],function(e){function t(e){e=s(e)||{},e.nodeType&&(e={element:e});var t=s(e.element)||d;if(1!==t.nodeType)throw new Error("posObject.element is invalid.");var n={element:t,x:e.x||0,y:e.y||0},i=t===d||"VIEWPORT"===t._id;return n.offset=function(){return u?{left:0,top:0}:i?{left:l(document).scrollLeft(),top:l(document).scrollTop()}:o(l(t)[0])},n.size=function(){var e=l(i?window:t);return{width:e.outerWidth(),height:e.outerHeight()}},n}function n(e){e.x=i(e.x,e,"width"),e.y=i(e.y,e,"height")}function i(e,t,n){if(e+="",e=e.replace(/px/gi,""),/\D/.test(e)&&(e=e.replace(/(?:top|left)/gi,"0%").replace(/center/gi,"50%").replace(/(?:bottom|right)/gi,"100%")),-1!==e.indexOf("%")&&(e=e.replace(/(\d+(?:\.\d+)?)%/gi,function(e,i){return t.size()[n]*(i/100)})),/[+\-*\/]/.test(e))try{e=new Function("return "+e)()}catch(i){throw new Error("Invalid position value: "+e)}return r(e)}function a(e){var t=e.offsetParent();t[0]===document.documentElement&&(t=l(document.body)),h&&t.css("zoom",1);var n;return n=t[0]===document.body&&"static"===t.css("position")?{top:0,left:0}:o(t[0]),n.top+=r(t.css("border-top-width")),n.left+=r(t.css("border-left-width")),n}function r(e){return parseFloat(e,10)||0}function s(e){return l(e)[0]}function o(e){var t=e.getBoundingClientRect(),n=document.documentElement;return{left:t.left+(window.pageXOffset||n.scrollLeft)-(n.clientLeft||document.body.clientLeft||0),top:t.top+(window.pageYOffset||n.scrollTop)-(n.clientTop||document.body.clientTop||0)}}var l=e("jquery"),c={},d={_id:"VIEWPORT",nodeType:1},u=!1,p=(window.navigator.userAgent||"").toLowerCase(),h=-1!==p.indexOf("msie 6");return c.pin=function(e,i){if(e=t(e),i=t(i),e.element!==d&&"VIEWPORT"!==e.element._id){var r=l(e.element);"fixed"!==r.css("position")||h?(r.css("position","absolute"),u=!1):u=!0,n(e),n(i);var s=a(r),o=i.offset(),c=o.top+i.y-e.y-s.top,p=o.left+i.x-e.x-s.left;r.css({left:Math.max(p,0),top:Math.max(c,0)})}},c.center=function(e,t){c.pin({element:e,x:"50%",y:"50%"},{element:t,x:"50%",y:"50%"})},c.VIEWPORT=d,c}),define("cui/ui/overlay/overlay",["require","jquery","../../core/widget/widget","../../util/position/position"],function(e){function t(e){return a.contains(document.documentElement,e)}function n(e){a(o.blurOverlays).each(function(t,n){if(n&&n.get("visible")){for(var i=0;i<n._relativeElements.length;i++){var r=a(n._relativeElements[i])[0];if(r===e.target||a.contains(r,e.target))return}n.hide()}})}function i(e,t){for(var n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),t}var a=e("jquery"),r=e("../../core/widget/widget"),s=e("../../util/position/position"),o=r.extend({attrs:{width:null,height:null,zIndex:99,visible:!1,align:{selfXY:[0,0],baseElement:s.VIEWPORT,baseXY:[0,0]},parentNode:document.body},show:function(){return this.rendered||this.render(),this.set("visible",!0),this},hide:function(){return this.set("visible",!1),this},setup:function(){var e=this;this._setupResize(),this.after("render",function(){var e=this.element.css("position");("static"===e||"relative"===e)&&this.element.css({position:"absolute",left:"-9999px",top:"-9999px"})}),this.after("show",function(){setTimeout(function(){e.element&&e._setPosition()},50)})},destroy:function(){return i(this,o.allOverlays),i(this,o.blurOverlays),o.superclass.destroy.call(this)},_setPosition:function(e){if(t(this.element[0])&&(e||(e=this.get("align")),e)){var n="none"===this.element.css("display");return n&&this.element.css({visibility:"hidden",display:"block"}),s.pin({element:this.element,x:e.selfXY[0],y:e.selfXY[1]},{element:e.baseElement,x:e.baseXY[0],y:e.baseXY[1]}),n&&this.element.css({visibility:"",display:"none"}),this}},_setupResize:function(){o.allOverlays.push(this)},_blurHide:function(e){e=a.makeArray(e),e.push(this.element),this._relativeElements=e,o.blurOverlays.push(this)},_onRenderWidth:function(e){this.element.css("width",e)},_onRenderHeight:function(e){this.element.css("height",e)},_onRenderZIndex:function(e){this.element.css("zIndex",e)},_onRenderAlign:function(e){this._setPosition(e)},_onRenderVisible:function(e){this.element[e?"show":"hide"]()}});o.blurOverlays=[],a(document).on("click",function(e){n(e)});var l,c=a(window).width(),d=a(window).height();return o.allOverlays=[],a(window).resize(function(){l&&clearTimeout(l),l=setTimeout(function(){var e=a(window).width(),t=a(window).height();(c!==e||d!==t)&&a(o.allOverlays).each(function(e,t){t&&t.get("visible")&&t._setPosition()}),c=e,d=t},80)}),o}),define("cui/ui/overlay/mask",["require","jquery","./overlay"],function(e){var t=e("jquery"),n=e("./overlay"),i=(window.navigator.userAgent||"").toLowerCase(),a=-1!==i.indexOf("msie 6"),r=t(document.body),s=t(document),o=n.extend({attrs:{width:a?s.outerWidth(!0):"100%",height:a?s.outerHeight(!0):"100%",className:"u-mask",opacity:.3,backgroundColor:"#000",style:{position:a?"absolute":"fixed",top:0,left:0},align:{baseElement:a?r:void 0}},show:function(){return a&&(this.set("width",s.outerWidth(!0)),this.set("height",s.outerHeight(!0))),o.superclass.show.call(this)},_onRenderBackgroundColor:function(e){this.element.css("backgroundColor",e)},_onRenderOpacity:function(e){this.element.css("opacity",e)}});return new o}),function(e,t){"function"==typeof define&&define.amd?define("components/handlebars/handlebars",[],t):"object"==typeof exports?module.exports=t():e.Handlebars=e.Handlebars||t()}(this,function(){var e=function(){"use strict";function e(e){this.string=e}var t;return e.prototype.toString=function(){return""+this.string},t=e}(),t=function(e){"use strict";function t(e){return l[e]}function n(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}function i(e){return e instanceof o?e.toString():null==e?"":e?(e=""+e,d.test(e)?e.replace(c,t):e):e+""}function a(e){return e||0===e?h(e)&&0===e.length?!0:!1:!0}function r(e,t){return(e?e+".":"")+t}var s={},o=e,l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=/[&<>"'`]/g,d=/[&<>"'`]/;s.extend=n;var u=Object.prototype.toString;s.toString=u;var p=function(e){return"function"==typeof e};p(/x/)&&(p=function(e){return"function"==typeof e&&"[object Function]"===u.call(e)});var p;s.isFunction=p;var h=Array.isArray||function(e){return e&&"object"==typeof e?"[object Array]"===u.call(e):!1};return s.isArray=h,s.escapeExpression=i,s.isEmpty=a,s.appendContextPath=r,s}(e),n=function(){"use strict";function e(e,t){var i;t&&t.firstLine&&(i=t.firstLine,e+=" - "+i+":"+t.firstColumn);for(var a=Error.prototype.constructor.call(this,e),r=0;r<n.length;r++)this[n[r]]=a[n[r]];i&&(this.lineNumber=i,this.column=t.firstColumn)}var t,n=["description","fileName","lineNumber","message","name","number","stack"];return e.prototype=new Error,t=e}(),i=function(e,t){"use strict";function n(e,t){this.helpers=e||{},this.partials=t||{},i(this)}function i(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new s("Missing helper: '"+arguments[arguments.length-1].name+"'")}),e.registerHelper("blockHelperMissing",function(t,n){var i=n.inverse,a=n.fn;if(t===!0)return a(this);if(t===!1||null==t)return i(this);if(d(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):i(this);if(n.data&&n.ids){var s=g(n.data);s.contextPath=r.appendContextPath(n.data.contextPath,n.name),n={data:s}}return a(t,n)}),e.registerHelper("each",function(e,t){if(!t)throw new s("Must pass iterator to #each");var n,i,a=t.fn,o=t.inverse,l=0,c="";if(t.data&&t.ids&&(i=r.appendContextPath(t.data.contextPath,t.ids[0])+"."),u(e)&&(e=e.call(this)),t.data&&(n=g(t.data)),e&&"object"==typeof e)if(d(e))for(var p=e.length;p>l;l++)n&&(n.index=l,n.first=0===l,n.last=l===e.length-1,i&&(n.contextPath=i+l)),c+=a(e[l],{data:n});else for(var h in e)e.hasOwnProperty(h)&&(n&&(n.key=h,n.index=l,n.first=0===l,i&&(n.contextPath=i+h)),c+=a(e[h],{data:n}),l++);return 0===l&&(c=o(this)),c}),e.registerHelper("if",function(e,t){return u(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||r.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){u(e)&&(e=e.call(this));var n=t.fn;if(r.isEmpty(e))return t.inverse(this);if(t.data&&t.ids){var i=g(t.data);i.contextPath=r.appendContextPath(t.data.contextPath,t.ids[0]),t={data:i}}return n(e,t)}),e.registerHelper("log",function(t,n){var i=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(i,t)}),e.registerHelper("lookup",function(e,t){return e&&e[t]})}var a={},r=e,s=t,o="2.0.0";a.VERSION=o;var l=6;a.COMPILER_REVISION=l;var c={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};a.REVISION_CHANGES=c;var d=r.isArray,u=r.isFunction,p=r.toString,h="[object Object]";a.HandlebarsEnvironment=n,n.prototype={constructor:n,logger:f,log:m,registerHelper:function(e,t){if(p.call(e)===h){if(t)throw new s("Arg not supported with multiple helpers");r.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){p.call(e)===h?r.extend(this.partials,e):this.partials[e]=t},unregisterPartial:function(e){delete this.partials[e]}};var f={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(f.level<=e){var n=f.methodMap[e];"undefined"!=typeof console&&console[n]&&console[n].call(console,t)}}};a.logger=f;var m=f.log;a.log=m;var g=function(e){var t=r.extend({},e);return t._parent=e,t};return a.createFrame=g,a}(t,n),a=function(e,t,n){"use strict";function i(e){var t=e&&e[0]||1,n=p;if(t!==n){if(n>t){var i=h[n],a=h[t];throw new u("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+a+").")}throw new u("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function a(e,t){if(!t)throw new u("No environment passed to template");if(!e||!e.main)throw new u("Unknown template object: "+typeof e);t.VM.checkRevision(e.compiler);var n=function(n,i,a,r,s,o,l,c,p){s&&(r=d.extend({},r,s));var h=t.VM.invokePartial.call(this,n,a,r,o,l,c,p);if(null==h&&t.compile){var f={helpers:o,partials:l,data:c,depths:p};l[a]=t.compile(n,{data:void 0!==c,compat:e.compat},t),h=l[a](r,f)}if(null!=h){if(i){for(var m=h.split("\n"),g=0,v=m.length;v>g&&(m[g]||g+1!==v);g++)m[g]=i+m[g];h=m.join("\n")}return h}throw new u("The partial "+a+" could not be compiled when running in runtime-only mode")},i={lookup:function(e,t){for(var n=e.length,i=0;n>i;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:d.escapeExpression,invokePartial:n,fn:function(t){return e[t]},programs:[],program:function(e,t,n){var i=this.programs[e],a=this.fn(e);return t||n?i=r(this,e,a,t,n):i||(i=this.programs[e]=r(this,e,a)),i},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=d.extend({},t,e)),n},noop:t.VM.noop,compilerInfo:e.compiler},a=function(t,n){n=n||{};var r=n.data;a._setup(n),!n.partial&&e.useData&&(r=l(t,r));var s;return e.useDepths&&(s=n.depths?[t].concat(n.depths):[t]),e.main.call(i,t,i.helpers,i.partials,r,s)};return a.isTop=!0,a._setup=function(n){n.partial?(i.helpers=n.helpers,i.partials=n.partials):(i.helpers=i.merge(n.helpers,t.helpers),e.usePartial&&(i.partials=i.merge(n.partials,t.partials)))},a._child=function(t,n,a){if(e.useDepths&&!a)throw new u("must pass parent depths");return r(i,t,e[t],n,a)},a}function r(e,t,n,i,a){var r=function(t,r){return r=r||{},n.call(e,t,e.helpers,e.partials,r.data||i,a&&[t].concat(a))};return r.program=t,r.depth=a?a.length:0,r}function s(e,t,n,i,a,r,s){var o={partial:!0,helpers:i,partials:a,data:r,depths:s};if(void 0===e)throw new u("The partial "+t+" could not be found");return e instanceof Function?e(n,o):void 0}function o(){return""}function l(e,t){return t&&"root"in t||(t=t?f(t):{},t.root=e),t}var c={},d=e,u=t,p=n.COMPILER_REVISION,h=n.REVISION_CHANGES,f=n.createFrame;return c.checkRevision=i,c.template=a,c.program=r,c.invokePartial=s,c.noop=o,c}(t,n,i),r=function(e,t,n,i,a){"use strict";var r,s=e,o=t,l=n,c=i,d=a,u=function(){var e=new s.HandlebarsEnvironment;return c.extend(e,s),e.SafeString=o,e.Exception=l,e.Utils=c,e.escapeExpression=c.escapeExpression,e.VM=d,e.template=function(t){return d.template(t,e)},e},p=u();return p.create=u,p["default"]=p,r=p}(i,e,n,t,a),s=function(e){"use strict";function t(e){e=e||{},this.firstLine=e.first_line,this.firstColumn=e.first_column,this.lastColumn=e.last_column,this.lastLine=e.last_line}var n,i=e,a={ProgramNode:function(e,n,i){t.call(this,i),this.type="program",this.statements=e,this.strip=n},MustacheNode:function(e,n,i,r,s){if(t.call(this,s),this.type="mustache",this.strip=r,null!=i&&i.charAt){var o=i.charAt(3)||i.charAt(2);this.escaped="{"!==o&&"&"!==o}else this.escaped=!!i;e instanceof a.SexprNode?this.sexpr=e:this.sexpr=new a.SexprNode(e,n),this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(e,n,i){t.call(this,i),this.type="sexpr",this.hash=n;var a=this.id=e[0],r=this.params=e.slice(1);this.isHelper=!(!r.length&&!n),this.eligibleHelper=this.isHelper||a.isSimple},PartialNode:function(e,n,i,a,r){t.call(this,r),this.type="partial",this.partialName=e,this.context=n,this.hash=i,this.strip=a,this.strip.inlineStandalone=!0},BlockNode:function(e,n,i,a,r){t.call(this,r),this.type="block",this.mustache=e,this.program=n,this.inverse=i,this.strip=a,i&&!n&&(this.isInverse=!0)},RawBlockNode:function(e,n,r,s){if(t.call(this,s),e.sexpr.id.original!==r)throw new i(e.sexpr.id.original+" doesn't match "+r,this);n=new a.ContentNode(n,s),this.type="block",this.mustache=e,this.program=new a.ProgramNode([n],{},s)},ContentNode:function(e,n){t.call(this,n),this.type="content",this.original=this.string=e},HashNode:function(e,n){t.call(this,n),this.type="hash",this.pairs=e},IdNode:function(e,n){t.call(this,n),this.type="ID";for(var a="",r=[],s=0,o="",l=0,c=e.length;c>l;l++){var d=e[l].part;if(a+=(e[l].separator||"")+d,".."===d||"."===d||"this"===d){if(r.length>0)throw new i("Invalid path: "+a,this);".."===d?(s++,o+="../"):this.isScoped=!0}else r.push(d)}this.original=a,this.parts=r,this.string=r.join("."),this.depth=s,this.idName=o+this.string,this.isSimple=1===e.length&&!this.isScoped&&0===s,this.stringModeValue=this.string},PartialNameNode:function(e,n){t.call(this,n),this.type="PARTIAL_NAME",this.name=e.original},DataNode:function(e,n){t.call(this,n),this.type="DATA",this.id=e,this.stringModeValue=e.stringModeValue,this.idName="@"+e.stringModeValue},StringNode:function(e,n){t.call(this,n),this.type="STRING",this.original=this.string=this.stringModeValue=e},NumberNode:function(e,n){t.call(this,n),this.type="NUMBER",this.original=this.number=e,this.stringModeValue=Number(e)},BooleanNode:function(e,n){t.call(this,n),this.type="BOOLEAN",this.bool=e,this.stringModeValue="true"===e},CommentNode:function(e,n){t.call(this,n),this.type="comment",this.comment=e,
this.strip={inlineStandalone:!0}}};return n=a}(n),o=function(){"use strict";var e,t=function(){function e(){this.yy={}}var t={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,CONTENT:12,COMMENT:13,openRawBlock:14,END_RAW_BLOCK:15,OPEN_RAW_BLOCK:16,sexpr:17,CLOSE_RAW_BLOCK:18,openBlock:19,block_option0:20,closeBlock:21,openInverse:22,block_option1:23,OPEN_BLOCK:24,CLOSE:25,OPEN_INVERSE:26,inverseAndProgram:27,INVERSE:28,OPEN_ENDBLOCK:29,path:30,OPEN:31,OPEN_UNESCAPED:32,CLOSE_UNESCAPED:33,OPEN_PARTIAL:34,partialName:35,param:36,partial_option0:37,partial_option1:38,sexpr_repetition0:39,sexpr_option0:40,dataName:41,STRING:42,NUMBER:43,BOOLEAN:44,OPEN_SEXPR:45,CLOSE_SEXPR:46,hash:47,hash_repetition_plus0:48,hashSegment:49,ID:50,EQUALS:51,DATA:52,pathSegments:53,SEP:54,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",12:"CONTENT",13:"COMMENT",15:"END_RAW_BLOCK",16:"OPEN_RAW_BLOCK",18:"CLOSE_RAW_BLOCK",24:"OPEN_BLOCK",25:"CLOSE",26:"OPEN_INVERSE",28:"INVERSE",29:"OPEN_ENDBLOCK",31:"OPEN",32:"OPEN_UNESCAPED",33:"CLOSE_UNESCAPED",34:"OPEN_PARTIAL",42:"STRING",43:"NUMBER",44:"BOOLEAN",45:"OPEN_SEXPR",46:"CLOSE_SEXPR",50:"ID",51:"EQUALS",52:"DATA",54:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[10,3],[14,3],[9,4],[9,4],[19,3],[22,3],[27,2],[21,3],[8,3],[8,3],[11,5],[11,4],[17,3],[17,1],[36,1],[36,1],[36,1],[36,1],[36,1],[36,3],[47,1],[49,3],[35,1],[35,1],[35,1],[41,2],[30,1],[53,3],[53,1],[6,0],[6,2],[20,0],[20,1],[23,0],[23,1],[37,0],[37,1],[38,0],[38,1],[39,0],[39,2],[40,0],[40,1],[48,1],[48,2]],performAction:function(e,t,n,i,a,r,s){var o=r.length-1;switch(a){case 1:return i.prepareProgram(r[o-1].statements,!0),r[o-1];case 2:this.$=new i.ProgramNode(i.prepareProgram(r[o]),{},this._$);break;case 3:this.$=r[o];break;case 4:this.$=r[o];break;case 5:this.$=r[o];break;case 6:this.$=r[o];break;case 7:this.$=new i.ContentNode(r[o],this._$);break;case 8:this.$=new i.CommentNode(r[o],this._$);break;case 9:this.$=new i.RawBlockNode(r[o-2],r[o-1],r[o],this._$);break;case 10:this.$=new i.MustacheNode(r[o-1],null,"","",this._$);break;case 11:this.$=i.prepareBlock(r[o-3],r[o-2],r[o-1],r[o],!1,this._$);break;case 12:this.$=i.prepareBlock(r[o-3],r[o-2],r[o-1],r[o],!0,this._$);break;case 13:this.$=new i.MustacheNode(r[o-1],null,r[o-2],i.stripFlags(r[o-2],r[o]),this._$);break;case 14:this.$=new i.MustacheNode(r[o-1],null,r[o-2],i.stripFlags(r[o-2],r[o]),this._$);break;case 15:this.$={strip:i.stripFlags(r[o-1],r[o-1]),program:r[o]};break;case 16:this.$={path:r[o-1],strip:i.stripFlags(r[o-2],r[o])};break;case 17:this.$=new i.MustacheNode(r[o-1],null,r[o-2],i.stripFlags(r[o-2],r[o]),this._$);break;case 18:this.$=new i.MustacheNode(r[o-1],null,r[o-2],i.stripFlags(r[o-2],r[o]),this._$);break;case 19:this.$=new i.PartialNode(r[o-3],r[o-2],r[o-1],i.stripFlags(r[o-4],r[o]),this._$);break;case 20:this.$=new i.PartialNode(r[o-2],void 0,r[o-1],i.stripFlags(r[o-3],r[o]),this._$);break;case 21:this.$=new i.SexprNode([r[o-2]].concat(r[o-1]),r[o],this._$);break;case 22:this.$=new i.SexprNode([r[o]],null,this._$);break;case 23:this.$=r[o];break;case 24:this.$=new i.StringNode(r[o],this._$);break;case 25:this.$=new i.NumberNode(r[o],this._$);break;case 26:this.$=new i.BooleanNode(r[o],this._$);break;case 27:this.$=r[o];break;case 28:r[o-1].isHelper=!0,this.$=r[o-1];break;case 29:this.$=new i.HashNode(r[o],this._$);break;case 30:this.$=[r[o-2],r[o]];break;case 31:this.$=new i.PartialNameNode(r[o],this._$);break;case 32:this.$=new i.PartialNameNode(new i.StringNode(r[o],this._$),this._$);break;case 33:this.$=new i.PartialNameNode(new i.NumberNode(r[o],this._$));break;case 34:this.$=new i.DataNode(r[o],this._$);break;case 35:this.$=new i.IdNode(r[o],this._$);break;case 36:r[o-2].push({part:r[o],separator:r[o-1]}),this.$=r[o-2];break;case 37:this.$=[{part:r[o]}];break;case 38:this.$=[];break;case 39:r[o-1].push(r[o]);break;case 48:this.$=[];break;case 49:r[o-1].push(r[o]);break;case 52:this.$=[r[o]];break;case 53:r[o-1].push(r[o])}},table:[{3:1,4:2,5:[2,38],6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],31:[2,38],32:[2,38],34:[2,38]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:[1,10],13:[1,11],14:16,16:[1,20],19:14,22:15,24:[1,18],26:[1,19],28:[2,2],29:[2,2],31:[1,12],32:[1,13],34:[1,17]},{1:[2,1]},{5:[2,39],12:[2,39],13:[2,39],16:[2,39],24:[2,39],26:[2,39],28:[2,39],29:[2,39],31:[2,39],32:[2,39],34:[2,39]},{5:[2,3],12:[2,3],13:[2,3],16:[2,3],24:[2,3],26:[2,3],28:[2,3],29:[2,3],31:[2,3],32:[2,3],34:[2,3]},{5:[2,4],12:[2,4],13:[2,4],16:[2,4],24:[2,4],26:[2,4],28:[2,4],29:[2,4],31:[2,4],32:[2,4],34:[2,4]},{5:[2,5],12:[2,5],13:[2,5],16:[2,5],24:[2,5],26:[2,5],28:[2,5],29:[2,5],31:[2,5],32:[2,5],34:[2,5]},{5:[2,6],12:[2,6],13:[2,6],16:[2,6],24:[2,6],26:[2,6],28:[2,6],29:[2,6],31:[2,6],32:[2,6],34:[2,6]},{5:[2,7],12:[2,7],13:[2,7],16:[2,7],24:[2,7],26:[2,7],28:[2,7],29:[2,7],31:[2,7],32:[2,7],34:[2,7]},{5:[2,8],12:[2,8],13:[2,8],16:[2,8],24:[2,8],26:[2,8],28:[2,8],29:[2,8],31:[2,8],32:[2,8],34:[2,8]},{17:21,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:27,30:22,41:23,50:[1,26],52:[1,25],53:24},{4:28,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{4:29,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{12:[1,30]},{30:32,35:31,42:[1,33],43:[1,34],50:[1,26],53:24},{17:35,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:36,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:37,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[1,38]},{18:[2,48],25:[2,48],33:[2,48],39:39,42:[2,48],43:[2,48],44:[2,48],45:[2,48],46:[2,48],50:[2,48],52:[2,48]},{18:[2,22],25:[2,22],33:[2,22],46:[2,22]},{18:[2,35],25:[2,35],33:[2,35],42:[2,35],43:[2,35],44:[2,35],45:[2,35],46:[2,35],50:[2,35],52:[2,35],54:[1,40]},{30:41,50:[1,26],53:24},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],52:[2,37],54:[2,37]},{33:[1,42]},{20:43,27:44,28:[1,45],29:[2,40]},{23:46,27:47,28:[1,45],29:[2,42]},{15:[1,48]},{25:[2,46],30:51,36:49,38:50,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],47:57,48:58,49:60,50:[1,59],52:[1,25],53:24},{25:[2,31],42:[2,31],43:[2,31],44:[2,31],45:[2,31],50:[2,31],52:[2,31]},{25:[2,32],42:[2,32],43:[2,32],44:[2,32],45:[2,32],50:[2,32],52:[2,32]},{25:[2,33],42:[2,33],43:[2,33],44:[2,33],45:[2,33],50:[2,33],52:[2,33]},{25:[1,61]},{25:[1,62]},{18:[1,63]},{5:[2,17],12:[2,17],13:[2,17],16:[2,17],24:[2,17],26:[2,17],28:[2,17],29:[2,17],31:[2,17],32:[2,17],34:[2,17]},{18:[2,50],25:[2,50],30:51,33:[2,50],36:65,40:64,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],46:[2,50],47:66,48:58,49:60,50:[1,59],52:[1,25],53:24},{50:[1,67]},{18:[2,34],25:[2,34],33:[2,34],42:[2,34],43:[2,34],44:[2,34],45:[2,34],46:[2,34],50:[2,34],52:[2,34]},{5:[2,18],12:[2,18],13:[2,18],16:[2,18],24:[2,18],26:[2,18],28:[2,18],29:[2,18],31:[2,18],32:[2,18],34:[2,18]},{21:68,29:[1,69]},{29:[2,41]},{4:70,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{21:71,29:[1,69]},{29:[2,43]},{5:[2,9],12:[2,9],13:[2,9],16:[2,9],24:[2,9],26:[2,9],28:[2,9],29:[2,9],31:[2,9],32:[2,9],34:[2,9]},{25:[2,44],37:72,47:73,48:58,49:60,50:[1,74]},{25:[1,75]},{18:[2,23],25:[2,23],33:[2,23],42:[2,23],43:[2,23],44:[2,23],45:[2,23],46:[2,23],50:[2,23],52:[2,23]},{18:[2,24],25:[2,24],33:[2,24],42:[2,24],43:[2,24],44:[2,24],45:[2,24],46:[2,24],50:[2,24],52:[2,24]},{18:[2,25],25:[2,25],33:[2,25],42:[2,25],43:[2,25],44:[2,25],45:[2,25],46:[2,25],50:[2,25],52:[2,25]},{18:[2,26],25:[2,26],33:[2,26],42:[2,26],43:[2,26],44:[2,26],45:[2,26],46:[2,26],50:[2,26],52:[2,26]},{18:[2,27],25:[2,27],33:[2,27],42:[2,27],43:[2,27],44:[2,27],45:[2,27],46:[2,27],50:[2,27],52:[2,27]},{17:76,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[2,47]},{18:[2,29],25:[2,29],33:[2,29],46:[2,29],49:77,50:[1,74]},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],51:[1,78],52:[2,37],54:[2,37]},{18:[2,52],25:[2,52],33:[2,52],46:[2,52],50:[2,52]},{12:[2,13],13:[2,13],16:[2,13],24:[2,13],26:[2,13],28:[2,13],29:[2,13],31:[2,13],32:[2,13],34:[2,13]},{12:[2,14],13:[2,14],16:[2,14],24:[2,14],26:[2,14],28:[2,14],29:[2,14],31:[2,14],32:[2,14],34:[2,14]},{12:[2,10]},{18:[2,21],25:[2,21],33:[2,21],46:[2,21]},{18:[2,49],25:[2,49],33:[2,49],42:[2,49],43:[2,49],44:[2,49],45:[2,49],46:[2,49],50:[2,49],52:[2,49]},{18:[2,51],25:[2,51],33:[2,51],46:[2,51]},{18:[2,36],25:[2,36],33:[2,36],42:[2,36],43:[2,36],44:[2,36],45:[2,36],46:[2,36],50:[2,36],52:[2,36],54:[2,36]},{5:[2,11],12:[2,11],13:[2,11],16:[2,11],24:[2,11],26:[2,11],28:[2,11],29:[2,11],31:[2,11],32:[2,11],34:[2,11]},{30:79,50:[1,26],53:24},{29:[2,15]},{5:[2,12],12:[2,12],13:[2,12],16:[2,12],24:[2,12],26:[2,12],28:[2,12],29:[2,12],31:[2,12],32:[2,12],34:[2,12]},{25:[1,80]},{25:[2,45]},{51:[1,78]},{5:[2,20],12:[2,20],13:[2,20],16:[2,20],24:[2,20],26:[2,20],28:[2,20],29:[2,20],31:[2,20],32:[2,20],34:[2,20]},{46:[1,81]},{18:[2,53],25:[2,53],33:[2,53],46:[2,53],50:[2,53]},{30:51,36:82,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],50:[1,26],52:[1,25],53:24},{25:[1,83]},{5:[2,19],12:[2,19],13:[2,19],16:[2,19],24:[2,19],26:[2,19],28:[2,19],29:[2,19],31:[2,19],32:[2,19],34:[2,19]},{18:[2,28],25:[2,28],33:[2,28],42:[2,28],43:[2,28],44:[2,28],45:[2,28],46:[2,28],50:[2,28],52:[2,28]},{18:[2,30],25:[2,30],33:[2,30],46:[2,30],50:[2,30]},{5:[2,16],12:[2,16],13:[2,16],16:[2,16],24:[2,16],26:[2,16],28:[2,16],29:[2,16],31:[2,16],32:[2,16],34:[2,16]}],defaultActions:{4:[2,1],44:[2,41],47:[2,43],57:[2,47],63:[2,10],70:[2,15],73:[2,45]},parseError:function(e,t){throw new Error(e)},parse:function(e){function t(){var e;return e=n.lexer.lex()||1,"number"!=typeof e&&(e=n.symbols_[e]||e),e}var n=this,i=[0],a=[null],r=[],s=this.table,o="",l=0,c=0,d=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;r.push(u);var p=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,f,m,g,v,_,y,b,w,M={};;){if(m=i[i.length-1],this.defaultActions[m]?g=this.defaultActions[m]:((null===h||"undefined"==typeof h)&&(h=t()),g=s[m]&&s[m][h]),"undefined"==typeof g||!g.length||!g[0]){var T="";if(!d){w=[];for(_ in s[m])this.terminals_[_]&&_>2&&w.push("'"+this.terminals_[_]+"'");T=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+w.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(T,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:u,expected:w})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+h);switch(g[0]){case 1:i.push(h),a.push(this.lexer.yytext),r.push(this.lexer.yylloc),i.push(g[1]),h=null,f?(h=f,f=null):(c=this.lexer.yyleng,o=this.lexer.yytext,l=this.lexer.yylineno,u=this.lexer.yylloc,d>0&&d--);break;case 2:if(y=this.productions_[g[1]][1],M.$=a[a.length-y],M._$={first_line:r[r.length-(y||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(y||1)].first_column,last_column:r[r.length-1].last_column},p&&(M._$.range=[r[r.length-(y||1)].range[0],r[r.length-1].range[1]]),v=this.performAction.call(M,o,c,l,this.yy,g[1],a,r),"undefined"!=typeof v)return v;y&&(i=i.slice(0,-1*y*2),a=a.slice(0,-1*y),r=r.slice(0,-1*y)),i.push(this.productions_[g[1]][0]),a.push(M.$),r.push(M._$),b=s[i[i.length-2]][i[i.length-1]],i.push(b);break;case 3:return!0}}return!0}},n=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i,a;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),s=0;s<r.length&&(n=this._input.match(this.rules[r[s]]),!n||t&&!(n[0].length>t[0].length)||(t=n,i=s,this.options.flex));s++);return t?(a=t[0].match(/(?:\r\n?|\n).*/g),a&&(this.yylineno+=a.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:a?a[a.length-1].length-a[a.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,r[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e?e:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return"undefined"!=typeof e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.options={},e.performAction=function(e,t,n,i){function a(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(a(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(a(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 12;break;case 1:return 12;case 2:return this.popState(),12;case 3:return t.yytext=t.yytext.substr(5,t.yyleng-9),this.popState(),15;case 4:return 12;case 5:return a(0,4),this.popState(),13;case 6:return 45;case 7:return 46;case 8:return 16;case 9:return this.popState(),this.begin("raw"),18;case 10:return 34;case 11:return 24;case 12:return 29;case 13:return this.popState(),28;case 14:return this.popState(),28;case 15:return 26;case 16:return 26;case 17:return 32;case 18:return 31;case 19:this.popState(),this.begin("com");break;case 20:return a(3,5),this.popState(),13;case 21:return 31;case 22:return 51;case 23:return 50;case 24:return 50;case 25:return 54;case 26:break;case 27:return this.popState(),33;case 28:return this.popState(),25;case 29:return t.yytext=a(1,2).replace(/\\"/g,'"'),42;case 30:return t.yytext=a(1,2).replace(/\\'/g,"'"),42;case 31:return 52;case 32:return 44;case 33:return 44;case 34:return 43;case 35:return 50;case 36:return t.yytext=a(1,2),50;case 37:return"INVALID";case 38:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[5],inclusive:!1},raw:{rules:[3,4],inclusive:!1},INITIAL:{rules:[0,1,38],inclusive:!0}},e}();return t.lexer=n,e.prototype=t,t.Parser=e,new e}();return e=t}(),l=function(e){"use strict";function t(e,t){return{left:"~"===e.charAt(2),right:"~"===t.charAt(t.length-3)}}function n(e,t,n,i,l,d){if(e.sexpr.id.original!==i.path.original)throw new c(e.sexpr.id.original+" doesn't match "+i.path.original,e);var u=n&&n.program,p={left:e.strip.left,right:i.strip.right,openStandalone:r(t.statements),closeStandalone:a((u||t).statements)};if(e.strip.right&&s(t.statements,null,!0),u){var h=n.strip;h.left&&o(t.statements,null,!0),h.right&&s(u.statements,null,!0),i.strip.left&&o(u.statements,null,!0),a(t.statements)&&r(u.statements)&&(o(t.statements),s(u.statements))}else i.strip.left&&o(t.statements,null,!0);return l?new this.BlockNode(e,u,t,p,d):new this.BlockNode(e,t,u,p,d)}function i(e,t){for(var n=0,i=e.length;i>n;n++){var l=e[n],c=l.strip;if(c){var d=a(e,n,t,"partial"===l.type),u=r(e,n,t),p=c.openStandalone&&d,h=c.closeStandalone&&u,f=c.inlineStandalone&&d&&u;c.right&&s(e,n,!0),c.left&&o(e,n,!0),f&&(s(e,n),o(e,n)&&"partial"===l.type&&(l.indent=/([ \t]+$)/.exec(e[n-1].original)?RegExp.$1:"")),p&&(s((l.program||l.inverse).statements),o(e,n)),h&&(s(e,n),o((l.inverse||l.program).statements))}}return e}function a(e,t,n){void 0===t&&(t=e.length);var i=e[t-1],a=e[t-2];return i?"content"===i.type?(a||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(i.original):void 0:n}function r(e,t,n){void 0===t&&(t=-1);var i=e[t+1],a=e[t+2];return i?"content"===i.type?(a||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(i.original):void 0:n}function s(e,t,n){var i=e[null==t?0:t+1];if(i&&"content"===i.type&&(n||!i.rightStripped)){var a=i.string;i.string=i.string.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),i.rightStripped=i.string!==a}}function o(e,t,n){var i=e[null==t?e.length-1:t-1];if(i&&"content"===i.type&&(n||!i.leftStripped)){var a=i.string;return i.string=i.string.replace(n?/\s+$/:/[ \t]+$/,""),i.leftStripped=i.string!==a,i.leftStripped}}var l={},c=e;return l.stripFlags=t,l.prepareBlock=n,l.prepareProgram=i,l}(n),c=function(e,t,n,i){"use strict";function a(e){return e.constructor===o.ProgramNode?e:(s.yy=d,s.parse(e))}var r={},s=e,o=t,l=n,c=i.extend;r.parser=s;var d={};return c(d,l,o),r.parse=a,r}(o,s,l,t),d=function(e,t){"use strict";function n(){}function i(e,t,n){if(null==e||"string"!=typeof e&&e.constructor!==n.AST.ProgramNode)throw new o("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0),t.compat&&(t.useDepths=!0);var i=n.parse(e),a=(new n.Compiler).compile(i,t);return(new n.JavaScriptCompiler).compile(a,t)}function a(e,t,n){function i(){var i=n.parse(e),a=(new n.Compiler).compile(i,t),r=(new n.JavaScriptCompiler).compile(a,t,void 0,!0);return n.template(r)}if(null==e||"string"!=typeof e&&e.constructor!==n.AST.ProgramNode)throw new o("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);t=t||{},"data"in t||(t.data=!0),t.compat&&(t.useDepths=!0);var a,r=function(e,t){return a||(a=i()),a.call(this,e,t)};return r._setup=function(e){return a||(a=i()),a._setup(e)},r._child=function(e,t,n){return a||(a=i()),a._child(e,t,n)},r}function r(e,t){if(e===t)return!0;if(l(e)&&l(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}}var s={},o=e,l=t.isArray,c=[].slice;return s.Compiler=n,n.prototype={compiler:n,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;t>n;n++){var i=this.opcodes[n],a=e.opcodes[n];if(i.opcode!==a.opcode||!r(i.args,a.args))return!1}for(t=this.children.length,n=0;t>n;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds;var n=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0,lookup:!0},n)for(var i in n)this.options.knownHelpers[i]=n[i];return this.accept(e)},accept:function(e){return this[e.type](e)},program:function(e){for(var t=e.statements,n=0,i=t.length;i>n;n++)this.accept(t[n]);return this.isSimple=1===i,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t,n=(new this.compiler).compile(e,this.options),i=this.guid++;this.usePartial=this.usePartial||n.usePartial,this.children[i]=n;for(var a=0,r=n.depths.list.length;r>a;a++)t=n.depths.list[a],2>t||this.addDepth(t-1);return i},block:function(e){var t=e.mustache,n=e.program,i=e.inverse;n&&(n=this.compileProgram(n)),i&&(i=this.compileProgram(i));var a=t.sexpr,r=this.classifySexpr(a);"helper"===r?this.helperSexpr(a,n,i):"simple"===r?(this.simpleSexpr(a),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("blockValue",a.id.original)):(this.ambiguousSexpr(a,n,i),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t,n,i=e.pairs;for(this.opcode("pushHash"),t=0,n=i.length;n>t;t++)this.pushParam(i[t][1]);for(;t--;)this.opcode("assignToHash",i[t][0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.hash?this.accept(e.hash):this.opcode("push","undefined"),e.context?this.accept(e.context):(this.opcode("getContext",0),this.opcode("pushContext")),this.opcode("invokePartial",t.name,e.indent||""),this.opcode("append")},content:function(e){e.string&&this.opcode("appendContent",e.string)},mustache:function(e){this.sexpr(e.sexpr),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousSexpr:function(e,t,n){var i=e.id,a=i.parts[0],r=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.ID(i),this.opcode("invokeAmbiguous",a,r)},simpleSexpr:function(e){var t=e.id;"DATA"===t.type?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),a=e.id,r=a.parts[0];if(this.options.knownHelpers[r])this.opcode("invokeKnownHelper",i.length,r);else{if(this.options.knownHelpersOnly)throw new o("You specified knownHelpersOnly, but used the unknown helper "+r,e);a.falsy=!0,this.ID(a),this.opcode("invokeHelper",i.length,a.original,a.isSimple)}},sexpr:function(e){var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0];t?this.opcode("lookupOnContext",e.parts,e.falsy,e.isScoped):this.opcode("pushContext")},DATA:function(e){this.options.data=!0,this.opcode("lookupData",e.id.depth,e.id.parts)},STRING:function(e){this.opcode("pushString",e.string)},NUMBER:function(e){this.opcode("pushLiteral",e.number)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:c.call(arguments,1)})},addDepth:function(e){0!==e&&(this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e)))},classifySexpr:function(e){var t=e.isHelper,n=e.eligibleHelper,i=this.options;if(n&&!t){var a=e.id.parts[0];i.knownHelpers[a]?t=!0:i.knownHelpersOnly&&(n=!1)}return t?"helper":n?"ambiguous":"simple"},pushParams:function(e){for(var t=0,n=e.length;n>t;t++)this.pushParam(e[t])},pushParam:function(e){this.stringParams?(e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",e.stringModeValue,e.type),"sexpr"===e.type&&this.sexpr(e)):(this.trackIds&&this.opcode("pushId",e.type,e.idName||e.stringModeValue),this.accept(e))},setupFullMustacheParams:function(e,t,n){var i=e.params;return this.pushParams(i),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.hash(e.hash):this.opcode("emptyHash"),i}},s.precompile=i,s.compile=a,s}(n,t),u=function(e,t){"use strict";function n(e){this.value=e}function i(){}var a,r=e.COMPILER_REVISION,s=e.REVISION_CHANGES,o=t;i.prototype={nameLookup:function(e,t){return i.isValidJavaScriptVariableName(t)?e+"."+t:e+"['"+t+"']"},depthedLookup:function(e){return this.aliases.lookup="this.lookup",'lookup(depths, "'+e+'")'},compilerInfo:function(){var e=r,t=s[e];return[e,t]},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,i){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!i,this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.depths.list.length||this.options.compat;var a,r,s,l=e.opcodes;for(r=0,s=l.length;s>r;r++)a=l[r],this[a.opcode].apply(this,a.args);if(this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new o("Compile completed with content left on stack");var c=this.createFunctionContext(i);if(this.isChild)return c;var d={compiler:this.compilerInfo(),main:c},u=this.context.programs;for(r=0,s=u.length;s>r;r++)u[r]&&(d[r]=u[r]);return this.environment.usePartial&&(d.usePartial=!0),this.options.data&&(d.useData=!0),this.useDepths&&(d.useDepths=!0),this.options.compat&&(d.compat=!0),i||(d.compiler=JSON.stringify(d.compiler),d=this.objectLiteral(d)),d},preamble:function(){this.lastContext=0,this.source=[]},createFunctionContext:function(e){var t="",n=this.stackVars.concat(this.registers.list);n.length>0&&(t+=", "+n.join(", "));for(var i in this.aliases)this.aliases.hasOwnProperty(i)&&(t+=", "+i+"="+this.aliases[i]);var a=["depth0","helpers","partials","data"];this.useDepths&&a.push("depths");var r=this.mergeSource(t);return e?(a.push(r),Function.apply(this,a)):"function("+a.join(",")+") {\n  "+r+"}"},mergeSource:function(e){for(var t,n,i="",a=!this.forceBuffer,r=0,s=this.source.length;s>r;r++){var o=this.source[r];o.appendToBuffer?t=t?t+"\n    + "+o.content:o.content:(t&&(i?i+="buffer += "+t+";\n  ":(n=!0,i=t+";\n  "),t=void 0),i+=o+"\n  ",this.environment.isSimple||(a=!1))}return a?(t||!i)&&(i+="return "+(t||'""')+";\n"):(e+=", buffer = "+(n?"":this.initializeBuffer()),i+=t?"return buffer + "+t+";\n":"return buffer;\n"),e&&(i="var "+e.substring(2)+(n?"":";\n  ")+i),i},blockValue:function(e){this.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=[this.contextName(0)];this.setupParams(e,0,t);var n=this.popStack();t.splice(1,0,n),this.push("blockHelperMissing.call("+t.join(", ")+")")},ambiguousBlockValue:function(){this.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=[this.contextName(0)];this.setupParams("",0,e,!0),this.flushInline();var t=this.topStack();e.splice(1,0,t),this.pushSource("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.pendingContent&&(e=this.pendingContent+e),this.pendingContent=e},append:function(){this.flushInline();var e=this.popStack();this.pushSource("if ("+e+" != null) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,n){var i=0,a=e.length;for(n||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[i++]));a>i;i++)this.replaceStack(function(n){var a=this.nameLookup(n,e[i],"context");return t?" && "+a:" != null ? "+a+" : "+n})},lookupData:function(e,t){e?this.pushStackLiteral("this.data(data, "+e+")"):this.pushStackLiteral("data");for(var n=t.length,i=0;n>i;i++)this.replaceStack(function(e){return" && "+this.nameLookup(e,t[i],"data")})},resolvePossibleLambda:function(){this.aliases.lambda="this.lambda",this.push("lambda("+this.popStack()+", "+this.contextName(0)+")")},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"sexpr"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(){this.pushStackLiteral("{}"),this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push("{"+e.ids.join(",")+"}"),this.stringParams&&(this.push("{"+e.contexts.join(",")+"}"),this.push("{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t,n){this.aliases.helperMissing="helpers.helperMissing";var i=this.popStack(),a=this.setupHelper(e,t),r=(n?a.name+" || ":"")+i+" || helperMissing";this.push("(("+r+").call("+a.callParams+"))")},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(n.name+".call("+n.callParams+")")},invokeAmbiguous:function(e,t){this.aliases.functionType='"function"',this.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var n=this.popStack();this.emptyHash();var i=this.setupHelper(0,e,t),a=this.lastHelper=this.nameLookup("helpers",e,"helper");this.push("((helper = (helper = "+a+" || "+n+") != null ? helper : helperMissing"+(i.paramsInit?"),("+i.paramsInit:"")+"),(typeof helper === functionType ? helper.call("+i.callParams+") : helper))")},invokePartial:function(e,t){var n=[this.nameLookup("partials",e,"partial"),"'"+t+"'","'"+e+"'",this.popStack(),this.popStack(),"helpers","partials"];this.options.data?n.push("data"):this.options.compat&&n.push("undefined"),
this.options.compat&&n.push("depths"),this.push("this.invokePartial("+n.join(", ")+")")},assignToHash:function(e){var t,n,i,a=this.popStack();this.trackIds&&(i=this.popStack()),this.stringParams&&(n=this.popStack(),t=this.popStack());var r=this.hash;t&&r.contexts.push("'"+e+"': "+t),n&&r.types.push("'"+e+"': "+n),i&&r.ids.push("'"+e+"': "+i),r.values.push("'"+e+"': ("+a+")")},pushId:function(e,t){"ID"===e||"DATA"===e?this.pushString(t):"sexpr"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:i,compileChildren:function(e,t){for(var n,i,a=e.children,r=0,s=a.length;s>r;r++){n=a[r],i=new this.compiler;var o=this.matchExistingProgram(n);null==o?(this.context.programs.push(""),o=this.context.programs.length,n.index=o,n.name="program"+o,this.context.programs[o]=i.compile(n,t,this.context,!this.precompile),this.context.environments[o]=n,this.useDepths=this.useDepths||i.useDepths):(n.index=o,n.name="program"+o)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;n>t;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){var t=this.environment.children[e],n=(t.depths.list,this.useDepths),i=[t.index,"data"];return n&&i.push("depths"),"this.program("+i.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new n(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),e&&this.source.push(e)},pushStack:function(e){this.flushInline();var t=this.incrStack();return this.pushSource(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var t,i,a,r="";this.isInline();if(!this.isInline())throw new o("replaceStack on non-inline");var s=this.popStack(!0);if(s instanceof n)r=t=s.value,a=!0;else{i=!this.stackSlot;var l=i?this.incrStack():this.topStackName();r="("+this.push(l)+" = "+s+")",t=this.topStack()}var c=e.call(this,t);a||this.popStack(),i&&this.stackSlot--,this.push("("+r+c+")")},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var t=0,i=e.length;i>t;t++){var a=e[t];a instanceof n?this.compileStack.push(a):this.pushStack(a)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),i=(t?this.inlineStack:this.compileStack).pop();if(!e&&i instanceof n)return i.value;if(!t){if(!this.stackSlot)throw new o("Invalid stack pop");this.stackSlot--}return i},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof n?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(this.quotedString(n)+":"+e[n]);return"{"+t.join(",")+"}"},setupHelper:function(e,t,n){var i=[],a=this.setupParams(t,e,i,n),r=this.nameLookup("helpers",t,"helper");return{params:i,paramsInit:a,name:r,callParams:[this.contextName(0)].concat(i).join(", ")}},setupOptions:function(e,t,n){var i,a,r,s={},o=[],l=[],c=[];s.name=this.quotedString(e),s.hash=this.popStack(),this.trackIds&&(s.hashIds=this.popStack()),this.stringParams&&(s.hashTypes=this.popStack(),s.hashContexts=this.popStack()),a=this.popStack(),r=this.popStack(),(r||a)&&(r||(r="this.noop"),a||(a="this.noop"),s.fn=r,s.inverse=a);for(var d=t;d--;)i=this.popStack(),n[d]=i,this.trackIds&&(c[d]=this.popStack()),this.stringParams&&(l[d]=this.popStack(),o[d]=this.popStack());return this.trackIds&&(s.ids="["+c.join(",")+"]"),this.stringParams&&(s.types="["+l.join(",")+"]",s.contexts="["+o.join(",")+"]"),this.options.data&&(s.data="data"),s},setupParams:function(e,t,n,i){var a=this.objectLiteral(this.setupOptions(e,t,n));return i?(this.useRegister("options"),n.push("options"),"options="+a):(n.push(a),"")}};for(var l="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),c=i.RESERVED_WORDS={},d=0,u=l.length;u>d;d++)c[l[d]]=!0;return i.isValidJavaScriptVariableName=function(e){return!i.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},a=i}(i,n),p=function(e,t,n,i,a){"use strict";var r,s=e,o=t,l=n.parser,c=n.parse,d=i.Compiler,u=i.compile,p=i.precompile,h=a,f=s.create,m=function(){var e=f();return e.compile=function(t,n){return u(t,n,e)},e.precompile=function(t,n){return p(t,n,e)},e.AST=o,e.Compiler=d,e.JavaScriptCompiler=h,e.Parser=l,e.parse=c,e};return s=m(),s.create=m,s["default"]=s,r=s}(r,s,c,d,u);return p}),define("cui/util/templatable/templatable",["require","jquery","handlebars"],function(e){function t(e){return r(e)?null:o(i(e))}function n(e,t){if(e){var n;if(t){if(n=e.find(t),0===n.length)throw new Error("Invalid template selector: "+t)}else n=e;return a(n.html())}}function i(e){return e.replace(/({{[^}]+}})/g,"<!--$1-->").replace(/\s(src|href)\s*=\s*(['"])(.*?\{.+?)\2/g," data-templatable-$1=$2$3$2")}function a(e){return e.replace(/(?:<|&lt;)!--({{[^}]+}})--(?:>|&gt;)/g,"$1").replace(/data-templatable-/gi,"")}function r(e){return"function"==typeof e}function s(e){if(!e)return{};var t={};for(var n in e){var i=e[n];t[n]=r(i)?i:l.compile(i)}return t}var o=e("jquery"),l=e("handlebars"),c={},d={templateHelpers:null,templatePartials:null,templateObject:null,parseElementFromTemplate:function(){var e,n=this.get("template");/^#/.test(n)&&(e=document.getElementById(n.substring(1)))&&(n=e.innerHTML,this.set("template",n)),this.templateObject=t(n),this.element=o(this.compile())},compile:function(e,t){if(e||(e=this.get("template")),t||(t=this.get("model"))||(t={}),t.toJSON&&(t=t.toJSON()),r(e))return e(t,{helpers:this.templateHelpers,partials:s(this.templatePartials)});var n,i,a=this.templateHelpers,o=this.templatePartials;if(a)for(n in a)a.hasOwnProperty(n)&&l.registerHelper(n,a[n]);if(o)for(i in o)o.hasOwnProperty(i)&&l.registerPartial(i,o[i]);var d=c[e];d||(d=c[e]=l.compile(e));var u=d(t);if(a)for(n in a)a.hasOwnProperty(n)&&delete l.helpers[n];if(o)for(i in o)o.hasOwnProperty(i)&&delete l.partials[i];return u},renderPartial:function(e){if(this.templateObject){var t=n(this.templateObject,e);t?e?this.$(e).html(this.compile(t)):this.element.html(this.compile(t)):this.element.html(this.compile())}else{var i=o(this.compile()),a=i.find(e);a.length?this.$(e).html(a.html()):this.element.html(i.html())}return this},escapeExpression:function(e){return l.escapeExpression(e)}},u=l.compile;return l.compile=function(e){return r(e)?e:u.call(l,e)},d}),define("cui/ui/dialog/dialog",["require","exports","module","jquery","../../core/events/events","../overlay/overlay","../overlay/mask","../../util/templatable/templatable"],function(e,t,n){function i(e){null==e.attr("tabindex")&&e.attr("tabindex","-1")}function a(e){var t=e[0].contentWindow.document;return t.body.scrollHeight&&t.documentElement.scrollHeight?Math.min(t.body.scrollHeight,t.documentElement.scrollHeight):t.documentElement.scrollHeight?t.documentElement.scrollHeight:t.body.scrollHeight?t.body.scrollHeight:void 0}var r=e("jquery"),s=e("../../core/events/events"),o=e("../overlay/overlay"),l=e("../overlay/mask"),c=e("../../util/templatable/templatable"),d='<div class="{{classPrefix}} {{subClass}}"><a class="{{classPrefix}}-close" title="Close" href="javascript:;" data-role="close"></a><div class="{{classPrefix}}-wrap" data-role="wrap"></div></div>',u=o.extend({Implements:c,attrs:{template:d,trigger:{value:null,getter:function(e){return r(e)}},classPrefix:"u-dialog",subClass:"",content:{value:null,setter:function(e){return/^(https?:\/\/|\/|\.\/|\.\.\/)/.test(e)&&(this._type="iframe",(e.indexOf("?ajax")>0||e.indexOf("&ajax")>0)&&(this._ajax=!0)),e}},hasMask:!0,hasEscClose:!0,closeTpl:"&times;",width:450,height:null,initialHeight:300,effect:"none",zIndex:999,autoFit:!0,align:{value:{selfXY:["50%","50%"],baseXY:["50%","42%"]},getter:function(e){return this.element.height()>.84*r(window).height()?{selfXY:["50%","0"],baseXY:["50%","0"]}:e}}},parseElement:function(){this.set("model",{classPrefix:this.get("classPrefix")}),u.superclass.parseElement.call(this),this.contentElement=this.$("[data-role=wrap]"),this.contentElement.css({height:"100%",zoom:1}),this.$("[data-role=close]").hide()},events:{"click [data-role=close]":function(e){e.preventDefault(),this.hide()}},show:function(){return"iframe"===this._type&&(this._ajax?this._ajaxHtml():(!this.get("height")&&this.contentElement.css("height",this.get("initialHeight")),this._showIframe())),u.superclass.show.call(this),this},hide:function(){return"iframe"===this._type&&this.iframe&&(this.iframe.attr({src:"javascript:'';"}),this.iframe.remove(),this.iframe=null),u.superclass.hide.call(this),clearInterval(this._interval),delete this._interval,this},destroy:function(){return this.element.remove(),this._hideMask(),clearInterval(this._interval),u.superclass.destroy.call(this)},setup:function(){u.superclass.setup.call(this),this._setupTrigger(),this._setupMask(),this._setupKeyEvents(),this._setupFocus(),i(this.element),i(this.get("trigger")),this.activeTrigger=this.get("trigger").eq(0)},_onRenderSubClass:function(e,t){t&&this.element.removeClass(t),e&&this.element.addClass(e)},_onRenderContent:function(e){if("iframe"!==this._type){var t;try{t=r(e)}catch(n){t=[]}t[0]?this.contentElement.empty().append(t):this.contentElement.empty().html(e),this._setPosition()}},_onRenderCloseTpl:function(e){""===e?this.$("[data-role=close]").html(e).hide():this.$("[data-role=close]").html(e).show()},_onRenderVisible:function(e){e?"fade"===this.get("effect")?this.element.fadeIn(300):this.element.show():this.element.hide()},_setupTrigger:function(){this.delegateEvents(this.get("trigger"),"click",function(e){e.preventDefault(),this.activeTrigger=r(e.currentTarget),this.show()})},_setupMask:function(){var e=this;l._dialogs=l._dialogs||[],this.after("show",function(){if(this.get("hasMask")){l.set("zIndex",e.get("zIndex")).show(),l.element.insertBefore(e.element);for(var t=!1,n=0;n<l._dialogs.length;n++)l._dialogs[n]===e&&(t=!0);t||l._dialogs.push(e)}}),this.after("hide",this._hideMask)},_hideMask:function(){if(this.get("hasMask"))if(l._dialogs&&l._dialogs[l._dialogs.length-1]===this&&l._dialogs.pop(),l._dialogs&&l._dialogs.length>0){var e=l._dialogs[l._dialogs.length-1];l.set("zIndex",e.get("zIndex")),l.element.insertBefore(e.element)}else l.hide()},_setupFocus:function(){this.after("show",function(){this.element.focus()}),this.after("hide",function(){this.activeTrigger&&this.activeTrigger.focus()})},_setupKeyEvents:function(){this.get("hasEscClose")&&this.delegateEvents(r(document),"keyup.esc",function(e){27===e.keyCode&&this.get("visible")&&this.hide()})},_showIframe:function(){var e=this;this.iframe||this._createIframe(),this.iframe.attr({src:this._fixUrl(),name:"dialog-iframe"+(new Date).getTime()}),this.iframe.one("load",function(){e.get("visible")&&(e.get("autoFit")&&(clearInterval(e._interval),e._interval=setInterval(function(){e._syncHeight()},300)),e._syncHeight(),e._setPosition(),e.trigger("complete:show"))})},_fixUrl:function(){var e=this.get("content").match(/([^?#]*)(\?[^#]*)?(#.*)?/);return e.shift(),e[1]=(e[1]&&"?"!==e[1]?e[1]+"&":"?")+"t="+(new Date).getTime(),e.join("")},_createIframe:function(){var e=this;this.iframe=r("<iframe>",{src:"javascript:'';",scrolling:"no",frameborder:"no",allowTransparency:"true",css:{border:"none",width:"100%",display:"block",height:"100%",overflow:"hidden"}}).appendTo(this.contentElement),s.mixTo(this.iframe[0]),this.iframe[0].on("close",function(){e.hide()})},_syncHeight:function(){var e;if(this.get("height"))clearInterval(this._interval),delete this._interval;else{try{this._errCount=0,e=a(this.iframe)+"px"}catch(t){this._errCount=(this._errCount||0)+1,this._errCount>=6&&(e=this.get("initialHeight"),clearInterval(this._interval),delete this._interval)}this.contentElement.css("height",e),this.element[0].className=this.element[0].className}},_ajaxHtml:function(){var e=this;this.contentElement.css("height",this.get("initialHeight")),this.contentElement.load(this.get("content"),function(){e._setPosition(),e.contentElement.css("height",""),e.trigger("complete:show")})}});n.exports=u}),define("cui/util/dnd/dnd",["require","jquery","../../core/base/base"],function(e){function t(e,t,i){var a=n(e).offset();return a||(a={left:0,top:0}),2===arguments.length?a.left<=n(t).offset().left&&a.left+n(e).outerWidth()>=n(t).offset().left+n(t).outerWidth()&&a.top<=n(t).offset().top&&a.top+n(e).outerHeight()>=n(t).offset().top+n(t).outerHeight():3===arguments.length?a.left<=t&&a.left+n(e).outerWidth()>=t&&a.top<=i&&a.top+n(e).outerHeight()>=i:void 0}var n=e("jquery"),i=e("../../core/base/base"),a=i.extend({propsInAttrs:["element","handle"],element:null,handle:null,attrs:{containment:{value:n(document),setter:function(e){return n(e).eq(0)}},proxy:{value:null,setter:function(e){return n(e).eq(0)}},drops:{value:null,setter:function(e){return n(e)}},disabled:!1,visible:!1,axis:!1,revert:!1,revertDuration:500,dragCursor:"move",dropCursor:"copy",zIndex:9999},initialize:function(e){a.superclass.initialize.call(this,e),this.options={id:"dnd-"+(new Date).getTime(),dragPre:!1,draging:!1,drop:null,diffX:0,diffY:0,dataTransfer:{},next:!0},this.element=n(this.element),0===this.element.length&&n.error("Dnd element error"),this.handle=n(this.handle),0!==this.handle.length&&n.contains(this.element[0],this.handle[0])||(this.handle=this.element),this.handle.css("cursor","move"),this.setup()},setup:function(){this.handle.on("mousedown",n.proxy(this._handleMouseDown,this)),n(document).on("mousemove."+this.options.id,n.proxy(this._handleMouseMove,this)),n(document).on("mouseup."+this.options.id,n.proxy(this._handleMouseUp,this))},destroy:function(){n(document).off("mousemove."+this.options.id),n(document).off("mouseup."+this.options.id),a.superclass.destroy.call(this)},_handleMouseDown:function(e){var t,i,a;if(this.options.next){if(this.get("disabled"))return;t=this.get("proxy")?this.get("proxy"):this.element.clone(),t.css({position:"absolute",left:0,top:0,visibility:"hidden"}),t.appendTo(this.element.parent()),t.data("originx",t.offset().left),t.data("originy",t.offset().top),t.css({left:this.element.offset().left-t.data("originx"),top:this.element.offset().top-t.data("originy"),width:this.element.width(),height:this.element.height()}),i=e.pageX-this.element.offset().left,a=e.pageY-this.element.offset().top,n.extend(this.options,{dragPre:!0,proxy:t,diffX:i,diffY:a})}this.options.dragPre&&e.preventDefault()},_handleMouseMove:function(e){this.options.dragPre?this._executeDragStart():this.options.draging&&(this._executeDrag({pageX:e.pageX,pageY:e.pageY}),this._executeDragEnterLeaveOver(),e.preventDefault())},_handleMouseUp:function(e){var t=this.options;t.dragPre?(t.proxy.remove(),t.proxy=null,t.dragPre=!1):t.draging&&(t.draging=!1,t.next=!1,t.proxy.css("cursor","default"),t.proxy.focus(),this._executeDrop(),this._executeRevert())},_executeDragStart:function(){var e=this.get("visible"),t=this.get("dragCursor"),n=this.get("zIndex"),i=this.options;e||this.element.css("visibility","hidden"),i.proxy.css({"z-index":n,visibility:"visible",cursor:t}),i.proxy.focus(),i.dataTransfer={},i.dragPre=!1,i.draging=!0,this.trigger("dragstart",i.dataTransfer,i.proxy)},_executeDrag:function(e){var t=this.options,n=this.get("containment"),i=this.get("axis"),a=e.pageX-t.diffX,r=e.pageY-t.diffY,s=t.proxy.data("originx"),o=t.proxy.data("originy"),l=n.offset();l||(l={left:0,top:0}),"y"!==i&&(a>=l.left&&a+t.proxy.outerWidth()<=l.left+n.outerWidth()?t.proxy.css("left",a-s):a<=l.left?t.proxy.css("left",l.left-s):t.proxy.css("left",l.left+n.outerWidth()-t.proxy.outerWidth()-s)),"x"!==i&&(r>=l.top&&r+t.proxy.outerHeight()<=l.top+n.outerHeight()?t.proxy.css("top",r-o):r<=l.top?t.proxy.css("top",l.top-o):t.proxy.css("top",l.top+n.outerHeight()-t.proxy.outerHeight()-o)),this.trigger("drag",t.proxy,t.drop)},_executeDragEnterLeaveOver:function(){var e=this,i=this.options,a=this.get("drops"),r=this.get("dragCursor"),s=this.get("dropCursor"),o=i.proxy.offset().left+i.diffX,l=i.proxy.offset().top+i.diffY;null!==a&&(null===i.drop?n.each(a,function(a,r){return t(r,o,l)===!0?(i.proxy.css("cursor",s),i.proxy.focus(),i.drop=n(r),e.trigger("dragenter",i.proxy,i.drop),!1):void 0}):t(i.drop,o,l)===!1?(i.proxy.css("cursor",r),i.proxy.focus(),e.trigger("dragleave",i.proxy,i.drop),i.drop=null):e.trigger("dragover",i.proxy,i.drop))},_executeDrop:function(){var e=this.options,n=this.get("revert"),i=e.proxy.data("originx"),a=e.proxy.data("originy");null!==e.drop&&(t(e.drop,e.proxy)===!1&&n===!1&&(e.proxy.css("left",e.drop.offset().left+(e.drop.outerWidth()-e.proxy.outerWidth())/2-i),e.proxy.css("top",e.drop.offset().top+(e.drop.outerHeight()-e.proxy.outerHeight())/2-a)),this.trigger("drop",e.dataTransfer,e.proxy,e.drop))},_executeRevert:function(){var e=this,t=this.options,n=this.get("drops"),i=this.get("revert"),a=this.get("revertDuration"),r=this.get("visible"),s=this.get("zIndex"),o=t.proxy.offset().left-this.element.offset().left,l=t.proxy.offset().top-this.element.offset().top,c=t.proxy.data("originx"),d=t.proxy.data("originy");i||null===t.drop&&null!==n?t.proxy.animate({left:this.element.offset().left-c,top:this.element.offset().top-d},a,function(){e.element.css("visibility",""),t.proxy.remove(),t.proxy=null,e.trigger("dragend",e.element,t.drop),t.drop=null,t.next=!0}):("relative"===this.element.css("position")?(o=(isNaN(parseInt(this.element.css("left"),10))?0:parseInt(this.element.css("left"),10))+o,l=(isNaN(parseInt(this.element.css("top"),10))?0:parseInt(this.element.css("top"),10))+l):"absolute"===this.element.css("position")?(o=t.proxy.offset().left-c,l=t.proxy.offset().top-d):this.element.css("position","relative"),r===!1?(this.element.css({left:o,top:l,visibility:"","z-index":s}),t.proxy.remove(),t.proxy=null,this.trigger("dragend",this.element,t.drop),t.drop=null,t.next=!0):this.element.animate({left:o,top:l},a,function(){t.proxy.remove(),t.proxy=null,e.trigger("dragend",e.element,e.drop),t.drop=null,t.next=!0}))}});return a.initialize=function(e,t){n(e).each(function(e,i){new a(n.extend({element:i},t))})},a}),define("cui/ui/dialog/confirmbox",["require","jquery","./dialog","../../util/dnd/dnd"],function(e){function t(e){var t=o[e].count||0;o[e].count=++t}function n(e){var t=o[e].count||0;t&&(o[e].count=--t)}var i=e("jquery"),a=e("./dialog"),r=e("../../util/dnd/dnd"),s='{{#if title}}<div class="{{classPrefix}}-title" data-role="title">{{{title}}}</div>{{/if}}<div class="{{classPrefix}}-content" data-role="content"><div class="{{classPrefix}}-message" data-role="message">{{{message}}}</div></div>{{#if hasFoot}}<div class="{{classPrefix}}-operation" data-role="foot"><div class="{{classPrefix}}-btns">{{#if confirmTpl}}<button type="button" class="u-btn u-btn-primary" data-role="confirm">{{{confirmTpl}}}</button>{{/if}}{{#if uncertainTpl}}<button type="button" class="u-btn u-btn-{{uncertainColor}}" data-role="uncertain">{{{uncertainTpl}}}</button>{{/if}}{{#if cancelTpl}}<button type="button" class="u-btn u-btn-default" data-role="cancel">{{{cancelTpl}}}</button>{{/if}}</div></div>{{/if}}',o=a.extend({attrs:{title:"",confirmTpl:"",uncertainTpl:"",uncertainColor:"primary",cancelTpl:"",message:"",dnd:!0,effect:"fade"},setup:function(){o.superclass.setup.call(this);var e={classPrefix:this.get("classPrefix"),message:this.get("message"),title:this.get("title"),confirmTpl:this.get("confirmTpl"),uncertainTpl:this.get("uncertainTpl"),uncertainColor:this.get("uncertainColor"),cancelTpl:this.get("cancelTpl"),hasFoot:this.get("confirmTpl")||this.get("cancelTpl")};this.set("content",this.compile(s,e)),this.after("render",function(){this.get("dnd")&&this.get("title")&&(this.dnd=new r({element:this.element,handle:this.$("[data-role=title]")}))})},destroy:function(){this.dnd&&this.dnd.destroy(),o.superclass.destroy.call(this)},_setPosition:function(){var e=this.contentElement;this.element.height()>.84*i(window).height()?e.find("[data-role=content]").css({maxHeight:i(window).height()-e.find("[data-role=title]").outerHeight()-e.find("[data-role=foot]").outerHeight(),overflowY:"scroll"}):e.find("[data-role=content]").css({maxHeight:9999,overflowY:"visible"}),a.superclass._setPosition.call(this)},events:{"click [data-role=confirm]":function(e){e.preventDefault(),this.trigger("confirm")},"click [data-role=uncertain]":function(e){e.preventDefault(),this.trigger("uncertain")},"click [data-role=cancel]":function(e){e.preventDefault(),this.trigger("cancel"),this.hide()}},_onChangeMessage:function(e){this.$("[data-role=message]").html(e)},_onChangeTitle:function(e){this.$("[data-role=title]").html(e)},_onChangeConfirmTpl:function(e){this.$("[data-role=confirm]").html(e)},_onChangeUncerainTpl:function(e){this.$("[data-role=uncertain]").html(e)},_onChangeCancelTpl:function(e){var t=this.$("[data-role=cancel]");e?t.html(e).show():t.html("").hide()}});return o.alert=function(e,a,r){var s={message:e,title:"",cancelTpl:"",closeTpl:"",onConfirm:function(){a&&a(),this.hide()}};t("alert"),new o(i.extend(null,s,r)).show().after("hide",function(){this.destroy(),n("alert")})},o.confirm=function(e,a,r,s,l){"object"!=typeof s||l||(l=s,s=void 0);var c={message:e,title:a||"",closeTpl:"",onConfirm:function(){r&&r(),this.hide()},onCancel:function(){s&&s(),this.hide()}};t("confirm"),new o(i.extend(null,c,l)).show().after("hide",function(){this.destroy(),n("confirm")})},o.show=function(e,a,r){var s={message:e,title:"",confirmTpl:!1,cancelTpl:!1};t("show"),new o(i.extend(null,s,r)).show().before("hide",function(){a&&a()}).after("hide",function(){this.destroy(),n("show")})},o.hasConfirmBox=function(e){return o[e]&&o[e].count>0},o}),define("component/confirmbox",["require","cui/ui/dialog/confirmbox","../util/i18n"],function(e){var t=e("cui/ui/dialog/confirmbox"),n=e("../util/i18n"),i=t.alert,a=t.confirm,r=t.show;return t.alert=function(e,a,r){r=r||{},(!t.hasConfirmBox("alert")||r.force)&&i(e,a,$.extend({title:n.t("main/sys_info"),confirmTpl:n.t("common/confirm")},r))},t.confirm=function(e,i,r,s){s=s||{},(!t.hasConfirmBox("confirm")||s.force)&&a(e,n.t("main/sys_info"),i,r,$.extend({confirmTpl:n.t("common/confirm"),cancelTpl:n.t("common/cancel")},s))},t.show=function(e,n,i){i=i||{},(!t.hasConfirmBox("show")||i.force)&&r(e,n,i)},t}),define("util/hbshelper",["require","handlebars","./i18n","./email"],function(e){var t=e("handlebars"),n=e("./i18n"),i=e("./email");t.registerHelper("raw",function(e){return e.fn(this).replace(/\[\[\[/g,"{{{").replace(/]]]/g,"}}}").replace(/\[\[/g,"{{").replace(/]]/g,"}}")}),t.registerHelper("lookup",function(e,t){return e[t]}),t.registerHelper("i18n",function(e,t){var i;return 0===e.indexOf("prop:")?(e=e.substring(5),i=n.translate(e),$.each(t.hash,function(e,t){var n=new RegExp("\\{"+e+"\\}","g");i=i.replace(n,t)})):0===e.indexOf("join:")?(e=e.substring(5),$.each(t.hash,function(t,n){e+=n}),i=n.translate(e)):i=n.translate(e,t.hash),i}),t.registerHelper("countIndent",function(e){return 12*(e-1)}),t.registerHelper("hemail",function(e,t,n){var a,r;switch(n||(n=t,t="name"),t){case"name":a=i.parseTrueName(e)||i.parseAddress(e);break;case"nameOnly":r=i.parseTrueName(e),a=r?/^"|"$/g.test(r)?r:'"'+r+'"':i.parseAddress(e);break;case"addr":a=i.parseAddress(e);break;case"addrWithQuote":r=i.parseTrueName(e).replace(/"/g,'\\"'),a=r?"<"+i.parseAddress(e)+">":"";break;case"both":r=i.parseTrueName(e),a=r?(/^"|"$/g.test(r)?r:'"'+r+'"')+" <"+i.parseAddress(e)+">":i.parseAddress(e)}return a}),t.registerHelper("listEditItems",function(e,n,i){var a="",r=n.split(","),s=t.compile(e);return $.each(r,function(e,t){i[t]&&(a+=s(i[t]))}),new t.SafeString(a)}),t.registerHelper("math",function(e,t,n,i){return e=parseFloat(e),n=parseFloat(n),{"+":e+n,"-":e-n,"*":e*n,"/":e/n,"%":e%n}[t]});var a={contains:function(e,t,n){return-1!==e.indexOf(t)?n.fn(this):n.inverse(this)},and:function(e,t,n){return e&&t?n.fn(this):n.inverse(this)},gt:function(e,t,n){return e>t?n.fn(this):n.inverse(this)},gte:function(e,t,n){return e>=t?n.fn(this):n.inverse(this)},is:function(){var e,t,n,i;if(3==arguments.length)return e=arguments[0],n=arguments[1],i=arguments[2],e===n?i.fn(this):i.inverse(this);if(e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3],"in"==t)return"string"==typeof n&&(n=n.split(",")),-1!==n.indexOf(e)?i.fn(this):i.inverse(this);throw new Error('Handlebars Helper "is" can\'t support '+t)},isnt:function(e,t,n){return e!==t?n.fn(this):n.inverse(this)},lt:function(e,t,n){return t>e?n.fn(this):n.inverse(this)},lte:function(e,t,n){return t>=e?n.fn(this):n.inverse(this)},or:function(e,t,n){return e||t?n.fn(this):n.inverse(this)},ifNth:function(e,t,n){return t+=1,t%e===0?n.fn(this):n.inverse(this)},compare:function(e,t,n,i){if(arguments.length<3)throw new Error('Handlebars Helper "compare" needs 2 parameters');void 0===i&&(i=n,n=t,t="===");var a={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},"<":function(e,t){return t>e},">":function(e,t){return e>t},"<=":function(e,t){return t>=e},">=":function(e,t){return e>=t},"typeof":function(e,t){return typeof e==t}};if(!a[t])throw new Error('Handlebars Helper "compare" doesn\'t know the operator '+t);var r=a[t](e,n);return r?i.fn(this):i.inverse(this)},random:function(){return Math.random()},if_eq:function(e,t){return e===t.hash.compare?t.fn(this):t.inverse(this)},unless_eq:function(e,t){return e===t.hash.compare?t.inverse(this):t.fn(this)},if_gt:function(e,t){return e>t.hash.compare?t.fn(this):t.inverse(this)},unless_gt:function(e,t){return e>t.hash.compare?t.inverse(this):t.fn(this)},if_lt:function(e,t){return e<t.hash.compare?t.fn(this):t.inverse(this)},unless_lt:function(e,t){return e<t.hash.compare?t.inverse(this):t.fn(this)},if_gteq:function(e,t){return e>=t.hash.compare?t.fn(this):t.inverse(this)},unless_gteq:function(e,t){return e>=t.hash.compare?t.inverse(this):t.fn(this)},if_lteq:function(e,t){return e<=t.hash.compare?t.fn(this):t.inverse(this)},unless_lteq:function(e,t){return e<=t.hash.compare?t.inverse(this):t.fn(this)},ifAny:function(){for(var e=arguments.length-2,t=arguments[e+1],n=!0,i=0;e>i;){if(!arguments[i]){n=!1;break}i+=1}return n?t(this):t.inverse(this)},ifEven:function(e,t){return e%2==0?t.fn(this):t.inverse(this)}};for(var r in a)a.hasOwnProperty(r)&&t.registerHelper(r,a[r])}),define("util/arrays",[],function(){function e(e,t){return e.length===t.length&&e.every(function(e){return t.includes(e)})}return{isEqUnordered:e}}),define("util/cache",[],function(){function e(e,t,n,i){i="boolean"==typeof i?i:!1,p[e]={value:t,timeout:"number"==typeof n?(new Date).getTime()+1e3*parseInt(n,10):null},i&&s(e,t,n)}function t(t,n,i){e(t,n,i,!0)}function n(e,t){t="boolean"==typeof t?t:!1;var n=p[e];return(!n||n.timeout&&n.timeout<(new Date).getTime())&&t&&(n=p[e]=o(e)),n&&n.value}function i(e){return n(e,!0)}function a(e,t){t="boolean"==typeof t?t:!1,delete p[e],t&&l(e)}function r(e){a(e,!0)}function s(e,t,n){var i;c&&u&&(i={value:t,timeout:"number"==typeof n?(new Date).getTime()+1e3*parseInt(n,10):null},localStorage.setItem(e,JSON.stringify(i)))}function o(e){var t=null;return c&&u&&(t=localStorage.getItem(e),t=JSON.parse(t),t&&t.timeout&&t.timeout<(new Date).getTime()&&(a(e),t=null)),t}function l(e){c&&localStorage.removeItem(e)}var c;try{localStorage.setItem("LS","LS"),localStorage.removeItem("LS"),c=!0}catch(d){c=!1}var u=JSON&&"function"==typeof JSON.parse,p={};return{setItem:e,setItemWithLocal:t,getItem:n,getItemWithLocal:i,removeItem:a,removeItemWithLocal:r,setLocalItem:s,getLocalItem:o,removeLocalItem:l}}),define("util/url",[],function(){function e(e,t){var n,i,a,r=0;if(e.indexOf("?")>=0?a=!0:(a=!1,e="?"+e),e=e.split("?"),n=e[0],i=e[1].split("&"),t)for(;r<i.length;)0===i[r].indexOf(t)?i.splice(r,1):r++;return i=i.join("&"),n?i?n+"?"+i:n:a?"?"+i:i}function t(t,n){var i,a;for(i=0,a=n.length;a>i;i++)t=e(t,n[i]);return t}function n(e,t){var n,i,a,r="";for(n=e.substring(e.indexOf("?")+1,e.length),n=n.replace(/#.*$/,""),n=n.split("&"),i=0,a=n.length;a>i;i++)if(t&&0===n[i].indexOf(t)){r=n[i].split("=")[1];break}return r}function i(t,n,i){var a;return t=e(t,n),a=t.indexOf("?"),i=encodeURIComponent(i),a>=0?a===t.length-1?t+n+"="+i:t+"&"+n+"="+i:t+"?"+n+"="+i}function a(e,t){function n(t){if($.isPlainObject(t))for(var n in t)t.hasOwnProperty(n)&&(e=i(e,n,t[n]))}for(var a=Array.prototype.slice.call(arguments,1),r=0;r<a.length;++r)!function(e){n(a[e])}(r);return e}return{removeUrlParam:e,removeUrlParams:t,getUrlParamValue:n,updateUrlParam:i,addUrlParams:a}}),define("util/jsonhelper",[],function(){function e(e){return 10>e?"0"+e:e}function t(e,t){if(!t)return e;var n=e.indexOf(":"),a=e.substring(0,n),r=e.substring(n+1);return r=i(r),a+":"+r}function n(e,t){return t?e=i(e):e}function i(e){return e.replace(/^[\'\"]|[\'\"]$/g,"")}function a(t){return"number"==typeof t||"string"==typeof t||"boolean"==typeof t?t.valueOf():t instanceof Date&&isFinite(t.valueOf())?"!!date '"+t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())+"'":null}function r(e){return l.lastIndex=0,l.test(e)?'"'+e.replace(l,function(e){var t=u[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function s(e,i){var o,l,u,h,f,m=c,g=i[e];switch(g&&"object"==typeof g&&null!=a(g)&&(g=a(g)),"function"==typeof p&&(g=p.call(i,e,g)),typeof g){case"string":return r(g);case"number":return isFinite(g)?String(g):"null";case"boolean":case"null":return String(g);case"object":if(!g)return"null";if(c+=d,f=[],"[object Array]"===Object.prototype.toString.apply(g)){for(h=g.length,o=0;h>o;o+=1)f[o]=s(o,g)||"null";if(0===f.length)u="[]";else{var v,_=c?"[\n"+c:"[";for(v=0;v<f.length;v++)v>0&&(_+=",\n"+c),_+=n(f[v],g[v]instanceof Date);_+=c?"\n"+m+"]":"]",u=_}return c=m,u}if(p&&"object"==typeof p)for(h=p.length,o=0;h>o;o+=1)"string"==typeof p[o]&&(l=p[o],u=s(l,g),u&&f.push(t(r(l)+(c?": ":":")+u,g[l]instanceof Date)));else for(l in g)Object.prototype.hasOwnProperty.call(g,l)&&(u=s(l,g),u&&f.push(t(r(l)+(c?": ":":")+u,g[l]instanceof Date)));return u=0===f.length?"{}":c?"{\n"+c+f.join(",\n"+c)+"\n"+m+"}":"{"+f.join(",")+"}",c=m,u}}function o(e,t,n){var i;if(c="",d="","number"==typeof n)for(i=0;n>i;i+=1)d+=" ";else"string"==typeof n&&(d=n);if(p=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return s("",{"":e})}var l,c,d,u,p;return l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},{stringify:o}}),define("util/xhr",["require","i18n!error,message,common","jquery","../configstore","./i18n","./common-controls","./url","../util/jsonhelper","../component/confirmbox"],function(e){function t(e){var t,n,i;return e=e||{},t=location.protocol,n=location.host,i=e.url||(e.json===!1?"/s":"/s/json"),i=c.addUrlParams(l.path(i),e.query||{}),t+"//"+n+i}function n(){return s.getConfig("context.exiturl")||"/"}function i(e){e=e||{};var t,n=e.query||{};t=e.url?l.path(e.url+(r.isEmptyObject(n)?"":"?")):l.path("/s"+(e.json===!1?"":"/json")+(r.isEmptyObject(n)?"":"?"));var i;for(i in n)t+=i+"="+n[i]+"&";
return t.replace(/&$/,"")}function a(e,t,n){e=e||{},e.onlyVar="boolean"===r.type(e.onlyVar)?e.onlyVar:!0,e.type=e.type||"POST",e.url=e.url||i(e),e.data=r.isPlainObject(e.data)?d.stringify(e.data):e.data,e.headers=e.headers||{},e.headers.Accept=e.headers.Accept||"text/x-json",e.contentType=e.contentType||"text/x-json",r.ajax(e).done(function(i,a,s){var o={};if(i&&i.code&&"S_OK"!==i.code){if(i.errorProcessed=function(){delete i.errorProcessed},e.preprocess===!1?(t||r.noop)(i,a,s):(n||r.noop)(s,a,i),void 0===i.errorProcessed)return;r.each(p,function(e,t){return t.code!==i.code||"FA_SECURITY"===i.code&&i.securityResult!==t.securityResult&&t.securityResult?void 0:(o=t,!1)}),r.isEmptyObject(o)?console.log("Unprocessed error: ",i):u.alert(o.message,function(){if(o.path){var e=o.path,t="/"===e[0];window.location.href=t?l.path(e):e}})}else(t||r.noop)(e.onlyVar&&i&&i["var"]?i["var"]:i,a,s)}).fail(function(e,t,i){"function"===r.type(n)?n(e,t,i):u.alert(o.t("common/msg_request_failed"))})}e("i18n!error,message,common");var r=e("jquery"),s=e("../configstore"),o=e("./i18n"),l=e("./common-controls"),c=e("./url"),d=e("../util/jsonhelper"),u=e("../component/confirmbox"),p=[{code:"FA_INVALID_SESSION",message:o.t("error/FA_INVALID_SESSION"),path:n()},{code:"FA_UNKNOWN",message:o.t("message/FS_UNKNOWN"),path:""},{code:"FA_SECURITY",securityReason:"Cookie",message:o.t("common/FA_COOKIE_NOT_MATCH"),path:n()},{code:"FA_SECURITY",securityReason:"IP",message:o.t("common/FA_IP_NOT_MATCH"),path:n()},{code:"FA_SECURITY",securityResult:"",message:o.t("common/FA_SECURITY"),path:n()},{code:"FA_SCREEN_LOCKED",message:o.t("error/FA_SCREEN_LOCKED")}];return{getFullRequestURL:t,getRequestURL:i,simpleCall:a}}),define("util/size",[],function(){function e(e,t){var n,i=["B","K","M","G","T"];return e=isNaN(parseFloat(e))?e:parseFloat(e),t=t||0,0==e?"0B":(n=parseInt(Math.floor(Math.log(e)/Math.log(1024))),(e/Math.pow(1024,n)).toFixed(t)+i[n])}return{bytesToSize:e}}),define("util/file",["require","./size"],function(e){function t(e){e=e||{},e.filename=e.filename||e.name,e.filename&&(e.fileType=n(e.filename)),e.formatSize=e.formatSize||a.bytesToSize(e.estimateSize||e.size||e.contentLength,2)}function n(e){var t,n;return"string"!=typeof e?e:(n=e.lastIndexOf("."),0>n?e:(t=e.substring(n+1,e.length).toLowerCase(),-1!=t.indexOf("htm")&&(t="html"),t))}function i(e,t){if(e=""+e,-1!==e.indexOf(".")){var n=e.substring(e.lastIndexOf(".")+1,e.length).toLowerCase(),i=e.replace("."+n,"");return i.length<=t?e:(i=i.substr(0,t)+(e.length>t?"[...]":""),i+"."+n)}return e.substr(0,t)+(e.length>t?"...":"")}var a=e("./size");return{isAllowableUploadImage:function(e){return e.type?/^image\/jpeg|png|gif$/.test(e.type):/\.(jpg|jpeg|png|gif)$/.test(e)},formatFile:t,formatFileType:n,truncateName:i}}),define("util/messageformat",[],function(){function e(e,t){return e.replace(/\{(\d+)\}/g,function(){return t instanceof Array?t[arguments[1]]:t})}return{format:e}}),define("util/py",["require"],function(e){function t(e,t,n){if(!e)return null;if(e&&t){var i=a(e,t);if(-1!=i)return{startIndex:i,matchLength:t.length}}if(n&&t){var s=r(n,t);if(-1!=s)return{startIndex:0,matchLength:s}}return null}function n(e,n){var i=t(e,n,null);return i?i.startIndex:-1}function i(e,t){if(e==t)return!0;var n=!1,i=String(e).charCodeAt(0);return i>=19968&&40869>=i&&(n=!0),n?(o[i]||s.charAt(i-19968)||"").indexOf(t)>-1:!1}function a(e,t){if(!e||!t)return-1;e=e.toUpperCase(),t=t.toUpperCase();var n=t.charAt(0),a=e.length-t.length;if(0>a)return-1;for(var r=0;a>=r;r++)if(i(e.charAt(r),n)&&a>=r){for(var s=r+1,o=s+t.length-1,l=1;o>s&&i(e.charAt(s),t.charAt(l));l++,s++);if(s==o)return r}return-1}function r(e,t){var n="",i=0;t=t.toLowerCase();for(var a,r=t.length,s=0;s<e.length;s++){var o=e[s],l=o.substring(1,o.length);if(a=o.charAt(0),n+=l,1==a?i++:i+=l.length,n.length>=r)break}return n.substring(0,r)==t?1==a?i:i-(n.length-r):-1}var s="YDYQSXMWZSSXJBYMGCCZQPSSQBYCDSCDQLDYLYBSSJGYZZJJFKCCLZDHWDWZJLJPFYYNWJJTMYHZWZHFLZPPQHGSCYYYNJQYXXGJHHSDSJNKKTMOMLCRXYPSNQSECCQZGGLLYJLMYZZSECYKYYHQWJSSGGYXYZYJWWKDJHYCHMYXJTLXJYQBYXZLDWRDJRWYSRLDZJPCBZJJBRCFTLECZSTZFXXZHTRQHYBDLYCZSSYMMRFMYQZPWWJJYFCRWFDFZQPYDDWYXKYJAWJFFXYPSFTZYHHYZYSWCJYXSCLCXXWZZXNBGNNXBXLZSZSBSGPYSYZDHMDZBQBZCWDZZYYTZHBTSYYBZGNTNXQYWQSKBPHHLXGYBFMJEBJHHGQTJCYSXSTKZHLYCKGLYSMZXYALMELDCCXGZYRJXSDLTYZCQKCNNJWHJTZZCQLJSTSTBNXBTYXCEQXGKWJYFLZQLYHYXSPSFXLMPBYSXXXYDJCZYLLLSJXFHJXPJBTFFYABYXBHZZBJYZLWLCZGGBTSSMDTJZXPTHYQTGLJSCQFZKJZJQNLZWLSLHDZBWJNCJZYZSQQYCQYRZCJJWYBRTWPYFTWEXCSKDZCTBZHYZZYYJXZCFFZZMJYXXSDZZOTTBZLQWFCKSZSXFYRLNYJMBDTHJXSQQCCSBXYYTSYFBXDZTGBCNSLCYZZPSAZYZZSCJCSHZQYDXLBPJLLMQXTYDZXSQJTZPXLCGLQTZWJBHCTSYJSFXYEJJTLBGXSXJMYJQQPFZASYJNTYDJXKJCDJSZCBARTDCLYJQMWNQNCLLLKBYBZZSYHQQLTWLCCXTXLLZNTYLNEWYZYXCZXXGRKRMTCNDNJTSYYSSDQDGHSDBJGHRWRQLYBGLXHLGTGXBQJDZPYJSJYJCTMRNYMGRZJCZGJMZMGXMPRYXKJNYMSGMZJYMKMFXMLDTGFBHCJHKYLPFMDXLQJJSMTQGZSJLQDLDGJYCALCMZCSDJLLNXDJFFFFJCZFMZFFPFKHKGDPSXKTACJDHHZDDCRRCFQYJKQCCWJDXHWJLYLLZGCFCQDSMLZPBJJPLSBCJGGDCKKDEZSQCCKJGCGKDJTJDLZYCXKLQSCGJCLTFPCQCZGWPJDQYZJJBYJHSJDZWGFSJGZKQCCZLLPSPKJGQJHZZLJPLGJGJJTHJJYJZCZMLZLYQBGJWMLJKXZDZNJQSYZMLJLLJKYWXMKJLHSKJGBMCLYYMKXJQLBMLLKMDXXKWYXYSLMLPSJQQJQXYXFJTJDXMXXLLCXQBSYJBGWYMBGGBCYXPJYGPEPFGDJGBHBNSQJYZJKJKHXQFGQZKFHYGKHDKLLSDJQXPQYKYBNQSXQNSZSWHBSXWHXWBZZXDMNSJBSBKBBZKLYLXGWXDRWYQZMYWSJQLCJXXJXKJEQXSCYETLZHLYYYSDZPAQYZCMTLSHTZCFYZYXYLJSDCJQAGYSLCQLYYYSHMRQQKLDXZSCSSSYDYCJYSFSJBFRSSZQSBXXPXJYSDRCKGJLGDKZJZBDKTCSYQPYHSTCLDJDHMXMCGXYZHJDDTMHLTXZXYLYMOHYJCLTYFBQQXPFBDFHHTKSQHZYYWCNXXCRWHOWGYJLEGWDQCWGFJYCSNTMYTOLBYGWQWESJPWNMLRYDZSZTXYQPZGCWXHNGPYXSHMYQJXZTDPPBFYHZHTJYFDZWKGKZBLDNTSXHQEEGZZYLZMMZYJZGXZXKHKSTXNXXWYLYAPSTHXDWHZYMPXAGKYDXBHNHXKDPJNMYHYLPMGOCSLNZHKXXLPZZLBMLSFBHHGYGYYGGBHSCYAQTYWLXTZQCEZYDQDQMMHTKLLSZHLSJZWFYHQSWSCWLQAZYNYTLSXTHAZNKZZSZZLAXXZWWCTGQQTDDYZTCCHYQZFLXPSLZYGPZSZNGLNDQTBDLXGTCTAJDKYWNSYZLJHHZZCWNYYZYWMHYCHHYXHJKZWSXHZYXLYSKQYSPSLYZWMYPPKBYGLKZHTYXAXQSYSHXASMCHKDSCRSWJPWXSGZJLWWSCHSJHSQNHCSEGNDAQTBAALZZMSSTDQJCJKTSCJAXPLGGXHHGXXZCXPDMMHLDGTYBYSJMXHMRCPXXJZCKZXSHMLQXXTTHXWZFKHCCZDYTCJYXQHLXDHYPJQXYLSYYDZOZJNYXQEZYSQYAYXWYPDGXDDXSPPYZNDLTWRHXYDXZZJHTCXMCZLHPYYYYMHZLLHNXMYLLLMDCPPXHMXDKYCYRDLTXJCHHZZXZLCCLYLNZSHZJZZLNNRLWHYQSNJHXYNTTTKYJPYCHHYEGKCTTWLGQRLGGTGTYGYHPYHYLQYQGCWYQKPYYYTTTTLHYHLLTYTTSPLKYZXGZWGPYDSSZZDQXSKCQNMJJZZBXYQMJRTFFBTKHZKBXLJJKDXJTLBWFZPPTKQTZTGPDGNTPJYFALQMKGXBDCLZFHZCLLLLADPMXDJHLCCLGYHDZFGYDDGCYYFGYDXKSSEBDHYKDKDKHNAXXYBPBYYHXZQGAFFQYJXDMLJCSQZLLPCHBSXGJYNDYBYQSPZWJLZKSDDTACTBXZDYZYPJZQSJNKKTKNJDJGYYPGTLFYQKASDNTCYHBLWDZHBBYDWJRYGKZYHEYYFJMSDTYFZJJHGCXPLXHLDWXXJKYTCYKSSSMTWCTTQZLPBSZDZWZXGZAGYKTYWXLHLSPBCLLOQMMZSSLCMBJCSZZKYDCZJGQQDSMCYTZQQLWZQZXSSFPTTFQMDDZDSHDTDWFHTDYZJYQJQKYPBDJYYXTLJHDRQXXXHAYDHRJLKLYTWHLLRLLRCXYLBWSRSZZSYMKZZHHKYHXKSMDSYDYCJPBZBSQLFCXXXNXKXWYWSDZYQOGGQMMYHCDZTTFJYYBGSTTTYBYKJDHKYXBELHTYPJQNFXFDYKZHQKZBYJTZBXHFDXKDASWTAWAJLDYJSFHBLDNNTNQJTJNCHXFJSRFWHZFMDRYJYJWZPDJKZYJYMPCYZNYNXFBYTFYFWYGDBNZZZDNYTXZEMMQBSQEHXFZMBMFLZZSRXYMJGSXWZJSPRYDJSJGXHJJGLJJYNZZJXHGXKYMLPYYYCXYTWQZSWHWLYRJLPXSLSXMFSWWKLCTNXNYNPSJSZHDZEPTXMYYWXYYSYWLXJQZQXZDCLEEELMCPJPCLWBXSQHFWWTFFJTNQJHJQDXHWLBYZNFJLALKYYJLDXHHYCSTYYWNRJYXYWTRMDRQHWQCMFJDYZMHMYYXJWMYZQZXTLMRSPWWCHAQBXYGZYPXYYRRCLMPYMGKSJSZYSRMYJSNXTPLNBAPPYPYLXYYZKYNLDZYJZCZNNLMZHHARQMPGWQTZMXXMLLHGDZXYHXKYXYCJMFFYYHJFSBSSQLXXNDYCANNMTCJCYPRRNYTYQNYYMBMSXNDLYLYSLJRLXYSXQMLLYZLZJJJKYZZCSFBZXXMSTBJGNXYZHLXNMCWSCYZYFZLXBRNNNYLBNRTGZQYSATSWRYHYJZMZDHZGZDWYBSSCSKXSYHYTXXGCQGXZZSHYXJSCRHMKKBXCZJYJYMKQHZJFNBHMQHYSNJNZYBKNQMCLGQHWLZNZSWXKHLJHYYBQLBFCDSXDLDSPFZPSKJYZWZXZDDXJSMMEGJSCSSMGCLXXKYYYLNYPWWWGYDKZJGGGZGGSYCKNJWNJPCXBJJTQTJWDSSPJXZXNZXUMELPXFSXTLLXCLJXJJLJZXCTPSWXLYDHLYQRWHSYCSQYYBYAYWJJJQFWQCQQCJQGXALDBZZYJGKGXPLTZYFXJLTPADKYQHPMATLCPDCKBMTXYBHKLENXDLEEGQDYMSAWHZMLJTWYGXLYQZLJEEYYBQQFFNLYXRDSCTGJGXYYNKLLYQKCCTLHJLQMKKZGCYYGLLLJDZGYDHZWXPYSJBZKDZGYZZHYWYFQYTYZSZYEZZLYMHJJHTSMQWYZLKYYWZCSRKQYTLTDXWCTYJKLWSQZWBDCQYNCJSRSZJLKCDCDTLZZZACQQZZDDXYPLXZBQJYLZLLLQDDZQJYJYJZYXNYYYNYJXKXDAZWYRDLJYYYRJLXLLDYXJCYWYWNQCCLDDNYYYNYCKCZHXXCCLGZQJGKWPPCQQJYSBZZXYJSQPXJPZBSBDSFNSFPZXHDWZTDWPPTFLZZBZDMYYPQJRSDZSQZSQXBDGCPZSWDWCSQZGMDHZXMWWFYBPDGPHTMJTHZSMMBGZMBZJCFZWFZBBZMQCFMBDMCJXLGPNJBBXGYHYYJGPTZGZMQBQTCGYXJXLWZKYDPDYMGCFTPFXYZTZXDZXTGKMTYBBCLBJASKYTSSQYYMSZXFJEWLXLLSZBQJJJAKLYLXLYCCTSXMCWFKKKBSXLLLLJYXTYLTJYYTDPJHNHNNKBYQNFQYYZBYYESSESSGDYHFHWTCJBSDZZTFDMXHCNJZYMQWSRYJDZJQPDQBBSTJGGFBKJBXTGQHNGWJXJGDLLTHZHHYYYYYYSXWTYYYCCBDBPYPZYCCZYJPZYWCBDLFWZCWJDXXHYHLHWZZXJTCZLCDPXUJCZZZLYXJJTXPHFXWPYWXZPTDZZBDZCYHJHMLXBQXSBYLRDTGJRRCTTTHYTCZWMXFYTWWZCWJWXJYWCSKYBZSCCTZQNHXNWXXKHKFHTSWOCCJYBCMPZZYKBNNZPBZHHZDLSYDDYTYFJPXYNGFXBYQXCBHXCPSXTYZDMKYSNXSXLHKMZXLYHDHKWHXXSSKQYHHCJYXGLHZXCSNHEKDTGZXQYPKDHEXTYKCNYMYYYPKQYYYKXZLTHJQTBYQHXBMYHSQCKWWYLLHCYYLNNEQXQWMCFBDCCMLJGGXDQKTLXKGNQCDGZJWYJJLYHHQTTTNWCHMXCXWHWSZJYDJCCDBQCDGDNYXZTHCQRXCBHZTQCBXWGQWYYBXHMBYMYQTYEXMQKYAQYRGYZSLFYKKQHYSSQYSHJGJCNXKZYCXSBXYXHYYLSTYCXQTHYSMGSCPMMGCCCCCMTZTASMGQZJHKLOSQYLSWTMXSYQKDZLJQQYPLSYCZTCQQPBBQJZCLPKHQZYYXXDTDDTSJCXFFLLCHQXMJLWCJCXTSPYCXNDTJSHJWXDQQJSKXYAMYLSJHMLALYKXCYYDMNMDQMXMCZNNCYBZKKYFLMCHCMLHXRCJJHSYLNMTJZGZGYWJXSRXCWJGJQHQZDQJDCJJZKJKGDZQGJJYJYLXZXXCDQHHHEYTMHLFSBDJSYYSHFYSTCZQLPBDRFRZTZYKYWHSZYQKWDQZRKMSYNBCRXQBJYFAZPZZEDZCJYWBCJWHYJBQSZYWRYSZPTDKZPFPBNZTKLQYHBBZPNPPTYZZYBQNYDCPJMMCYCQMCYFZZDCMNLFPBPLNGQJTBTTNJZPZBBZNJKLJQYLNBZQHKSJZNGGQSZZKYXSHPZSNBCGZKDDZQANZHJKDRTLZLSWJLJZLYWTJNDJZJHXYAYNCBGTZCSSQMNJPJYTYSWXZFKWJQTKHTZPLBHSNJZSYZBWZZZZLSYLSBJHDWWQPSLMMFBJDWAQYZTCJTBNNWZXQXCDSLQGDSDPDZHJTQQPSWLYYJZLGYXYZLCTCBJTKTYCZJTQKBSJLGMGZDMCSGPYNJZYQYYKNXRPWSZXMTNCSZZYXYBYHYZAXYWQCJTLLCKJJTJHGDXDXYQYZZBYWDLWQCGLZGJGQRQZCZSSBCRPCSKYDZNXJSQGXSSJMYDNSTZTPBDLTKZWXQWQTZEXNQCZGWEZKSSBYBRTSSSLCCGBPSZQSZLCCGLLLZXHZQTHCZMQGYZQZNMCOCSZJMMZSQPJYGQLJYJPPLDXRGZYXCCSXHSHGTZNLZWZKJCXTCFCJXLBMQBCZZWPQDNHXLJCTHYZLGYLNLSZZPCXDSCQQHJQKSXZPBAJYEMSMJTZDXLCJYRYYNWJBNGZZTMJXLTBSLYRZPYLSSCNXPHLLHYLLQQZQLXYMRSYCXZLMMCZLTZSDWTJJLLNZGGQXPFSKYGYGHBFZPDKMWGHCXMSGDXJMCJZDYCABXJDLNBCDQYGSKYDQTXDJJYXMSZQAZDZFSLQXYJSJZYLBTXXWXQQZBJZUFBBLYLWDSLJHXJYZJWTDJCZFQZQZZDZSXZZQLZCDZFJHYSPYMPQZMLPPLFFXJJNZZYLSJEYQZFPFZKSYWJJJHRDJZZXTXXGLGHYDXCSKYSWMMZCWYBAZBJKSHFHJCXMHFQHYXXYZFTSJYZFXYXPZLCHMZMBXHZZSXYFYMNCWDABAZLXKTCSHHXKXJJZJSTHYGXSXYYHHHJWXKZXSSBZZWHHHCWTZZZPJXSNXQQJGZYZYWLLCWXZFXXYXYHXMKYYSWSQMNLNAYCYSPMJKHWCQHYLAJJMZXHMMCNZHBHXCLXTJPLTXYJHDYYLTTXFSZHYXXSJBJYAYRSMXYPLCKDUYHLXRLNLLSTYZYYQYGYHHSCCSMZCTZQXKYQFPYYRPFFLKQUNTSZLLZMWWTCQQYZWTLLMLMPWMBZSSTZRBPDDTLQJJBXZCSRZQQYGWCSXFWZLXCCRSZDZMCYGGDZQSGTJSWLJMYMMZYHFBJDGYXCCPSHXNZCSBSJYJGJMPPWAFFYFNXHYZXZYLREMZGZCYZSSZDLLJCSQFNXZKPTXZGXJJGFMYYYSNBTYLBNLHPFZDCYFBMGQRRSSSZXYSGTZRNYDZZCDGPJAFJFZKNZBLCZSZPSGCYCJSZLMLRSZBZZLDLSLLYSXSQZQLYXZLSKKBRXBRBZCYCXZZZEEYFGKLZLYYHGZSGZLFJHGTGWKRAAJYZKZQTSSHJJXDCYZUYJLZYRZDQQHGJZXSSZBYKJPBFRTJXLLFQWJHYLQTYMBLPZDXTZYGBDHZZRBGXHWNJTJXLKSCFSMWLSDQYSJTXKZSCFWJLBXFTZLLJZLLQBLSQMQQCGCZFPBPHZCZJLPYYGGDTGWDCFCZQYYYQYSSCLXZSKLZZZGFFCQNWGLHQYZJJCZLQZZYJPJZZBPDCCMHJGXDQDGDLZQMFGPSYTSDYFWWDJZJYSXYYCZCYHZWPBYKXRYLYBHKJKSFXTZJMMCKHLLTNYYMSYXYZPYJQYCSYCWMTJJKQYRHLLQXPSGTLYYCLJSCPXJYZFNMLRGJJTYZBXYZMSJYJHHFZQMSYXRSZCWTLRTQZSSTKXGQKGSPTGCZNJSJCQCXHMXGGZTQYDJKZDLBZSXJLHYQGGGTHQSZPYHJHHGYYGKGGCWJZZYLCZLXQSFTGZSLLLMLJSKCTBLLZZSZMMNYTPZSXQHJCJYQXYZXZQZCPSHKZZYSXCDFGMWQRLLQXRFZTLYSTCTMJCXJJXHJNXTNRZTZFQYHQGLLGCXSZSJDJLJCYDSJTLNYXHSZXCGJZYQPYLFHDJSBPCCZHJJJQZJQDYBSSLLCMYTTMQTBHJQNNYGKYRQYQMZGCJKPDCGMYZHQLLSLLCLMHOLZGDYYFZSLJCQZLYLZQJESHNYLLJXGJXLYSYYYXNBZLJSSZCQQCJYLLZLTJYLLZLLBNYLGQCHXYYXOXCXQKYJXXXYKLXSXXYQXCYKQXQCSGYXXYQXYGYTQOHXHXPYXXXULCYEYCHZZCBWQBBWJQZSCSZSSLZYLKDESJZWMYMCYTSDSXXSCJPQQSQYLYYZYCMDJDZYWCBTJSYDJKCYDDJLBDJJSODZYSYXQQYXDHHGQQYQHDYXWGMMMAJDYBBBPPBCMUUPLJZSMTXERXJMHQNUTPJDCBSSMSSSTKJTSSMMTRCPLZSZMLQDSDMJMQPNQDXCFYNBFSDQXYXHYAYKQYDDLQYYYSSZBYDSLNTFQTZQPZMCHDHCZCWFDXTMYQSPHQYYXSRGJCWTJTZZQMGWJJTJHTQJBBHWZPXXHYQFXXQYWYYHYSCDYDHHQMNMTMWCPBSZPPZZGLMZFOLLCFWHMMSJZTTDHZZYFFYTZZGZYSKYJXQYJZQBHMBZZLYGHGFMSHPZFZSNCLPBQSNJXZSLXXFPMTYJYGBXLLDLXPZJYZJYHHZCYWHJYLSJEXFSZZYWXKZJLUYDTMLYMQJPWXYHXSKTQJEZRPXXZHHMHWQPWQLYJJQJJZSZCPHJLCHHNXJLQWZJHBMZYXBDHHYPZLHLHLGFWLCHYYTLHJXCJMSCPXSTKPNHQXSRTYXXTESYJCTLSSLSTDLLLWWYHDHRJZSFGXTSYCZYNYHTDHWJSLHTZDQDJZXXQHGYLTZPHCSQFCLNJTCLZPFSTPDYNYLGMJLLYCQHYSSHCHYLHQYQTMZYPBYWRFQYKQSYSLZDQJMPXYYSSRHZJNYWTQDFZBWWTWWRXCWHGYHXMKMYYYQMSMZHNGCEPMLQQMTCWCTMMPXJPJJHFXYYZSXZHTYBMSTSYJTTQQQYYLHYNPYQZLCYZHZWSMYLKFJXLWGXYPJYTYSYXYMZCKTTWLKSMZSYLMPWLZWXWQZSSAQSYXYRHSSNTSRAPXCPWCMGDXHXZDZYFJHGZTTSBJHGYZSZYSMYCLLLXBTYXHBBZJKSSDMALXHYCFYGMQYPJYCQXJLLLJGSLZGQLYCJCCZOTYXMTMTTLLWTGPXYMZMKLPSZZZXHKQYSXCTYJZYHXSHYXZKXLZWPSQPYHJWPJPWXQQYLXSDHMRSLZZYZWTTCYXYSZZSHBSCCSTPLWSSCJCHNLCGCHSSPHYLHFHHXJSXYLLNYLSZDHZXYLSXLWZYKCLDYAXZCMDDYSPJTQJZLNWQPSSSWCTSTSZLBLNXSMNYYMJQBQHRZWTYYDCHQLXKPZWBGQYBKFCMZWPZLLYYLSZYDWHXPSBCMLJBSCGBHXLQHYRLJXYSWXWXZSLDFHLSLYNJLZYFLYJYCDRJLFSYZFSLLCQYQFGJYHYXZLYLMSTDJCYHBZLLNWLXXYGYYHSMGDHXXHHLZZJZXCZZZCYQZFNGWPYLCPKPYYPMCLQKDGXZGGWQBDXZZKZFBXXLZXJTPJPTTBYTSZZDWSLCHZHSLTYXHQLHYXXXYYZYSWTXZKHLXZXZPYHGCHKCFSYHUTJRLXFJXPTZTWHPLYXFCRHXSHXKYXXYHZQDXQWULHYHMJTBFLKHTXCWHJFWJCFPQRYQXCYYYQYGRPYWSGSUNGWCHKZDXYFLXXHJJBYZWTSXXNCYJJYMSWZJQRMHXZWFQSYLZJZGBHYNSLBGTTCSYBYXXWXYHXYYXNSQYXMQYWRGYQLXBBZLJSYLPSYTJZYHYZAWLRORJMKSCZJXXXYXCHDYXRYXXJDTSQFXLYLTSFFYXLMTYJMJUYYYXLTZCSXQZQHZXLYYXZHDNBRXXXJCTYHLBRLMBRLLAXKYLLLJLYXXLYCRYLCJTGJCMTLZLLCYZZPZPCYAWHJJFYBDYYZSMPCKZDQYQPBPCJPDCYZMDPBCYYDYCNNPLMTMLRMFMMGWYZBSJGYGSMZQQQZTXMKQWGXLLPJGZBQCDJJJFPKJKCXBLJMSWMDTQJXLDLPPBXCWRCQFBFQJCZAHZGMYKPHYYHZYKNDKZMBPJYXPXYHLFPNYYGXJDBKXNXHJMZJXSTRSTLDXSKZYSYBZXJLXYSLBZYSLHXJPFXPQNBYLLJQKYGZMCYZZYMCCSLCLHZFWFWYXZMWSXTYNXJHPYYMCYSPMHYSMYDYSHQYZCHMJJMZCAAGCFJBBHPLYZYLXXSDJGXDHKXXTXXNBHRMLYJSLTXMRHNLXQJXYZLLYSWQGDLBJHDCGJYQYCMHWFMJYBMBYJYJWYMDPWHXQLDYGPDFXXBCGJSPCKRSSYZJMSLBZZJFLJJJLGXZGYXYXLSZQYXBEXYXHGCXBPLDYHWETTWWCJMBTXCHXYQXLLXFLYXLLJLSSFWDPZSMYJCLMWYTCZPCHQEKCQBWLCQYDPLQPPQZQFJQDJHYMMCXTXDRMJWRHXCJZYLQXDYYNHYYHRSLSRSYWWZJYMTLTLLGTQCJZYABTCKZCJYCCQLJZQXALMZYHYWLWDXZXQDLLQSHGPJFJLJHJABCQZDJGTKHSSTCYJLPSWZLXZXRWGLDLZRLZXTGSLLLLZLYXXWGDZYGBDPHZPBRLWSXQBPFDWOFMWHLYPCBJCCLDMBZPBZZLCYQXLDOMZBLZWPDWYYGDSTTHCSQSCCRSSSYSLFYBFNTYJSZDFNDPDHDZZMBBLSLCMYFFGTJJQWFTMTPJWFNLBZCMMJTGBDZLQLPYFHYYMJYLSDCHDZJWJCCTLJCLDTLJJCPDDSQDSSZYBNDBJLGGJZXSXNLYCYBJXQYCBYLZCFZPPGKCXZDZFZTJJFJSJXZBNZYJQTTYJYHTYCZHYMDJXTTMPXSPLZCDWSLSHXYPZGTFMLCJTYCBPMGDKWYCYZCDSZZYHFLYCTYGWHKJYYLSJCXGYWJCBLLCSNDDBTZBSCLYZCZZSSQDLLMQYYHFSLQLLXFTYHABXGWNYWYYPLLSDLDLLBJCYXJZMLHLJDXYYQYTDLLLBUGBFDFBBQJZZMDPJHGCLGMJJPGAEHHBWCQXAXHHHZCHXYPHJAXHLPHJPGPZJQCQZGJJZZUZDMQYYBZZPHYHYBWHAZYJHYKFGDPFQSDLZMLJXKXGALXZDAGLMDGXMWZQYXXDXXPFDMMSSYMPFMDMMKXKSYZYSHDZKXSYSMMZZZMSYDNZZCZXFPLSTMZDNMXCKJMZTYYMZMZZMSXHHDCZJEMXXKLJSTLWLSQLYJZLLZJSSDPPMHNLZJCZYHMXXHGZCJMDHXTKGRMXFWMCGMWKDTKSXQMMMFZZYDKMSCLCMPCGMHSPXQPZDSSLCXKYXTWLWJYAHZJGZQMCSNXYYMMPMLKJXMHLMLQMXCTKZMJQYSZJSYSZHSYJZJCDAJZYBSDQJZGWZQQXFKDMSDJLFWEHKZQKJPEYPZYSZCDWYJFFMZZYLTTDZZEFMZLBNPPLPLPEPSZALLTYLKCKQZKGENQLWAGYXYDPXLHSXQQWQCQXQCLHYXXMLYCCWLYMQYSKGCHLCJNSZKPYZKCQZQLJPDMDZHLASXLBYDWQLWDNBQCRYDDZTJYBKBWSZDXDTNPJDTCTQDFXQQMGNXECLTTBKPWSLCTYQLPWYZZKLPYGZCQQPLLKCCYLPQMZCZQCLJSLQZDJXLDDHPZQDLJJXZQDXYZQKZLJCYQDYJPPYPQYKJYRMPCBYMCXKLLZLLFQPYLLLMBSGLCYSSLRSYSQTMXYXZQZFDZUYSYZTFFMZZSMZQHZSSCCMLYXWTPZGXZJGZGSJSGKDDHTQGGZLLBJDZLCBCHYXYZHZFYWXYZYMSDBZZYJGTSMTFXQYXQSTDGSLNXDLRYZZLRYYLXQHTXSRTZNGZXBNQQZFMYKMZJBZYMKBPNLYZPBLMCNQYZZZSJZHJCTZKHYZZJRDYZHNPXGLFZTLKGJTCTSSYLLGZRZBBQZZKLPKLCZYSSUYXBJFPNJZZXCDWXZYJXZZDJJKGGRSRJKMSMZJLSJYWQSKYHQJSXPJZZZLSNSHRNYPZTWCHKLPSRZLZXYJQXQKYSJYCZTLQZYBBYBWZPQDWWYZCYTJCJXCKCWDKKZXSGKDZXWWYYJQYYTCYTDLLXWKCZKKLCCLZCQQDZLQLCSFQCHQHSFSMQZZLNBJJZBSJHTSZDYSJQJPDLZCDCWJKJZZLPYCGMZWDJJBSJQZSYZYHHXJPBJYDSSXDZNCGLQMBTSFSBPDZDLZNFGFJGFSMPXJQLMBLGQCYYXBQKDJJQYRFKZTJDHCZKLBSDZCFJTPLLJGXHYXZCSSZZXSTJYGKGCKGYOQXJPLZPBPGTGYJZGHZQZZLBJLSQFZGKQQJZGYCZBZQTLDXRJXBSXXPZXHYZYCLWDXJJHXMFDZPFZHQHQMQGKSLYHTYCGFRZGNQXCLPDLBZCSCZQLLJBLHBZCYPZZPPDYMZZSGYHCKCPZJGSLJLNSCDSLDLXBMSTLDDFJMKDJDHZLZXLSZQPQPGJLLYBDSZGQLBZLSLKYYHZTTNTJYQTZZPSZQZTLLJTYYLLQLLQYZQLBDZLSLYYZYMDFSZSNHLXZNCZQZPBWSKRFBSYZMTHBLGJPMCZZLSTLXSHTCSYZLZBLFEQHLXFLCJLYLJQCBZLZJHHSSTBRMHXZHJZCLXFNBGXGTQJCZTMSFZKJMSSNXLJKBHSJXNTNLZDNTLMSJXGZJYJCZXYJYJWRWWQNZTNFJSZPZSHZJFYRDJSFSZJZBJFZQZZHZLXFYSBZQLZSGYFTZDCSZXZJBQMSZKJRHYJZCKMJKHCHGTXKXQGLXPXFXTRTYLXJXHDTSJXHJZJXZWZLCQSBTXWXGXTXXHXFTSDKFJHZYJFJXRZSDLLLTQSQQZQWZXSYQTWGWBZCGZLLYZBCLMQQTZHZXZXLJFRMYZFLXYSQXXJKXRMQDZDMMYYBSQBHGZMWFWXGMXLZPYYTGZYCCDXYZXYWGSYJYZNBHPZJSQSYXSXRTFYZGRHZTXSZZTHCBFCLSYXZLZQMZLMPLMXZJXSFLBYZMYQHXJSXRXSQZZZSSLYFRCZJRCRXHHZXQYDYHXSJJHZCXZBTYNSYSXJBQLPXZQPYMLXZKYXLXCJLCYSXXZZLXDLLLJJYHZXGYJWKJRWYHCPSGNRZLFZWFZZNSXGXFLZSXZZZBFCSYJDBRJKRDHHGXJLJJTGXJXXSTJTJXLYXQFCSGSWMSBCTLQZZWLZZKXJMLTMJYHSDDBXGZHDLBMYJFRZFSGCLYJBPMLYSMSXLSZJQQHJZFXGFQFQBPXZGYYQXGZTCQWYLTLGWSGWHRLFSFGZJMGMGBGTJFSYZZGZYZAFLSSPMLPFLCWBJZCLJJMZLPJJLYMQDMYYYFBGYGYZMLYZDXQYXRQQQHSYYYQXYLJTYXFSFSLLGNQCYHYCWFHCCCFXPYLYPLLZYXXXXXKQHHXSHJZCFZSCZJXCPZWHHHHHAPYLQALPQAFYHXDYLUKMZQGGGDDESRNNZLTZGCHYPPYSQJJHCLLJTOLNJPZLJLHYMHEYDYDSQYCDDHGZUNDZCLZYZLLZNTNYZGSLHSLPJJBDGWXPCDUTJCKLKCLWKLLCASSTKZZDNQNTTLYYZSSYSSZZRYLJQKCQDHHCRXRZYDGRGCWCGZQFFFPPJFZYNAKRGYWYQPQXXFKJTSZZXSWZDDFBBXTBGTZKZNPZZPZXZPJSZBMQHKCYXYLDKLJNYPKYGHGDZJXXEAHPNZKZTZCMXCXMMJXNKSZQNMNLWBWWXJKYHCPSTMCSQTZJYXTPCTPDTNNPGLLLZSJLSPBLPLQHDTNJNLYYRSZFFJFQWDPHZDWMRZCCLODAXNSSNYZRESTYJWJYJDBCFXNMWTTBYLWSTSZGYBLJPXGLBOCLHPCBJLTMXZLJYLZXCLTPNCLCKXTPZJSWCYXSFYSZDKNTLBYJCYJLLSTGQCBXRYZXBXKLYLHZLQZLNZCXWJZLJZJNCJHXMNZZGJZZXTZJXYCYYCXXJYYXJJXSSSJSTSSTTPPGQTCSXWZDCSYFPTFBFHFBBLZJCLZZDBXGCXLQPXKFZFLSYLTUWBMQJHSZBMDDBCYSCCLDXYCDDQLYJJWMQLLCSGLJJSYFPYYCCYLTJANTJJPWYCMMGQYYSXDXQMZHSZXPFTWWZQSWQRFKJLZJQQYFBRXJHHFWJJZYQAZMYFRHCYYBYQWLPEXCCZSTYRLTTDMQLYKMBBGMYYJPRKZNPBSXYXBHYZDJDNGHPMFSGMWFZMFQMMBCMZZCJJLCNUXYQLMLRYGQZCYXZLWJGCJCGGMCJNFYZZJHYCPRRCMTZQZXHFQGTJXCCJEAQCRJYHPLQLSZDJRBCQHQDYRHYLYXJSYMHZYDWLDFRYHBPYDTSSCNWBXGLPZMLZZTQSSCPJMXXYCSJYTYCGHYCJWYRXXLFEMWJNMKLLSWTXHYYYNCMMCWJDQDJZGLLJWJRKHPZGGFLCCSCZMCBLTBHBQJXQDSPDJZZGKGLFQYWBZYZJLTSTDHQHCTCBCHFLQMPWDSHYYTQWCNZZJTLBYMBPDYYYXSQKXWYYFLXXNCWCXYPMAELYKKJMZZZBRXYYQJFLJPFHHHYTZZXSGQQMHSPGDZQWBWPJHZJDYSCQWZKTXXSQLZYYMYSDZGRXCKKUJLWPYSYSCSYZLRMLQSYLJXBCXTLWDQZPCYCYKPPPNSXFYZJJRCEMHSZMSXLXGLRWGCSTLRSXBZGBZGZTCPLUJLSLYLYMTXMTZPALZXPXJTJWTCYYZLBLXBZLQMYLXPGHDSLSSDMXMBDZZSXWHAMLCZCPJMCNHJYSNSYGCHSKQMZZQDLLKABLWJXSFMOCDXJRRLYQZKJMYBYQLYHETFJZFRFKSRYXFJTWDSXXSYSQJYSLYXWJHSNLXYYXHBHAWHHJZXWMYLJCSSLKYDZTXBZSYFDXGXZJKHSXXYBSSXDPYNZWRPTQZCZENYGCXQFJYKJBZMLJCMQQXUOXSLYXXLYLLJDZBTYMHPFSTTQQWLHOKYBLZZALZXQLHZWRRQHLSTMYPYXJJXMQSJFNBXYXYJXXYQYLTHYLQYFMLKLJTMLLHSZWKZHLJMLHLJKLJSTLQXYLMBHHLNLZXQJHXCFXXLHYHJJGBYZZKBXSCQDJQDSUJZYYHZHHMGSXCSYMXFEBCQWWRBPYYJQTYZCYQYQQZYHMWFFHGZFRJFCDPXNTQYZPDYKHJLFRZXPPXZDBBGZQSTLGDGYLCQMLCHHMFYWLZYXKJLYPQHSYWMQQGQZMLZJNSQXJQSYJYCBEHSXFSZPXZWFLLBCYYJDYTDTHWZSFJMQQYJLMQXXLLDTTKHHYBFPWTYYSQQWNQWLGWDEBZWCMYGCULKJXTMXMYJSXHYBRWFYMWFRXYQMXYSZTZZTFYKMLDHQDXWYYNLCRYJBLPSXCXYWLSPRRJWXHQYPHTYDNXHHMMYWYTZCSQMTSSCCDALWZTCPQPYJLLQZYJSWXMZZMMYLMXCLMXCZMXMZSQTZPPQQBLPGXQZHFLJJHYTJSRXWZXSCCDLXTYJDCQJXSLQYCLZXLZZXMXQRJMHRHZJBHMFLJLMLCLQNLDXZLLLPYPSYJYSXCQQDCMQJZZXHNPNXZMEKMXHYKYQLXSXTXJYYHWDCWDZHQYYBGYBCYSCFGPSJNZDYZZJZXRZRQJJYMCANYRJTLDPPYZBSTJKXXZYPFDWFGZZRPYMTNGXZQBYXNBUFNQKRJQZMJEGRZGYCLKXZDSKKNSXKCLJSPJYYZLQQJYBZSSQLLLKJXTBKTYLCCDDBLSPPFYLGYDTZJYQGGKQTTFZXBDKTYYHYBBFYTYYBCLPDYTGDHRYRNJSPTCSNYJQHKLLLZSLYDXXWBCJQSPXBPJZJCJDZFFXXBRMLAZHCSNDLBJDSZBLPRZTSWSBXBCLLXXLZDJZSJPYLYXXYFTFFFBHJJXGBYXJPMMMPSSJZJMTLYZJXSWXTYLEDQPJMYGQZJGDJLQJWJQLLSJGJGYGMSCLJJXDTYGJQJQJCJZCJGDZZSXQGSJGGCXHQXSNQLZZBXHSGZXCXYLJXYXYYDFQQJHJFXDHCTXJYRXYSQTJXYEFYYSSYYJXNCYZXFXMSYSZXYYSCHSHXZZZGZZZGFJDLTYLNPZGYJYZYYQZPBXQBDZTZCZYXXYHHSQXSHDHGQHJHGYWSZTMZMLHYXGEBTYLZKQWYTJZRCLEKYSTDBCYKQQSAYXCJXWWGSBHJYZYDHCSJKQCXSWXFLTYNYZPZCCZJQTZWJQDZZZQZLJJXLSBHPYXXPSXSHHEZTXFPTLQYZZXHYTXNCFZYYHXGNXMYWXTZSJPTHHGYMXMXQZXTSBCZYJYXXTYYZYPCQLMMSZMJZZLLZXGXZAAJZYXJMZXWDXZSXZDZXLEYJJZQBHZWZZZQTZPSXZTDSXJJJZNYAZPHXYYSRNQDTHZHYYKYJHDZXZLSWCLYBZYECWCYCRYLCXNHZYDZYDYJDFRJJHTRSQTXYXJRJHOJYNXELXSFSFJZGHPZSXZSZDZCQZBYYKLSGSJHCZSHDGQGXYZGXCHXZJWYQWGYHKSSEQZZNDZFKWYSSTCLZSTSYMCDHJXXYWEYXCZAYDMPXMDSXYBSQMJMZJMTZQLPJYQZCGQHXJHHLXXHLHDLDJQCLDWBSXFZZYYSCHTYTYYBHECXHYKGJPXHHYZJFXHWHBDZFYZBCAPNPGNYDMSXHMMMMAMYNBYJTMPXYYMCTHJBZYFCGTYHWPHFTWZZEZSBZEGPFMTSKFTYCMHFLLHGPZJXZJGZJYXZSBBQSCZZLZCCSTPGXMJSFTCCZJZDJXCYBZLFCJSYZFGSZLYBCWZZBYZDZYPSWYJZXZBDSYUXLZZBZFYGCZXBZHZFTPBGZGEJBSTGKDMFHYZZJHZLLZZGJQZLSFDJSSCBZGPDLFZFZSZYZYZSYGCXSNXXCHCZXTZZLJFZGQSQYXZJQDCCZTQCDXZJYQJQCHXZTDLGSCXZSYQJQTZWLQDQZTQCHQQJZYEZZZPBWKDJFCJPZTYPQYQTTYNLMBDKTJZPQZQZZFPZSBNJLGYJDXJDZZKZGQKXDLPZJTCJDQBXDJQJSTCKNXBXZMSLYJCQMTJQWWCJQNJNLLLHJCWQTBZQYDZCZPZZDZYDDCYZZZCCJTTJFZDPRRTZTJDCQTQZDTJNPLZBCLLCTZSXKJZQZPZLBZRBTJDCXFCZDBCCJJLTQQPLDCGZDBBZJCQDCJWYNLLZYZCCDWLLXWZLXRXNTQQCZXKQLSGDFQTDDGLRLAJJTKUYMKQLLTZYTDYYCZGJWYXDXFRSKSTQTENQMRKQZHHQKDLDAZFKYPBGGPZREBZZYKZZSPEGJXGYKQZZZSLYSYYYZWFQZYLZZLZHWCHKYPQGNPGBLPLRRJYXCCSYYHSFZFYBZYYTGZXYLXCZWXXZJZBLFFLGSKHYJZEYJHLPLLLLCZGXDRZELRHGKLZZYHZLYQSZZJZQLJZFLNBHGWLCZCFJYSPYXZLZLXGCCPZBLLCYBBBBUBBCBPCRNNZCZYRBFSRLDCGQYYQXYGMQZWTZYTYJXYFWTEHZZJYWLCCNTZYJJZDEDPZDZTSYQJHDYMBJNYJZLXTSSTPHNDJXXBYXQTZQDDTJTDYYTGWSCSZQFLSHLGLBCZPHDLYZJYCKWTYTYLBNYTSDSYCCTYSZYYEBHEXHQDTWNYGYCLXTSZYSTQMYGZAZCCSZZDSLZCLZRQXYYELJSBYMXSXZTEMBBLLYYLLYTDQYSHYMRQWKFKBFXNXSBYCHXBWJYHTQBPBSBWDZYLKGZSKYHXQZJXHXJXGNLJKZLYYCDXLFYFGHLJGJYBXQLYBXQPQGZTZPLNCYPXDJYQYDYMRBESJYYHKXXSTMXRCZZYWXYQYBMCLLYZHQYZWQXDBXBZWZMSLPDMYSKFMZKLZCYQYCZLQXFZZYDQZPZYGYJYZMZXDZFYFYTTQTZHGSPCZMLCCYTZXJCYTJMKSLPZHYSNZLLYTPZCTZZCKTXDHXXTQCYFKSMQCCYYAZHTJPCYLZLYJBJXTPNYLJYYNRXSYLMMNXJSMYBCSYSYLZYLXJJQYLDZLPQBFZZBLFNDXQKCZFYWHGQMRDSXYCYTXNQQJZYYPFZXDYZFPRXEJDGYQBXRCNFYYQPGHYJDYZXGRHTKYLNWDZNTSMPKLBTHBPYSZBZTJZSZZJTYYXZPHSSZZBZCZPTQFZMYFLYPYBBJQXZMXXDJMTSYSKKBJZXHJCKLPSMKYJZCXTMLJYXRZZQSLXXQPYZXMKYXXXJCLJPRMYYGADYSKQLSNDHYZKQXZYZTCGHZTLMLWZYBWSYCTBHJHJFCWZTXWYTKZLXQSHLYJZJXTMPLPYCGLTBZZTLZJCYJGDTCLKLPLLQPJMZPAPXYZLKKTKDZCZZBNZDYDYQZJYJGMCTXLTGXSZLMLHBGLKFWNWZHDXUHLFMKYSLGXDTWWFRJEJZTZHYDXYKSHWFZCQSHKTMQQHTZHYMJDJSKHXZJZBZZXYMPAGQMSTPXLSKLZYNWRTSQLSZBPSPSGZWYHTLKSSSWHZZLYYTNXJGMJSZSUFWNLSOZTXGXLSAMMLBWLDSZYLAKQCQCTMYCFJBSLXCLZZCLXXKSBZQCLHJPSQPLSXXCKSLNHPSFQQYTXYJZLQLDXZQJZDYYDJNZPTUZDSKJFSLJHYLZSQZLBTXYDGTQFDBYAZXDZHZJNHHQBYKNXJJQCZMLLJZKSPLDYCLBBLXKLELXJLBQYCXJXGCNLCQPLZLZYJTZLJGYZDZPLTQCSXFDMNYCXGBTJDCZNBGBQYQJWGKFHTNPYQZQGBKPBBYZMTJDYTBLSQMPSXTBNPDXKLEMYYCJYNZCTLDYKZZXDDXHQSHDGMZSJYCCTAYRZLPYLTLKXSLZCGGEXCLFXLKJRTLQJAQZNCMBYDKKCXGLCZJZXJHPTDJJMZQYKQSECQZDSHHADMLZFMMZBGNTJNNLGBYJBRBTMLBYJDZXLCJLPLDLPCQDHLXZLYCBLCXZZJADJLNZMMSSSMYBHBSQKBHRSXXJMXSDZNZPXLGBRHWGGFCXGMSKLLTSJYYCQLTSKYWYYHYWXBXQYWPYWYKQLSQPTNTKHQCWDQKTWPXXHCPTHTWUMSSYHBWCRWXHJMKMZNGWTMLKFGHKJYLSYYCXWHYECLQHKQHTTQKHFZLDXQWYZYYDESBPKYRZPJFYYZJCEQDZZDLATZBBFJLLCXDLMJSSXEGYGSJQXCWBXSSZPDYZCXDNYXPPZYDLYJCZPLTXLSXYZYRXCYYYDYLWWNZSAHJSYQYHGYWWAXTJZDAXYSRLTDPSSYYFNEJDXYZHLXLLLZQZSJNYQYQQXYJGHZGZCYJCHZLYCDSHWSHJZYJXCLLNXZJJYYXNFXMWFPYLCYLLABWDDHWDXJMCXZTZPMLQZHSFHZYNZTLLDYWLSLXHYMMYLMBWWKYXYADTXYLLDJPYBPWUXJMWMLLSAFDLLYFLBHHHBQQLTZJCQJLDJTFFKMMMBYTHYGDCQRDDWRQJXNBYSNWZDBYYTBJHPYBYTTJXAAHGQDQTMYSTQXKBTZPKJLZRBEQQSSMJJBDJOTGTBXPGBKTLHQXJJJCTHXQDWJLWRFWQGWSHCKRYSWGFTGYGBXSDWDWRFHWYTJJXXXJYZYSLPYYYPAYXHYDQKXSHXYXGSKQHYWFDDDPPLCJLQQEEWXKSYYKDYPLTJTHKJLTCYYHHJTTPLTZZCDLTHQKZXQYSTEEYWYYZYXXYYSTTJKLLPZMCYHQGXYHSRMBXPLLNQYDQHXSXXWGDQBSHYLLPJJJTHYJKYPPTHYYKTYEZYENMDSHLCRPQFDGFXZPSFTLJXXJBSWYYSKSFLXLPPLBBBLBSFXFYZBSJSSYLPBBFFFFSSCJDSTZSXZRYYSYFFSYZYZBJTBCTSBSDHRTJJBYTCXYJEYLXCBNEBJDSYXYKGSJZBXBYTFZWGENYHHTHZHHXFWGCSTBGXKLSXYWMTMBYXJSTZSCDYQRCYTWXZFHMYMCXLZNSDJTTTXRYCFYJSBSDYERXJLJXBBDEYNJGHXGCKGSCYMBLXJMSZNSKGXFBNBPTHFJAAFXYXFPXMYPQDTZCXZZPXRSYWZDLYBBKTYQPQJPZYPZJZNJPZJLZZFYSBTTSLMPTZRTDXQSJEHBZYLZDHLJSQMLHTXTJECXSLZZSPKTLZKQQYFSYGYWPCPQFHQHYTQXZKRSGTTSQCZLPTXCDYYZXSQZSLXLZMYCPCQBZYXHBSXLZDLTCDXTYLZJYYZPZYZLTXJSJXHLPMYTXCQRBLZSSFJZZTNJYTXMYJHLHPPLCYXQJQQKZZSCPZKSWALQSBLCCZJSXGWWWYGYKTJBBZTDKHXHKGTGPBKQYSLPXPJCKBMLLXDZSTBKLGGQKQLSBKKTFXRMDKBFTPZFRTBBRFERQGXYJPZSSTLBZTPSZQZSJDHLJQLZBPMSMMSXLQQNHKNBLRDDNXXDHDDJCYYGYLXGZLXSYGMQQGKHBPMXYXLYTQWLWGCPBMQXCYZYDRJBHTDJYHQSHTMJSBYPLWHLZFFNYPMHXXHPLTBQPFBJWQDBYGPNZTPFZJGSDDTQSHZEAWZZYLLTYYBWJKXXGHLFKXDJTMSZSQYNZGGSWQSPHTLSSKMCLZXYSZQZXNCJDQGZDLFNYKLJCJLLZLMZZNHYDSSHTHZZLZZBBHQZWWYCRZHLYQQJBEYFXXXWHSRXWQHWPSLMSSKZTTYGYQQWRSLALHMJTQJSMXQBJJZJXZYZKXBYQXBJXSHZTSFJLXMXZXFGHKZSZGGYLCLSARJYHSLLLMZXELGLXYDJYTLFBHBPNLYZFBBHPTGJKWETZHKJJXZXXGLLJLSTGSHJJYQLQZFKCGNNDJSSZFDBCTWWSEQFHQJBSAQTGYPQLBXBMMYWXGSLZHGLZGQYFLZBYFZJFRYSFMBYZHQGFWZSYFYJJPHZBYYZFFWODGRLMFTWLBZGYCQXCDJYGZYYYYTYTYDWEGAZYHXJLZYYHLRMGRXXZCLHNELJJTJTPWJYBJJBXJJTJTEEKHWSLJPLPSFYZPQQBDLQJJTYYQLYZKDKSQJYYQZLDQTGJQYZJSUCMRYQTHTEJMFCTYHYPKMHYZWJDQFHYYXWSHCTXRLJHQXHCCYYYJLTKTTYTMXGTCJTZAYYOCZLYLBSZYWJYTSJYHBYSHFJLYGJXXTMZYYLTXXYPZLXYJZYZYYPNHMYMDYYLBLHLSYYQQLLNJJYMSOYQBZGDLYXYLCQYXTSZEGXHZGLHWBLJHEYXTWQMAKBPQCGYSHHEGQCMWYYWLJYJHYYZLLJJYLHZYHMGSLJLJXCJJYCLYCJPCPZJZJMMYLCQLNQLJQJSXYJMLSZLJQLYCMMHCFMMFPQQMFYLQMCFFQMMMMHMZNFHHJGTTHHKHSLNCHHYQDXTMMQDCYZYXYQMYQYLTDCYYYZAZZCYMZYDLZFFFMMYCQZWZZMABTBYZTDMNZZGGDFTYPCGQYTTSSFFWFDTZQSSYSTWXJHXYTSXXYLBYQHWWKXHZXWZNNZZJZJJQJCCCHYYXBZXZCYZTLLCQXYNJYCYYCYNZZQYYYEWYCZDCJYCCHYJLBTZYYCQWMPWPYMLGKDLDLGKQQBGYCHJXY",o={19969:"DZ",19975:"WM",19988:"QJ",20048:"YL",20056:"SC",20060:"NM",20094:"QG",20127:"QJ",20167:"QC",20193:"YG",20250:"KH",20256:"ZC",20282:"SC",20285:"QJG",20291:"TD",20314:"YD",20340:"NE",20375:"TD",20389:"YJ",20391:"CZ",20415:"PB",20446:"YS",20447:"SQ",20504:"TC",20608:"KG",20854:"QJ",20857:"ZC",20911:"PF",20985:"AW",21032:"PB",21048:"XQ",21049:"SC",21089:"YS",21119:"JC",21242:"SB",21273:"SC",21305:"YP",21306:"QO",21330:"ZC",21333:"SDC",21345:"QK",21378:"CA",21397:"SC",21414:"XS",21442:"SC",21477:"JG",21480:"TD",21484:"ZS",21494:"YX",21505:"YX",21512:"HG",21523:"XH",21537:"PB",21542:"PF",21549:"KH",21571:"E",21574:"DA",21588:"TD",21589:"O",21618:"ZC",21621:"KHA",21632:"ZJ",21654:"KG",21679:"LKG",21683:"KH",21710:"A",21719:"YH",21734:"WOE",21769:"A",21780:"WN",21804:"XH",21834:"A",21899:"ZD",21903:"RN",21908:"WO",21939:"ZC",21956:"SA",21964:"YA",21970:"TD",22003:"A",22031:"JG",22040:"XS",22060:"ZC",22066:"ZC",22079:"MH",22129:"XJ",22179:"XA",22237:"NJ",22244:"TD",22280:"JQ",22300:"YH",22313:"XW",22331:"YQ",22343:"YJ",22351:"PH",22395:"DC",22412:"TD",22484:"PB",22500:"PB",22534:"ZD",22549:"DH",22561:"PB",22612:"TD",22771:"KQ",22831:"HB",22841:"JG",22855:"QJ",22865:"XQ",23013:"ML",23081:"WM",23487:"SX",23558:"QJ",23561:"YW",23586:"YW",23614:"YW",23615:"SN",23631:"PB",23646:"ZS",23663:"ZT",23673:"YG",23762:"TD",23769:"ZS",23780:"QJ",23884:"QK",24055:"XH",24113:"DC",24162:"ZC",24191:"GA",24273:"QJ",24324:"NL",24377:"TD",24378:"QJ",24439:"PF",24554:"ZS",24683:"TD",24694:"WE",24733:"LK",24925:"TN",25094:"ZG",25100:"XQ",25103:"XH",25153:"PB",25170:"PB",25179:"KG",25203:"PB",25240:"ZS",25282:"FB",25303:"NA",25324:"KG",25341:"ZY",25373:"WZ",25375:"XJ",25384:"A",25457:"A",25528:"SD",25530:"SC",25552:"TD",25774:"ZC",25874:"ZC",26044:"YW",26080:"WM",26292:"PB",26333:"PB",26355:"ZY",26366:"CZ",26397:"ZC",26399:"QJ",26415:"ZS",26451:"SB",26526:"ZC",26552:"JG",26561:"TD",26588:"JG",26597:"CZ",26629:"ZS",26638:"YL",26646:"XQ",26653:"KG",26657:"XJ",26727:"HG",26894:"ZC",26937:"ZS",26946:"ZC",26999:"KJ",27099:"KJ",27449:"YQ",27481:"XS",27542:"ZS",27663:"ZS",27748:"TS",27784:"SC",27788:"ZD",27795:"TD",27812:"O",27850:"PB",27852:"MB",27895:"SL",27898:"PL",27973:"QJ",27981:"KH",27986:"HX",27994:"XJ",28044:"YC",28065:"WG",28177:"SM",28267:"QJ",28291:"KH",28337:"ZQ",28463:"TL",28548:"DC",28601:"TD",28689:"PB",28805:"JG",28820:"QG",28846:"PB",28952:"TD",28975:"ZC",29100:"A",29325:"QJ",29575:"SL",29602:"FB",30010:"TD",30044:"CX",30058:"PF",30091:"YSP",30111:"YN",30229:"XJ",30427:"SC",30465:"SX",30631:"YQ",30655:"QJ",30684:"QJG",30707:"SD",30729:"XH",30796:"LG",30917:"PB",31074:"NM",31085:"JZ",31109:"SC",31181:"ZC",31192:"MLB",31293:"JQ",31400:"YX",31584:"YJ",31896:"ZN",31909:"ZY",31995:"XJ",32321:"PF",32327:"ZY",32418:"HG",32420:"XQ",32421:"HG",32438:"LG",32473:"GJ",32488:"TD",32521:"QJ",32527:"PB",32562:"ZSQ",32564:"JZ",32735:"ZD",32793:"PB",33071:"PF",33098:"XL",33100:"YA",33152:"PB",33261:"CX",33324:"BP",33333:"TD",33406:"YA",33426:"WM",33432:"PB",33445:"JG",33486:"ZN",33493:"TS",33507:"QJ",33540:"QJ",33544:"ZC",33564:"XQ",33617:"YT",33632:"QJ",33636:"XH",33637:"YX",33694:"WG",33705:"PF",33728:"YW",33882:"SR",34067:"WM",34074:"YW",34121:"QJ",34255:"ZC",34259:"XL",34425:"JH",34430:"XH",34485:"KH",34503:"YS",34532:"HG",34552:"XS",34558:"YE",34593:"ZL",34660:"YQ",34892:"XH",34928:"SC",34999:"QJ",35048:"PB",35059:"SC",35098:"ZC",35203:"TQ",35265:"JX",35299:"JX",35782:"SZ",35828:"YS",35830:"E",35843:"TD",35895:"YG",35977:"MH",36158:"JG",36228:"QJ",36426:"XQ",36466:"DC",36710:"JC",36711:"ZYG",36767:"PB",36866:"SK",36951:"YW",37034:"YX",37063:"XH",37218:"ZC",37325:"ZC",38063:"PB",38079:"TD",38085:"QY",38107:"DC",38116:"TD",38123:"YD",38224:"HG",38241:"XTC",38271:"ZC",38415:"YE",38426:"KH",38461:"YD",38463:"AE",38466:"PB",38477:"XJ",38518:"YT",38551:"WK",38585:"ZC",38704:"XS",38739:"LJ",38761:"GJ",38808:"SQ",39048:"JG",39049:"XJ",39052:"HG",39076:"CZ",39271:"XT",39534:"TD",39552:"TD",39584:"PB",39647:"SB",39730:"LG",39748:"TPB",40109:"ZQ",40479:"ND",40516:"HG",40536:"HG",40583:"QJ",40765:"YQ",40784:"QJ",40840:"YK",40863:"QJG"};return{match:t,indexOf:n}}),define("util/params",["require","exports","module","jquery"],function(e,t){function n(e){var t=o.type(e);return void 0===e||("string"===t||"array"===t)&&0===e.length||o.isEmptyObject(e)}function i(e,t){var i=!1;return n(e)||n(t)?i:(o.each(e,function(e,a){return t===e?(i=!n(a),!1):void 0}),i)}function a(e){o.each(e,function(t,n){0===t.indexOf("_")&&delete e[t]})}function r(e,t){var n="";return o.isPlainObject(e)||o.isArray(e)&&t?(o.each(e,function(e,i){n+=o.isArray(i)?r(i,e)+"&":o.isPlainObject(i)?r(i)+"&":t?t+"="+i+"&":e+"="+i+"&"}),n.substring(0,n.length-1)):""}function s(e){var t,n,i={},a=e.split("&");return a.forEach(function(e){e=e.split("="),t=e[0],n=e[1],t&&n&&(i[t]=n)}),i}var o=e("jquery");t.isEmpty=n,t.isValid=i,t.removePrivate=a,t.serialize=r,t.deserialize=s}),define("util/sitenode",[],function(){function e(e){var t=e.indexOf("/");return-1==t?e:e.substring(0,t)}function t(e){var t=e.indexOf("/");return t>0?e.substring(t+1):""}function n(e,t){return t?e+"/"+t:e}function i(t){return e(t)===t}return{getOrg:e,getOrgUnit:t,getDN:n,isOrgRoot:i}}),define("util/mboxa",[],function(){function e(e){var t="",n=(e+"").indexOf("@");return n>0&&(t=e.substring(n),e=e.substring(0,n)),{fid:+e,mboxa:t}}return{disassembly:e}}),define("util/math",[],function(){function e(){return(new Date).getTime()}function t(e){return""+(e||"")+ ++n}var n=0;return{getUID:e,uniqueId:t}}),define("util/securitylevel",["require","./email","../configstore"],function(e){function t(e,t,i,a){var r,s,o=f.getConfig("user.securitylevel")||{schema:{}};return i="boolean"==typeof i?i:!1,a="boolean"==typeof a?a:!1,t=t||"security_level",r=o.schema[t]||{},s=r[e]||n(t,r),i?"["+s+"]"+(a?" ":""):s}function n(e,t){var n,i=[];if(t=t||{},g[e])return g[e][0].name;for(n in t)i.push({name:t[n],value:n});return 0!==i.length?(i.sort(function(e,t){return e.value-t.value}),g[e]=i,i[0].name):""}function i(e,t){var n,i,a=f.getConfig("user.securitylevel")||{schema:{},value:-1},r={};if(e="boolean"==typeof e?e:!1,t="boolean"==typeof t?t:!1,n=a.schema[t?"sender_security_level":"security_level"],e){i=a.value;for(var s in n)i>=s&&(r[s]=n[s]);return r}return n||{}}function a(){var e,t=i(!0,!0),n=[];for(e in t)n.push({name:t[e],value:e});return n.sort(function(e,t){return e.value-t.value}),{schema:n,value:(f.getConfig("user.securitylevel")||{}).value||-1}}function r(e,t){e=e||"security_level",t=t||1;var n=m[e]||{};return n[t]||s(e,t)}function s(e,t){var n,a="security_level"!==e,r=i(!1,a),s=null,o=[];for(n in r)o.push(r[n]);if(0!==o.length){switch(t){case 1:s=new RegExp("^\\[("+o.join("|")+")\\]\\s*","ig");break;case 2:s=new RegExp("^\\[("+o.join("|")+')\\]\\s*\\"',"ig")}m[e]=m[e]||{},m[e][t]=s}return s}function o(e){var t,n=r("sender_security_level");return n&&(t=e.match(n))?t[0].replace("[","").replace(/\]\s*/,""):""}function l(e,t,n){t=t||1;var i,a=r("security_level",t),s="",o=e;if(a&&(i=e.match(a)))s=i[0].replace('"',""),o=e.replace(a,"");else if(n){var l=h.parseAddress(e)===h.parseAddress(n);l||(o=new h(e).toString())}else o=new h(e).toString();return{securityLevel:s,address:o}}function c(e){e&&(e=e.replace(/\s#\"/," ").replace(/\"#$/,""));
var t=l(e);return{securityLevel:t.securityLevel,trueName:t.address}}function d(e,t){e&&(e=e.replace(/\[/,"").replace(/\]\s*/,"")),t="boolean"==typeof t?t:!0;var n,a=i(t,t);for(n in a)if(a[n]===e)return parseInt(n);return-1}function u(e,n,i,a){return a="boolean"==typeof a?a:!0,e='#"${0}"#'.replace("${0}",e||""),a?t(n,i,!0,!0)+e:e}function p(e){return e?e.replace(/,\"/g,',#"').replace(/\s\"/g,' #"').replace(/\"\s</g,'"# <'):""}var h=e("./email"),f=e("../configstore"),m={},g={};return{i18n:t,getSchema:i,getMatchExpression:r,getSenderSecurityLevel:a,departSLFromFilename:o,departSLFromAddress:l,departSLFromTrueName:c,getSLValueByName:d,formatContactList:p,formatTrueName:u}}),define("util/regexpruler",[],function(){function e(e,t){var n,i="",a="";return t=t||{},Object.keys(t).forEach(function(r){"$$"!==r?(n=new RegExp(r,"i"),n.test(e)&&""===i&&(i=t[r])):a=t[r]}),""!==i?i:a}return{exec:e}}),define("cui/util/cookie/cookie",[],function(){function e(e,n){var i={};if(t(e)&&e.length>0)for(var r,o,l,c=n?s:a,d=e.split(/;\s/g),u=0,p=d.length;p>u;u++){if(l=d[u].match(/([^=]+)=/i),l instanceof Array)try{r=s(l[1]),o=c(d[u].substring(l[1].length+1))}catch(h){}else r=s(d[u]),o="";r&&(i[r]=o)}return i}function t(e){return"string"==typeof e}function n(e){return t(e)&&""!==e}function i(e){if(!n(e))throw new TypeError("Cookie name must be a non-empty string")}function a(e){return e}var r={},s=decodeURIComponent,o=encodeURIComponent;return r.get=function(t,n){i(t),n="function"==typeof n?{converter:n}:n||{};var r=e(document.cookie,!n.raw);return(n.converter||a)(r[t])},r.set=function(e,t,a){i(e),a=a||{};var r=a.expires,s=a.domain,l=a.path;a.raw||(t=o(String(t)));var c=e+"="+t,d=r;return"number"==typeof d&&(d=new Date,d.setDate(d.getDate()+r)),d instanceof Date&&(c+="; expires="+d.toUTCString()),n(s)&&(c+="; domain="+s),n(l)&&(c+="; path="+l),a.secure&&(c+="; secure"),document.cookie=c,c},r.remove=function(e,t){return t=t||{},t.expires=new Date(0),this.set(e,"",t)},r}),define("util/cookies",["require","cui/util/cookie/cookie","./params"],function(e){function t(e,t){var n,i,l=0,c=!1;n=r.deserialize(a.get(s)||""),i=Object.keys(n).length,Object.keys(n).forEach(function(i){c||(i===e&&(n[e]=t,c=!0),l++)}),(l===i||0===l)&&(n[e]=t),a.set(s,r.serialize(n),o)}function n(e,t){var n=r.deserialize(a.get(s)||"");return n[e]?n[e]:t}function i(){a.remove(s)}var a=e("cui/util/cookie/cookie"),r=e("./params"),s="Coremail.XT5",o={path:"/",expires:365};return{set:t,get:n,clear:i}}),define("util/index",["require","./hbshelper","./arrays","./cache","./email","./i18n","./url","./xhr","./size","./file","./messageformat","./py","./params","./sitenode","./html","./mboxa","./math","./detector","./securitylevel","./regexpruler","./cookies"],function(e){e("./hbshelper");var t=e("./arrays"),n=e("./cache"),i=e("./email"),a=e("./i18n"),r=e("./url"),s=e("./xhr"),o=e("./size"),l=e("./file"),c=e("./messageformat"),d=e("./py"),u=e("./params"),p=e("./sitenode"),h=e("./html"),f=e("./mboxa"),m=e("./math"),g=e("./detector"),v=e("./securitylevel"),_=e("./regexpruler"),y=e("./cookies");return{Arrays:t,cache:n,Email:i,i18n:a,url:r,xhr:s,size:o,file:l,messageFormat:c,py:d,params:u,siteNode:p,html:h,mboxa:f,math:m,detector:g,securityLevel:v,regexpRuler:_,cookies:y}}),function(e,t){"object"==typeof exports?t(exports):"function"==typeof define&&define.amd?define("widget/intro/intro",["exports"],t):t(e)}(this,function(e){function t(e){this._targetElement=e,this._options={nextLabel:"Next &rarr;",prevLabel:"&larr; Back",skipLabel:"Skip",doneLabel:"Done",tooltipPosition:"bottom",tooltipClass:"",highlightClass:"",exitOnEsc:!0,exitOnOverlayClick:!0,showStepNumbers:!0,keyboardNavigation:!0,showButtons:!0,showBullets:!0,showProgress:!1,scrollToElement:!0,overlayOpacity:.8,positionPrecedence:["bottom","top","right","left"],disableInteraction:!1}}function n(e){var t=[],n=this;if(this._options.steps)for(var a=[],l=0,c=this._options.steps.length;c>l;l++){var d=i(this._options.steps[l]);if(d.step=t.length+1,"string"==typeof d.element&&(d.element=document.querySelector(d.element)),"undefined"==typeof d.element||null==d.element){var p=document.querySelector(".introjsFloatingElement");null==p&&(p=document.createElement("div"),p.className="introjsFloatingElement",document.body.appendChild(p)),d.element=p,d.position="floating"}null!=d.element&&t.push(d)}else{var a=e.querySelectorAll("*[data-intro]");if(a.length<1)return!1;for(var l=0,h=a.length;h>l;l++){var f=a[l],m=parseInt(f.getAttribute("data-step"),10);m>0&&(t[m-1]={element:f,intro:f.getAttribute("data-intro"),step:parseInt(f.getAttribute("data-step"),10),tooltipClass:f.getAttribute("data-tooltipClass"),highlightClass:f.getAttribute("data-highlightClass"),position:f.getAttribute("data-position")||this._options.tooltipPosition})}for(var g=0,l=0,h=a.length;h>l;l++){var f=a[l];if(null==f.getAttribute("data-step")){for(;;){if("undefined"==typeof t[g])break;g++}t[g]={element:f,intro:f.getAttribute("data-intro"),step:g+1,tooltipClass:f.getAttribute("data-tooltipClass"),highlightClass:f.getAttribute("data-highlightClass"),position:f.getAttribute("data-position")||this._options.tooltipPosition}}}}for(var _=[],y=0;y<t.length;y++)t[y]&&_.push(t[y]);if(t=_,t.sort(function(e,t){return e.step-t.step}),n._introItems=t,v.call(n,e)){r.call(n);e.querySelector(".introjs-skipbutton"),e.querySelector(".introjs-nextbutton");n._onKeyDown=function(t){if(27===t.keyCode&&1==n._options.exitOnEsc)o.call(n,e),void 0!=n._introExitCallback&&n._introExitCallback.call(n);else if(37===t.keyCode)s.call(n);else if(39===t.keyCode)r.call(n);else if(13===t.keyCode){var i=t.target||t.srcElement;i&&i.className.indexOf("introjs-prevbutton")>0?s.call(n):i&&i.className.indexOf("introjs-skipbutton")>0?o.call(n,e):r.call(n),t.preventDefault?t.preventDefault():t.returnValue=!1}},n._onResize=function(e){u.call(n,document.querySelector(".introjs-helperLayer")),u.call(n,document.querySelector(".introjs-tooltipReferenceLayer"))},window.addEventListener?(this._options.keyboardNavigation&&window.addEventListener("keydown",n._onKeyDown,!0),window.addEventListener("resize",n._onResize,!0)):document.attachEvent&&(this._options.keyboardNavigation&&document.attachEvent("onkeydown",n._onKeyDown),document.attachEvent("onresize",n._onResize))}return!1}function i(e){if(null==e||"object"!=typeof e||"undefined"!=typeof e.nodeType)return e;var t={};for(var n in e)t[n]=i(e[n]);return t}function a(e){this._currentStep=e-2,"undefined"!=typeof this._introItems&&r.call(this)}function r(){if(this._direction="forward","undefined"==typeof this._currentStep?this._currentStep=0:++this._currentStep,this._introItems.length<=this._currentStep)return"function"==typeof this._introCompleteCallback&&this._introCompleteCallback.call(this),void o.call(this,this._targetElement);var e=this._introItems[this._currentStep];"undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,e.element,e),h.call(this,e)}function s(){if(this._direction="backward",0===this._currentStep)return!1;var e=this._introItems[--this._currentStep];"undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,e.element,e),h.call(this,e)}function o(e){var t=e.querySelector(".introjs-overlay");if(null!=t){t.style.opacity=0,setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t)},500);var n=e.querySelector(".introjs-helperLayer");n&&n.parentNode.removeChild(n);var i=e.querySelector(".introjs-tooltipReferenceLayer");i&&i.parentNode.removeChild(i);var a=e.querySelector(".introjs-disableInteraction");a&&a.parentNode.removeChild(a);var r=document.querySelector(".introjsFloatingElement");r&&r.parentNode.removeChild(r);var s=document.querySelector(".introjs-showElement");s&&(s.className=s.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""));var o=document.querySelectorAll(".introjs-fixParent");if(o&&o.length>0)for(var l=o.length-1;l>=0;l--)o[l].className=o[l].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown),this._currentStep=void 0}}function l(e,t,n,i){var a,r,s,o="";if(t.style.top=null,t.style.right=null,t.style.bottom=null,t.style.left=null,t.style.marginLeft=null,t.style.marginTop=null,n.style.display="inherit","undefined"!=typeof i&&null!=i&&(i.style.top=null,i.style.left=null),this._introItems[this._currentStep]){a=this._introItems[this._currentStep],o="string"==typeof a.tooltipClass?a.tooltipClass:this._options.tooltipClass,t.className=("introjs-tooltip "+o).replace(/^\s+|\s+$/g,"");var o=this._options.tooltipClass,l=this._introItems[this._currentStep].position;("auto"==l||"auto"==this._options.tooltipPosition)&&"floating"!=l&&(l=c.call(this,e,t,l));var d=_(e),u=_(t).height,p=m();switch(l){case"top":t.style.left="15px",t.style.top="-"+(u+10)+"px",n.className="introjs-arrow bottom";break;case"right":t.style.left=_(e).width+68+"px",d.top+u>p.height&&(n.className="introjs-arrow left-bottom",t.style.top="-"+(u-d.height-20)+"px"),n.className="introjs-arrow left";break;case"left":1==this._options.showStepNumbers&&(t.style.top="15px"),d.top+u>p.height?(t.style.top="-"+(u-d.height-20)+"px",n.className="introjs-arrow right-bottom"):n.className="introjs-arrow right",t.style.right=d.width+68+"px";break;case"floating":n.style.display="none",r=_(t),t.style.left="50%",t.style.top="50%",t.style.marginLeft="-"+r.width/2+"px",t.style.marginTop="-"+r.height/2+"px","undefined"!=typeof i&&null!=i&&(i.style.left="-"+(r.width/2+18)+"px",i.style.top="-"+(r.height/2+18)+"px");break;case"bottom-right-aligned":n.className="introjs-arrow top-right",t.style.right="0px",t.style.bottom="-"+(_(t).height+10)+"px";break;case"bottom-middle-aligned":s=_(e),r=_(t),n.className="introjs-arrow top-middle",t.style.left=s.width/2-r.width/2+"px",t.style.bottom="-"+(r.height+10)+"px";break;case"bottom-left-aligned":case"bottom":default:t.style.bottom="-"+(_(t).height+60)+"px",t.style.left=_(e).width/2-_(t).width/2+"px",n.className="introjs-arrow top"}}}function c(e,t,n){var i=this._options.positionPrecedence.slice(),a=m(),r=_(t).height+10,s=_(t).width+20,o=_(e),l="floating";return o.left+s>a.width||o.left+o.width/2-s<0?(d(i,"bottom"),d(i,"top")):(o.height+o.top+r>a.height&&d(i,"bottom"),o.top-r<0&&d(i,"top")),o.width+o.left+s>a.width&&d(i,"right"),o.left-s<0&&d(i,"left"),i.length>0&&(l=i[0]),n&&"auto"!=n&&i.indexOf(n)>-1&&(l=n),l}function d(e,t){e.indexOf(t)>-1&&e.splice(e.indexOf(t),1)}function u(e){if(e){if(!this._introItems[this._currentStep])return;var t=this._introItems[this._currentStep],n=_(t.element),i=10;"floating"==t.position&&(i=0),e.setAttribute("style","width: "+(n.width+i)+"px; height:"+(n.height+i)+"px; top:"+(n.top-5)+"px;left: "+(n.left-5)+"px;")}}function p(){var e=document.querySelector(".introjs-disableInteraction");null===e&&(e=document.createElement("div"),e.className="introjs-disableInteraction",this._targetElement.appendChild(e)),u.call(this,e)}function h(e){"undefined"!=typeof this._introChangeCallback&&this._introChangeCallback.call(this,e.element);var t=this,n=document.querySelector(".introjs-helperLayer"),i=document.querySelector(".introjs-tooltipReferenceLayer"),a="introjs-helperLayer";_(e.element);if("string"==typeof e.highlightClass&&(a+=" "+e.highlightClass),"string"==typeof this._options.highlightClass&&(a+=" "+this._options.highlightClass),null!=n){var c=i.querySelector(".introjs-helperNumberLayer"),d=i.querySelector(".introjs-tooltiptext"),h=i.querySelector(".introjs-arrow"),v=i.querySelector(".introjs-tooltip"),b=i.querySelector(".introjs-skipbutton"),w=i.querySelector(".introjs-prevbutton"),M=i.querySelector(".introjs-nextbutton");if(n.className=a,v.style.opacity=0,v.style.display="none",null!=c){var T=this._introItems[e.step-2>=0?e.step-2:0];(null!=T&&"forward"==this._direction&&"floating"==T.position||"backward"==this._direction&&"floating"==e.position)&&(c.style.opacity=0)}u.call(t,n),u.call(t,i);var L=document.querySelectorAll(".introjs-fixParent");if(L&&L.length>0)for(var x=L.length-1;x>=0;x--)L[x].className=L[x].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");var C=document.querySelector(".introjs-showElement");C&&(C.className=C.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,"")),t._lastShowElementTimer&&clearTimeout(t._lastShowElementTimer),t._lastShowElementTimer=setTimeout(function(){null!=c&&(c.innerHTML=e.step),d.innerHTML=e.intro,v.style.display="block",l.call(t,e.element,v,h,c),i.querySelector(".introjs-bullets li > a.active").className="",i.querySelector('.introjs-bullets li > a[data-stepnumber="'+e.step+'"]').className="active",i.querySelector(".introjs-progress .introjs-progressbar").setAttribute("style","width:"+y.call(t)+"%;"),v.style.opacity=1,c&&(c.style.opacity=1),-1===M.tabIndex?b.focus():M.focus()},350)}else{var S=document.createElement("div"),k=document.createElement("div"),D=document.createElement("div"),Y=document.createElement("div"),j=document.createElement("div"),N=document.createElement("div"),P=document.createElement("div"),E=document.createElement("div");S.className=a,k.className="introjs-tooltipReferenceLayer",u.call(t,S),u.call(t,k),this._targetElement.appendChild(S),this._targetElement.appendChild(k),D.className="introjs-arrow",j.className="introjs-tooltiptext",j.innerHTML=e.intro,N.className="introjs-bullets",this._options.showBullets===!1&&(N.style.display="none");for(var A=document.createElement("ul"),x=0,F=this._introItems.length;F>x;x++){var I=document.createElement("li"),H=document.createElement("a");H.onclick=function(){t.goToStep(this.getAttribute("data-stepnumber"))},x===e.step-1&&(H.className="active"),H.href="javascript:void(0);",H.innerHTML="&nbsp;",H.setAttribute("data-stepnumber",this._introItems[x].step),I.appendChild(H),A.appendChild(I)}N.appendChild(A),P.className="introjs-progress",this._options.showProgress===!1&&(P.style.display="none");var Z=document.createElement("div");if(Z.className="introjs-progressbar",Z.setAttribute("style","width:"+y.call(this)+"%;"),P.appendChild(Z),E.className="introjs-tooltipbuttons",this._options.showButtons===!1&&(E.style.display="none"),Y.className="introjs-tooltip",Y.appendChild(j),Y.appendChild(N),Y.appendChild(P),1==this._options.showStepNumbers){var R=document.createElement("span");R.className="introjs-helperNumberLayer",R.innerHTML=e.step,k.appendChild(R)}Y.appendChild(D),k.appendChild(Y);var M=document.createElement("a");M.onclick=function(){t._introItems.length-1!=t._currentStep&&r.call(t)},M.href="javascript:void(0);",M.innerHTML=this._options.nextLabel;var w=document.createElement("a");w.onclick=function(){0!=t._currentStep&&s.call(t)},w.href="javascript:void(0);",w.innerHTML=this._options.prevLabel;var b=document.createElement("a");b.className="introjs-button introjs-skipbutton",b.href="javascript:void(0);",b.innerHTML=this._options.skipLabel,b.onclick=function(){t._introItems.length-1==t._currentStep&&"function"==typeof t._introCompleteCallback&&t._introCompleteCallback.call(t),t._introItems.length-1!=t._currentStep&&"function"==typeof t._introExitCallback&&t._introExitCallback.call(t),o.call(t,t._targetElement)},E.appendChild(b),this._introItems.length>1&&(E.appendChild(w),E.appendChild(M),M.focus()),Y.appendChild(E),l.call(t,e.element,Y,D,R)}this._options.disableInteraction===!0&&p.call(t),w.removeAttribute("tabIndex"),M.removeAttribute("tabIndex"),0==this._currentStep&&this._introItems.length>1?(w.className="introjs-button introjs-prevbutton introjs-disabled",w.tabIndex="-1",M.className="introjs-button introjs-nextbutton",b.innerHTML=this._options.skipLabel):this._introItems.length-1==this._currentStep||1==this._introItems.length?(b.innerHTML=this._options.doneLabel,w.className="introjs-button introjs-prevbutton",M.className="introjs-button introjs-nextbutton introjs-disabled",M.tabIndex="-1"):(w.className="introjs-button introjs-prevbutton",M.className="introjs-button introjs-nextbutton",b.innerHTML=this._options.skipLabel),e.element.className+=" introjs-showElement";var O=f(e.element,"position");"absolute"!==O&&"relative"!==O&&(e.element.className+=" introjs-relativePosition");for(var X=e.element.parentNode;null!=X&&"body"!==X.tagName.toLowerCase();){var J=f(X,"z-index"),B=parseFloat(f(X,"opacity")),W=f(X,"transform")||f(X,"-webkit-transform")||f(X,"-moz-transform")||f(X,"-ms-transform")||f(X,"-o-transform");(/[0-9]+/.test(J)||1>B||"none"!==W)&&(X.className+=" introjs-fixParent"),X=X.parentNode}if(!g(e.element)&&this._options.scrollToElement===!0){var q=e.element.getBoundingClientRect(),Q=m().height,$=q.bottom-(q.bottom-q.top),z=q.bottom-Q;0>$||e.element.clientHeight>Q?window.scrollBy(0,$-30):window.scrollBy(0,z+100)}"undefined"!=typeof this._introAfterChangeCallback&&this._introAfterChangeCallback.call(this,e.element,e)}function f(e,t){var n="";return e.currentStyle?n=e.currentStyle[t]:document.defaultView&&document.defaultView.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t)),n&&n.toLowerCase?n.toLowerCase():n}function m(){if(void 0!=window.innerWidth)return{width:window.innerWidth,height:window.innerHeight};var e=document.documentElement;return{width:e.clientWidth,height:e.clientHeight}}function g(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom+80<=window.innerHeight&&t.right<=window.innerWidth}function v(e){var t=document.createElement("div"),n="",i=this;if(t.className="introjs-overlay","body"===e.tagName.toLowerCase())n+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",t.setAttribute("style",n);else{var a=_(e);a&&(n+="width: "+a.width+"px; height:"+a.height+"px; top:"+a.top+"px;left: "+a.left+"px;",t.setAttribute("style",n))}return e.appendChild(t),t.onclick=function(){1==i._options.exitOnOverlayClick&&(o.call(i,e),void 0!=i._introExitCallback&&i._introExitCallback.call(i))},setTimeout(function(){n+="opacity: "+i._options.overlayOpacity.toString()+";",t.setAttribute("style",n)},10),!0}function _(e){var t={};t.width=e.offsetWidth,t.height=e.offsetHeight;for(var n=0,i=0,a=e.defaultOffsetLeft?e.defaultOffsetLeft:0,r=e.defaultOffsetTop?e.defaultOffsetTop:0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)n+=e.offsetLeft,i+=e.offsetTop,e=e.offsetParent;return t.top=i+r,t.left=n+a,t}function y(){var e=parseInt(this._currentStep+1,10);return e/this._introItems.length*100}function b(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)n[i]=t[i];return n}var w="1.0.0",M=function(e){if("object"==typeof e)return new t(e);if("string"==typeof e){var n=document.querySelector(e);if(n)return new t(n);throw new Error("There is no element with given selector.")}return new t(document.body)};return M.version=w,M.fn=t.prototype={clone:function(){return new t(this)},setOption:function(e,t){return this._options[e]=t,this},setOptions:function(e){return this._options=b(this._options,e),this},start:function(){return n.call(this,this._targetElement),this},goToStep:function(e){return a.call(this,e),this},nextStep:function(){return r.call(this),this},previousStep:function(){return s.call(this),this},exit:function(){return o.call(this,this._targetElement),this},refresh:function(){return u.call(this,document.querySelector(".introjs-helperLayer")),u.call(this,document.querySelector(".introjs-tooltipReferenceLayer")),this},onbeforechange:function(e){if("function"!=typeof e)throw new Error("Provided callback for onbeforechange was not a function");return this._introBeforeChangeCallback=e,this},onchange:function(e){if("function"!=typeof e)throw new Error("Provided callback for onchange was not a function.");return this._introChangeCallback=e,this},onafterchange:function(e){if("function"!=typeof e)throw new Error("Provided callback for onafterchange was not a function");return this._introAfterChangeCallback=e,this},oncomplete:function(e){if("function"!=typeof e)throw new Error("Provided callback for oncomplete was not a function.");return this._introCompleteCallback=e,this},onexit:function(e){if("function"!=typeof e)throw new Error("Provided callback for onexit was not a function.");return this._introExitCallback=e,this}},e.introJs=M,M}),define("cui/core/events/pubsub",[],function(){function e(e,t){var n;for(n in e)if(e.hasOwnProperty(n)&&t(e[n],n))break}function t(e,t,n){var i=!0;if(e){var a=0,r=e.length,s=t[0],o=t[1],l=t[2];switch(t.length){case 0:for(;r>a;a+=2)i=e[a].call(e[a+1]||n)!==!1&&i;break;case 1:for(;r>a;a+=2)i=e[a].call(e[a+1]||n,s)!==!1&&i;break;case 2:for(;r>a;a+=2)i=e[a].call(e[a+1]||n,s,o)!==!1&&i;break;case 3:for(;r>a;a+=2)i=e[a].call(e[a+1]||n,s,o,l)!==!1&&i;break;default:for(;r>a;a+=2)i=e[a].apply(e[a+1]||n,t)!==!1&&i}}return i}function n(){return+new Date+String(Math.random()).slice(-8)}var i=/\s+/,a=Object.keys;a||(a=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t});var r=function(e){this.id=e||n(),this.channel=r.channel(e)};return r.prototype.onMessage=function(e,t,n){var a,r,s;if(!t)return this;for(e=e.split(i),r=this.channel.events;a=e.shift();)s=r[a]||(r[a]=[]),s.push(t,n);return this},r.prototype.onceMessage=function(e,t,n){var i=this,a=function(){i.offMessage(e,a),t.apply(n||i,arguments)};return this.onMessage(e,a,n)},r.prototype.offMessage=function(e,t,n){var r,s,o,l;if(!(e||t||n))return this.channel.events={},this;for(r=this.channel.events,e=e?e.split(i):a(r);s=e.shift();)if(o=r[s])if(t||n)for(l=o.length-2;l>=0;l-=2)t&&o[l]!==t||n&&o[l+1]!==n||o.splice(l,2);else delete r[s];return this},r.prototype.sendMessage=function(e,n,a){var s,o,l,c;if(!(s=r.getChannel(e)))return this;for(n=n.split(i),o={from:this.id,message:a};l=n.shift();)(c=s.events[l])&&(c=c.slice()),o.event=l,t(c,[o],null);return this},r.prototype.subscribe=function(e,t,n,a){var s,o;if(!e||!t||"function"!=typeof n)return this;if(t=t.split(i),s=r.channel(e))for(;o=t.shift();)s.topics[o]=s.topics[o]||[],s.topics[o].push({from:this.id,callback:n,context:a});return this},r.prototype.publish=function(e,t){var n,i,a,r,s;if(n=this.channel.topics[e])for(i={from:this.id,topic:e,message:t},a=0,r=n.length;r>a;a++)s=n[a],s&&s.callback&&"[object Function]"===Object.prototype.toString.call(s.callback)&&s.callback.call(s.context,i);return this},r.prototype.unsubscribe=function(t,n){var i,a,s,o,l,c;if(c=this,!t)return e(r.channels,function(t){e(t.topics,function(e){for(o=e.length-1;o>=0;o--)e[o].from===c.id&&e.splice(o,1)})}),c;if(!(i=r.getChannel(t)))return c;if(a=i.topics,s=a[n]||[],n&&"string"==typeof n)for(o=s.length-1;o>=0;o--)s[o].from===this.id&&s.splice(o,1);else for(l in a)for(o=a[l].length-1;o>=0;o--)a[l][o].from===this.id&&a[l].splice(o,1);return c},r.channels={},r.channel=function(e){return e||(e=n()),r.channels[e]||(r.channels[e]={events:{},topics:{}})},r.getChannel=function(e){return r.channels.hasOwnProperty(e)&&r.channel(e)},r}),define("widget/intro/introduce",["require","i18n!common,mail,calendar","jquery","util/index","./intro","cui/core/events/pubsub"],function(e){function t(e){if("calendar"==e&&(e+=".index"),clearInterval(_),r(e)){var t=a(e),i=10;_=setInterval(function(){if(0==i)return void clearInterval(_);var a,r,s=!0;for(a=0;a<t.steps.length;a++){if(r=t.steps[a],r.element&&!document.querySelector(r.element)){s=!1;break}if(r.extra&&r.extra.frameNode){var o=r.extra.frameNode,c=document.querySelector(o.selector);if(!c){s=!1;break}c=c.contentDocument||c.contentWindow.document;var d=o.index||0,u=c.querySelectorAll(o.innerSelector)[d];if(l(c,o),!u){s=!1;break}r.inlineElement=u,delete r.extra.frameNode}}if(s){for(var p=0;p<t.steps.length;p++)t.steps[p].element=t.steps[p].element||t.steps[p].inlineElement;clearInterval(_),n(t,e)}else i--},1e3)}}function n(e,t){var n=f();n.setOptions(e),n.onbeforechange(function(e,t){var i=p(".introjs-tooltipReferenceLayer .introjs-nextbutton"),a=t.nextLabel||h.i18n.t("common/lbl_intro_next");0!=i.length?i.html(a):n.setOption("nextLabel",a),n.setOption("skipLabel",t.skipLabel||h.i18n.t("common/lbl_intro_close"));var r,s,o=t.extra||{};for(r in o)if("defaultOffsetLeft"===r)for(s=e;s;)s.defaultOffsetLeft=o[r],s=s.offsetParent;else if("defaultOffsetTop"===r)for(s=e;s;)s.defaultOffsetTop=o[r],s=s.offsetParent;else if("helperLayerClass"===r)p("div.introjs-helperLayer").addClass(o[r]);else if("imageName"===r){var l,c=o[r];l=-1!=c.indexOf(".")?'<img class="image" src="796e441f/style/img/intro/'+c+'"/>':y?'<img src="796e441f/style/img/intro/'+c+'.gif"/>':'<video autoplay loop><source src="796e441f/style/img/intro/'+c+'.mp4" type="video/mp4"></video>',t.intro&&(t.intro=h.messageFormat.format(t.intro,l))}}),n.onafterchange(function(e,t){var n,i=t.extra||{};for(n in i)"helperLayerClass"===n&&p("div.introjs-helperLayer").addClass(i[n])}),n.oncomplete(function(){s(t)}),n.onexit(function(){s(t,!0)}),n.start()}function i(){var e=p.Deferred(),t={mail_welcome:0,mail_previewlayout:0,mail_compose:0,calendar_index:0,calendar_edit:0,file_personalnf:0,file_enterprisenf:0,contact_oab:0};return p("head").append('<link rel="stylesheet" href="'+CC.assetPath("style/css/introjs.css")+'" />'),p.when(c(),d()).then(function(n,i){g={modulesList:p.extend(t,i),stepsList:n},e.resolve()},function(){e.reject()}),e.promise()}function a(e){e=e.split(".");for(var t,n=g.stepsList;p.isPlainObject(n)&&(t=e.shift());)n=n[t.toLowerCase()];return n=o(n),{doneLabel:h.i18n.t("common/lbl_intro_done"),steps:n,showStepNumbers:!1,tooltipPosition:"auto",showBullets:!1,overlayOpacity:.75,exitOnOverlayClick:!1}}function r(e){e=e.replace(".","_");var t=g.modulesList;return 0==t[e]}function s(e,t){t="boolean"==typeof t?t:!1,t?p.each(g.modulesList,function(e,t){g.modulesList[e]=1}):(e=e.replace(".","_"),g.modulesList[e]=1),u(h.params.serialize(g.modulesList))}function o(e){return p.each(e,function(t,n){"object"==typeof n?o.call(this,n):"string"==typeof n&&0==n.indexOf("i18n ")&&(e[t]=h.i18n.t(n.replace("i18n ","")))}),e}function l(e,n){n.eventSelector&&"string"==typeof n.eventSelector&&p(e).one("click."+n.moduleName,n.eventSelector,function(){t(n.moduleName)})}function c(){var e=p.Deferred();return h.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:h.xhr.getRequestURL({url:"/XT5/json/intro.json"}),onlyVar:!1,preprocess:!1},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function d(){var e=p.Deferred();return h.xhr.simpleCall({query:{func:"user:getFaces",sid:h.url.getUrlParamValue(location.href,"sid")}},function(t){var n=t.faces.XT5||{},i=n.userOptions||"";e.resolve(h.params.deserialize(i))},function(){e.reject()}),e.promise()}function u(e){var t=p.Deferred();return h.xhr.simpleCall({query:{func:"user:changeFaceSettings",sid:h.url.getUrlParamValue(location.href,"sid")},data:{options:e}},function(){t.resolve()},function(){t.reject()}),t.promise()}e("i18n!common,mail,calendar");var p=e("jquery"),h=e("util/index"),f=e("./intro"),m=e("cui/core/events/pubsub"),g=null,v=new m("introduce"),_=1,y=!p.support.leadingWhitespace;return v.unsubscribe("dispatcher","view:changed").subscribe("dispatcher","view:changed",function(e){var n=e.message.newState.module;t.call(this,n)}),v.unsubscribe("dispatcher","url:changed").subscribe("dispatcher","url:changed",function(e){var n=e.message.newState.module;t.call(this,n)}),{initIntro:i}}),define("dispatcher",["require","exports","module","jquery","cui/core/events/pubsub","cui/util/history/hash","util/cache"],function(e,t){function n(){p=g.getHash()}function i(){return p}function a(){_=[{id:"mail",children:[{id:"welcome"},{id:"list"},{id:"search"},{id:"read"},{id:"compose"},{id:"thread"},{id:"previewlayout"},{id:"entrustmanager"}]},{id:"calendar"},{id:"file",children:[{id:"accessory"},{id:"personalnf"},{id:"enterprisenf"},{id:"transitcenter"}]},{id:"contact",children:[{id:"oab"},{id:"pab"}]},{id:"appcenter"},{id:"skins"},{id:"logs",children:[{id:"login"},{id:"send"},{id:"receive"},{id:"delete"},{id:"trs"}]},{id:"setting",children:[{id:"account",children:[{id:"personal"},{id:"password"},{id:"signature"},{id:"question"},{id:"externalauth"}]},{id:"display",children:[{id:"general"},{id:"list"}]},{id:"delivery",children:[{id:"compose"},{id:"reply"},{id:"read"},{id:"forward"},{id:"autoreply"},{id:"template"}]},{id:"filter",children:[{id:"letter"},{id:"vip"}]},{id:"security",children:[{id:"whitelist"},{id:"blacklist"},{id:"antivirus"},{id:"junkfilter"},{id:"auth2lock"},{id:"junknotify"},{id:"offsiteremind"},{id:"smime"},{id:"twofactorauth"},{id:"logindevices"}]},{id:"folder",children:[{id:"folder"}]},{id:"calendar",children:[{id:"calendar"}]},{id:"advance",children:[{id:"mboxshare"},{id:"pop"},{id:"question"},{id:"pop3set"},{id:"searchinrange"},{id:"mailpush"},{id:"smsnotification"},{id:"loginnotification"},{id:"bindmobile"},{id:"hotkeys"}]}]}]}function r(){f(window).hashchange("off","history").hashchange("history",function(e,t,n){window._handleTackPageView();var i=v.getItemWithLocal("cm_state");t.module&&(i.module===t.module&&(t=f.extend(!0,i,t)),y.publish(h||"url:changed",{newState:t,oldState:n})),y.publish("locationChanged",{newState:t,oldState:n}),h="url:changed"})}function s(){y.onMessage("history:add",function(e){var t,n,i=e.message;return!i||f.isEmptyObject(i)?!1:(f.isPlainObject(i.param)||(i.param={}),u(i,!1),t=i.param.historyUrl,n=i.param.vid,delete i.param.vid,delete i.param.historyUrl,t||(t=g.stringifyHash(i)),c(i,t,n),void(d(t)||(h="url:changed",g.addHash(t,!1))))}),y.onMessage("view:render",function(e){var t,n,i,a=e.message,r=v.getItemWithLocal("cm_state");return!a||f.isEmptyObject(a)?!1:(t=l(a.module),0!==r.module.indexOf(a.module)&&u(a),void(!t||t.children&&0!==t.children.length||(a.param=a.param||{},n=a.param.historyUrl,i=a.param.vid,delete a.param.historyUrl,delete a.param.vid,n||(n=g.stringifyHash(a)),p=null,c(a,n,i),d(n)||(h="view:changed",g.addHash(n,!1)))))}),y.onMessage("view:refresh",function(e){var t,n,i,a=e.message;return"string"===f.type(a)&&(a={module:a,param:{}}),a.module?(a.param=a.param||{},t=l(a.module),p=null,i=a.param.vid,delete a.param.vid,void(t&&t.children&&t.children.length>0?t.curPath&&!d(t.curPath)&&(u(a),h="view:changed",g.addHash(t.curPath,!1)):(n=t[i]||t.curPath,n||(n=g.stringifyHash(a)),c(a,n,i),u(a),d(n)||(h="view:changed",g.addHash(n,!1))))):!1})}function o(){n(),a(),r(),s()}function l(e){var t,n,i,a;if(!e)return!1;for(i={children:_},t=e.split(".");(n=t.shift())&&i&&(i=i.children,a=!1,f.each(i,function(e,t){return t.id===n?(i=t,a=!0,!1):void 0}),a););return a?i:!1}function c(e,t,n){var i,a,r;if(r=e.module,!r||!t||!l(r))return!1;for(i=r.split("."),r={children:_};(a=i.shift())&&r;)r=r.children,f.each(r,function(e,n){return n.id===a?(n.curPath=t,r=n,!1):void 0});n&&(r=l(e.module),r[n]=t)}function d(e){var t=g.getHash();return e===g.stringifyHash(t)}function u(e,t){var n,i,a=v.getItemWithLocal("cm_state");t="boolean"===f.type(t)?t:!0,n="string"===f.type(e)?g.getHash("#"+e):f.extend(!0,{},e),i=n.module.split("."),i.length>1&&(n.param.view=i[1]),0===n.module.indexOf(a.module)&&t&&(n=f.extend(!0,{},a,n)),v.setItemWithLocal("cm_state",n)}var p,h,f=e("jquery"),m=e("cui/core/events/pubsub"),g=e("cui/util/history/hash"),v=e("util/cache"),_=[],y=new m("dispatcher");t.getInitHash=i,t.start=o,t.getModuleCurrentPath=function(e){var t=l(e);return t?"undefined"==typeof t.curPath?"":t.curPath:!1}}),+function(){define("module/common/previewCtrl",["require","exports","module","../../configstore"],function(e,t,n){var i=e("../../configstore"),a=i.getConfig("user.enablepreview"),r=i.getConfig("user.previewengine"),s=a&&!!r,o=i.getConfig("mail.supportedpreviewtypes"),l=i.getConfig("user.previewdefaultsize"),c=i.getConfig("user.previewsizelimit"),d=null,u=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=function(e){return null==e?"":(e+"").replace(u,"")},h=function(e){var t,n;return"string"==typeof e&&(e=$.trim(e)).length?(n=e.lastIndexOf("."),0>n?"":(t=e.substring(n+1,e.length).toLowerCase(),-1!==t.indexOf("htm")&&(t="html"),t)):""},f=function(e){var t,n,i,a,r,s,o={};if("string"!=typeof e)return o;for(t=e.split(";"),
r=0;r<t.length;r++)for(n=p(t[r]).split(":"),i=n[0].split(","),a=n[1],s=0;s<i.length;s++)o[p(i[s])]=a;return o},m=function(){return{isAuth:a,engine:r,isAvailable:s}},g=function(e){if(null==e||!e.length)return!1;var t=h(e);return!!(t.length&&o.indexOf(t)>=0)},v=function(e,t){var n,i;return null!=e&&e.length?(t=parseFloat(t),isNaN(t)?!1:(d=null==d?f(c):d,n=h(e),n.length?(i=d[n],(i=null==i?l:i)?(i=1024*parseFloat(i),i>t):!0):!1)):!1},_=function(e,t){return s&&g(e)&&v(e,t)};n.exports={checkFilePermit:_,checkFileSizeExceedLimit:v,getPreviewStatus:m}})}(),define("module/common/globalService",["require","jquery","cui/util/cookie/cookie","cui/util/history/hash","../../util/index","../../util/common-controls","../../dispatcher","../../configstore","./previewCtrl"],function(e){function t(e,t){j.setConfig(e,t)}function n(e){return j.getConfig(e)}function i(e){var t=x.Deferred();return e?k.xhr.simpleCall({query:{func:"user:getAttrs",sid:e},data:{attrIds:["email","primary_email","true_name","gender","@ou","safelist","refuselist"].concat(y())}},function(n){if(n.sid=e,n.def_sec_folder){var i=L(decodeURIComponent(n.def_sec_folder));n.def_sec_folder=i.folder,n.def_sec_op=i.op}n.email=k.Email.parseAddress(n.email),u(n);var a=k.cache.getItemWithLocal("cm_state");a||(a={module:"",param:{}},k.cache.setItemWithLocal("cm_state",a)),t.resolve()},function(){t.reject()}):t.reject(),t.promise()}function a(e,t){var n,i=x.Deferred(),a=d();return e=e||{},t="boolean"==typeof t?t:!0,n={attrs:e},e.password&&(n.password=e.password,delete e.password),x.isEmptyObject(e)?i.reject():k.xhr.simpleCall({query:{func:"user:setAttrs",sid:c()},data:n},function(){t&&u(x.extend(a,e)),i.resolve()},function(e,t,n){i.reject(n)}),i.promise()}function r(e){var t=x.Deferred();e="boolean"==typeof e?e:!1;var n=d(),i=D.assetPath("style/img/"),a=void 0==n.gender||0==n.gender?i+"man.png":i+"woman.png",r=D.path("/s?func=user:getHeadImageData&sid="+c()+"&ts="+ +new Date)+(e?"&temp=1":"");return k.xhr.simpleCall({url:r,type:"GET"},function(e,n,i){200===i.status?t.resolve(r):t.resolve(a)},function(){t.resolve(a)}),t.promise()}function s(){var e=x.Deferred(),t=D.assetPath("style/img/")+"logo.png";return k.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:k.xhr.getRequestURL({url:"/XT5/jsp/logo.jsp",query:{sid:c()}})},function(n,i,a){200===a.status?e.resolve(n):e.resolve(t)},function(){e.resolve(t)}),e.promise()}function o(){var e=x.Deferred();return k.xhr.simpleCall({query:{func:"user:logout",sid:c()}},function(t){l(),e.resolve(t)},function(){e.reject()}),e.promise()}function l(){k.cache.removeItem("cm_user"),k.cache.removeItemWithLocal("cm_state"),C.remove("Coremail.sid")}function c(){var e=k.cache.getItem("cm_user");return e&&e.sid}function d(){return k.cache.getItem("cm_user")||{}}function u(e){e=e||{},k.cache.setItem("cm_user",e)}function p(e){e=e||{},k.cache.setItem("cm_op_stack",e)}function h(){return k.cache.getItem("cm_op_stack")||{}}function f(){var e,t,n=Y.getInitHash(),i=k.cache.getItemWithLocal("cm_state"),a=S.getHash();return e=n?x.extend(!0,{},n):i.module===a.module?x.extend(!0,{},a,i):x.extend(!0,{},i),t=e.module.split("."),t=e.param.view||t[1]||"",e.param.view=t,e}function m(e){e.module=e.module||"",e.param=x.isPlainObject(e.param)?e.param:{},k.cache.setItemWithLocal("cm_state",e)}function g(){return{firstpage:0,save_sent:1,edit_mode:0,aftersend_saveaddr:0,maxlist:20,addo:0,replyf:0,afterdel:1,displaysender:0,smtp_save_sent:1,op_readreceipt:0,newwindowtoreadletter:0,clock_system:0,display_list:0,display_size:0,list_brief_text:1,reference_content:0,preview_layout:0,list_style:0,shortcut:0,send_card:0,search_ordering_rule:0,index_time_category:1,multi_tab:0,reply_all_mode:0,customized_font:"SimSun;16px"}}function v(){return{maxlist:20,addo:0,replyf:0,afterdel:1,displaysender:0,op_readreceipt:0}}function _(){return{autoReply:"1",updatePwd:"2",mboxShare:"3"}}function y(){var e=[];for(var t in g())e.push(t);e.push("time_zone"),e.push("def_sec_folder"),e.push("ws_msg_notify"),e.push("ws_msg_notify_folder"),e.push("default_sender_address"),e.push("signature_position"),e.push("sms_login_notify"),e.push("app_login_notify"),e.push("subject_refw_prefix_expand"),e.push("search_sent_date_in_range");var i=n("setting.showSMTPSaveSent");if(!i){var a=e.indexOf("smtp_save_sent");a>-1&&e.splice(a,1)}return e}function b(e){var t,i,a=n("user.auth2lockdefined"),r=n("user.auth2unlocked"),s=n("file.nfrootauth2lockdefined"),o=n("file.nfrootauth2locked");return e?(i=r||!o,t={locked:!i,lockedDefined:s,isAuth:!s||i}):t={locked:!r,lockedDefined:a,isAuth:!a||r},t}function w(){return N.getPreviewStatus()}function M(){var e=x.Deferred();return k.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:k.xhr.getRequestURL({url:"/XT5/jsp/generateSidCookie.jsp",query:{sid:c()}})},function(){e.resolve()},function(){e.reject()}),e.promise()}function T(){return"./detach.jsp?sid="+encodeURIComponent(c())}function L(e){var t={folder:[],op:[]},n=decodeURIComponent(e).replace(/(?:op:)(\d+)/g,function(e,n){t.op.push(n)});return t.folder=n.match(/\d+(?=,)?/g),t}var x=e("jquery"),C=e("cui/util/cookie/cookie"),S=e("cui/util/history/hash"),k=e("../../util/index"),D=e("../../util/common-controls"),Y=e("../../dispatcher"),j=e("../../configstore"),N=e("./previewCtrl");return{updateConfig:t,getConfig:n,initUser:i,updateUser:a,logoutUser:o,getUserAvatar:r,getOrgLogo:s,clear:l,getSid:c,getUser:d,setUser:u,getOpStack:h,setOpStack:p,getCurrentState:f,setCurrentState:m,getReservedUserAttrValues:g,getReservedUserAttrRecommendValues:v,getReservedUserAttrKeys:y,getFolderLockedStatus:b,getPreviewStatus:w,generateSidCookie:M,getDetachBaseURL:T,getLockOpValues:_,parseLockRange:L}}),define("module/file/fileService",["require","i18n!file","jquery","../../util/index","../common/globalService"],function(e){function t(e){var t=S.Deferred(),n={skipLockedFolders:!0,desc:!0,order:"date"};return e=S.extend(!0,{},n,S.isPlainObject(e)&&e),k.xhr.simpleCall({onlyVar:!1,query:{func:"mbox:listAttachments",sid:D.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function n(e,n,i){return t({start:e,limit:n,returnTotal:i})}function i(e){return t({start:e.start,limit:e.limit,returnTotal:e.returnTotal,order:e.order,filter:e.filter,desc:e.desc})}function a(e){var t=S.Deferred(),n={func:"nf:getAllFolders",sid:D.getSid()};return k.xhr.simpleCall({query:n,data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function r(e,t,n,i){var a=S.Deferred();return k.xhr.simpleCall({url:k.xhr.getRequestURL({url:"/XT5/jsp/file.jsp",query:{func:"file:getPNfFolderStructure",sid:D.getSid(),fid:e||0,listTree:"undefined"==typeof t?!0:t,listFolders:"undefined"==typeof n?!0:n,listFiles:"undefined"==typeof i?!0:i}})},function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise()}function s(e){var t=S.Deferred(),n={func:"file:getENfFolderStructure",sid:D.getSid(),uid:D.getConfig("file.enfuid")};return"undefined"!=typeof e&&null!=e&&(n.fid=e),k.xhr.simpleCall({url:k.xhr.getRequestURL({url:"/XT5/jsp/file.jsp",query:n})},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function o(e){var t=S.Deferred(),n={fid:D.getConfig("file.trsfid")};return k.xhr.simpleCall({onlyVar:!1,query:{func:"nf:listFiles",sid:D.getSid()},data:S.extend({},e,n)},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function l(e){var t=S.Deferred(),n={func:"mbox:saveMessageToNF",sid:D.getSid()};return k.xhr.simpleCall({query:n,data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function c(e){var t=S.Deferred(),n={func:"nf:createUserFolders",sid:D.getSid()};return k.xhr.simpleCall({query:n,data:{items:e}},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function d(e,t){var n,i,a,r=200,s="%'\"\\/:*?<>|=,#^",o={isValid:!0,msg:null};return t="boolean"==typeof t?t:!0,t?(n=k.i18n.t("file/msg_tips_filename_empty"),i=k.i18n.t("file/msg_tips_filename_toolong"),a=k.i18n.t("file/msg_tips_filename_error")):(n=k.i18n.t("file/msg_tips_foldername_empty"),i=k.i18n.t("file/msg_tips_foldername_toolong"),a=k.i18n.t("file/msg_tips_foldername_error"),s="%'\"\\/:*?<>|=,.#^"),e.length<=0?(o.isValid=!1,o.msg=n,o):e.length>r?(o.isValid=!1,o.msg=i.replace("{0}",r).replace("{1}",Math.floor(r/2)),o):L(e,s)?(o.isValid=!1,o.msg=a.replace("{0}",s),o):o}function u(e){var t=S.Deferred();return k.xhr.simpleCall({query:{func:"xnf:getConfig",sid:D.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function p(e,t){var n=S.Deferred();return e="boolean"==typeof e?e:!0,t="boolean"==typeof t?t:!0,S.when(u({returnAccountInfo:e})).then(function(e){var i=x(e,t);n.resolve(i)},function(e){n.reject(e)}),n.promise()}function h(){var e=x(D.getConfig("file.xnfconfig"));return e}function f(e,t,n,i,a,r,s){var o=S.Deferred();return r=r||0,s=s||20,k.xhr.simpleCall({url:k.xhr.getRequestURL({url:"/XT5/jsp/file.jsp",query:{func:"file:getXNfFolderStructure",sid:D.getSid(),token:e,fid:encodeURI(t)||"",listTree:"undefined"==typeof n?!0:n,listFolders:"undefined"==typeof i?!0:i,listFiles:"undefined"==typeof a?!0:a}})},function(e){o.resolve(C(e,r,s))},function(e){o.reject(e)}),o.promise()}function m(e){var t=S.Deferred(),n={func:"xnf:saveFromMessage",sid:D.getSid()};return k.xhr.simpleCall({query:n,data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function g(e){var t=S.Deferred(),n={};return S.isPlainObject(e)&&"undefined"!=typeof e.token?(n.token=e.token,"undefined"==typeof e.id?n.id=[]:S.isArray(e.id)?n.id=e.id:n.id=[e.id],k.xhr.simpleCall({query:{func:"xnf:getShareableUrl",sid:D.getSid()},data:n},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()):(setTimeout(function(){t.reject("fileService.getXNFShareableUrl: error params")},10),t.promise())}function v(e){var t=S.Deferred();return S.isPlainObject(e)&&"undefined"!=typeof e.token?(k.xhr.simpleCall({url:k.xhr.getRequestURL({url:"/XT5/jsp/file.jsp",query:{func:"xnf:attachToCompose",sid:D.getSid(),ids:e.ids,composeId:e.composeId,token:e.token}})},function(e){t.resolve(e)},function(e,n,i){t.reject(i)}),t.promise()):(setTimeout(function(){t.reject("fileService.attachToCompose: error params")},10),t.promise())}function _(e){var t=S.Deferred(),n=0;return S.isPlainObject(e)&&"undefined"!=typeof e.token?(e.fid=e.fid||"",e.returnTotal=!0,k.xhr.simpleCall({query:{func:"xnf:search",sid:D.getSid()},data:e},function(e,i,a){n=a.responseJSON.total,t.resolve({totalLen:n,listResult:e})},function(e){t.reject(e)}),t.promise()):(setTimeout(function(){t.reject("fileService.SearchXNFList: error params")},10),t.promise())}function y(e){var t=S.Deferred();return S.isPlainObject(e)&&"undefined"!=typeof e.token?(e.path=e.path||"",k.xhr.simpleCall({query:{func:"xnf:createFolder",sid:D.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()):(setTimeout(function(){t.reject("fileService.createXNFFolder: error params")},10),t.promise())}function b(e){var t=S.Deferred();return S.isPlainObject(e)&&"undefined"!=typeof e.token?(k.xhr.simpleCall({query:{func:"xnf:rename",sid:D.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()):(setTimeout(function(){t.reject("fileService.renameXNFFolder: error params")},10),t.promise())}function w(e){var t=S.Deferred();return k.xhr.simpleCall({query:{func:"nf:getOrCreateShareLink",sid:D.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function M(e){var t=S.Deferred();return k.xhr.simpleCall({url:k.xhr.getRequestURL({url:"/XT5/jsp/file.jsp",query:{func:"file:getShareLinkInfo",sid:D.getSid(),file_id:e.file_id,net_disk_uid:e.net_disk_uid,type:e.type}})},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function T(e){var t=S.Deferred();return k.xhr.simpleCall({query:{func:"nf:deleteShareLink",sid:D.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function L(e,t){for(var n=!1,i=0;i<e.length;i++)if(t.indexOf(e[i])>=0){n=!0;break}return n}function x(e,t){var n,i,a,r=[];return t="boolean"==typeof t?t:!0,S.isPlainObject(e)?(n=e.tokens,i=e.engines,S.each(n,function(e,n){(!t||n.linked)&&(a={},a.token=e,a.engineKey=n.engine,a.linked=n.linked,a.engine=S.extend(!0,{},i[a.engineKey]),a.account=S.extend(!0,{},n.account),a.engineName=a.engine.name,r.push(a))}),r):r}function C(e,t,n){var i,a=e.folders?e.folders:[],r=e.files?e.files:[],s=a.concat(r),o=a.length+r.length;return i=s.slice(t,t+n),e.totalLen=o,e.listResult=i,e}e("i18n!file");var S=e("jquery"),k=e("../../util/index"),D=e("../common/globalService");return{getAccList:t,getAccListDefault:n,getAccListConditional:i,getNFAllFolders:a,getPNfFolderStructure:r,getENfFolderStructure:s,getTrsFiles:o,saveToNF:l,createNFFolder:c,validateName:d,initValidXNFEngines:h,getXNFConfig:p,getXNfFolderStructure:f,saveToXNF:m,getXNFShareableUrl:g,SearchXNFList:_,renameXNFFolder:b,createXNFFolder:y,attachToCompose:v,createShareLink:w,getShareLinkInfo:M,cancelShareLink:T}}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("components/socket.io-client/socket.io",[],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.io=e()}}(function(){var e;return function t(e,n,i){function a(s,o){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return a(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":2}],2:[function(e,t,n){function i(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,i=a(e),r=i.source,c=i.id;return t.forceNew||t["force new connection"]||!1===t.multiplex?(o("ignoring socket cache for %s",r),n=s(r,t)):(l[c]||(o("new io instance for %s",r),l[c]=s(r,t)),n=l[c]),n.socket(i.path)}var a=e("./url"),r=e("socket.io-parser"),s=e("./manager"),o=e("debug")("socket.io-client");t.exports=n=i;var l=n.managers={};n.protocol=r.protocol,n.connect=i,n.Manager=e("./manager"),n.Socket=e("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(e,t,n){function i(e,t){return this instanceof i?(e&&"object"==typeof e&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connected=[],this.encoding=!1,this.packetBuffer=[],this.encoder=new o.Encoder,this.decoder=new o.Decoder,this.autoConnect=t.autoConnect!==!1,void(this.autoConnect&&this.open())):new i(e,t)}var a=(e("./url"),e("engine.io-client")),r=e("./socket"),s=e("component-emitter"),o=e("socket.io-parser"),l=e("./on"),c=e("component-bind"),d=(e("object-component"),e("debug")("socket.io-client:manager")),u=e("indexof"),p=e("backo2");t.exports=i,i.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)this.nsps[e].emit.apply(this.nsps[e],arguments)},i.prototype.updateSocketIds=function(){for(var e in this.nsps)this.nsps[e].id=this.engine.id},s(i.prototype),i.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},i.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},i.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},i.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},i.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},i.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},i.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},i.prototype.open=i.prototype.connect=function(e){if(d("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;d("opening %s",this.uri),this.engine=a(this.uri,this.opts);var t=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var i=l(t,"open",function(){n.onopen(),e&&e()}),r=l(t,"error",function(t){if(d("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var i=new Error("Connection error");i.data=t,e(i)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;d("connect attempt will timeout after %d",s);var o=setTimeout(function(){d("connect attempt timed out after %d",s),i.destroy(),t.close(),t.emit("error","timeout"),n.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(o)}})}return this.subs.push(i),this.subs.push(r),this},i.prototype.onopen=function(){d("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(l(e,"data",c(this,"ondata"))),this.subs.push(l(this.decoder,"decoded",c(this,"ondecoded"))),this.subs.push(l(e,"error",c(this,"onerror"))),this.subs.push(l(e,"close",c(this,"onclose")))},i.prototype.ondata=function(e){this.decoder.add(e)},i.prototype.ondecoded=function(e){this.emit("packet",e)},i.prototype.onerror=function(e){d("error",e),this.emitAll("error",e)},i.prototype.socket=function(e){var t=this.nsps[e];if(!t){t=new r(this,e),this.nsps[e]=t;var n=this;t.on("connect",function(){t.id=n.engine.id,~u(n.connected,t)||n.connected.push(t)})}return t},i.prototype.destroy=function(e){var t=u(this.connected,e);~t&&this.connected.splice(t,1),this.connected.length||this.close()},i.prototype.packet=function(e){d("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(e){for(var n=0;n<e.length;n++)t.engine.write(e[n]);t.encoding=!1,t.processPacketQueue()}))},i.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},i.prototype.cleanup=function(){for(var e;e=this.subs.shift();)e.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},i.prototype.close=i.prototype.disconnect=function(){this.skipReconnect=!0,this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},i.prototype.onclose=function(e){d("close"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},i.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)d("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();d("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(d("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(d("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(d("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},i.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(e,t,n){function i(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}t.exports=i},{}],5:[function(e,t,n){function i(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.io.autoConnect&&this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0}var a=e("socket.io-parser"),r=e("component-emitter"),s=e("to-array"),o=e("./on"),l=e("component-bind"),c=e("debug")("socket.io-client:socket"),d=e("has-binary");t.exports=n=i;var u={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},p=r.prototype.emit;r(i.prototype),i.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[o(e,"open",l(this,"onopen")),o(e,"packet",l(this,"onpacket")),o(e,"close",l(this,"onclose"))]}},i.prototype.open=i.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},i.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},i.prototype.emit=function(e){if(u.hasOwnProperty(e))return p.apply(this,arguments),this;var t=s(arguments),n=a.EVENT;d(t)&&(n=a.BINARY_EVENT);var i={type:n,data:t};return"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this},i.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},i.prototype.onopen=function(){c("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:a.CONNECT})},i.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},i.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case a.CONNECT:this.onconnect();break;case a.EVENT:this.onevent(e);break;case a.BINARY_EVENT:this.onevent(e);break;case a.ACK:this.onack(e);break;case a.BINARY_ACK:this.onack(e);break;case a.DISCONNECT:this.ondisconnect();break;case a.ERROR:this.emit("error",e.data)}},i.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?p.apply(this,t):this.receiveBuffer.push(t)},i.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var i=s(arguments);c("sending ack %j",i);var r=d(i)?a.BINARY_ACK:a.ACK;t.packet({type:r,id:e,data:i})}}},i.prototype.onack=function(e){c("calling ack %s with %j",e.id,e.data);var t=this.acks[e.id];t.apply(this,e.data),delete this.acks[e.id]},i.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},i.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)p.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},i.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},i.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},i.prototype.close=i.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:a.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(e,t,n){(function(n){function i(e,t){var i=e,t=t||n.location;return null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"==e.charAt(0)&&(e="/"==e.charAt(1)?t.protocol+e:t.hostname+e),/^(https?|wss?):\/\//.test(e)||(r("protocol-less url %s",e),e="undefined"!=typeof t?t.protocol+"//"+e:"https://"+e),r("parse %s",e),i=a(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/",i.id=i.protocol+"://"+i.host+":"+i.port,i.href=i.protocol+"://"+i.host+(t&&t.port==i.port?"":":"+i.port),i}var a=e("parseuri"),r=e("debug")("socket.io-client:url");t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:10,parseuri:44}],7:[function(e,t,n){function i(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=i,i.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},i.prototype.reset=function(){this.attempts=0},i.prototype.setMin=function(e){this.ms=e},i.prototype.setMax=function(e){this.max=e},i.prototype.setJitter=function(e){this.jitter=e}},{}],8:[function(e,t,n){var i=[].slice;t.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments)))}}},{}],9:[function(e,t,n){function i(e){return e?a(e):void 0}function a(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}t.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i,a=0;a<n.length;a++)if(i=n[a],i===t||i.fn===t){n.splice(a,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var i=0,a=n.length;a>i;++i)n[i].apply(this,t)}return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],10:[function(e,t,n){function i(e){return i.enabled(e)?function(t){t=a(t);var n=new Date,r=n-(i[e]||n);i[e]=n,t=e+" "+t+" +"+i.humanize(r),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function a(e){return e instanceof Error?e.stack||e.message:e}t.exports=i,i.names=[],i.skips=[],i.enable=function(e){try{localStorage.debug=e}catch(t){}for(var n=(e||"").split(/[\s,]+/),a=n.length,r=0;a>r;r++)e=n[r].replace("*",".*?"),"-"===e[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$"))},i.disable=function(){i.enable("")},i.humanize=function(e){var t=1e3,n=6e4,i=60*n;return e>=i?(e/i).toFixed(1)+"h":e>=n?(e/n).toFixed(1)+"m":e>=t?(e/t|0)+"s":e+"ms"},i.enabled=function(e){for(var t=0,n=i.skips.length;n>t;t++)if(i.skips[t].test(e))return!1;for(var t=0,n=i.names.length;n>t;t++)if(i.names[t].test(e))return!0;return!1};try{window.localStorage&&i.enable(localStorage.debug)}catch(r){}},{}],11:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":12}],12:[function(e,t,n){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(e,t,n){(function(n){function i(e,t){if(!(this instanceof i))return new i(e,t);if(t=t||{},e&&"object"==typeof e&&(t=e,e=null),e&&(e=d(e),t.host=e.host,t.secure="https"==e.protocol||"wss"==e.protocol,t.port=e.port,e.query&&(t.query=e.query)),this.secure=null!=t.secure?t.secure:n.location&&"https:"==location.protocol,t.host){var a=t.host.split(":");t.hostname=a.shift(),a.length?t.port=a.pop():t.port||(t.port=this.secure?"443":"80")}this.agent=t.agent||!1,this.hostname=t.hostname||(n.location?location.hostname:"localhost"),this.port=t.port||(n.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=p.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=t.rejectUnauthorized||null,this.open()}function a(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var r=e("./transports"),s=e("component-emitter"),o=e("debug")("engine.io-client:socket"),l=e("indexof"),c=e("engine.io-parser"),d=e("parseuri"),u=e("parsejson"),p=e("parseqs");t.exports=i,i.priorWebsocketSuccess=!1,s(i.prototype),i.protocol=c.protocol,i.Socket=i,i.Transport=e("./transport"),i.transports=e("./transports"),i.parser=e("engine.io-parser"),i.prototype.createTransport=function(e){o('creating transport "%s"',e);var t=a(this.query);t.EIO=c.protocol,t.transport=e,this.id&&(t.sid=this.id);var n=new r[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return n},i.prototype.open=function(){var e;if(this.rememberUpgrade&&i.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0==this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";var e;try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},i.prototype.setTransport=function(e){o("setting transport %s",e.name);var t=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},i.prototype.probe=function(e){function t(){if(p.onlyBinaryUpgrades){var t=!this.supportsBinary&&p.transport.supportsBinary;u=u||t}u||(o('probe transport "%s" opened',e),d.send([{type:"ping",data:"probe"}]),d.once("packet",function(t){if(!u)if("pong"==t.type&&"probe"==t.data){if(o('probe transport "%s" pong',e),p.upgrading=!0,p.emit("upgrading",d),!d)return;i.priorWebsocketSuccess="websocket"==d.name,o('pausing current transport "%s"',p.transport.name),p.transport.pause(function(){u||"closed"!=p.readyState&&(o("changing transport and sending upgrade packet"),c(),p.setTransport(d),d.send([{type:"upgrade"}]),p.emit("upgrade",d),d=null,p.upgrading=!1,p.flush())})}else{o('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=d.name,p.emit("upgradeError",n)}}))}function n(){u||(u=!0,c(),d.close(),d=null)}function a(t){var i=new Error("probe error: "+t);
i.transport=d.name,n(),o('probe transport "%s" failed because of error: %s',e,t),p.emit("upgradeError",i)}function r(){a("transport closed")}function s(){a("socket closed")}function l(e){d&&e.name!=d.name&&(o('"%s" works - aborting "%s"',e.name,d.name),n())}function c(){d.removeListener("open",t),d.removeListener("error",a),d.removeListener("close",r),p.removeListener("close",s),p.removeListener("upgrading",l)}o('probing transport "%s"',e);var d=this.createTransport(e,{probe:1}),u=!1,p=this;i.priorWebsocketSuccess=!1,d.once("open",t),d.once("error",a),d.once("close",r),this.once("close",s),this.once("upgrading",l),d.open()},i.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",i.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var e=0,t=this.upgrades.length;t>e;e++)this.probe(this.upgrades[e])}},i.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(o('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(u(e.data));break;case"pong":this.setPing();break;case"error":var t=new Error("server error");t.code=e.data,this.emit("error",t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else o('packet received with socket readyState "%s"',this.readyState)},i.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},i.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!=t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},i.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},i.prototype.ping=function(){this.sendPacket("ping")},i.prototype.onDrain=function(){for(var e=0;e<this.prevBufferLen;e++)this.callbackBuffer[e]&&this.callbackBuffer[e]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},i.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},i.prototype.write=i.prototype.send=function(e,t){return this.sendPacket("message",e,t),this},i.prototype.sendPacket=function(e,t,n){if("closing"!=this.readyState&&"closed"!=this.readyState){var i={type:e,data:t};this.emit("packetCreate",i),this.writeBuffer.push(i),this.callbackBuffer.push(n),this.flush()}},i.prototype.close=function(){function e(){i.onClose("forced close"),o("socket closing - telling transport to close"),i.transport.close()}function t(){i.removeListener("upgrade",t),i.removeListener("upgradeError",t),e()}function n(){i.once("upgrade",t),i.once("upgradeError",t)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var i=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}return this},i.prototype.onError=function(e){o("socket error %j",e),i.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},i.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){o('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){n.writeBuffer=[],n.callbackBuffer=[],n.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t)}},i.prototype.filterUpgrades=function(e){for(var t=[],n=0,i=e.length;i>n;n++)~l(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(e,t,n){function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized}var a=e("engine.io-parser"),r=e("component-emitter");t.exports=i,r(i.prototype),i.timestamps=0,i.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},i.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){var t=a.decodePacket(e,this.socket.binaryType);this.onPacket(t)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(e,t,n){(function(t){function i(e){var n,i=!1,o=!1,l=!1!==e.jsonp;if(t.location){var c="https:"==location.protocol,d=location.port;d||(d=c?443:80),i=e.hostname!=location.hostname||d!=e.port,o=e.secure!=c}if(e.xdomain=i,e.xscheme=o,n=new a(e),"open"in n&&!e.forceJSONP)return new r(e);if(!l)throw new Error("JSONP disabled");return new s(e)}var a=e("xmlhttprequest"),r=e("./polling-xhr"),s=e("./polling-jsonp"),o=e("./websocket");n.polling=i,n.websocket=o}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(e,t,n){(function(n){function i(){}function a(e){r.call(this,e),this.query=this.query||{},o||(n.___eio||(n.___eio=[]),o=n.___eio),this.index=o.length;var t=this;o.push(function(e){t.onData(e)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=i)},!1)}var r=e("./polling"),s=e("component-inherit");t.exports=a;var o,l=/\n/g,c=/\\n/g;s(a,r),a.prototype.supportsBinary=!1,a.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},a.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),this.script=t;var i="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);i&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},a.prototype.doWrite=function(e,t){function n(){i(),t()}function i(){if(a.iframe)try{a.form.removeChild(a.iframe)}catch(e){a.onError("jsonp polling iframe removal error",e)}try{var t='<iframe src="javascript:0" name="'+a.iframeId+'">';r=document.createElement(t)}catch(e){r=document.createElement("iframe"),r.name=a.iframeId,r.src="javascript:0"}r.id=a.iframeId,a.form.appendChild(r),a.iframe=r}var a=this;if(!this.form){var r,s=document.createElement("form"),o=document.createElement("textarea"),d=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=d,s.method="POST",s.setAttribute("accept-charset","utf-8"),o.name="d",s.appendChild(o),document.body.appendChild(s),this.form=s,this.area=o}this.form.action=this.uri(),i(),e=e.replace(c,"\\\n"),this.area.value=e.replace(l,"\\n");try{this.form.submit()}catch(u){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==a.iframe.readyState&&n()}:this.iframe.onload=n}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":18,"component-inherit":21}],17:[function(e,t,n){(function(n){function i(){}function a(e){if(l.call(this,e),n.location){var t="https:"==location.protocol,i=location.port;i||(i=t?443:80),this.xd=e.hostname!=n.location.hostname||i!=e.port,this.xs=e.secure!=t}}function r(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.create()}function s(){for(var e in r.requests)r.requests.hasOwnProperty(e)&&r.requests[e].abort()}var o=e("xmlhttprequest"),l=e("./polling"),c=e("component-emitter"),d=e("component-inherit"),u=e("debug")("engine.io-client:polling-xhr");t.exports=a,t.exports.Request=r,d(a,l),a.prototype.supportsBinary=!0,a.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,new r(e)},a.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,i=this.request({method:"POST",data:e,isBinary:n}),a=this;i.on("success",t),i.on("error",function(e){a.onError("xhr post error",e)}),this.sendXhr=i},a.prototype.doPoll=function(){u("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},c(r.prototype),r.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new o(e),i=this;try{if(u("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async),this.supportsBinary&&(t.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(a){}"withCredentials"in t&&(t.withCredentials=!0),this.hasXDR()?(t.onload=function(){i.onLoad()},t.onerror=function(){i.onError(t.responseText)}):t.onreadystatechange=function(){4==t.readyState&&(200==t.status||1223==t.status?i.onLoad():setTimeout(function(){i.onError(t.status)},0))},u("xhr data %s",this.data),t.send(this.data)}catch(a){return void setTimeout(function(){i.onError(a)},0)}n.document&&(this.index=r.requestsCount++,r.requests[this.index]=this)},r.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},r.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},r.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},r.prototype.cleanup=function(e){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=i:this.xhr.onreadystatechange=i,e)try{this.xhr.abort()}catch(t){}n.document&&delete r.requests[this.index],this.xhr=null}},r.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(n){}e="application/octet-stream"===t?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(n){this.onError(n)}null!=e&&this.onData(e)},r.prototype.hasXDR=function(){return"undefined"!=typeof n.XDomainRequest&&!this.xs&&this.enablesXDR},r.prototype.abort=function(){this.cleanup()},n.document&&(r.requestsCount=0,r.requests={},n.attachEvent?n.attachEvent("onunload",s):n.addEventListener&&n.addEventListener("beforeunload",s,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(e,t,n){function i(e){var t=e&&e.forceBase64;(!c||t)&&(this.supportsBinary=!1),a.call(this,e)}var a=e("../transport"),r=e("parseqs"),s=e("engine.io-parser"),o=e("component-inherit"),l=e("debug")("engine.io-client:polling");t.exports=i;var c=function(){var t=e("xmlhttprequest"),n=new t({xdomain:!1});return null!=n.responseType}();o(i,a),i.prototype.name="polling",i.prototype.doOpen=function(){this.poll()},i.prototype.pause=function(e){function t(){l("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var i=0;this.polling&&(l("we are currently polling - waiting to pause"),i++,this.once("pollComplete",function(){l("pre-pause polling complete"),--i||t()})),this.writable||(l("we are currently writing - waiting to pause"),i++,this.once("drain",function(){l("pre-pause writing complete"),--i||t()}))}else t()},i.prototype.poll=function(){l("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},i.prototype.onData=function(e){var t=this;l("polling got data %s",e);var n=function(e,n,i){return"opening"==t.readyState&&t.onOpen(),"close"==e.type?(t.onClose(),!1):void t.onPacket(e)};s.decodePayload(e,this.socket.binaryType,n),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():l('ignoring poll - transport state "%s"',this.readyState))},i.prototype.doClose=function(){function e(){l("writing close packet"),t.write([{type:"close"}])}var t=this;"open"==this.readyState?(l("transport open - closing"),e()):(l("transport not open - deferring close"),this.once("open",e))},i.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")},t=this;s.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},i.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=+new Date+"-"+a.timestamps++),this.supportsBinary||e.sid||(e.b64=1),e=r.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(e,t,n){function i(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),a.call(this,e)}var a=e("../transport"),r=e("engine.io-parser"),s=e("parseqs"),o=e("component-inherit"),l=e("debug")("engine.io-client:websocket"),c=e("ws");t.exports=i,o(i,a),i.prototype.name="websocket",i.prototype.supportsBinary=!0,i.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=void 0,n={agent:this.agent};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.ws=new c(e,t,n),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},i.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(i.prototype.onData=function(e){var t=this;setTimeout(function(){a.prototype.onData.call(t,e)},0)}),i.prototype.write=function(e){function t(){n.writable=!0,n.emit("drain")}var n=this;this.writable=!1;for(var i=0,a=e.length;a>i;i++)r.encodePacket(e[i],this.supportsBinary,function(e){try{n.ws.send(e)}catch(t){l("websocket closed before onclose event")}});setTimeout(t,0)},i.prototype.onClose=function(){a.prototype.onClose.call(this)},i.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},i.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=+new Date),this.supportsBinary||(e.b64=1),e=s.encode(e),e.length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e},i.prototype.check=function(){return!(!c||"__initialize"in c&&this.name===i.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(e,t,n){var i=e("has-cors");t.exports=function(e){var t=e.xdomain,n=e.xscheme,a=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||i))return new XMLHttpRequest}catch(r){}try{if("undefined"!=typeof XDomainRequest&&!n&&a)return new XDomainRequest}catch(r){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(r){}}},{"has-cors":40}],21:[function(e,t,n){t.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],22:[function(e,t,n){function i(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function a(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var i="color: "+this.color;e=[e[0],i,"color: inherit"].concat(Array.prototype.slice.call(e,1));var a=0,r=0;return e[0].replace(/%[a-z%]/g,function(e){"%"!==e&&(a++,"%c"===e&&(r=a))}),e.splice(r,0,i),e}function r(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?localStorage.removeItem("debug"):localStorage.debug=e}catch(t){}}function o(){var e;try{e=localStorage.debug}catch(t){}return e}n=t.exports=e("./debug"),n.log=r,n.formatArgs=a,n.save=s,n.load=o,n.useColors=i,n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(o())},{"./debug":23}],23:[function(e,t,n){function i(){return n.colors[d++%n.colors.length]}function a(e){function t(){}function a(){var e=a,t=+new Date,r=t-(c||t);e.diff=r,e.prev=c,e.curr=t,c=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=i());var s=Array.prototype.slice.call(arguments);s[0]=n.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var o=0;s[0]=s[0].replace(/%([a-z%])/g,function(t,i){if("%"===t)return t;o++;var a=n.formatters[i];if("function"==typeof a){var r=s[o];t=a.call(e,r),s.splice(o,1),o--}return t}),"function"==typeof n.formatArgs&&(s=n.formatArgs.apply(e,s));var l=a.log||n.log||console.log.bind(console);l.apply(e,s)}t.enabled=!1,a.enabled=!0;var r=n.enabled(e)?a:t;return r.namespace=e,r}function r(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),i=t.length,a=0;i>a;a++)t[a]&&(e=t[a].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function s(){n.enable("")}function o(e){var t,i;for(t=0,i=n.skips.length;i>t;t++)if(n.skips[t].test(e))return!1;for(t=0,i=n.names.length;i>t;t++)if(n.names[t].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}n=t.exports=a,n.coerce=l,n.disable=s,n.enable=r,n.enabled=o,n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var c,d=0},{ms:24}],24:[function(e,t,n){function i(e){var t=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"y":return n*u;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*c;case"minutes":case"minute":case"m":return n*l;case"seconds":case"second":case"s":return n*o;case"ms":return n}}}function a(e){return e>=d?Math.round(e/d)+"d":e>=c?Math.round(e/c)+"h":e>=l?Math.round(e/l)+"m":e>=o?Math.round(e/o)+"s":e+"ms"}function r(e){return s(e,d,"day")||s(e,c,"hour")||s(e,l,"minute")||s(e,o,"second")||e+" ms"}function s(e,t,n){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var o=1e3,l=60*o,c=60*l,d=24*c,u=365.25*d;t.exports=function(e,t){return t=t||{},"string"==typeof e?i(e):t["long"]?r(e):a(e)}},{}],25:[function(e,t,n){(function(t){function i(e,t){var i="b"+n.packets[e.type]+e.data.data;return t(i)}function a(e,t,i){if(!t)return n.encodeBase64Packet(e,i);var a=e.data,r=new Uint8Array(a),s=new Uint8Array(1+a.byteLength);s[0]=v[e.type];for(var o=0;o<r.length;o++)s[o+1]=r[o];return i(s.buffer)}function r(e,t,i){if(!t)return n.encodeBase64Packet(e,i);var a=new FileReader;return a.onload=function(){e.data=a.result,n.encodePacket(e,t,!0,i)},a.readAsArrayBuffer(e.data)}function s(e,t,i){if(!t)return n.encodeBase64Packet(e,i);if(g)return r(e,t,i);var a=new Uint8Array(1);a[0]=v[e.type];var s=new b([a.buffer,e.data]);return i(s)}function o(e,t,n){for(var i=new Array(e.length),a=p(e.length,n),r=function(e,n,a){t(n,function(t,n){i[e]=n,a(t,i)})},s=0;s<e.length;s++)r(s,e[s],a)}var l=e("./keys"),c=e("has-binary"),d=e("arraybuffer.slice"),u=e("base64-arraybuffer"),p=e("after"),h=e("utf8"),f=navigator.userAgent.match(/Android/i),m=/PhantomJS/i.test(navigator.userAgent),g=f||m;n.protocol=3;var v=n.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},_=l(v),y={type:"error",data:"parser error"},b=e("blob");n.encodePacket=function(e,n,r,o){"function"==typeof n&&(o=n,n=!1),"function"==typeof r&&(o=r,r=null);var l=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&l instanceof ArrayBuffer)return a(e,n,o);if(b&&l instanceof t.Blob)return s(e,n,o);if(l&&l.base64)return i(e,o);var c=v[e.type];return void 0!==e.data&&(c+=r?h.encode(String(e.data)):String(e.data)),o(""+c)},n.encodeBase64Packet=function(e,i){var a="b"+n.packets[e.type];if(b&&e.data instanceof b){var r=new FileReader;return r.onload=function(){var e=r.result.split(",")[1];i(a+e)},r.readAsDataURL(e.data)}var s;try{s=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(o){for(var l=new Uint8Array(e.data),c=new Array(l.length),d=0;d<l.length;d++)c[d]=l[d];s=String.fromCharCode.apply(null,c)}return a+=t.btoa(s),i(a)},n.decodePacket=function(e,t,i){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return n.decodeBase64Packet(e.substr(1),t);if(i)try{e=h.decode(e)}catch(a){return y}var r=e.charAt(0);return Number(r)==r&&_[r]?e.length>1?{type:_[r],data:e.substring(1)}:{type:_[r]}:y}var s=new Uint8Array(e),r=s[0],o=d(e,1);return b&&"blob"===t&&(o=new b([o])),{type:_[r],data:o}},n.decodeBase64Packet=function(e,n){var i=_[e.charAt(0)];if(!t.ArrayBuffer)return{type:i,data:{base64:!0,data:e.substr(1)}};var a=u.decode(e.substr(1));return"blob"===n&&b&&(a=new b([a])),{type:i,data:a}},n.encodePayload=function(e,t,i){function a(e){return e.length+":"+e}function r(e,i){n.encodePacket(e,s?t:!1,!0,function(e){i(null,a(e))})}"function"==typeof t&&(i=t,t=null);var s=c(e);return t&&s?b&&!g?n.encodePayloadAsBlob(e,i):n.encodePayloadAsArrayBuffer(e,i):e.length?void o(e,r,function(e,t){return i(t.join(""))}):i("0:")},n.decodePayload=function(e,t,i){if("string"!=typeof e)return n.decodePayloadAsBinary(e,t,i);"function"==typeof t&&(i=t,t=null);var a;if(""==e)return i(y,0,1);for(var r,s,o="",l=0,c=e.length;c>l;l++){var d=e.charAt(l);if(":"!=d)o+=d;else{if(""==o||o!=(r=Number(o)))return i(y,0,1);if(s=e.substr(l+1,r),o!=s.length)return i(y,0,1);if(s.length){if(a=n.decodePacket(s,t,!0),y.type==a.type&&y.data==a.data)return i(y,0,1);var u=i(a,l+r,c);if(!1===u)return}l+=r,o=""}}return""!=o?i(y,0,1):void 0},n.encodePayloadAsArrayBuffer=function(e,t){function i(e,t){n.encodePacket(e,!0,!0,function(e){return t(null,e)})}return e.length?void o(e,i,function(e,n){var i=n.reduce(function(e,t){var n;return n="string"==typeof t?t.length:t.byteLength,e+n.toString().length+n+2},0),a=new Uint8Array(i),r=0;return n.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var i=new Uint8Array(e.length),s=0;s<e.length;s++)i[s]=e.charCodeAt(s);n=i.buffer}t?a[r++]=0:a[r++]=1;for(var o=n.byteLength.toString(),s=0;s<o.length;s++)a[r++]=parseInt(o[s]);a[r++]=255;for(var i=new Uint8Array(n),s=0;s<i.length;s++)a[r++]=i[s]}),t(a.buffer)}):t(new ArrayBuffer(0))},n.encodePayloadAsBlob=function(e,t){function i(e,t){n.encodePacket(e,!0,!0,function(e){var n=new Uint8Array(1);if(n[0]=1,"string"==typeof e){for(var i=new Uint8Array(e.length),a=0;a<e.length;a++)i[a]=e.charCodeAt(a);e=i.buffer,n[0]=0}for(var r=e instanceof ArrayBuffer?e.byteLength:e.size,s=r.toString(),o=new Uint8Array(s.length+1),a=0;a<s.length;a++)o[a]=parseInt(s[a]);if(o[s.length]=255,b){var l=new b([n.buffer,o.buffer,e]);t(null,l)}})}o(e,i,function(e,n){return t(new b(n))})},n.decodePayloadAsBinary=function(e,t,i){"function"==typeof t&&(i=t,t=null);for(var a=e,r=[],s=!1;a.byteLength>0;){for(var o=new Uint8Array(a),l=0===o[0],c="",u=1;255!=o[u];u++){if(c.length>310){s=!0;break}c+=o[u]}if(s)return i(y,0,1);a=d(a,2+c.length),c=parseInt(c);var p=d(a,0,c);if(l)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(h){var f=new Uint8Array(p);p="";for(var u=0;u<f.length;u++)p+=String.fromCharCode(f[u])}r.push(p),a=d(a,c)}var m=r.length;r.forEach(function(e,a){i(n.decodePacket(e,t,!0),a,m)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(e,t,n){t.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var i in e)n.call(e,i)&&t.push(i);return t}},{}],27:[function(e,t,n){function i(e,t,n){function i(e,a){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(r=!0,t(e),t=n):0!==i.count||r||t(null,a)}var r=!1;return n=n||a,i.count=e,0===e?t():i}function a(){}t.exports=i},{}],28:[function(e,t,n){t.exports=function(e,t,n){var i=e.byteLength;if(t=t||0,n=n||i,e.slice)return e.slice(t,n);if(0>t&&(t+=i),0>n&&(n+=i),n>i&&(n=i),t>=i||t>=n||0===i)return new ArrayBuffer(0);for(var a=new Uint8Array(e),r=new Uint8Array(n-t),s=t,o=0;n>s;s++,o++)r[o]=a[s];return r.buffer}},{}],29:[function(e,t,n){!function(e){"use strict";n.encode=function(t){var n,i=new Uint8Array(t),a=i.length,r="";for(n=0;a>n;n+=3)r+=e[i[n]>>2],r+=e[(3&i[n])<<4|i[n+1]>>4],r+=e[(15&i[n+1])<<2|i[n+2]>>6],r+=e[63&i[n+2]];return a%3===2?r=r.substring(0,r.length-1)+"=":a%3===1&&(r=r.substring(0,r.length-2)+"=="),r},n.decode=function(t){var n,i,a,r,s,o=.75*t.length,l=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var d=new ArrayBuffer(o),u=new Uint8Array(d);for(n=0;l>n;n+=4)i=e.indexOf(t[n]),a=e.indexOf(t[n+1]),r=e.indexOf(t[n+2]),s=e.indexOf(t[n+3]),u[c++]=i<<2|a>>4,u[c++]=(15&a)<<4|r>>2,u[c++]=(3&r)<<6|63&s;return d}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(e,t,n){(function(e){function n(e,t){t=t||{};for(var n=new i,a=0;a<e.length;a++)n.append(e[a]);return t.type?n.getBlob(t.type):n.getBlob()}var i=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,a=function(){try{var e=new Blob(["hi"]);return 2==e.size}catch(t){return!1}}(),r=i&&i.prototype.append&&i.prototype.getBlob;t.exports=function(){return a?e.Blob:r?n:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(e,t,n){(function(n){function i(e){function t(e){if(!e)return!1;if(n.Buffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File)return!0;if(a(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==typeof e){e.toJSON&&(e=e.toJSON());for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return!0}return!1}return t(e)}var a=e("isarray");t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:32}],32:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],33:[function(t,n,i){(function(t){!function(a){function r(e){for(var t,n,i=[],a=0,r=e.length;r>a;)t=e.charCodeAt(a++),t>=55296&&56319>=t&&r>a?(n=e.charCodeAt(a++),56320==(64512&n)?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),a--)):i.push(t);return i}function s(e){for(var t,n=e.length,i=-1,a="";++i<n;)t=e[i],t>65535&&(t-=65536,a+=y(t>>>10&1023|55296),t=56320|1023&t),a+=y(t);return a}function o(e,t){return y(e>>t&63|128)}function l(e){if(0==(4294967168&e))return y(e);var t="";return 0==(4294965248&e)?t=y(e>>6&31|192):0==(4294901760&e)?(t=y(e>>12&15|224),t+=o(e,6)):0==(4292870144&e)&&(t=y(e>>18&7|240),t+=o(e,12),t+=o(e,6)),t+=y(63&e|128)}function c(e){for(var t,n=r(e),i=n.length,a=-1,s="";++a<i;)t=n[a],s+=l(t);return s}function d(){if(_>=v)throw Error("Invalid byte index");var e=255&g[_];if(_++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function u(){var e,t,n,i,a;if(_>v)throw Error("Invalid byte index");if(_==v)return!1;if(e=255&g[_],_++,0==(128&e))return e;if(192==(224&e)){var t=d();if(a=(31&e)<<6|t,a>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&e)){if(t=d(),n=d(),a=(15&e)<<12|t<<6|n,a>=2048)return a;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=d(),n=d(),i=d(),a=(15&e)<<18|t<<12|n<<6|i,a>=65536&&1114111>=a))return a;throw Error("Invalid UTF-8 detected")}function p(e){g=r(e),v=g.length,_=0;for(var t,n=[];(t=u())!==!1;)n.push(t);return s(n)}var h="object"==typeof i&&i,f="object"==typeof n&&n&&n.exports==h&&n,m="object"==typeof t&&t;(m.global===m||m.window===m)&&(a=m);var g,v,_,y=String.fromCharCode,b={version:"2.0.0",encode:c,decode:p};if("function"==typeof e&&"object"==typeof e.amd&&e.amd)e(function(){return b});else if(h&&!h.nodeType)if(f)f.exports=b;else{var w={},M=w.hasOwnProperty;for(var T in b)M.call(b,T)&&(h[T]=b[T])}else a.utf8=b}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(e,t,n){(function(e){var n=/^[\],:{}\s]*$/,i=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,a=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g,s=/^\s+/,o=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(s,"").replace(o,""),e.JSON&&JSON.parse?JSON.parse(t):n.test(t.replace(i,"@").replace(a,"]").replace(r,""))?new Function("return "+t)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(e,t,n){n.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},n.decode=function(e){for(var t={},n=e.split("&"),i=0,a=n.length;a>i;i++){var r=n[i].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}},{}],36:[function(e,t,n){var i=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,a=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];
t.exports=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var s=i.exec(e||""),o={},l=14;l--;)o[a[l]]=s[l]||"";return-1!=n&&-1!=r&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o}},{}],37:[function(e,t,n){function i(e,t,n){var i;return i=t?new r(e,t):new r(e)}var a=function(){return this}(),r=a.WebSocket||a.MozWebSocket;t.exports=r?i:null,r&&(i.prototype=r.prototype)},{}],38:[function(e,t,n){(function(n){function i(e){function t(e){if(!e)return!1;if(n.Buffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File)return!0;if(a(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==typeof e){e.toJSON&&(e=e.toJSON());for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return!0}return!1}return t(e)}var a=e("isarray");t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:39}],39:[function(e,t,n){t.exports=e(32)},{}],40:[function(e,t,n){var i=e("global");try{t.exports="XMLHttpRequest"in i&&"withCredentials"in new i.XMLHttpRequest}catch(a){t.exports=!1}},{global:41}],41:[function(e,t,n){t.exports=function(){return this}()},{}],42:[function(e,t,n){var i=[].indexOf;t.exports=function(e,t){if(i)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},{}],43:[function(e,t,n){var i=Object.prototype.hasOwnProperty;n.keys=Object.keys||function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t},n.values=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(e[n]);return t},n.merge=function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);return e},n.length=function(e){return n.keys(e).length},n.isEmpty=function(e){return 0==n.length(e)}},{}],44:[function(e,t,n){var i=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,a=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){for(var t=i.exec(e||""),n={},r=14;r--;)n[a[r]]=t[r]||"";return n}},{}],45:[function(e,t,n){(function(t){var i=e("isarray"),a=e("./is-buffer");n.deconstructPacket=function(e){function t(e){if(!e)return e;if(a(e)){var r={_placeholder:!0,num:n.length};return n.push(e),r}if(i(e)){for(var s=new Array(e.length),o=0;o<e.length;o++)s[o]=t(e[o]);return s}if("object"==typeof e&&!(e instanceof Date)){var s={};for(var l in e)s[l]=t(e[l]);return s}return e}var n=[],r=e.data,s=e;return s.data=t(r),s.attachments=n.length,{packet:s,buffers:n}},n.reconstructPacket=function(e,t){function n(e){if(e&&e._placeholder){var a=t[e.num];return a}if(i(e)){for(var r=0;r<e.length;r++)e[r]=n(e[r]);return e}if(e&&"object"==typeof e){for(var s in e)e[s]=n(e[s]);return e}return e}return e.data=n(e.data),e.attachments=void 0,e},n.removeBlobs=function(e,n){function r(e,l,c){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){s++;var d=new FileReader;d.onload=function(){c?c[l]=this.result:o=this.result,--s||n(o)},d.readAsArrayBuffer(e)}else if(i(e))for(var u=0;u<e.length;u++)r(e[u],u,e);else if(e&&"object"==typeof e&&!a(e))for(var p in e)r(e[p],p,e)}var s=0,o=e;r(o),s||n(o)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./is-buffer":47,isarray:48}],46:[function(e,t,n){function i(){}function a(e){var t="",i=!1;return t+=e.type,(n.BINARY_EVENT==e.type||n.BINARY_ACK==e.type)&&(t+=e.attachments,t+="-"),e.nsp&&"/"!=e.nsp&&(i=!0,t+=e.nsp),null!=e.id&&(i&&(t+=",",i=!1),t+=e.id),null!=e.data&&(i&&(t+=","),t+=u.stringify(e.data)),d("encoded %j as %s",e,t),t}function r(e,t){function n(e){var n=h.deconstructPacket(e),i=a(n.packet),r=n.buffers;r.unshift(i),t(r)}h.removeBlobs(e,n)}function s(){this.reconstructor=null}function o(e){var t={},i=0;if(t.type=Number(e.charAt(0)),null==n.types[t.type])return c();if(n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type){for(var a="";"-"!=e.charAt(++i)&&(a+=e.charAt(i),i!=e.length););if(a!=Number(a)||"-"!=e.charAt(i))throw new Error("Illegal attachments");t.attachments=Number(a)}if("/"==e.charAt(i+1))for(t.nsp="";++i;){var r=e.charAt(i);if(","==r)break;if(t.nsp+=r,i==e.length)break}else t.nsp="/";var s=e.charAt(i+1);if(""!==s&&Number(s)==s){for(t.id="";++i;){var r=e.charAt(i);if(null==r||Number(r)!=r){--i;break}if(t.id+=e.charAt(i),i==e.length)break}t.id=Number(t.id)}if(e.charAt(++i))try{t.data=u.parse(e.substr(i))}catch(o){return c()}return d("decoded %s as %j",e,t),t}function l(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:n.ERROR,data:"parser error"}}var d=e("debug")("socket.io-parser"),u=e("json3"),p=(e("isarray"),e("component-emitter")),h=e("./binary"),f=e("./is-buffer");n.protocol=4,n.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],n.CONNECT=0,n.DISCONNECT=1,n.EVENT=2,n.ACK=3,n.ERROR=4,n.BINARY_EVENT=5,n.BINARY_ACK=6,n.Encoder=i,n.Decoder=s,i.prototype.encode=function(e,t){if(d("encoding packet %j",e),n.BINARY_EVENT==e.type||n.BINARY_ACK==e.type)r(e,t);else{var i=a(e);t([i])}},p(s.prototype),s.prototype.add=function(e){var t;if("string"==typeof e)t=o(e),n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type?(this.reconstructor=new l(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!f(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,this.emit("decoded",t))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},l.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=h.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},l.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(e,t,n){(function(e){function n(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}t.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(e,t,n){t.exports=e(32)},{}],49:[function(t,n,i){!function(t){function n(e){if(n[e]!==s)return n[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=n("json-stringify")&&n("json-parse");else{var i,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var r=d.stringify,l="function"==typeof r&&u;if(l){(i=function(){return 1}).toJSON=i;try{l="0"===r(0)&&"0"===r(new Number)&&'""'==r(new String)&&r(o)===s&&r(s)===s&&r()===s&&"1"===r(i)&&"[1]"==r([i])&&"[null]"==r([s])&&"null"==r(null)&&"[null,null,null]"==r([s,o,null])&&r({a:[i,!0,!1,null,"\x00\b\n\f\r	"]})==a&&"1"===r(null,i)&&"[\n 1,\n 2\n]"==r([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==r(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==r(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==r(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==r(new Date(-1))}catch(c){l=!1}}t=l}if("json-parse"==e){var p=d.parse;if("function"==typeof p)try{if(0===p("0")&&!p(!1)){i=p(a);var h=5==i.a.length&&1===i.a[0];if(h){try{h=!p('"	"')}catch(c){}if(h)try{h=1!==p("01")}catch(c){}if(h)try{h=1!==p("1.")}catch(c){}}}}catch(c){h=!1}t=h}}return n[e]=!!t}var a,r,s,o={}.toString,l="function"==typeof e&&e.amd,c="object"==typeof JSON&&JSON,d="object"==typeof i&&i&&!i.nodeType&&i;d&&c?(d.stringify=c.stringify,d.parse=c.parse):d=t.JSON=c||{};var u=new Date(-0xc782b5b800cec);try{u=-109252==u.getUTCFullYear()&&0===u.getUTCMonth()&&1===u.getUTCDate()&&10==u.getUTCHours()&&37==u.getUTCMinutes()&&6==u.getUTCSeconds()&&708==u.getUTCMilliseconds()}catch(p){}if(!n("json")){var h="[object Function]",f="[object Date]",m="[object Number]",g="[object String]",v="[object Array]",_="[object Boolean]",y=n("bug-string-char-index");if(!u)var b=Math.floor,w=[0,31,59,90,120,151,181,212,243,273,304,334],M=function(e,t){return w[t]+365*(e-1970)+b((e-1969+(t=+(t>1)))/4)-b((e-1901+t)/100)+b((e-1601+t)/400)};(a={}.hasOwnProperty)||(a=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=o?a=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,a=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,a.call(this,e)});var T={"boolean":1,number:1,string:1,undefined:1},L=function(e,t){var n=typeof e[t];return"object"==n?!!e[t]:!T[n]};if(r=function(e,t){var n,i,s,l=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,i=new n;for(s in i)a.call(i,s)&&l++;return n=i=null,l?r=2==l?function(e,t){var n,i={},r=o.call(e)==h;for(n in e)r&&"prototype"==n||a.call(i,n)||!(i[n]=1)||!a.call(e,n)||t(n)}:function(e,t){var n,i,r=o.call(e)==h;for(n in e)r&&"prototype"==n||!a.call(e,n)||(i="constructor"===n)||t(n);(i||a.call(e,n="constructor"))&&t(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],r=function(e,t){var n,r,s=o.call(e)==h,l=!s&&"function"!=typeof e.constructor&&L(e,"hasOwnProperty")?e.hasOwnProperty:a;for(n in e)s&&"prototype"==n||!l.call(e,n)||t(n);for(r=i.length;n=i[--r];l.call(e,n)&&t(n));}),r(e,t)},!n("json-stringify")){var x={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},C="000000",S=function(e,t){return(C+(t||0)).slice(-e)},k="\\u00",D=function(e){var t,n='"',i=0,a=e.length,r=a>10&&y;for(r&&(t=e.split(""));a>i;i++){var s=e.charCodeAt(i);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:n+=x[s];break;default:if(32>s){n+=k+S(2,s.toString(16));break}n+=r?t[i]:y?e.charAt(i):e[i]}}return n+'"'},Y=function(e,t,n,i,l,c,d){var u,p,h,y,w,T,L,x,C,k,j,N,P,E,A,F;try{u=t[e]}catch(I){}if("object"==typeof u&&u)if(p=o.call(u),p!=f||a.call(u,"toJSON"))"function"==typeof u.toJSON&&(p!=m&&p!=g&&p!=v||a.call(u,"toJSON"))&&(u=u.toJSON(e));else if(u>-1/0&&1/0>u){if(M){for(w=b(u/864e5),h=b(w/365.2425)+1970-1;M(h+1,0)<=w;h++);for(y=b((w-M(h,0))/30.42);M(h,y+1)<=w;y++);w=1+w-M(h,y),T=(u%864e5+864e5)%864e5,L=b(T/36e5)%24,x=b(T/6e4)%60,C=b(T/1e3)%60,k=T%1e3}else h=u.getUTCFullYear(),y=u.getUTCMonth(),w=u.getUTCDate(),L=u.getUTCHours(),x=u.getUTCMinutes(),C=u.getUTCSeconds(),k=u.getUTCMilliseconds();u=(0>=h||h>=1e4?(0>h?"-":"+")+S(6,0>h?-h:h):S(4,h))+"-"+S(2,y+1)+"-"+S(2,w)+"T"+S(2,L)+":"+S(2,x)+":"+S(2,C)+"."+S(3,k)+"Z"}else u=null;if(n&&(u=n.call(t,e,u)),null===u)return"null";if(p=o.call(u),p==_)return""+u;if(p==m)return u>-1/0&&1/0>u?""+u:"null";if(p==g)return D(""+u);if("object"==typeof u){for(E=d.length;E--;)if(d[E]===u)throw TypeError();if(d.push(u),j=[],A=c,c+=l,p==v){for(P=0,E=u.length;E>P;P++)N=Y(P,u,n,i,l,c,d),j.push(N===s?"null":N);F=j.length?l?"[\n"+c+j.join(",\n"+c)+"\n"+A+"]":"["+j.join(",")+"]":"[]"}else r(i||u,function(e){var t=Y(e,u,n,i,l,c,d);t!==s&&j.push(D(e)+":"+(l?" ":"")+t)}),F=j.length?l?"{\n"+c+j.join(",\n"+c)+"\n"+A+"}":"{"+j.join(",")+"}":"{}";return d.pop(),F}};d.stringify=function(e,t,n){var i,a,r,s;if("function"==typeof t||"object"==typeof t&&t)if((s=o.call(t))==h)a=t;else if(s==v){r={};for(var l,c=0,d=t.length;d>c;l=t[c++],s=o.call(l),(s==g||s==m)&&(r[l]=1));}if(n)if((s=o.call(n))==m){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else s==g&&(i=n.length<=10?n:n.slice(0,10));return Y("",(l={},l[""]=e,l),a,r,i,"",[])}}if(!n("json-parse")){var j,N,P=String.fromCharCode,E={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},A=function(){throw j=N=null,SyntaxError()},F=function(){for(var e,t,n,i,a,r=N,s=r.length;s>j;)switch(a=r.charCodeAt(j)){case 9:case 10:case 13:case 32:j++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=y?r.charAt(j):r[j],j++,e;case 34:for(e="@",j++;s>j;)if(a=r.charCodeAt(j),32>a)A();else if(92==a)switch(a=r.charCodeAt(++j)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=E[a],j++;break;case 117:for(t=++j,n=j+4;n>j;j++)a=r.charCodeAt(j),a>=48&&57>=a||a>=97&&102>=a||a>=65&&70>=a||A();e+=P("0x"+r.slice(t,j));break;default:A()}else{if(34==a)break;for(a=r.charCodeAt(j),t=j;a>=32&&92!=a&&34!=a;)a=r.charCodeAt(++j);e+=r.slice(t,j)}if(34==r.charCodeAt(j))return j++,e;A();default:if(t=j,45==a&&(i=!0,a=r.charCodeAt(++j)),a>=48&&57>=a){for(48==a&&(a=r.charCodeAt(j+1),a>=48&&57>=a)&&A(),i=!1;s>j&&(a=r.charCodeAt(j),a>=48&&57>=a);j++);if(46==r.charCodeAt(j)){for(n=++j;s>n&&(a=r.charCodeAt(n),a>=48&&57>=a);n++);n==j&&A(),j=n}if(a=r.charCodeAt(j),101==a||69==a){for(a=r.charCodeAt(++j),(43==a||45==a)&&j++,n=j;s>n&&(a=r.charCodeAt(n),a>=48&&57>=a);n++);n==j&&A(),j=n}return+r.slice(t,j)}if(i&&A(),"true"==r.slice(j,j+4))return j+=4,!0;if("false"==r.slice(j,j+5))return j+=5,!1;if("null"==r.slice(j,j+4))return j+=4,null;A()}return"$"},I=function(e){var t,n;if("$"==e&&A(),"string"==typeof e){if("@"==(y?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=F(),"]"!=e;n||(n=!0))n&&(","==e?(e=F(),"]"==e&&A()):A()),","==e&&A(),t.push(I(e));return t}if("{"==e){for(t={};e=F(),"}"!=e;n||(n=!0))n&&(","==e?(e=F(),"}"==e&&A()):A()),(","==e||"string"!=typeof e||"@"!=(y?e.charAt(0):e[0])||":"!=F())&&A(),t[e.slice(1)]=I(F());return t}A()}return e},H=function(e,t,n){var i=Z(e,t,n);i===s?delete e[t]:e[t]=i},Z=function(e,t,n){var i,a=e[t];if("object"==typeof a&&a)if(o.call(a)==v)for(i=a.length;i--;)H(a,i,n);else r(a,function(e){H(a,e,n)});return n.call(e,t,a)};d.parse=function(e,t){var n,i;return j=0,N=""+e,n=I(F()),"$"!=F()&&A(),j=N=null,t&&o.call(t)==h?Z((i={},i[""]=n,i),"",t):n}}}l&&e(function(){return d})}(this)},{}],50:[function(e,t,n){function i(e,t){var n=[];t=t||0;for(var i=t||0;i<e.length;i++)n[i-t]=e[i];return n}t.exports=i},{}]},{},[1])(1)}),function(){define("component/wsStore",["require","exports","module","jquery","socket-io-client","module/common/globalService","../configstore"],function(e,t,n){var i=e("jquery"),a=e("socket-io-client"),r=e("module/common/globalService"),s=e("../configstore"),o=0,l={IN_MAIL:s.getConfig("user.onlineinmailpath"),IN_AUTO_FWD:s.getConfig("user.onlineinautofwdpath"),IN_AUTO_REPLY:s.getConfig("user.onlineinautoreplypath"),OUT_DS:s.getConfig("user.onlineoutdspath"),OUT_READ:s.getConfig("user.onlineoutreadpath"),MAIL_QUOTA:s.getConfig("user.onlinemailquotapath"),OFFSITE_REMIND:s.getConfig("user.onlineoffsiteremindpath"),MEETING_NEW:s.getConfig("user.onlinemeetingnewpath"),MEETING_REQUEST:s.getConfig("user.onlinemeetingrequestpath"),OTP_BIND_DEVICE:"/second_auth/$uid$/$key$/op_app_binddevice",OTP_AUTH:"/second_auth/$uid$/$tempsid$/op_app_authed_device_cert"},c={IN_MAIL_FB:1,IN_MAIL:"in_mail",IN_AUTO_FWD:"in_auto_fwd",IN_AUTO_REPLY:"in_auto_reply",OUT_DS:"out_ds",OUT_READ:"out_read",MAIL_QUOTA:"mail_quota",OFFSITE_REMIND:"offsite_remind",MEETING_NEW:"meeting_new",MEETING_REQUEST:"meeting_request",OTP_BIND_DEVICE:"op_app_binddevice",OTP_AUTH:"op_app_authed_device_cert"},d={},u=function(e){return e="string"!=typeof e?"":e,{topic:e,observers:{},subscribing:!1,unSubscribers:{}}},p=function(e){"string"==typeof e&&null!=d[e]&&delete d[e]},h={host:s.getConfig("user.onlinehost"),orgid:s.getConfig("user.orgid"),uid:s.getConfig("user.uid"),maxConnTimes:s.getConfig("user.onlinetrycount")||3,socket:null,manager:null,name:"component.wsStore",disable:!s.getConfig("user.enablepushnotify"),init:function(){this.disable?this.destroy():this._on()},_on:function(){var e={forceNew:!0,reconnection:!0,reconnectionAttempts:parseInt(this.maxConnTimes,10)},t=this.socket=a.connect(this.host,e),n=this.manager=t.io;t.on("connect",i.proxy(this._onSocketConnect,this)).on("reconnect",i.proxy(this._onSocketReconnect,this)).on("disconnect",i.proxy(this._onSocketDisconnect,this)),n.on("connect_error",i.proxy(this._onSocketConnectError,this)).on("connect_timeout",i.proxy(this._onSocketConnectTimeout,this)).on("reconnect_failed",i.proxy(this._onSocketReconnectFailed,this)).on("reconnect_error",i.proxy(this._onSocketReconnectError,this)),t.on("auth_error",i.proxy(this._onSocketAuthError,this)).on("ready",i.proxy(this._onSocketReady,this)).on("message",i.proxy(this._onSocketMessage,this))},destroy:function(){this._destroySocket(),i.each(d,function(e){p(e)})},subscribe:function(e,t,n){var a,r;return this.disable?(console.log("siosvr connect is not supported!"),null):"string"!=typeof e?(console.log("invalid topic name to subscribe"),null):i.isFunction(t)?(n="boolean"==typeof n?n:!0,n&&(e=e.replace("$org_id$",this.orgid),e=e.replace("$uid$",this.uid)),d.hasOwnProperty(e)||(d[e]=u(e)),a=d[e],r=++o+"",a.observers[r]=t,this._doSubscribeTopicToSocket(a),this._makeUnSubscribeFn(a,r)):(console.log("invalid observer function to subscribe"),null)},_makeUnSubscribeFn:function(e,t){var n,a=this;return null==e?i.noop:"string"!=typeof t?(console.log("invalid uid to unsubscribe."),i.noop):(n=function(){delete e.observers[t],delete e.unSubscribers[t],i.isEmptyObject(e.observers)&&(a._doUnSubscribeTopicToSocket(e),p(e.topic))},e.unSubscribers[t]=n,n)},_doSubscribeTopicToSocket:function(e,t){var n=e.topic;return null!=e&&i.isPlainObject(e)?"string"==typeof n&&n.length?null!=this.socket&&this._checkSocketReady()?(t="boolean"==typeof t?t:!1,void((t||!e.subscribing)&&(console.debug("socket subscribe topic: "+n),this.socket.emit("subscribe",{topic:n}),e.subscribing=!0))):!1:(console.log("invalid topic to subscribe!"),!1):(console.log("invalid observer model"),!1)},_doUnSubscribeTopicToSocket:function(e,t){var n=e.topic;return null!=e&&i.isPlainObject(e)?"string"==typeof n&&n.length?null!=this.socket&&this._checkSocketReady()?(t="boolean"==typeof t?t:!1,void((t||e.subscribing)&&(console.debug("socket unsubscribe topic: "+n),this.socket.emit("unsubscribe",{topic:n}),e.subscribing=!1))):!1:(console.log("invalid topic to unsubscribe!"),!1):(console.log("invalid observer model"),!1)},_destroySocket:function(){var e=this;i.each(d,function(t,n){e._doUnSubscribeTopicToSocket(n)}),this.socket&&this.socket.disconnect(),this.manager&&this.manager.disconnect(),this.socket=null,this.manager=null},_checkSocketReady:function(){return null==this.socket?!1:!!this.socket.connected},_triggerSocketAuth:function(){var e=r.getSid();this.socket.emit("auth",{clientId:"webmail:"+e,sid:e,username:r.getUser().email})},_onSocketConnect:function(){this._triggerSocketAuth()},_onSocketReconnect:function(){this._triggerSocketAuth()},_onSocketDisconnect:function(e){console.log("disconnect"," sio socket was disconnected. ",e)},_onSocketAuthError:function(){console.log("auth_error"," sio socket auth error. ")},_onSocketReady:function(){var e=this;console.log("ready","websocket ready"),i.each(d,function(t,n){e._doSubscribeTopicToSocket(n,!0)})},_onSocketMessage:function(e){var t,n,a,r,s,o=e.topic,l=i.parseJSON(e.payload);return console.log(e),null==l.type?(console.log("a message without type was received",o,l),!1):(l.type===c.IN_MAIL_FB?(n=c.IN_MAIL_FB,t={fid:l.fid,result:l.result}):(n=l.type,t=l.payload,a=l.id,r=l.time),s=d[o],void i.each(s.observers||[],function(e,s){i.isFunction(s)&&s({type:n,payload:t,id:a,time:r})}))},_onSocketConnectError:function(e){console.log("connect_error"," error occur when sio socket try to connect. ",e)},_onSocketConnectTimeout:function(e){console.log("reconnect_failed"," sio socket try too much reconnect attempts. ",e)},_onSocketReconnectFailed:function(){console.log("reconnect_failed"," sio socket try too much reconnect attempts. ",this.manager.reconnectionAttempts()),this._destroySocket()},_onSocketReconnectError:function(e){console.log("reconnect_error"," error occur when sio socket try to reconnect. ",e)}};n.exports={init:i.proxy(h.init,h),destroy:i.proxy(h.destroy,h),subscribe:i.proxy(h.subscribe,h),topicList:l,topicTypes:c}})}(),function(){define("widget/notification/notification",["require","exports","module","jquery","../../util/index"],function(e,t,n){function i(e){var t=(new Date).getTime();return e=null==e?"":e,["__","desktop_notification_tag_",t,"_",e,"__"].join("")}function a(){if(window.Notification&&(window.Notification.permissionLevel||window.Notification.permission))return window.Notification;var e=window.webkitNotifications;if(!e)return!1;var t=[w.GRANTED,w.DEFAULT,w.DENIED],n=function(t,i){if(i=i||{},t){var a=e.createNotification(i.iconUrl||"",t,i.body||"");return a.titleDir=i.dir||"auto",a.body=i.body||"",a.bodyDir=i.dir||"auto",a.tag=i.tag||"",a.replaceId=i.tag||"",a.iconUrl=i.iconUrl||"",a.onclick=i.onclick||h.noop,a.onshow=i.onshow||h.noop,a.onerror=i.onerror||h.noop,a.onclose=i.onclose||h.noop,a.close=function(){a.cancel()},"granted"===n.permissionLevel()&&a.show(),a}};return n.permissionLevel=function(){return n.permission=t[e.checkPermission()]},n.permissionLevel(),n.requestPermission=function(t){if(n.permissionLevel()!==w.DEFAULT)return void t();if(e.requestPermission.length)return void e.requestPermission(function(){n.permissionLevel(),t()});e.requestPermission();var i=window.setInterval(function(){var e=n.permissionLevel();e!==w.DEFAULT&&(window.clearInterval(i),t())},200)},n}function r(e){var t;return e=h.extend({},T,e),null==e.tag&&delete e.tag,t=new M(e.title,e),y.push(t._uid=++v),t.onshow=function(t){e.onShow.call(this,t)},t.onclick=function(t){e.onClick.call(this,t)},t.onclose=function(t){var n,i=this._uid;null!=this.closeTimeout&&clearTimeout(this.closeTimeout),n=h.inArray(i,y),n>=0&&y.splice(n,1),e.onClose.call(this,t),this._closed=!0,d()},t.onerror=function(t){e.onError.call(this,t)},t._meta=e._meta,e.autoClose&&(t.closeTimeout=setTimeout(function(){t.close()},e.timeout||T.timeout)),t}function s(e){return(M.permission||M.permissionLevel())!==w.DEFAULT?void e(M.permission):void M.requestPermission(function(){e(l())})}function o(){return!!M}function l(){return h.isFunction(M.permissionLevel)?M.permissionLevel():M.permission}function c(e,t){y.length<_?t(r(e)):b.push({options:e,next:t})}function d(){var e=b.shift();e&&e.next(r(e.options))}function u(e){var t=l();e=h.isFunction(e)?e:h.noop,t===w.DEFAULT?s(function(t){e(t)}):e(t)}function p(){function e(){h.notify.error(g.t("common/lbl_notification_desktop_denied"))}function t(){h.notify.success(g.t("common/lbl_notification_desktop_granted"))}u(function(n){switch(n){case w.GRANTED:t();break;case w.DENIED:e()}})}var h=e("jquery"),f=e("../../util/index"),m=f.detector,g=f.i18n,v=0,_="safari"===m.browser.name?1:3,y=[],b=[],w={DENIED:"denied",DEFAULT:"default",GRANTED:"granted"},M=a(),T={title:"",icon:"",dir:"auto",tag:null,autoClose:!0,timeout:5e3,onShow:h.noop,onClose:h.noop,onClick:h.noop,onError:h.noop,_meta:null};n.exports={checkAvailable:o,create:r,createThreshold:c,shiftUnCreateQueue:d,requestPermission:s,permission:M.permission,permissionLevel:l(),genTag:i,permissionTypes:w,checkPermission:u,initPermission:p}})}(),function(){define("util/visibly",[],function(){var e={q:document,p:void 0,prefixes:["webkit","ms","o","moz","khtml"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],genericCallbacks:[],_callbacks:[],cachedPrefix:"",fn:null,onVisible:function(e){"function"==typeof e&&this.visibleCallbacks.push(e)},onHidden:function(e){"function"==typeof e&&this.hiddenCallbacks.push(e)},getPrefix:function(){if(!this.cachedPrefix)for(var e,t=0;e=this.prefixes[t++];)if(e+this.props[2]in this.q)return this.cachedPrefix=e,this.cachedPrefix},visibilityState:function(){return this._getProp(0)},hidden:function(){return this._getProp(2)},visibilitychange:function(e){"function"==typeof e&&this.genericCallbacks.push(e);var t=this.genericCallbacks.length;if(t)if(this.cachedPrefix)for(;t--;)this.genericCallbacks[t].call(this,this.visibilityState());else for(;t--;)this.genericCallbacks[t].call(this,arguments[0])},isSupported:function(){return this._getPropName(2)in this.q},_getPropName:function(e){return""==this.cachedPrefix?this.props[e].substring(0,1).toLowerCase()+this.props[e].substring(1):this.cachedPrefix+this.props[e]},_getProp:function(e){return this.q[this._getPropName(e)]},_execute:function(e){if(e){this._callbacks=1==e?this.visibleCallbacks:this.hiddenCallbacks;for(var t=this._callbacks.length;t--;)this._callbacks[t]()}},_visible:function(){e._execute(1),e.visibilitychange.call(e,"visible")},_hidden:function(){e._execute(2),e.visibilitychange.call(e,"hidden")},_nativeSwitch:function(){this[this._getProp(2)?"_hidden":"_visible"]()},_listen:function(){try{this.isSupported()?this.q.addEventListener(this._getPropName(1),function(){e._nativeSwitch.apply(e,arguments)},1):this.q.addEventListener?(window.addEventListener(this.m[0],this._visible,1),window.addEventListener(this.m[1],this._hidden,1)):this.q.attachEvent&&(this.q.attachEvent("onfocusin",this._visible),this.q.attachEvent("onfocusout",function(e){return function(){null!=event&&null==event.toElement&&e()}}(this._hidden)))}catch(t){}},init:function(){this.getPrefix(),this._listen()}};return e.init(),e})}(),define("components/requirejs-text/text",["module"],function(e){"use strict";var t,n,i,a,r,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),u=c&&location.hostname,p=c&&(location.port||void 0),h={},f=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(i){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,i,a=!1,r=e.lastIndexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==r&&(!s||r>1)?(t=e.substring(0,r),n=e.substring(r+1)):t=e,i=n||t,r=i.indexOf("!"),-1!==r&&(a="strip"===i.substring(r+1),i=i.substring(0,r),n?n=i:t=i),{moduleName:t,ext:n,strip:a}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,a){var r,s,o,l=t.xdRegExp.exec(e);return l?(r=l[2],s=l[3],s=s.split(":"),o=s[1],s=s[0],!(r&&r!==n||s&&s.toLowerCase()!==i.toLowerCase()||(o||s)&&o!==a)):!0},finishLoad:function(e,n,i,a){i=n?t.strip(i):i,f.isBuild&&(h[e]=i),a(i)},load:function(e,n,i,a){if(a&&a.isBuild&&!a.inlineText)return void i();f.isBuild=a&&a.isBuild;var r=t.parseName(e),s=r.moduleName+(r.ext?"."+r.ext:""),o=n.toUrl(s),l=f.useXhr||t.useXhr;return 0===o.indexOf("empty:")?void i():void(!c||l(o,d,u,p)?t.get(o,function(n){t.finishLoad(e,r.strip,n,i)},function(e){i.error&&i.error(e)}):n([s],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,i)}))},write:function(e,n,i,a){if(h.hasOwnProperty(n)){var r=t.jsEscape(h[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,a,r){var s=t.parseName(n),o=s.ext?"."+s.ext:"",l=s.moduleName+o,c=i.toUrl(s.moduleName+o)+".js";t.load(l,i,function(n){var i=function(e){return a(c,e)};i.asModule=function(e,t){return a.asModule(e,c,t)},t.write(e,l,i,r)},r)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var a=n.readFileSync(e,"utf8");"\ufeff"===a[0]&&(a=a.substring(1)),t(a)}catch(r){i&&i(r)}}):"xhr"===f.env||!f.env&&t.createXhr()?t.get=function(e,n,i,a){var r,s=t.createXhr();if(s.open("GET",e,!0),a)for(r in a)a.hasOwnProperty(r)&&s.setRequestHeader(r.toLowerCase(),a[r]);f.onXhr&&f.onXhr(s,e),s.onreadystatechange=function(t){var a,r;4===s.readyState&&(a=s.status||0,a>399&&600>a?(r=new Error(e+" HTTP status: "+a),r.xhr=s,i&&i(r)):n(s.responseText),f.onXhrComplete&&f.onXhrComplete(s,e))},s.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,a="utf-8",r=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),a)),l="";try{for(n=new java.lang.StringBuffer,i=o.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=o.readLine());)n.append(s),n.append(i);l=String(n.toString())}finally{o.close()}t(l)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,a=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,s,o,l={};r&&(e=e.replace(/\//g,"\\")),o=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(a.nsIFileInputStream),n.init(o,1,0,!1),s=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(a.nsIConverterInputStream),s.init(n,"utf-8",n.available(),a.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),l),s.close(),n.close(),t(l.value)}catch(c){throw new Error((o&&o.path||"")+": "+c)}}),t}),define("components/requirejs-text/text!template/component/notificationOnline.tpl.html",[],function(){return'<div class="c-notification-online">\r\n  <div class="c-notification-header j-header" data-role="title">\r\n    <p class="c-notification-title">\r\n      <i class="dot"></i>\r\n      <span class="text j-title"></span>\r\n    </p>\r\n    <div class="c-notification-title-action">\r\n      <div class="notification-page j-page-wrap">\r\n        <a class="prev j-action j-page-prev" data-action="prev"><i class="iconfont iconleft"></i></a>\r\n        <span class="info j-page-info"></span>\r\n        <a class="next j-action j-page-next" data-action="next"><i class="iconfont iconright"></i></a>\r\n      </div>\r\n      <a href="javascript:void(0);" class="clean j-action" data-action="clean"><i class="iconfont icontabclose"></i> </a>\r\n    </div>\r\n  </div>\r\n  <div class="c-notification-content j-content" data-role="content">{{{content}}}</div>\r\n  <div class="c-notification-footer j-footer" data-role="foot">\r\n    <div class="f-fr">\r\n      <button class="u-btn u-btn-primary j-action" data-action="detail" data-role="detail">\r\n        {{i18n "common/lbl_notification_detail_tip"}}\r\n      </button>\r\n      <button class="u-btn u-btn-primary j-action" data-action="close" data-role="close">\r\n        {{i18n "common/confirm"}}\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n</div>'}),function e(t,n,i){function a(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return a(n?n:e)},d,d.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,n){function i(e,t,n){}function a(e,t,n){}function r(e,t,n){}function s(e,t,n){}function o(e){return e.replace(w,"&lt;").replace(M,"&gt;")}function l(e,t,n){if(n=f(n),"href"===t||"src"===t){if(n=n.trim(),"#"===n)return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"/"!==n[0])return""}else if("background"===t){if(D.lastIndex=0,D.test(n))return""}else if("style"===t){if(k.lastIndex=0,k.test(n))return"";if(Y.lastIndex=0,Y.test(n))return"";if(j.lastIndex=0,j.test(n)&&(D.lastIndex=0,
D.test(n)))return""}return n=m(n)}function c(e){return e.replace(T,"&quot;")}function d(e){return e.replace(L,'"')}function u(e){return e.replace(x,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})}function p(e){return e.replace(C,":").replace(S," ")}function h(e){for(var t="",n=0,i=e.length;i>n;n++)t+=e.charCodeAt(n)<32?" ":e.charAt(n);return t.trim()}function f(e){return e=d(e),e=u(e),e=p(e),e=h(e)}function m(e){return e=c(e),e=o(e)}function g(){return""}function v(e,t){function n(t){return i?!0:-1!==e.indexOf(t)}"function"!=typeof t&&(t=function(){});var i=!Array.isArray(e),a=[],r=!1;return{onIgnoreTag:function(e,i,s){if(n(e)){if(s.isClosing){var o="[/removed]",l=s.position+o.length;return a.push([r!==!1?r:s.position,l]),r=!1,o}return r||(r=s.position),"[removed]"}return t(e,i,s)},remove:function(e){var t="",n=0;return a.forEach(function(i){t+=e.slice(n,i[0]),n=i[1]}),t+=e.slice(n)}}}function _(e){return e.replace(N,"")}function y(e){var t=e.split("");return t=t.filter(function(e){var t=e.charCodeAt(0);return 127===t?!1:31>=t?10===t||13===t?!0:!1:!0}),t.join("")}var b={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","colspan","align","valign"],tfoot:["align","valign"],th:["width","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]},w=/</g,M=/>/g,T=/"/g,L=/&quot;/g,x=/&#([a-zA-Z0-9]*);?/gim,C=/&colon;?/gim,S=/&newline;?/gim,k=/\/\*|\*\//gm,D=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,Y=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,j=/u\s*r\s*l\s*\(.*/gi,N=/<!--[\s\S]*?-->/g;n.whiteList=b,n.onTag=i,n.onIgnoreTag=a,n.onTagAttr=r,n.onIgnoreTagAttr=s,n.safeAttrValue=l,n.escapeHtml=o,n.escapeQuote=c,n.unescapeQuote=d,n.escapeHtmlEntities=u,n.escapeDangerHtml5Entities=p,n.clearNonPrintableCharacter=h,n.friendlyAttrValue=f,n.escapeAttrValue=m,n.onIgnoreTagStripAll=g,n.StripTagBody=v,n.stripCommentTag=_,n.stripBlankChar=y},{}],2:[function(e,t,n){function i(e,t){var n=new s(t);return n.process(e)}var a=e("./default"),r=e("./parser"),s=e("./xss");n=t.exports=i,n.FilterXSS=s;for(var o in a)n[o]=a[o];for(var o in r)n[o]=r[o];Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")}),"function"==typeof define&&define.amd&&define("components/xss/dist/xss",[],function(){return t.exports}),"undefined"!=typeof window&&(window.filterXSS=t.exports)},{"./default":1,"./parser":3,"./xss":4}],3:[function(e,t,n){function i(e){var t=e.indexOf(" ");if(-1===t)var n=e.slice(1,-1);else var n=e.slice(1,t+1);return n=n.trim().toLowerCase(),"/"===n[0]&&(n=n.slice(1)),"/"===n[n.length-1]&&(n=n.slice(0,-1)),n}function a(e){return"</"===e.slice(0,2)}function r(e,t,n){"user strict";var r="",s=0,o=!1,l=!1,c=0,d=e.length,u="",p="";for(c=0;d>c;c++){var h=e.charAt(c);if(o===!1){if("<"===h){o=c;continue}}else if(l===!1){if("<"===h){r+=n(e.slice(s,c)),o=c,s=c;continue}if(">"===h){r+=n(e.slice(s,o)),u=e.slice(o,c+1),p=i(u),r+=t(o,r.length,p,u,a(u)),s=c+1,o=!1;continue}if('"'===h||"'"===h){l=h;continue}}else if(h===l){l=!1;continue}}return s<e.length&&(r+=n(e.substr(s))),r}function s(e,t){"user strict";function n(e,n){e=e.trim(),e=e.replace(o,"").toLowerCase(),e.length<1||a.push(t(e,n||""))}for(var i=0,a=[],r=!1,s=e.length,l=0;s>l;l++){var c,d=e.charAt(l);if(r!==!1||"="!==d)if(r===!1||l!==i||'"'!==d&&"'"!==d)" "!==d||(c=e.slice(i,l).trim(),r===!1?n(c):n(r,c),r=!1,i=l+1);else{var u=e.indexOf(d,l+1);if(-1===u)break;c=e.slice(i+1,u).trim(),n(r,c),r=!1,l=u,i=l+1}else r=e.slice(i,l),i=l+1}return i<e.length&&(r===!1?n(e.slice(i)):n(r,e.slice(i))),a.join(" ").trim()}var o=/[^a-zA-Z0-9_:\.\-]/gim;n.parseTag=r,n.parseAttr=s},{}],4:[function(e,t,n){function i(e){return void 0===e||null===e}function a(e){var t=e.indexOf(" ");if(-1===t)return{html:"",closing:"/"===e[e.length-2]};e=e.slice(t+1,-1).trim();var n="/"===e[e.length-1];return n&&(e=e.slice(0,-1).trim()),{html:e,closing:n}}function r(e){e=e||{},e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=s.onIgnoreTagStripAll),e.whiteList=e.whiteList||s.whiteList,e.onTag=e.onTag||s.onTag,e.onTagAttr=e.onTagAttr||s.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||s.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||s.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||s.safeAttrValue,e.escapeHtml=e.escapeHtml||s.escapeHtml,this.options=e}var s=e("./default"),o=e("./parser"),l=o.parseTag,c=o.parseAttr;r.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,n=t.options,r=n.whiteList,o=n.onTag,d=n.onIgnoreTag,u=n.onTagAttr,p=n.onIgnoreTagAttr,h=n.safeAttrValue,f=n.escapeHtml;if(n.stripBlankChar&&(e=s.stripBlankChar(e)),n.allowCommentTag||(e=s.stripCommentTag(e)),n.stripIgnoreTagBody){var m=s.StripTagBody(n.stripIgnoreTagBody,d);d=m.onIgnoreTag}else m=!1;var g=l(e,function(e,t,n,s,l){var m={sourcePosition:e,position:t,isClosing:l,isWhite:n in r},g=o(n,s,m);if(!i(g))return g;if(m.isWhite){if(m.isClosing)return"</"+n+">";var v=a(s),_=r[n],y=c(v.html,function(e,t){var a=-1!==_.indexOf(e),r=u(n,e,t,a);if(!i(r))return r;if(a)return t=h(n,e,t),t?e+'="'+t+'"':e;var r=p(n,e,t,a);return i(r)?void 0:r}),s="<"+n;return y&&(s+=" "+y),v.closing&&(s+=" /"),s+=">"}var g=d(n,s,m);return i(g)?f(s):g},f);return m&&(g=m.remove(g)),g},t.exports=r},{"./default":1,"./parser":3}]},{},[2]),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("components/moment/min/moment-with-locales",t):e.moment=t()}(this,function(){"use strict";function e(){return Pi.apply(null,arguments)}function t(e){Pi=e}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function a(e,t){var n,i=[];for(n=0;n<e.length;++n)i.push(t(e[n],n));return i}function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function s(e,t){for(var n in t)r(t,n)&&(e[n]=t[n]);return r(t,"toString")&&(e.toString=t.toString),r(t,"valueOf")&&(e.valueOf=t.valueOf),e}function o(e,t,n,i){return xe(e,t,n,i,!0).utc()}function l(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function c(e){return null==e._pf&&(e._pf=l()),e._pf}function d(e){if(null==e._isValid){var t=c(e);e._isValid=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour)}return e._isValid}function u(e){var t=o(NaN);return null!=e?s(c(t),e):c(t).userInvalidated=!0,t}function p(e,t){var n,i,a;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=c(t)),"undefined"!=typeof t._locale&&(e._locale=t._locale),Ai.length>0)for(n in Ai)i=Ai[n],a=t[i],"undefined"!=typeof a&&(e[i]=a);return e}function h(t){p(this,t),this._d=new Date(+t._d),Fi===!1&&(Fi=!0,e.updateOffset(this),Fi=!1)}function f(e){return e instanceof h||null!=e&&null!=e._isAMomentObject}function m(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function g(e,t,n){var i,a=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),s=0;for(i=0;a>i;i++)(n&&e[i]!==t[i]||!n&&m(e[i])!==m(t[i]))&&s++;return s+r}function v(){}function _(e){return e?e.toLowerCase().replace("_","-"):e}function y(e){for(var t,n,i,a,r=0;r<e.length;){for(a=_(e[r]).split("-"),t=a.length,n=_(e[r+1]),n=n?n.split("-"):null;t>0;){if(i=b(a.slice(0,t).join("-")))return i;if(n&&n.length>=t&&g(a,n,!0)>=t-1)break;t--}r++}return null}function b(e){var t=null;if(!Ii[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=Ei._abbr,require("./locale/"+e),w(t)}catch(n){}return Ii[e]}function w(e,t){var n;return e&&(n="undefined"==typeof t?T(e):M(e,t),n&&(Ei=n)),Ei._abbr}function M(e,t){return null!==t?(t.abbr=e,Ii[e]||(Ii[e]=new v),Ii[e].set(t),w(e),Ii[e]):(delete Ii[e],null)}function T(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Ei;if(!n(e)){if(t=b(e))return t;e=[e]}return y(e)}function L(e,t){var n=e.toLowerCase();Hi[n]=Hi[n+"s"]=Hi[t]=e}function x(e){return"string"==typeof e?Hi[e]||Hi[e.toLowerCase()]:void 0}function C(e){var t,n,i={};for(n in e)r(e,n)&&(t=x(n),t&&(i[t]=e[n]));return i}function S(t,n){return function(i){return null!=i?(D(this,t,i),e.updateOffset(this,n),this):k(this,t)}}function k(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function D(e,t,n){return e._d["set"+(e._isUTC?"UTC":"")+t](n)}function Y(e,t){var n;if("object"==typeof e)for(n in e)this.set(n,e[n]);else if(e=x(e),"function"==typeof this[e])return this[e](t);return this}function j(e,t,n){for(var i=""+Math.abs(e),a=e>=0;i.length<t;)i="0"+i;return(a?n?"+":"":"-")+i}function N(e,t,n,i){var a=i;"string"==typeof i&&(a=function(){return this[i]()}),e&&(Xi[e]=a),t&&(Xi[t[0]]=function(){return j(a.apply(this,arguments),t[1],t[2])}),n&&(Xi[n]=function(){return this.localeData().ordinal(a.apply(this,arguments),e)})}function P(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function E(e){var t,n,i=e.match(Zi);for(t=0,n=i.length;n>t;t++)Xi[i[t]]?i[t]=Xi[i[t]]:i[t]=P(i[t]);return function(a){var r="";for(t=0;n>t;t++)r+=i[t]instanceof Function?i[t].call(a,e):i[t];return r}}function A(e,t){return e.isValid()?(t=F(t,e.localeData()),Oi[t]||(Oi[t]=E(t)),Oi[t](e)):e.localeData().invalidDate()}function F(e,t){function n(e){return t.longDateFormat(e)||e}var i=5;for(Ri.lastIndex=0;i>=0&&Ri.test(e);)e=e.replace(Ri,n),Ri.lastIndex=0,i-=1;return e}function I(e,t,n){ia[e]="function"==typeof t?t:function(e){return e&&n?n:t}}function H(e,t){return r(ia,e)?ia[e](t._strict,t._locale):new RegExp(Z(e))}function Z(e){return e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,i,a){return t||n||i||a}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function R(e,t){var n,i=t;for("string"==typeof e&&(e=[e]),"number"==typeof t&&(i=function(e,n){n[t]=m(e)}),n=0;n<e.length;n++)aa[e[n]]=i}function O(e,t){R(e,function(e,n,i,a){i._w=i._w||{},t(e,i._w,i,a)})}function X(e,t,n){null!=t&&r(aa,e)&&aa[e](t,n._a,n,e)}function J(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function B(e){return this._months[e.month()]}function W(e){return this._monthsShort[e.month()]}function q(e,t,n){var i,a,r;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;12>i;i++){if(a=o([2e3,i]),n&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(a,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(a,"").replace(".","")+"$","i")),n||this._monthsParse[i]||(r="^"+this.months(a,"")+"|^"+this.monthsShort(a,""),this._monthsParse[i]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[i].test(e))return i;if(n&&"MMM"===t&&this._shortMonthsParse[i].test(e))return i;if(!n&&this._monthsParse[i].test(e))return i}}function Q(e,t){var n;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),J(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function $(t){return null!=t?(Q(this,t),e.updateOffset(this,!0),this):k(this,"Month")}function z(){return J(this.year(),this.month())}function U(e){var t,n=e._a;return n&&-2===c(e).overflow&&(t=n[sa]<0||n[sa]>11?sa:n[oa]<1||n[oa]>J(n[ra],n[sa])?oa:n[la]<0||n[la]>24||24===n[la]&&(0!==n[ca]||0!==n[da]||0!==n[ua])?la:n[ca]<0||n[ca]>59?ca:n[da]<0||n[da]>59?da:n[ua]<0||n[ua]>999?ua:-1,c(e)._overflowDayOfYear&&(ra>t||t>oa)&&(t=oa),c(e).overflow=t),e}function G(t){e.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}function K(e,t){var n=!0,i=e+"\n"+(new Error).stack;return s(function(){return n&&(G(i),n=!1),t.apply(this,arguments)},t)}function V(e,t){fa[e]||(G(t),fa[e]=!0)}function ee(e){var t,n,i=e._i,a=ma.exec(i);if(a){for(c(e).iso=!0,t=0,n=ga.length;n>t;t++)if(ga[t][1].exec(i)){e._f=ga[t][0]+(a[6]||" ");break}for(t=0,n=va.length;n>t;t++)if(va[t][1].exec(i)){e._f+=va[t][0];break}i.match(ea)&&(e._f+="Z"),ye(e)}else e._isValid=!1}function te(t){var n=_a.exec(t._i);return null!==n?void(t._d=new Date(+n[1])):(ee(t),void(t._isValid===!1&&(delete t._isValid,e.createFromInputFallback(t))))}function ne(e,t,n,i,a,r,s){var o=new Date(e,t,n,i,a,r,s);return 1970>e&&o.setFullYear(e),o}function ie(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function ae(e){return re(e)?366:365}function re(e){return e%4===0&&e%100!==0||e%400===0}function se(){return re(this.year())}function oe(e,t,n){var i,a=n-t,r=n-e.day();return r>a&&(r-=7),a-7>r&&(r+=7),i=Ce(e).add(r,"d"),{week:Math.ceil(i.dayOfYear()/7),year:i.year()}}function le(e){return oe(e,this._week.dow,this._week.doy).week}function ce(){return this._week.dow}function de(){return this._week.doy}function ue(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")}function pe(e){var t=oe(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")}function he(e,t,n,i,a){var r,s,o=ie(e,0,1).getUTCDay();return o=0===o?7:o,n=null!=n?n:a,r=a-o+(o>i?7:0)-(a>o?7:0),s=7*(t-1)+(n-a)+r+1,{year:s>0?e:e-1,dayOfYear:s>0?s:ae(e-1)+s}}function fe(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")}function me(e,t,n){return null!=e?e:null!=t?t:n}function ge(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function ve(e){var t,n,i,a,r=[];if(!e._d){for(i=ge(e),e._w&&null==e._a[oa]&&null==e._a[sa]&&_e(e),e._dayOfYear&&(a=me(e._a[ra],i[ra]),e._dayOfYear>ae(a)&&(c(e)._overflowDayOfYear=!0),n=ie(a,0,e._dayOfYear),e._a[sa]=n.getUTCMonth(),e._a[oa]=n.getUTCDate()),t=0;3>t&&null==e._a[t];++t)e._a[t]=r[t]=i[t];for(;7>t;t++)e._a[t]=r[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[la]&&0===e._a[ca]&&0===e._a[da]&&0===e._a[ua]&&(e._nextDay=!0,e._a[la]=0),e._d=(e._useUTC?ie:ne).apply(null,r),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[la]=24)}}function _e(e){var t,n,i,a,r,s,o;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(r=1,s=4,n=me(t.GG,e._a[ra],oe(Ce(),1,4).year),i=me(t.W,1),a=me(t.E,1)):(r=e._locale._week.dow,s=e._locale._week.doy,n=me(t.gg,e._a[ra],oe(Ce(),r,s).year),i=me(t.w,1),null!=t.d?(a=t.d,r>a&&++i):a=null!=t.e?t.e+r:r),o=he(n,i,a,s,r),e._a[ra]=o.year,e._dayOfYear=o.dayOfYear}function ye(t){if(t._f===e.ISO_8601)return void ee(t);t._a=[],c(t).empty=!0;var n,i,a,r,s,o=""+t._i,l=o.length,d=0;for(a=F(t._f,t._locale).match(Zi)||[],n=0;n<a.length;n++)r=a[n],i=(o.match(H(r,t))||[])[0],i&&(s=o.substr(0,o.indexOf(i)),s.length>0&&c(t).unusedInput.push(s),o=o.slice(o.indexOf(i)+i.length),d+=i.length),Xi[r]?(i?c(t).empty=!1:c(t).unusedTokens.push(r),X(r,i,t)):t._strict&&!i&&c(t).unusedTokens.push(r);c(t).charsLeftOver=l-d,o.length>0&&c(t).unusedInput.push(o),c(t).bigHour===!0&&t._a[la]<=12&&t._a[la]>0&&(c(t).bigHour=void 0),t._a[la]=be(t._locale,t._a[la],t._meridiem),ve(t),U(t)}function be(e,t,n){var i;return null==n?t:null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?(i=e.isPM(n),i&&12>t&&(t+=12),i||12!==t||(t=0),t):t}function we(e){var t,n,i,a,r;if(0===e._f.length)return c(e).invalidFormat=!0,void(e._d=new Date(NaN));for(a=0;a<e._f.length;a++)r=0,t=p({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[a],ye(t),d(t)&&(r+=c(t).charsLeftOver,r+=10*c(t).unusedTokens.length,c(t).score=r,(null==i||i>r)&&(i=r,n=t));s(e,n||t)}function Me(e){if(!e._d){var t=C(e._i);e._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],ve(e)}}function Te(e){var t,a=e._i,r=e._f;return e._locale=e._locale||T(e._l),null===a||void 0===r&&""===a?u({nullInput:!0}):("string"==typeof a&&(e._i=a=e._locale.preparse(a)),f(a)?new h(U(a)):(n(r)?we(e):r?ye(e):i(a)?e._d=a:Le(e),t=new h(U(e)),t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t))}function Le(t){var r=t._i;void 0===r?t._d=new Date:i(r)?t._d=new Date(+r):"string"==typeof r?te(t):n(r)?(t._a=a(r.slice(0),function(e){return parseInt(e,10)}),ve(t)):"object"==typeof r?Me(t):"number"==typeof r?t._d=new Date(r):e.createFromInputFallback(t)}function xe(e,t,n,i,a){var r={};return"boolean"==typeof n&&(i=n,n=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=a,r._l=n,r._i=e,r._f=t,r._strict=i,Te(r)}function Ce(e,t,n,i){return xe(e,t,n,i,!1)}function Se(e,t){var i,a;if(1===t.length&&n(t[0])&&(t=t[0]),!t.length)return Ce();for(i=t[0],a=1;a<t.length;++a)t[a][e](i)&&(i=t[a]);return i}function ke(){var e=[].slice.call(arguments,0);return Se("isBefore",e)}function De(){var e=[].slice.call(arguments,0);return Se("isAfter",e)}function Ye(e){var t=C(e),n=t.year||0,i=t.quarter||0,a=t.month||0,r=t.week||0,s=t.day||0,o=t.hour||0,l=t.minute||0,c=t.second||0,d=t.millisecond||0;this._milliseconds=+d+1e3*c+6e4*l+36e5*o,this._days=+s+7*r,this._months=+a+3*i+12*n,this._data={},this._locale=T(),this._bubble()}function je(e){return e instanceof Ye}function Ne(e,t){N(e,0,0,function(){var e=this.utcOffset(),n="+";return 0>e&&(e=-e,n="-"),n+j(~~(e/60),2)+t+j(~~e%60,2)})}function Pe(e){var t=(e||"").match(ea)||[],n=t[t.length-1]||[],i=(n+"").match(Ta)||["-",0,0],a=+(60*i[1])+m(i[2]);return"+"===i[0]?a:-a}function Ee(t,n){var a,r;return n._isUTC?(a=n.clone(),r=(f(t)||i(t)?+t:+Ce(t))-+a,a._d.setTime(+a._d+r),e.updateOffset(a,!1),a):Ce(t).local()}function Ae(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Fe(t,n){var i,a=this._offset||0;return null!=t?("string"==typeof t&&(t=Pe(t)),Math.abs(t)<16&&(t=60*t),!this._isUTC&&n&&(i=Ae(this)),this._offset=t,this._isUTC=!0,null!=i&&this.add(i,"m"),a!==t&&(!n||this._changeInProgress?Ke(this,Qe(t-a,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?a:Ae(this)}function Ie(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}function He(e){return this.utcOffset(0,e)}function Ze(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Ae(this),"m")),this}function Re(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Pe(this._i)),this}function Oe(e){return e=e?Ce(e).utcOffset():0,(this.utcOffset()-e)%60===0}function Xe(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Je(){if(this._a){var e=this._isUTC?o(this._a):Ce(this._a);return this.isValid()&&g(this._a,e.toArray())>0}return!1}function Be(){return!this._isUTC}function We(){return this._isUTC}function qe(){return this._isUTC&&0===this._offset}function Qe(e,t){var n,i,a,s=e,o=null;return je(e)?s={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(s={},t?s[t]=e:s.milliseconds=e):(o=La.exec(e))?(n="-"===o[1]?-1:1,s={y:0,d:m(o[oa])*n,h:m(o[la])*n,m:m(o[ca])*n,s:m(o[da])*n,ms:m(o[ua])*n}):(o=xa.exec(e))?(n="-"===o[1]?-1:1,s={y:$e(o[2],n),M:$e(o[3],n),d:$e(o[4],n),h:$e(o[5],n),m:$e(o[6],n),s:$e(o[7],n),w:$e(o[8],n)}):null==s?s={}:"object"==typeof s&&("from"in s||"to"in s)&&(a=Ue(Ce(s.from),Ce(s.to)),s={},s.ms=a.milliseconds,s.M=a.months),i=new Ye(s),je(e)&&r(e,"_locale")&&(i._locale=e._locale),i}function $e(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function ze(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function Ue(e,t){var n;return t=Ee(t,e),e.isBefore(t)?n=ze(e,t):(n=ze(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function Ge(e,t){return function(n,i){var a,r;return null===i||isNaN(+i)||(V(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),r=n,n=i,i=r),n="string"==typeof n?+n:n,a=Qe(n,i),Ke(this,a,e),this}}function Ke(t,n,i,a){var r=n._milliseconds,s=n._days,o=n._months;a=null==a?!0:a,r&&t._d.setTime(+t._d+r*i),s&&D(t,"Date",k(t,"Date")+s*i),o&&Q(t,k(t,"Month")+o*i),a&&e.updateOffset(t,s||o)}function Ve(e){var t=e||Ce(),n=Ee(t,this).startOf("day"),i=this.diff(n,"days",!0),a=-6>i?"sameElse":-1>i?"lastWeek":0>i?"lastDay":1>i?"sameDay":2>i?"nextDay":7>i?"nextWeek":"sameElse";return this.format(this.localeData().calendar(a,this,Ce(t)))}function et(){return new h(this)}function tt(e,t){var n;return t=x("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=f(e)?e:Ce(e),+this>+e):(n=f(e)?+e:+Ce(e),n<+this.clone().startOf(t))}function nt(e,t){var n;return t=x("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=f(e)?e:Ce(e),+e>+this):(n=f(e)?+e:+Ce(e),+this.clone().endOf(t)<n)}function it(e,t,n){return this.isAfter(e,n)&&this.isBefore(t,n)}function at(e,t){var n;return t=x(t||"millisecond"),"millisecond"===t?(e=f(e)?e:Ce(e),+this===+e):(n=+Ce(e),+this.clone().startOf(t)<=n&&n<=+this.clone().endOf(t))}function rt(e){return 0>e?Math.ceil(e):Math.floor(e)}function st(e,t,n){var i,a,r=Ee(e,this),s=6e4*(r.utcOffset()-this.utcOffset());return t=x(t),"year"===t||"month"===t||"quarter"===t?(a=ot(this,r),"quarter"===t?a/=3:"year"===t&&(a/=12)):(i=this-r,a="second"===t?i/1e3:"minute"===t?i/6e4:"hour"===t?i/36e5:"day"===t?(i-s)/864e5:"week"===t?(i-s)/6048e5:i),n?a:rt(a)}function ot(e,t){var n,i,a=12*(t.year()-e.year())+(t.month()-e.month()),r=e.clone().add(a,"months");return 0>t-r?(n=e.clone().add(a-1,"months"),i=(t-r)/(r-n)):(n=e.clone().add(a+1,"months"),i=(t-r)/(n-r)),-(a+i)}function lt(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function ct(){var e=this.clone().utc();return 0<e.year()&&e.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():A(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):A(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function dt(t){var n=A(this,t||e.defaultFormat);return this.localeData().postformat(n)}function ut(e,t){return this.isValid()?Qe({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function pt(e){return this.from(Ce(),e)}function ht(e,t){return this.isValid()?Qe({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function ft(e){return this.to(Ce(),e)}function mt(e){var t;return void 0===e?this._locale._abbr:(t=T(e),null!=t&&(this._locale=t),this)}function gt(){return this._locale}function vt(e){switch(e=x(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this}function _t(e){return e=x(e),void 0===e||"millisecond"===e?this:this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms")}function yt(){return+this._d-6e4*(this._offset||0)}function bt(){return Math.floor(+this/1e3)}function wt(){return this._offset?new Date(+this):this._d}function Mt(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function Tt(){return d(this)}function Lt(){return s({},c(this))}function xt(){return c(this).overflow}function Ct(e,t){N(0,[e,e.length],0,t)}function St(e,t,n){return oe(Ce([e,11,31+t-n]),t,n).week}function kt(e){var t=oe(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")}function Dt(e){var t=oe(this,1,4).year;return null==e?t:this.add(e-t,"y")}function Yt(){return St(this.year(),1,4)}function jt(){var e=this.localeData()._week;return St(this.year(),e.dow,e.doy)}function Nt(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)}function Pt(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function Et(e){return this._weekdays[e.day()]}function At(e){return this._weekdaysShort[e.day()]}function Ft(e){return this._weekdaysMin[e.day()]}function It(e){var t,n,i;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=Ce([2e3,1]).day(t),i="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(i.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t}function Ht(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=Pt(e,this.localeData()),this.add(e-t,"d")):t}function Zt(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")}function Rt(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)}function Ot(e,t){N(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Xt(e,t){return t._meridiemParse}function Jt(e){return"p"===(e+"").toLowerCase().charAt(0)}function Bt(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"}function Wt(e){N(0,[e,3],0,"millisecond")}function qt(){return this._isUTC?"UTC":""}function Qt(){return this._isUTC?"Coordinated Universal Time":""}function $t(e){return Ce(1e3*e)}function zt(){return Ce.apply(null,arguments).parseZone()}function Ut(e,t,n){var i=this._calendar[e];return"function"==typeof i?i.call(t,n):i}function Gt(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t}function Kt(){return this._invalidDate}function Vt(e){return this._ordinal.replace("%d",e)}function en(e){return e}function tn(e,t,n,i){var a=this._relativeTime[n];return"function"==typeof a?a(e,t,n,i):a.replace(/%d/i,e)}function nn(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)}function an(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function rn(e,t,n,i){var a=T(),r=o().set(i,t);return a[n](r,e)}function sn(e,t,n,i,a){if("number"==typeof e&&(t=e,e=void 0),e=e||"",null!=t)return rn(e,t,n,a);var r,s=[];for(r=0;i>r;r++)s[r]=rn(e,r,n,a);return s}function on(e,t){return sn(e,t,"months",12,"month")}function ln(e,t){return sn(e,t,"monthsShort",12,"month")}function cn(e,t){return sn(e,t,"weekdays",7,"day")}function dn(e,t){return sn(e,t,"weekdaysShort",7,"day")}function un(e,t){return sn(e,t,"weekdaysMin",7,"day")}function pn(){var e=this._data;return this._milliseconds=Qa(this._milliseconds),this._days=Qa(this._days),this._months=Qa(this._months),e.milliseconds=Qa(e.milliseconds),e.seconds=Qa(e.seconds),e.minutes=Qa(e.minutes),e.hours=Qa(e.hours),e.months=Qa(e.months),e.years=Qa(e.years),this}function hn(e,t,n,i){var a=Qe(t,n);return e._milliseconds+=i*a._milliseconds,e._days+=i*a._days,e._months+=i*a._months,e._bubble()}function fn(e,t){return hn(this,e,t,1)}function mn(e,t){return hn(this,e,t,-1)}function gn(){var e,t,n,i=this._milliseconds,a=this._days,r=this._months,s=this._data,o=0;return s.milliseconds=i%1e3,e=rt(i/1e3),s.seconds=e%60,t=rt(e/60),s.minutes=t%60,n=rt(t/60),s.hours=n%24,a+=rt(n/24),o=rt(vn(a)),a-=rt(_n(o)),r+=rt(a/30),a%=30,o+=rt(r/12),r%=12,s.days=a,s.months=r,s.years=o,this}function vn(e){return 400*e/146097}function _n(e){return 146097*e/400}function yn(e){var t,n,i=this._milliseconds;if(e=x(e),"month"===e||"year"===e)return t=this._days+i/864e5,n=this._months+12*vn(t),"month"===e?n:n/12;switch(t=this._days+Math.round(_n(this._months/12)),e){case"week":return t/7+i/6048e5;case"day":return t+i/864e5;case"hour":return 24*t+i/36e5;case"minute":return 1440*t+i/6e4;case"second":return 86400*t+i/1e3;case"millisecond":return Math.floor(864e5*t)+i;default:throw new Error("Unknown unit "+e)}}function bn(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*m(this._months/12)}function wn(e){return function(){return this.as(e)}}function Mn(e){return e=x(e),this[e+"s"]()}function Tn(e){return function(){return this._data[e]}}function Ln(){return rt(this.days()/7)}function xn(e,t,n,i,a){return a.relativeTime(t||1,!!n,e,i)}function Cn(e,t,n){var i=Qe(e).abs(),a=cr(i.as("s")),r=cr(i.as("m")),s=cr(i.as("h")),o=cr(i.as("d")),l=cr(i.as("M")),c=cr(i.as("y")),d=a<dr.s&&["s",a]||1===r&&["m"]||r<dr.m&&["mm",r]||1===s&&["h"]||s<dr.h&&["hh",s]||1===o&&["d"]||o<dr.d&&["dd",o]||1===l&&["M"]||l<dr.M&&["MM",l]||1===c&&["y"]||["yy",c];return d[2]=t,d[3]=+e>0,d[4]=n,xn.apply(null,d)}function Sn(e,t){return void 0===dr[e]?!1:void 0===t?dr[e]:(dr[e]=t,!0)}function kn(e){var t=this.localeData(),n=Cn(this,!e,t);return e&&(n=t.pastFuture(+this,n)),t.postformat(n)}function Dn(){var e=ur(this.years()),t=ur(this.months()),n=ur(this.days()),i=ur(this.hours()),a=ur(this.minutes()),r=ur(this.seconds()+this.milliseconds()/1e3),s=this.asSeconds();return s?(0>s?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(i||a||r?"T":"")+(i?i+"H":"")+(a?a+"M":"")+(r?r+"S":""):"P0D"}function Yn(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?n[1]:n[2]}function jn(e,t,n){var i={mm:t?"__":"__",hh:t?"__":"__",dd:"__",MM:"__",yy:"__"};return"m"===n?t?"":"":"h"===n?t?"":"":e+" "+Yn(i[n],+e)}function Nn(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function Pn(e,t){var n={nominative:"______".split("_"),accusative:"______".split("_")},i=/\[ ?[] ?(?:|)? ?\] ?dddd/.test(t)?"accusative":"nominative";return n[i][e.day()]}function En(e,t,n){var i={mm:"munutenn",MM:"miz",dd:"devezh"};return e+" "+In(i[n],e)}function An(e){switch(Fn(e)){case 1:case 3:case 4:case 5:case 9:return e+" bloaz";default:return e+" vloaz"}}function Fn(e){return e>9?Fn(e%10):e}function In(e,t){return 2===t?Hn(e):e}function Hn(e){var t={m:"v",b:"v",d:"z"};return void 0===t[e.charAt(0)]?e:t[e.charAt(0)]+e.substring(1)}function Zn(e,t,n){var i=e+" ";switch(n){case"m":return t?"jedna minuta":"jedne minute";
case"mm":return i+=1===e?"minuta":2===e||3===e||4===e?"minute":"minuta";case"h":return t?"jedan sat":"jednog sata";case"hh":return i+=1===e?"sat":2===e||3===e||4===e?"sata":"sati";case"dd":return i+=1===e?"dan":"dana";case"MM":return i+=1===e?"mjesec":2===e||3===e||4===e?"mjeseca":"mjeseci";case"yy":return i+=1===e?"godina":2===e||3===e||4===e?"godine":"godina"}}function Rn(e){return e>1&&5>e&&1!==~~(e/10)}function On(e,t,n,i){var a=e+" ";switch(n){case"s":return t||i?"pr sekund":"pr sekundami";case"m":return t?"minuta":i?"minutu":"minutou";case"mm":return t||i?a+(Rn(e)?"minuty":"minut"):a+"minutami";case"h":return t?"hodina":i?"hodinu":"hodinou";case"hh":return t||i?a+(Rn(e)?"hodiny":"hodin"):a+"hodinami";case"d":return t||i?"den":"dnem";case"dd":return t||i?a+(Rn(e)?"dny":"dn"):a+"dny";case"M":return t||i?"msc":"mscem";case"MM":return t||i?a+(Rn(e)?"msce":"msc"):a+"msci";case"y":return t||i?"rok":"rokem";case"yy":return t||i?a+(Rn(e)?"roky":"let"):a+"lety"}}function Xn(e,t,n,i){var a={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?a[n][0]:a[n][1]}function Jn(e,t,n,i){var a={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?a[n][0]:a[n][1]}function Bn(e,t,n,i){var a={s:["mne sekundi","mni sekund","paar sekundit"],m:["he minuti","ks minut"],mm:[e+" minuti",e+" minutit"],h:["he tunni","tund aega","ks tund"],hh:[e+" tunni",e+" tundi"],d:["he peva","ks pev"],M:["kuu aja","kuu aega","ks kuu"],MM:[e+" kuu",e+" kuud"],y:["he aasta","aasta","ks aasta"],yy:[e+" aasta",e+" aastat"]};return t?a[n][2]?a[n][2]:a[n][1]:i?a[n][0]:a[n][1]}function Wn(e,t,n,i){var a="";switch(n){case"s":return i?"muutaman sekunnin":"muutama sekunti";case"m":return i?"minuutin":"minuutti";case"mm":a=i?"minuutin":"minuuttia";break;case"h":return i?"tunnin":"tunti";case"hh":a=i?"tunnin":"tuntia";break;case"d":return i?"pivn":"piv";case"dd":a=i?"pivn":"piv";break;case"M":return i?"kuukauden":"kuukausi";case"MM":a=i?"kuukauden":"kuukautta";break;case"y":return i?"vuoden":"vuosi";case"yy":a=i?"vuoden":"vuotta"}return a=qn(e,i)+" "+a}function qn(e,t){return 10>e?t?Er[e]:Pr[e]:e}function Qn(e,t,n){var i=e+" ";switch(n){case"m":return t?"jedna minuta":"jedne minute";case"mm":return i+=1===e?"minuta":2===e||3===e||4===e?"minute":"minuta";case"h":return t?"jedan sat":"jednog sata";case"hh":return i+=1===e?"sat":2===e||3===e||4===e?"sata":"sati";case"dd":return i+=1===e?"dan":"dana";case"MM":return i+=1===e?"mjesec":2===e||3===e||4===e?"mjeseca":"mjeseci";case"yy":return i+=1===e?"godina":2===e||3===e||4===e?"godine":"godina"}}function $n(e,t,n,i){var a=e;switch(n){case"s":return i||t?"nhny msodperc":"nhny msodperce";case"m":return"egy"+(i||t?" perc":" perce");case"mm":return a+(i||t?" perc":" perce");case"h":return"egy"+(i||t?" ra":" rja");case"hh":return a+(i||t?" ra":" rja");case"d":return"egy"+(i||t?" nap":" napja");case"dd":return a+(i||t?" nap":" napja");case"M":return"egy"+(i||t?" hnap":" hnapja");case"MM":return a+(i||t?" hnap":" hnapja");case"y":return"egy"+(i||t?" v":" ve");case"yy":return a+(i||t?" v":" ve")}return""}function zn(e){return(e?"":"[mlt] ")+"["+Zr[this.day()]+"] LT[-kor]"}function Un(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function Gn(e,t){var n="___________".split("_");return n[e.month()]}function Kn(e,t){var n="______".split("_");return n[e.day()]}function Vn(e){return e%100===11?!0:e%10===1?!1:!0}function ei(e,t,n,i){var a=e+" ";switch(n){case"s":return t||i?"nokkrar sekndur":"nokkrum sekndum";case"m":return t?"mnta":"mntu";case"mm":return Vn(e)?a+(t||i?"mntur":"mntum"):t?a+"mnta":a+"mntu";case"hh":return Vn(e)?a+(t||i?"klukkustundir":"klukkustundum"):a+"klukkustund";case"d":return t?"dagur":i?"dag":"degi";case"dd":return Vn(e)?t?a+"dagar":a+(i?"daga":"dgum"):t?a+"dagur":a+(i?"dag":"degi");case"M":return t?"mnuur":i?"mnu":"mnui";case"MM":return Vn(e)?t?a+"mnuir":a+(i?"mnui":"mnuum"):t?a+"mnuur":a+(i?"mnu":"mnui");case"y":return t||i?"r":"ri";case"yy":return Vn(e)?a+(t||i?"r":"rum"):a+(t||i?"r":"ri")}}function ti(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD] *MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function ni(e,t){var n={nominative:"______".split("_"),accusative:"______".split("_")},i=/(|)/.test(t)?"accusative":"nominative";return n[i][e.day()]}function ii(e,t,n,i){var a={m:["eng Minutt","enger Minutt"],h:["eng Stonn","enger Stonn"],d:["een Dag","engem Dag"],M:["ee Mount","engem Mount"],y:["ee Joer","engem Joer"]};return t?a[n][0]:a[n][1]}function ai(e){var t=e.substr(0,e.indexOf(" "));return si(t)?"a "+e:"an "+e}function ri(e){var t=e.substr(0,e.indexOf(" "));return si(t)?"viru "+e:"virun "+e}function si(e){if(e=parseInt(e,10),isNaN(e))return!1;if(0>e)return!0;if(10>e)return e>=4&&7>=e?!0:!1;if(100>e){var t=e%10,n=e/10;return si(0===t?n:t)}if(1e4>e){for(;e>=10;)e/=10;return si(e)}return e/=1e3,si(e)}function oi(e,t,n,i){return t?"kelios sekunds":i?"keli sekundi":"kelias sekundes"}function li(e,t,n,i){return t?di(n)[0]:i?di(n)[1]:di(n)[2]}function ci(e){return e%10===0||e>10&&20>e}function di(e){return Rr[e].split("_")}function ui(e,t,n,i){var a=e+" ";return 1===e?a+li(e,t,n[0],i):t?a+(ci(e)?di(n)[1]:di(n)[0]):i?a+di(n)[1]:a+(ci(e)?di(n)[1]:di(n)[2])}function pi(e,t){var n=-1===t.indexOf("dddd HH:mm"),i=Or[e.day()];return n?i:i.substring(0,i.length-2)+""}function hi(e,t,n){return n?t%10===1&&11!==t?e[2]:e[3]:t%10===1&&11!==t?e[0]:e[1]}function fi(e,t,n){return e+" "+hi(Xr[n],e,t)}function mi(e,t,n){return hi(Xr[n],e,t)}function gi(e,t){return t?"daas sekundes":"dam sekundm"}function vi(e){return 5>e%10&&e%10>1&&~~(e/10)%10!==1}function _i(e,t,n){var i=e+" ";switch(n){case"m":return t?"minuta":"minut";case"mm":return i+(vi(e)?"minuty":"minut");case"h":return t?"godzina":"godzin";case"hh":return i+(vi(e)?"godziny":"godzin");case"MM":return i+(vi(e)?"miesice":"miesicy");case"yy":return i+(vi(e)?"lata":"lat")}}function yi(e,t,n){var i={mm:"minute",hh:"ore",dd:"zile",MM:"luni",yy:"ani"},a=" ";return(e%100>=20||e>=100&&e%100===0)&&(a=" de "),e+a+i[n]}function bi(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?n[1]:n[2]}function wi(e,t,n){var i={mm:t?"__":"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===n?t?"":"":e+" "+bi(i[n],+e)}function Mi(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function Ti(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function Li(e,t){var n={nominative:"______".split("_"),accusative:"______".split("_")},i=/\[ ?[] ?(?:||)? ?\] ?dddd/.test(t)?"accusative":"nominative";return n[i][e.day()]}function xi(e){return e>1&&5>e}function Ci(e,t,n,i){var a=e+" ";switch(n){case"s":return t||i?"pr seknd":"pr sekundami";case"m":return t?"minta":i?"mintu":"mintou";case"mm":return t||i?a+(xi(e)?"minty":"mint"):a+"mintami";case"h":return t?"hodina":i?"hodinu":"hodinou";case"hh":return t||i?a+(xi(e)?"hodiny":"hodn"):a+"hodinami";case"d":return t||i?"de":"dom";case"dd":return t||i?a+(xi(e)?"dni":"dn"):a+"dami";case"M":return t||i?"mesiac":"mesiacom";case"MM":return t||i?a+(xi(e)?"mesiace":"mesiacov"):a+"mesiacmi";case"y":return t||i?"rok":"rokom";case"yy":return t||i?a+(xi(e)?"roky":"rokov"):a+"rokmi"}}function Si(e,t,n,i){var a=e+" ";switch(n){case"s":return t||i?"nekaj sekund":"nekaj sekundami";case"m":return t?"ena minuta":"eno minuto";case"mm":return a+=1===e?t?"minuta":"minuto":2===e?t||i?"minuti":"minutama":5>e?t||i?"minute":"minutami":t||i?"minut":"minutami";case"h":return t?"ena ura":"eno uro";case"hh":return a+=1===e?t?"ura":"uro":2===e?t||i?"uri":"urama":5>e?t||i?"ure":"urami":t||i?"ur":"urami";case"d":return t||i?"en dan":"enim dnem";case"dd":return a+=1===e?t||i?"dan":"dnem":2===e?t||i?"dni":"dnevoma":t||i?"dni":"dnevi";case"M":return t||i?"en mesec":"enim mesecem";case"MM":return a+=1===e?t||i?"mesec":"mesecem":2===e?t||i?"meseca":"mesecema":5>e?t||i?"mesece":"meseci":t||i?"mesecev":"meseci";case"y":return t||i?"eno leto":"enim letom";case"yy":return a+=1===e?t||i?"leto":"letom":2===e?t||i?"leti":"letoma":5>e?t||i?"leta":"leti":t||i?"let":"leti"}}function ki(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?n[1]:n[2]}function Di(e,t,n){var i={mm:"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===n?t?"":"":"h"===n?t?"":"":e+" "+ki(i[n],+e)}function Yi(e,t){var n={nominative:"___________".split("_"),accusative:"___________".split("_")},i=/D[oD]? *MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function ji(e,t){var n={nominative:"______".split("_"),accusative:"______".split("_"),genitive:"______".split("_")},i=/(\[[]\]) ?dddd/.test(t)?"accusative":/\[?(?:|)? ?\] ?dddd/.test(t)?"genitive":"nominative";return n[i][e.day()]}function Ni(e){return function(){return e+""+(11===this.hours()?"":"")+"] LT"}}var Pi,Ei,Ai=e.momentProperties=[],Fi=!1,Ii={},Hi={},Zi=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,Ri=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Oi={},Xi={},Ji=/\d/,Bi=/\d\d/,Wi=/\d{3}/,qi=/\d{4}/,Qi=/[+-]?\d{6}/,$i=/\d\d?/,zi=/\d{1,3}/,Ui=/\d{1,4}/,Gi=/[+-]?\d{1,6}/,Ki=/\d+/,Vi=/[+-]?\d+/,ea=/Z|[+-]\d\d:?\d\d/gi,ta=/[+-]?\d+(\.\d{1,3})?/,na=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,ia={},aa={},ra=0,sa=1,oa=2,la=3,ca=4,da=5,ua=6;N("M",["MM",2],"Mo",function(){return this.month()+1}),N("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),N("MMMM",0,0,function(e){return this.localeData().months(this,e)}),L("month","M"),I("M",$i),I("MM",$i,Bi),I("MMM",na),I("MMMM",na),R(["M","MM"],function(e,t){t[sa]=m(e)-1}),R(["MMM","MMMM"],function(e,t,n,i){var a=n._locale.monthsParse(e,i,n._strict);null!=a?t[sa]=a:c(n).invalidMonth=e});var pa="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ha="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),fa={};e.suppressDeprecationWarnings=!1;var ma=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ga=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],va=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],_a=/^\/?Date\((\-?\d+)/i;e.createFromInputFallback=K("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),N(0,["YY",2],0,function(){return this.year()%100}),N(0,["YYYY",4],0,"year"),N(0,["YYYYY",5],0,"year"),N(0,["YYYYYY",6,!0],0,"year"),L("year","y"),I("Y",Vi),I("YY",$i,Bi),I("YYYY",Ui,qi),I("YYYYY",Gi,Qi),I("YYYYYY",Gi,Qi),R(["YYYY","YYYYY","YYYYYY"],ra),R("YY",function(t,n){n[ra]=e.parseTwoDigitYear(t)}),e.parseTwoDigitYear=function(e){return m(e)+(m(e)>68?1900:2e3)};var ya=S("FullYear",!1);N("w",["ww",2],"wo","week"),N("W",["WW",2],"Wo","isoWeek"),L("week","w"),L("isoWeek","W"),I("w",$i),I("ww",$i,Bi),I("W",$i),I("WW",$i,Bi),O(["w","ww","W","WW"],function(e,t,n,i){t[i.substr(0,1)]=m(e)});var ba={dow:0,doy:6};N("DDD",["DDDD",3],"DDDo","dayOfYear"),L("dayOfYear","DDD"),I("DDD",zi),I("DDDD",Wi),R(["DDD","DDDD"],function(e,t,n){n._dayOfYear=m(e)}),e.ISO_8601=function(){};var wa=K("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var e=Ce.apply(null,arguments);return this>e?this:e}),Ma=K("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var e=Ce.apply(null,arguments);return e>this?this:e});Ne("Z",":"),Ne("ZZ",""),I("Z",ea),I("ZZ",ea),R(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Pe(e)});var Ta=/([\+\-]|\d\d)/gi;e.updateOffset=function(){};var La=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,xa=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;Qe.fn=Ye.prototype;var Ca=Ge(1,"add"),Sa=Ge(-1,"subtract");e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var ka=K("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});N(0,["gg",2],0,function(){return this.weekYear()%100}),N(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Ct("gggg","weekYear"),Ct("ggggg","weekYear"),Ct("GGGG","isoWeekYear"),Ct("GGGGG","isoWeekYear"),L("weekYear","gg"),L("isoWeekYear","GG"),I("G",Vi),I("g",Vi),I("GG",$i,Bi),I("gg",$i,Bi),I("GGGG",Ui,qi),I("gggg",Ui,qi),I("GGGGG",Gi,Qi),I("ggggg",Gi,Qi),O(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,i){t[i.substr(0,2)]=m(e)}),O(["gg","GG"],function(t,n,i,a){n[a]=e.parseTwoDigitYear(t)}),N("Q",0,0,"quarter"),L("quarter","Q"),I("Q",Ji),R("Q",function(e,t){t[sa]=3*(m(e)-1)}),N("D",["DD",2],"Do","date"),L("date","D"),I("D",$i),I("DD",$i,Bi),I("Do",function(e,t){return e?t._ordinalParse:t._ordinalParseLenient}),R(["D","DD"],oa),R("Do",function(e,t){t[oa]=m(e.match($i)[0],10)});var Da=S("Date",!0);N("d",0,"do","day"),N("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),N("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),N("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),N("e",0,0,"weekday"),N("E",0,0,"isoWeekday"),L("day","d"),L("weekday","e"),L("isoWeekday","E"),I("d",$i),I("e",$i),I("E",$i),I("dd",na),I("ddd",na),I("dddd",na),O(["dd","ddd","dddd"],function(e,t,n){var i=n._locale.weekdaysParse(e);null!=i?t.d=i:c(n).invalidWeekday=e}),O(["d","e","E"],function(e,t,n,i){t[i]=m(e)});var Ya="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),ja="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Na="Su_Mo_Tu_We_Th_Fr_Sa".split("_");N("H",["HH",2],0,"hour"),N("h",["hh",2],0,function(){return this.hours()%12||12}),Ot("a",!0),Ot("A",!1),L("hour","h"),I("a",Xt),I("A",Xt),I("H",$i),I("h",$i),I("HH",$i,Bi),I("hh",$i,Bi),R(["H","HH"],la),R(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),R(["h","hh"],function(e,t,n){t[la]=m(e),c(n).bigHour=!0});var Pa=/[ap]\.?m?\.?/i,Ea=S("Hours",!0);N("m",["mm",2],0,"minute"),L("minute","m"),I("m",$i),I("mm",$i,Bi),R(["m","mm"],ca);var Aa=S("Minutes",!1);N("s",["ss",2],0,"second"),L("second","s"),I("s",$i),I("ss",$i,Bi),R(["s","ss"],da);var Fa=S("Seconds",!1);N("S",0,0,function(){return~~(this.millisecond()/100)}),N(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),Wt("SSS"),Wt("SSSS"),L("millisecond","ms"),I("S",zi,Ji),I("SS",zi,Bi),I("SSS",zi,Wi),I("SSSS",Ki),R(["S","SS","SSS","SSSS"],function(e,t){t[ua]=m(1e3*("0."+e))});var Ia=S("Milliseconds",!1);N("z",0,0,"zoneAbbr"),N("zz",0,0,"zoneName");var Ha=h.prototype;Ha.add=Ca,Ha.calendar=Ve,Ha.clone=et,Ha.diff=st,Ha.endOf=_t,Ha.format=dt,Ha.from=ut,Ha.fromNow=pt,Ha.to=ht,Ha.toNow=ft,Ha.get=Y,Ha.invalidAt=xt,Ha.isAfter=tt,Ha.isBefore=nt,Ha.isBetween=it,Ha.isSame=at,Ha.isValid=Tt,Ha.lang=ka,Ha.locale=mt,Ha.localeData=gt,Ha.max=Ma,Ha.min=wa,Ha.parsingFlags=Lt,Ha.set=Y,Ha.startOf=vt,Ha.subtract=Sa,Ha.toArray=Mt,Ha.toDate=wt,Ha.toISOString=ct,Ha.toJSON=ct,Ha.toString=lt,Ha.unix=bt,Ha.valueOf=yt,Ha.year=ya,Ha.isLeapYear=se,Ha.weekYear=kt,Ha.isoWeekYear=Dt,Ha.quarter=Ha.quarters=Nt,Ha.month=$,Ha.daysInMonth=z,Ha.week=Ha.weeks=ue,Ha.isoWeek=Ha.isoWeeks=pe,Ha.weeksInYear=jt,Ha.isoWeeksInYear=Yt,Ha.date=Da,Ha.day=Ha.days=Ht,Ha.weekday=Zt,Ha.isoWeekday=Rt,Ha.dayOfYear=fe,Ha.hour=Ha.hours=Ea,Ha.minute=Ha.minutes=Aa,Ha.second=Ha.seconds=Fa,Ha.millisecond=Ha.milliseconds=Ia,Ha.utcOffset=Fe,Ha.utc=He,Ha.local=Ze,Ha.parseZone=Re,Ha.hasAlignedHourOffset=Oe,Ha.isDST=Xe,Ha.isDSTShifted=Je,Ha.isLocal=Be,Ha.isUtcOffset=We,Ha.isUtc=qe,Ha.isUTC=qe,Ha.zoneAbbr=qt,Ha.zoneName=Qt,Ha.dates=K("dates accessor is deprecated. Use date instead.",Da),Ha.months=K("months accessor is deprecated. Use month instead",$),Ha.years=K("years accessor is deprecated. Use year instead",ya),Ha.zone=K("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",Ie);var Za=Ha,Ra={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Oa={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},Xa="Invalid date",Ja="%d",Ba=/\d{1,2}/,Wa={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},qa=v.prototype;qa._calendar=Ra,qa.calendar=Ut,qa._longDateFormat=Oa,qa.longDateFormat=Gt,qa._invalidDate=Xa,qa.invalidDate=Kt,qa._ordinal=Ja,qa.ordinal=Vt,qa._ordinalParse=Ba,qa.preparse=en,qa.postformat=en,qa._relativeTime=Wa,qa.relativeTime=tn,qa.pastFuture=nn,qa.set=an,qa.months=B,qa._months=pa,qa.monthsShort=W,qa._monthsShort=ha,qa.monthsParse=q,qa.week=le,qa._week=ba,qa.firstDayOfYear=de,qa.firstDayOfWeek=ce,qa.weekdays=Et,qa._weekdays=Ya,qa.weekdaysMin=Ft,qa._weekdaysMin=Na,qa.weekdaysShort=At,qa._weekdaysShort=ja,qa.weekdaysParse=It,qa.isPM=Jt,qa._meridiemParse=Pa,qa.meridiem=Bt,w("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===m(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),e.lang=K("moment.lang is deprecated. Use moment.locale instead.",w),e.langData=K("moment.langData is deprecated. Use moment.localeData instead.",T);var Qa=Math.abs,$a=wn("ms"),za=wn("s"),Ua=wn("m"),Ga=wn("h"),Ka=wn("d"),Va=wn("w"),er=wn("M"),tr=wn("y"),nr=Tn("milliseconds"),ir=Tn("seconds"),ar=Tn("minutes"),rr=Tn("hours"),sr=Tn("days"),or=Tn("months"),lr=Tn("years"),cr=Math.round,dr={s:45,m:45,h:22,d:26,M:11},ur=Math.abs,pr=Ye.prototype;pr.abs=pn,pr.add=fn,pr.subtract=mn,pr.as=yn,pr.asMilliseconds=$a,pr.asSeconds=za,pr.asMinutes=Ua,pr.asHours=Ga,pr.asDays=Ka,pr.asWeeks=Va,pr.asMonths=er,pr.asYears=tr,pr.valueOf=bn,pr._bubble=gn,pr.get=Mn,pr.milliseconds=nr,pr.seconds=ir,pr.minutes=ar,pr.hours=rr,pr.days=sr,pr.weeks=Ln,pr.months=or,pr.years=lr,pr.humanize=kn,pr.toISOString=Dn,pr.toString=Dn,pr.toJSON=Dn,pr.locale=mt,pr.localeData=gt,pr.toIsoString=K("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Dn),pr.lang=ka,N("X",0,0,"unix"),N("x",0,0,"valueOf"),I("x",Vi),I("X",ta),R("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),R("x",function(e,t,n){n._d=new Date(m(e))}),e.version="2.10.3",t(Ce),e.fn=Za,e.min=ke,e.max=De,e.utc=o,e.unix=$t,e.months=on,e.isDate=i,e.locale=w,e.invalid=u,e.duration=Qe,e.isMoment=f,e.weekdays=cn,e.parseZone=zt,e.localeData=T,e.isDuration=je,e.monthsShort=ln,e.weekdaysMin=un,e.defineLocale=M,e.weekdaysShort=dn,e.normalizeUnits=x,e.relativeTimeThreshold=Sn;var hr=e,fr=(hr.defineLocale("af",{months:"Januarie_Februarie_Maart_April_Mei_Junie_Julie_Augustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Aug_Sep_Okt_Nov_Des".split("_"),weekdays:"Sondag_Maandag_Dinsdag_Woensdag_Donderdag_Vrydag_Saterdag".split("_"),weekdaysShort:"Son_Maa_Din_Woe_Don_Vry_Sat".split("_"),weekdaysMin:"So_Ma_Di_Wo_Do_Vr_Sa".split("_"),meridiemParse:/vm|nm/i,isPM:function(e){return/^nm$/i.test(e)},meridiem:function(e,t,n){return 12>e?n?"vm":"VM":n?"nm":"NM"},longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Vandag om] LT",nextDay:"[Mre om] LT",nextWeek:"dddd [om] LT",lastDay:"[Gister om] LT",lastWeek:"[Laas] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oor %s",past:"%s gelede",s:"'n paar sekondes",m:"'n minuut",mm:"%d minute",h:"'n uur",hh:"%d ure",d:"'n dag",dd:"%d dae",M:"'n maand",MM:"%d maande",y:"'n jaar",yy:"%d jaar"},ordinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}}),hr.defineLocale("ar-ma",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}}),{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}),mr={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},gr=(hr.defineLocale("ar-sa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,n){return 12>e?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return mr[e]}).replace(//g,",")},postformat:function(e){return e.replace(/\d/g,function(e){return fr[e]}).replace(/,/g,"")},week:{dow:6,doy:12}}),hr.defineLocale("ar-tn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:1,doy:4}}),{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}),vr={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},_r=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&10>=e%100?3:e%100>=11?4:5},yr={s:["  "," ",["",""],"%d ","%d ","%d "],m:["  "," ",["",""],"%d ","%d ","%d "],h:["  "," ",["",""],"%d ","%d ","%d "],d:["  "," ",["",""],"%d ","%d ","%d "],M:["  "," ",["",""],"%d ","%d ","%d "],y:["  "," ",["",""],"%d ","%d ","%d "]},br=function(e){return function(t,n,i,a){var r=_r(t),s=yr[e][_r(t)];return 2===r&&(s=s[n?0:1]),s.replace(/%d/i,t)}},wr=["  "," "," "," "," "," "," "," "," ","  ","  ","  "],Mr=(hr.defineLocale("ar",{months:wr,monthsShort:wr,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,n){return 12>e?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:br("s"),m:br("m"),mm:br("m"),h:br("h"),hh:br("h"),d:br("d"),dd:br("d"),M:br("M"),MM:br("M"),y:br("y"),yy:br("y")},preparse:function(e){return e.replace(/\u200f/g,"").replace(/[]/g,function(e){return vr[e]}).replace(//g,",")},postformat:function(e){return e.replace(/\d/g,function(e){return gr[e]}).replace(/,/g,"")},week:{dow:6,doy:12}}),{1:"-inci",5:"-inci",8:"-inci",70:"-inci",80:"-inci",2:"-nci",7:"-nci",20:"-nci",50:"-nci",3:"-nc",4:"-nc",100:"-nc",6:"-nc",9:"-uncu",10:"-uncu",30:"-uncu",60:"-nc",90:"-nc"}),Tr=(hr.defineLocale("az",{months:"yanvar_fevral_mart_aprel_may_iyun_iyul_avqust_sentyabr_oktyabr_noyabr_dekabr".split("_"),monthsShort:"yan_fev_mar_apr_may_iyn_iyl_avq_sen_okt_noy_dek".split("_"),weekdays:"Bazar_Bazar ertsi_rnb axam_rnb_Cm axam_Cm_nb".split("_"),weekdaysShort:"Baz_BzE_Ax_r_CAx_Cm_n".split("_"),weekdaysMin:"Bz_BE_A__CA_C_".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[sabah saat] LT",nextWeek:"[gln hft] dddd [saat] LT",lastDay:"[dnn] LT",lastWeek:"[ken hft] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s vvl",s:"birne saniyy",m:"bir dqiq",mm:"%d dqiq",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir il",yy:"%d il"},meridiemParse:/gec|shr|gndz|axam/,isPM:function(e){return/^(gndz|axam)$/.test(e)},meridiem:function(e,t,n){return 4>e?"gec":12>e?"shr":17>e?"gndz":"axam"},ordinalParse:/\d{1,2}-(nc|inci|nci|nc|nc|uncu)/,ordinal:function(e){if(0===e)return e+"-nc";var t=e%10,n=e%100-t,i=e>=100?100:null;return e+(Mr[t]||Mr[n]||Mr[i])},week:{dow:1,doy:7}}),hr.defineLocale("be",{months:Nn,monthsShort:"___________".split("_"),weekdays:Pn,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return"[] dddd [] LT"},lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:jn,mm:jn,h:jn,hh:jn,d:"",dd:jn,M:"",MM:jn,y:"",yy:jn},meridiemParse:/|||/,isPM:function(e){return/^(|)$/.test(e)},meridiem:function(e,t,n){return 4>e?"":12>e?"":17>e?"":""},ordinalParse:/\d{1,2}-(||)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e%10!==2&&e%10!==3||e%100===12||e%100===13?e+"-":e+"-";case"D":return e+"-";default:return e}},week:{dow:1,doy:7}}),hr.defineLocale("bg",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:case 5:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinalParse:/\d{1,2}-(|||||)/,ordinal:function(e){var t=e%10,n=e%100;return 0===e?e+"-":0===n?e+"-":n>10&&20>n?e+"-":1===t?e+"-":2===t?e+"-":7===t||8===t?e+"-":e+"-"},week:{dow:1,doy:7}}),{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}),Lr={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},xr=(hr.defineLocale("bn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",
LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return Lr[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return Tr[e]})},meridiemParse:/||||/,isPM:function(e){return/^(||)$/.test(e)},meridiem:function(e,t,n){return 4>e?"":10>e?"":17>e?"":20>e?"":""},week:{dow:0,doy:6}}),{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}),Cr={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},Sr=(hr.defineLocale("bo",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[], LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return Cr[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return xr[e]})},meridiemParse:/||||/,isPM:function(e){return/^(||)$/.test(e)},meridiem:function(e,t,n){return 4>e?"":10>e?"":17>e?"":20>e?"":""},week:{dow:0,doy:6}}),hr.defineLocale("br",{months:"Genver_C'hwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_C'hwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Merc'her_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),longDateFormat:{LT:"h[e]mm A",LTS:"h[e]mm:ss A",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY LT",LLLL:"dddd, D [a viz] MMMM YYYY LT"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warc'hoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dec'h da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s 'zo",s:"un nebeud segondenno",m:"ur vunutenn",mm:En,h:"un eur",hh:"%d eur",d:"un devezh",dd:En,M:"ur miz",MM:En,y:"ur bloaz",yy:An},ordinalParse:/\d{1,2}(a|vet)/,ordinal:function(e){var t=1===e?"a":"vet";return e+t},week:{dow:1,doy:4}}),hr.defineLocale("bs",{months:"januar_februar_mart_april_maj_juni_juli_august_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._aug._sep._okt._nov._dec.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:Zn,mm:Zn,h:Zn,hh:Zn,d:"dan",dd:Zn,M:"mjesec",MM:Zn,y:"godinu",yy:Zn},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}}),hr.defineLocale("ca",{months:"gener_febrer_mar_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),monthsShort:"gen._febr._mar._abr._mai._jun._jul._ag._set._oct._nov._des.".split("_"),weekdays:"diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dt._dc._dj._dv._ds.".split("_"),weekdaysMin:"Dg_Dl_Dt_Dc_Dj_Dv_Ds".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[dem a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"fa %s",s:"uns segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},ordinalParse:/\d{1,2}(r|n|t||a)/,ordinal:function(e,t){var n=1===e?"r":2===e?"n":3===e?"r":4===e?"t":"";return("w"===t||"W"===t)&&(n="a"),e+n},week:{dow:1,doy:4}}),"leden_nor_bezen_duben_kvten_erven_ervenec_srpen_z_jen_listopad_prosinec".split("_")),kr="led_no_be_dub_kv_vn_vc_srp_z_j_lis_pro".split("_"),Dr=(hr.defineLocale("cs",{months:Sr,monthsShort:kr,monthsParse:function(e,t){var n,i=[];for(n=0;12>n;n++)i[n]=new RegExp("^"+e[n]+"$|^"+t[n]+"$","i");return i}(Sr,kr),weekdays:"nedle_pondl_ter_steda_tvrtek_ptek_sobota".split("_"),weekdaysShort:"ne_po_t_st_t_p_so".split("_"),weekdaysMin:"ne_po_t_st_t_p_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes v] LT",nextDay:"[ztra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve stedu v] LT";case 4:return"[ve tvrtek v] LT";case 5:return"[v ptek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[vera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou nedli v] LT";case 1:case 2:return"[minul] dddd [v] LT";case 3:return"[minulou stedu v] LT";case 4:case 5:return"[minul] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"ped %s",s:On,m:On,mm:On,h:On,hh:On,d:On,dd:On,M:On,MM:On,y:On,yy:On},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),hr.defineLocale("cv",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD-MM-YYYY",LL:"YYYY [] MMMM [] D[-]",LLL:"YYYY [] MMMM [] D[-], LT",LLLL:"dddd, YYYY [] MMMM [] D[-], LT"},calendar:{sameDay:"[] LT []",nextDay:"[] LT []",lastDay:"[] LT []",nextWeek:"[] dddd LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:function(e){var t=/$/i.exec(e)?"":/$/i.exec(e)?"":"";return e+t},past:"%s ",s:"- ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinalParse:/\d{1,2}-/,ordinal:"%d-",week:{dow:1,doy:7}}),hr.defineLocale("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn l",s:"ychydig eiliadau",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},ordinalParse:/\d{1,2}(fed|ain|af|il|ydd|ed|eg)/,ordinal:function(e){var t=e,n="",i=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"];return t>20?n=40===t||50===t||60===t||80===t||100===t?"fed":"ain":t>0&&(n=i[t]),e+n},week:{dow:1,doy:4}}),hr.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tir_ons_tor_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd [d.] D. MMMM YYYY LT"},calendar:{sameDay:"[I dag kl.] LT",nextDay:"[I morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[I gr kl.] LT",lastWeek:"[sidste] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en mned",MM:"%d mneder",y:"et r",yy:"%d r"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),hr.defineLocale("de-at",{months:"Jnner_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jn._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT [Uhr]",sameElse:"L",nextDay:"[Morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[Gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:Xn,mm:"%d Minuten",h:Xn,hh:"%d Stunden",d:Xn,dd:Xn,M:Xn,MM:Xn,y:Xn,yy:Xn},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),hr.defineLocale("de",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT [Uhr]",sameElse:"L",nextDay:"[Morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[Gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:Jn,mm:"%d Minuten",h:Jn,hh:"%d Stunden",d:Jn,dd:Jn,M:Jn,MM:Jn,y:Jn,yy:Jn},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),hr.defineLocale("el",{monthsNominativeEl:"___________".split("_"),monthsGenitiveEl:"___________".split("_"),months:function(e,t){return/D/.test(t.substring(0,t.indexOf("MMMM")))?this._monthsGenitiveEl[e.month()]:this._monthsNominativeEl[e.month()]},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),meridiem:function(e,t,n){return e>11?n?"":"":n?"":""},isPM:function(e){return""===(e+"").toLowerCase()[0]},meridiemParse:/[]\.??\.?/i,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendarEl:{sameDay:"[ {}] LT",nextDay:"[ {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[ {}] LT",lastWeek:function(){switch(this.day()){case 6:return"[ ] dddd [{}] LT";default:return"[ ] dddd [{}] LT"}},sameElse:"L"},calendar:function(e,t){var n=this._calendarEl[e],i=t&&t.hours();return"function"==typeof n&&(n=n.apply(t)),n.replace("{}",i%12===1?"":"")},relativeTime:{future:" %s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}}),hr.defineLocale("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10,n=1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n},week:{dow:1,doy:4}}),hr.defineLocale("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"YYYY-MM-DD",LL:"D MMMM, YYYY",LLL:"D MMMM, YYYY LT",LLLL:"dddd, D MMMM, YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10,n=1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),hr.defineLocale("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10,n=1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n},week:{dow:1,doy:4}}),hr.defineLocale("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_agusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_ag_sep_okt_nov_dec".split("_"),weekdays:"Dimano_Lundo_Mardo_Merkredo_ado_Vendredo_Sabato".split("_"),weekdaysShort:"Dim_Lun_Mard_Merk_a_Ven_Sab".split("_"),weekdaysMin:"Di_Lu_Ma_Me_a_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"YYYY-MM-DD",LL:"D[-an de] MMMM, YYYY",LLL:"D[-an de] MMMM, YYYY LT",LLLL:"dddd, [la] D[-an de] MMMM, YYYY LT"},meridiemParse:/[ap]\.t\.m/i,isPM:function(e){return"p"===e.charAt(0).toLowerCase()},meridiem:function(e,t,n){return e>11?n?"p.t.m.":"P.T.M.":n?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodia je] LT",nextDay:"[Morga je] LT",nextWeek:"dddd [je] LT",lastDay:"[Hiera je] LT",lastWeek:"[pasinta] dddd [je] LT",sameElse:"L"},relativeTime:{future:"je %s",past:"anta %s",s:"sekundoj",m:"minuto",mm:"%d minutoj",h:"horo",hh:"%d horoj",d:"tago",dd:"%d tagoj",M:"monato",MM:"%d monatoj",y:"jaro",yy:"%d jaroj"},ordinalParse:/\d{1,2}a/,ordinal:"%da",week:{dow:1,doy:7}}),"Ene._Feb._Mar._Abr._May._Jun._Jul._Ago._Sep._Oct._Nov._Dic.".split("_")),Yr="Ene_Feb_Mar_Abr_May_Jun_Jul_Ago_Sep_Oct_Nov_Dic".split("_"),jr=(hr.defineLocale("es",{months:"Enero_Febrero_Marzo_Abril_Mayo_Junio_Julio_Agosto_Septiembre_Octubre_Noviembre_Diciembre".split("_"),monthsShort:function(e,t){return/-MMM-/.test(t)?Yr[e.month()]:Dr[e.month()]},weekdays:"Domingo_Lunes_Martes_Mircoles_Jueves_Viernes_Sbado".split("_"),weekdaysShort:"Dom._Lun._Mar._Mi._Jue._Vie._Sb.".split("_"),weekdaysMin:"Do_Lu_Ma_Mi_Ju_Vi_S".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},ordinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}}),hr.defineLocale("et",{months:"jaanuar_veebruar_mrts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_mrts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"phapev_esmaspev_teisipev_kolmapev_neljapev_reede_laupev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Tna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Jrgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s prast",past:"%s tagasi",s:Bn,m:Bn,mm:Bn,h:Bn,hh:Bn,d:Bn,dd:"%d peva",M:Bn,MM:Bn,y:Bn,yy:Bn},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),hr.defineLocale("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] LT",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] LT",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] LT",llll:"ddd, YYYY[ko] MMM D[a] LT"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}}),{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}),Nr={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},Pr=(hr.defineLocale("fa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},meridiemParse:/  |  /,isPM:function(e){return/  /.test(e)},meridiem:function(e,t,n){return 12>e?"  ":"  "},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[-]/g,function(e){return Nr[e]}).replace(//g,",")},postformat:function(e){return e.replace(/\d/g,function(e){return jr[e]}).replace(/,/g,"")},ordinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:6,doy:12}}),"nolla yksi kaksi kolme nelj viisi kuusi seitsemn kahdeksan yhdeksn".split(" ")),Er=["nolla","yhden","kahden","kolmen","neljn","viiden","kuuden",Pr[7],Pr[8],Pr[9]],Ar=(hr.defineLocale("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_keskuu_heinkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kes_hein_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] LT",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] LT",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] LT",llll:"ddd, Do MMM YYYY, [klo] LT"},calendar:{sameDay:"[tnn] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s pst",past:"%s sitten",s:Wn,m:Wn,mm:Wn,h:Wn,hh:Wn,d:Wn,dd:Wn,M:Wn,MM:Wn,y:Wn,yy:Wn},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),hr.defineLocale("fo",{months:"januar_februar_mars_aprl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_mnadagur_tsdagur_mikudagur_hsdagur_frggjadagur_leygardagur".split("_"),weekdaysShort:"sun_mn_ts_mik_hs_fr_ley".split("_"),weekdaysMin:"su_m_t_mi_h_fr_le".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D. MMMM, YYYY LT"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gjr kl.] LT",lastWeek:"[sstu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s sani",s:"f sekund",m:"ein minutt",mm:"%d minuttir",h:"ein tmi",hh:"%d tmar",d:"ein dagur",dd:"%d dagar",M:"ein mnai",MM:"%d mnair",y:"eitt r",yy:"%d r"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),hr.defineLocale("fr-ca",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinalParse:/\d{1,2}(er|)/,ordinal:function(e){return e+(1===e?"er":"")}}),hr.defineLocale("fr",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinalParse:/\d{1,2}(er|)/,ordinal:function(e){return e+(1===e?"er":"")},week:{dow:1,doy:4}}),"jan._feb._mrt._apr._mai_jun._jul._aug._sep._okt._nov._des.".split("_")),Fr="jan_feb_mrt_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),Ir=(hr.defineLocale("fy",{months:"jannewaris_febrewaris_maart_april_maaie_juny_july_augustus_septimber_oktober_novimber_desimber".split("_"),monthsShort:function(e,t){return/-MMM-/.test(t)?Fr[e.month()]:Ar[e.month()]},weekdays:"snein_moandei_tiisdei_woansdei_tongersdei_freed_sneon".split("_"),weekdaysShort:"si._mo._ti._wo._to._fr._so.".split("_"),weekdaysMin:"Si_Mo_Ti_Wo_To_Fr_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[hjoed om] LT",nextDay:"[moarn om] LT",nextWeek:"dddd [om] LT",lastDay:"[juster om] LT",lastWeek:"[frne] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oer %s",past:"%s lyn",s:"in pear sekonden",m:"ien mint",mm:"%d minuten",h:"ien oere",hh:"%d oeren",d:"ien dei",dd:"%d dagen",M:"ien moanne",MM:"%d moannen",y:"ien jier",yy:"%d jierren"},ordinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}}),hr.defineLocale("gl",{months:"Xaneiro_Febreiro_Marzo_Abril_Maio_Xuo_Xullo_Agosto_Setembro_Outubro_Novembro_Decembro".split("_"),monthsShort:"Xan._Feb._Mar._Abr._Mai._Xu._Xul._Ago._Set._Out._Nov._Dec.".split("_"),weekdays:"Domingo_Luns_Martes_Mrcores_Xoves_Venres_Sbado".split("_"),weekdaysShort:"Dom._Lun._Mar._Mr._Xov._Ven._Sb.".split("_"),weekdaysMin:"Do_Lu_Ma_M_Xo_Ve_S".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma "+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"s":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"s":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(e){return"uns segundos"===e?"nuns segundos":"en "+e},past:"hai %s",s:"uns segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},ordinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:7}}),hr.defineLocale("he",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D []MMMM YYYY",LLL:"D []MMMM YYYY LT",LLLL:"dddd, D []MMMM YYYY LT",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[ ]LT",nextDay:"[ ]LT",nextWeek:"dddd [] LT",lastDay:"[ ]LT",lastWeek:"[] dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:function(e){return 2===e?"":e+" "},d:"",dd:function(e){return 2===e?"":e+" "},M:"",MM:function(e){return 2===e?"":e+" "},y:"",yy:function(e){return 2===e?"":e%10===0&&10!==e?e+" ":e+" "}}}),{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}),Hr={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},Zr=(hr.defineLocale("hi",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return Hr[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return Ir[e]})},meridiemParse:/|||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?4>e?e:e+12:""===t?e:""===t?e>=10?e:e+12:""===t?e+12:void 0},meridiem:function(e,t,n){return 4>e?"":10>e?"":17>e?"":20>e?"":""},week:{dow:0,doy:6}}),hr.defineLocale("hr",{months:"sijeanj_veljaa_oujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_"),monthsShort:"sij._velj._ou._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){
switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:Qn,mm:Qn,h:Qn,hh:Qn,d:"dan",dd:Qn,M:"mjesec",MM:Qn,y:"godinu",yy:Qn},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}}),"vasrnap htfn kedden szerdn cstrtkn pnteken szombaton".split(" ")),Rr=(hr.defineLocale("hu",{months:"janur_februr_mrcius_prilis_mjus_jnius_jlius_augusztus_szeptember_oktber_november_december".split("_"),monthsShort:"jan_feb_mrc_pr_mj_jn_jl_aug_szept_okt_nov_dec".split("_"),weekdays:"vasrnap_htf_kedd_szerda_cstrtk_pntek_szombat".split("_"),weekdaysShort:"vas_ht_kedd_sze_cst_pn_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D., LT",LLLL:"YYYY. MMMM D., dddd LT"},meridiemParse:/de|du/i,isPM:function(e){return"u"===e.charAt(1).toLowerCase()},meridiem:function(e,t,n){return 12>e?n===!0?"de":"DE":n===!0?"du":"DU"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return zn.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return zn.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s mlva",past:"%s",s:$n,m:$n,mm:$n,h:$n,hh:$n,d:$n,dd:$n,M:$n,MM:$n,y:$n,yy:$n},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}}),hr.defineLocale("hy-am",{months:Un,monthsShort:Gn,weekdays:Kn,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",lastDay:"[] LT",nextWeek:function(){return"dddd [ ] LT"},lastWeek:function(){return"[] dddd [ ] LT"},sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},meridiemParse:/|||/,isPM:function(e){return/^(|)$/.test(e)},meridiem:function(e){return 4>e?"":12>e?"":17>e?"":""},ordinalParse:/\d{1,2}|\d{1,2}-(|)/,ordinal:function(e,t){switch(t){case"DDD":case"w":case"W":case"DDDo":return 1===e?e+"-":e+"-";default:return e}},week:{dow:1,doy:7}}),hr.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"LT.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiemParse:/pagi|siang|sore|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"siang"===t?e>=11?e:e+12:"sore"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,n){return 11>e?"pagi":15>e?"siang":19>e?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}}),hr.defineLocale("is",{months:"janar_febrar_mars_aprl_ma_jn_jl_gst_september_oktber_nvember_desember".split("_"),monthsShort:"jan_feb_mar_apr_ma_jn_jl_g_sep_okt_nv_des".split("_"),weekdays:"sunnudagur_mnudagur_rijudagur_mivikudagur_fimmtudagur_fstudagur_laugardagur".split("_"),weekdaysShort:"sun_mn_ri_mi_fim_fs_lau".split("_"),weekdaysMin:"Su_M_r_Mi_Fi_F_La".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd, D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gr kl.] LT",lastWeek:"[sasta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s san",s:ei,m:ei,mm:ei,h:"klukkustund",hh:ei,d:ei,dd:ei,M:ei,MM:ei,y:ei,yy:ei},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),hr.defineLocale("it",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"Domenica_Luned_Marted_Mercoled_Gioved_Venerd_Sabato".split("_"),weekdaysShort:"Dom_Lun_Mar_Mer_Gio_Ven_Sab".split("_"),weekdaysMin:"D_L_Ma_Me_G_V_S".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:function(){switch(this.day()){case 0:return"[la scorsa] dddd [alle] LT";default:return"[lo scorso] dddd [alle] LT"}},sameElse:"L"},relativeTime:{future:function(e){return(/^[0-9].+$/.test(e)?"tra":"in")+" "+e},past:"%s fa",s:"alcuni secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},ordinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}}),hr.defineLocale("ja",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahm",LTS:"LTs",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMDLT",LLLL:"YYYYMDLT dddd"},meridiemParse:/|/i,isPM:function(e){return""===e},meridiem:function(e,t,n){return 12>e?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd LT",lastDay:"[] LT",lastWeek:"[]dddd LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:"",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"}}),hr.defineLocale("jv",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_Nopember_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nop_Des".split("_"),weekdays:"Minggu_Senen_Seloso_Rebu_Kemis_Jemuwah_Septu".split("_"),weekdaysShort:"Min_Sen_Sel_Reb_Kem_Jem_Sep".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sp".split("_"),longDateFormat:{LT:"HH.mm",LTS:"LT.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiemParse:/enjing|siyang|sonten|ndalu/,meridiemHour:function(e,t){return 12===e&&(e=0),"enjing"===t?e:"siyang"===t?e>=11?e:e+12:"sonten"===t||"ndalu"===t?e+12:void 0},meridiem:function(e,t,n){return 11>e?"enjing":15>e?"siyang":19>e?"sonten":"ndalu"},calendar:{sameDay:"[Dinten puniko pukul] LT",nextDay:"[Mbenjang pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kala wingi pukul] LT",lastWeek:"dddd [kepengker pukul] LT",sameElse:"L"},relativeTime:{future:"wonten ing %s",past:"%s ingkang kepengker",s:"sawetawis detik",m:"setunggal menit",mm:"%d menit",h:"setunggal jam",hh:"%d jam",d:"sedinten",dd:"%d dinten",M:"sewulan",MM:"%d wulan",y:"setaun",yy:"%d taun"},week:{dow:1,doy:7}}),hr.defineLocale("ka",{months:ti,monthsShort:"___________".split("_"),weekdays:ni,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[] LT[-]",nextDay:"[] LT[-]",lastDay:"[] LT[-]",nextWeek:"[] dddd LT[-]",lastWeek:"[] dddd LT-",sameElse:"L"},relativeTime:{future:function(e){return/(|||)/.test(e)?e.replace(/$/,""):e+""},past:function(e){return/(||||)/.test(e)?e.replace(/(|)$/," ")://.test(e)?e.replace(/$/," "):void 0},s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinalParse:/0|1-|-\d{1,2}|\d{1,2}-/,ordinal:function(e){return 0===e?e:1===e?e+"-":20>e||100>=e&&e%20===0||e%100===0?"-"+e:e+"-"},week:{dow:1,doy:7}}),hr.defineLocale("km",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:1,doy:4}}),hr.defineLocale("ko",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h m",LTS:"A h m s",L:"YYYY.MM.DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D LT",LLLL:"YYYY MMMM D dddd LT"},calendar:{sameDay:" LT",nextDay:" LT",nextWeek:"dddd LT",lastDay:" LT",lastWeek:" dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",ss:"%d",m:"",mm:"%d",h:"",hh:"%d",d:"",dd:"%d",M:"",MM:"%d",y:"",yy:"%d"},ordinalParse:/\d{1,2}/,ordinal:"%d",meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,n){return 12>e?"":""}}),hr.defineLocale("lb",{months:"Januar_Februar_Merz_Abrll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonndeg_Mindeg_Dnschdeg_Mttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),weekdaysShort:"So._M._D._M._Do._Fr._Sa.".split("_"),weekdaysMin:"So_M_D_M_Do_Fr_Sa".split("_"),longDateFormat:{LT:"H:mm [Auer]",LTS:"H:mm:ss [Auer]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Haut um] LT",sameElse:"L",nextDay:"[Muer um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gschter um] LT",lastWeek:function(){switch(this.day()){case 2:case 4:return"[Leschten] dddd [um] LT";default:return"[Leschte] dddd [um] LT"}}},relativeTime:{future:ai,past:ri,s:"e puer Sekonnen",m:ii,mm:"%d Minutten",h:ii,hh:"%d Stonnen",d:ii,dd:"%d Deeg",M:ii,MM:"%d Mint",y:ii,yy:"%d Joer"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),{m:"minut_minuts_minut",mm:"minuts_minui_minutes",h:"valanda_valandos_valand",hh:"valandos_valand_valandas",d:"diena_dienos_dien",dd:"dienos_dien_dienas",M:"mnuo_mnesio_mnes",MM:"mnesiai_mnesi_mnesius",y:"metai_met_metus",yy:"metai_met_metus"}),Or="sekmadienis_pirmadienis_antradienis_treiadienis_ketvirtadienis_penktadienis_etadienis".split("_"),Xr=(hr.defineLocale("lt",{months:"sausio_vasario_kovo_balandio_gegus_birelio_liepos_rugpjio_rugsjo_spalio_lapkriio_gruodio".split("_"),monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:pi,weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_e".split("_"),weekdaysMin:"S_P_A_T_K_Pn_".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], LT [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, LT [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], LT [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, LT [val.]"},calendar:{sameDay:"[iandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Prajus] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prie %s",s:oi,m:li,mm:ui,h:li,hh:ui,d:li,dd:ui,M:li,MM:ui,y:li,yy:ui},ordinalParse:/\d{1,2}-oji/,ordinal:function(e){return e+"-oji"},week:{dow:1,doy:4}}),{m:"mintes_mintm_minte_mintes".split("_"),mm:"mintes_mintm_minte_mintes".split("_"),h:"stundas_stundm_stunda_stundas".split("_"),hh:"stundas_stundm_stunda_stundas".split("_"),d:"dienas_dienm_diena_dienas".split("_"),dd:"dienas_dienm_diena_dienas".split("_"),M:"mnea_mneiem_mnesis_mnei".split("_"),MM:"mnea_mneiem_mnesis_mnei".split("_"),y:"gada_gadiem_gads_gadi".split("_"),yy:"gada_gadiem_gads_gadi".split("_")}),Jr=(hr.defineLocale("lv",{months:"janvris_februris_marts_aprlis_maijs_jnijs_jlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_jn_jl_aug_sep_okt_nov_dec".split("_"),weekdays:"svtdiena_pirmdiena_otrdiena_trediena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY.",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, LT",LLLL:"YYYY. [gada] D. MMMM, dddd, LT"},calendar:{sameDay:"[odien pulksten] LT",nextDay:"[Rt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pagju] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"pc %s",past:"pirms %s",s:gi,m:mi,mm:fi,h:mi,hh:fi,d:mi,dd:fi,M:mi,MM:fi,y:mi,yy:fi},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),{words:{m:["jedan minut","jednog minuta"],mm:["minut","minuta","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mjesec","mjeseca","mjeseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(e,t){return 1===e?t[0]:e>=2&&4>=e?t[1]:t[2]},translate:function(e,t,n){var i=Jr.words[n];return 1===n.length?t?i[0]:i[1]:e+" "+Jr.correctGrammaticalCase(e,i)}}),Br=(hr.defineLocale("me",{months:["januar","februar","mart","april","maj","jun","jul","avgust","septembar","oktobar","novembar","decembar"],monthsShort:["jan.","feb.","mar.","apr.","maj","jun","jul","avg.","sep.","okt.","nov.","dec."],weekdays:["nedjelja","ponedjeljak","utorak","srijeda","etvrtak","petak","subota"],weekdaysShort:["ned.","pon.","uto.","sri.","et.","pet.","sub."],weekdaysMin:["ne","po","ut","sr","e","pe","su"],longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sjutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jue u] LT",lastWeek:function(){var e=["[prole] [nedjelje] [u] LT","[prolog] [ponedjeljka] [u] LT","[prolog] [utorka] [u] LT","[prole] [srijede] [u] LT","[prolog] [etvrtka] [u] LT","[prolog] [petka] [u] LT","[prole] [subote] [u] LT"];return e[this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"nekoliko sekundi",m:Jr.translate,mm:Jr.translate,h:Jr.translate,hh:Jr.translate,d:"dan",dd:Jr.translate,M:"mjesec",MM:Jr.translate,y:"godinu",yy:Jr.translate},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}}),hr.defineLocale("mk",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"e_o_____a".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:case 5:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinalParse:/\d{1,2}-(|||||)/,ordinal:function(e){var t=e%10,n=e%100;return 0===e?e+"-":0===n?e+"-":n>10&&20>n?e+"-":1===t?e+"-":2===t?e+"-":7===t||8===t?e+"-":e+"-"},week:{dow:1,doy:7}}),hr.defineLocale("ml",{months:"___________".split("_"),monthsShort:"._._._.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm -",LTS:"A h:mm:ss -",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiemParse:/|| ||/i,isPM:function(e){return/^( ||)$/.test(e)},meridiem:function(e,t,n){return 4>e?"":12>e?"":17>e?" ":20>e?"":""}}),{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}),Wr={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},qr=(hr.defineLocale("mr",{months:"___________".split("_"),monthsShort:"._._._._._._._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return Wr[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return Br[e]})},meridiemParse:/|||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?4>e?e:e+12:""===t?e:""===t?e>=10?e:e+12:""===t?e+12:void 0},meridiem:function(e,t,n){return 4>e?"":10>e?"":17>e?"":20>e?"":""},week:{dow:0,doy:6}}),hr.defineLocale("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"LT.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"tengahari"===t?e>=11?e:e+12:"petang"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,n){return 11>e?"pagi":15>e?"tengahari":19>e?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}}),{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}),Qr={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},$r=(hr.defineLocale("my",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[.] LT []",nextDay:"[] LT []",nextWeek:"dddd LT []",lastDay:"[.] LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:" %s ",past:" %s ",s:".",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(e){return e.replace(/[]/g,function(e){return Qr[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return qr[e]})},week:{dow:1,doy:4}}),hr.defineLocale("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tirs_ons_tors_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"H.mm",LTS:"LT.ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s siden",s:"noen sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",M:"en mned",MM:"%d mneder",y:"ett r",yy:"%d r"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""}),zr={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},Ur=(hr.defineLocale("ne",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"._.__._._._.".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},preparse:function(e){return e.replace(/[]/g,function(e){return zr[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return $r[e]})},meridiemParse:/|||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?3>e?e:e+12:""===t?e:""===t?e>=10?e:e+12:""===t||""===t?e+12:void 0},meridiem:function(e,t,n){return 3>e?"":10>e?"":15>e?"":18>e?"":20>e?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd[,] LT",lastDay:"[] LT",lastWeek:"[] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}}),"jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_")),Gr="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),Kr=(hr.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(e,t){return/-MMM-/.test(t)?Gr[e.month()]:Ur[e.month()]},weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"Zo_Ma_Di_Wo_Do_Vr_Za".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},ordinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}}),hr.defineLocale("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sundag_mndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"sun_mn_tys_ons_tor_fre_lau".split("_"),weekdaysMin:"su_m_ty_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I gr klokka] LT",lastWeek:"[Fregande] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s sidan",s:"nokre sekund",m:"eit minutt",mm:"%d minutt",h:"ein time",hh:"%d timar",d:"ein dag",dd:"%d dagar",M:"ein mnad",MM:"%d mnader",y:"eit r",yy:"%d r"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),"stycze_luty_marzec_kwiecie_maj_czerwiec_lipiec_sierpie_wrzesie_padziernik_listopad_grudzie".split("_")),Vr="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrzenia_padziernika_listopada_grudnia".split("_"),es=(hr.defineLocale("pl",{months:function(e,t){return""===t?"("+Vr[e.month()]+"|"+Kr[e.month()]+")":/D MMMM/.test(t)?Vr[e.month()]:Kr[e.month()]},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa_lis_gru".split("_"),weekdays:"niedziela_poniedziaek_wtorek_roda_czwartek_pitek_sobota".split("_"),weekdaysShort:"nie_pon_wt_r_czw_pt_sb".split("_"),weekdaysMin:"N_Pn_Wt_r_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Dzi o] LT",nextDay:"[Jutro o] LT",nextWeek:"[W] dddd [o] LT",lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz niedziel o] LT";case 3:return"[W zesz rod o] LT";case 6:return"[W zesz sobot o] LT";default:return"[W zeszy] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",m:_i,mm:_i,h:_i,hh:_i,d:"1 dzie",dd:"%d dni",M:"miesic",MM:_i,y:"rok",yy:_i},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),hr.defineLocale("pt-br",{months:"Janeiro_Fevereiro_Maro_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-Feira_Tera-Feira_Quarta-Feira_Quinta-Feira_Sexta-Feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Dom_2_3_4_5_6_Sb".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [s] LT",LLLL:"dddd, D [de] MMMM [de] YYYY [s] LT"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrs",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinalParse:/\d{1,2}/,ordinal:"%d"}),hr.defineLocale("pt",{months:"Janeiro_Fevereiro_Maro_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-Feira_Tera-Feira_Quarta-Feira_Quinta-Feira_Sexta-Feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Dom_2_3_4_5_6_Sb".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h %s",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}}),hr.defineLocale("ro",{months:"ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),monthsShort:"ian._febr._mart._apr._mai_iun._iul._aug._sept._oct._nov._dec.".split("_"),weekdays:"duminic_luni_mari_miercuri_joi_vineri_smbt".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_Sm".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_S".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[mine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s n urm",s:"cteva secunde",m:"un minut",mm:yi,h:"o or",hh:yi,d:"o zi",dd:yi,M:"o lun",MM:yi,y:"un an",yy:yi},week:{dow:1,doy:7}}),hr.defineLocale("ru",{months:Mi,monthsShort:Ti,weekdays:Li,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),monthsParse:[/^/i,/^/i,/^/i,/^/i,/^[|]/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i],longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return 2===this.day()?"[] dddd [] LT":"[] dddd [] LT"},lastWeek:function(e){if(e.week()===this.week())return 2===this.day()?"[] dddd [] LT":"[] dddd [] LT";switch(this.day()){case 0:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT";case 3:case 5:case 6:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:wi,mm:wi,h:"",hh:wi,d:"",dd:wi,M:"",MM:wi,y:"",yy:wi},meridiemParse:/|||/i,isPM:function(e){return/^(|)$/.test(e)},meridiem:function(e,t,n){return 4>e?"":12>e?"":17>e?"":""},ordinalParse:/\d{1,2}-(||)/,ordinal:function(e,t){
switch(t){case"M":case"d":case"DDD":return e+"-";case"D":return e+"-";case"w":case"W":return e+"-";default:return e}},week:{dow:1,doy:7}}),hr.defineLocale("si",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"a h:mm",LTS:"a h:mm:ss",L:"YYYY/MM/DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D, LT",LLLL:"YYYY MMMM D [] dddd, LTS"},calendar:{sameDay:"[] LT[]",nextDay:"[] LT[]",nextWeek:"dddd LT[]",lastDay:"[] LT[]",lastWeek:"[] dddd LT[]",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",m:"",mm:" %d",h:"",hh:" %d",d:"",dd:" %d",M:"",MM:" %d",y:"",yy:" %d"},ordinalParse:/\d{1,2} /,ordinal:function(e){return e+" "},meridiem:function(e,t,n){return e>11?n?"..":" ":n?"..":" "}}),"janur_februr_marec_aprl_mj_jn_jl_august_september_oktber_november_december".split("_")),ts="jan_feb_mar_apr_mj_jn_jl_aug_sep_okt_nov_dec".split("_"),ns=(hr.defineLocale("sk",{months:es,monthsShort:ts,monthsParse:function(e,t){var n,i=[];for(n=0;12>n;n++)i[n]=new RegExp("^"+e[n]+"$|^"+t[n]+"$","i");return i}(es,ts),weekdays:"nedea_pondelok_utorok_streda_tvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_t_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_t_pi_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedeu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo tvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[vera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minul nedeu o] LT";case 1:case 2:return"[minul] dddd [o] LT";case 3:return"[minul stredu o] LT";case 4:case 5:return"[minul] dddd [o] LT";case 6:return"[minul sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:Ci,m:Ci,mm:Ci,h:Ci,hh:Ci,d:Ci,dd:Ci,M:Ci,MM:Ci,y:Ci,yy:Ci},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),hr.defineLocale("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedelja_ponedeljek_torek_sreda_etrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._et._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_e_pe_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[veraj ob] LT",lastWeek:function(){switch(this.day()){case 0:return"[prejnjo] [nedeljo] [ob] LT";case 3:return"[prejnjo] [sredo] [ob] LT";case 6:return"[prejnjo] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[prejnji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"ez %s",past:"pred %s",s:Si,m:Si,mm:Si,h:Si,hh:Si,d:Si,dd:Si,M:Si,MM:Si,y:Si,yy:Si},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}}),hr.defineLocale("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nn_Dhj".split("_"),weekdays:"E Diel_E Hn_E Mart_E Mrkur_E Enjte_E Premte_E Shtun".split("_"),weekdaysShort:"Die_Hn_Mar_Mr_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_M_E_P_Sh".split("_"),meridiemParse:/PD|MD/,isPM:function(e){return"M"===e.charAt(0)},meridiem:function(e,t,n){return 12>e?"PD":"MD"},longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Sot n] LT",nextDay:"[Nesr n] LT",nextWeek:"dddd [n] LT",lastDay:"[Dje n] LT",lastWeek:"dddd [e kaluar n] LT",sameElse:"L"},relativeTime:{future:"n %s",past:"%s m par",s:"disa sekonda",m:"nj minut",mm:"%d minuta",h:"nj or",hh:"%d or",d:"nj dit",dd:"%d dit",M:"nj muaj",MM:"%d muaj",y:"nj vit",yy:"%d vite"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}}),{words:{m:[" "," "],mm:["","",""],h:[" "," "],hh:["","",""],dd:["","",""],MM:["","",""],yy:["","",""]},correctGrammaticalCase:function(e,t){return 1===e?t[0]:e>=2&&4>=e?t[1]:t[2]},translate:function(e,t,n){var i=ns.words[n];return 1===n.length?t?i[0]:i[1]:e+" "+ns.correctGrammaticalCase(e,i)}}),is=(hr.defineLocale("sr-cyrl",{months:["","","","","","","","","","","",""],monthsShort:[".",".",".",".","","","",".",".",".",".","."],weekdays:["","","","","","",""],weekdaysShort:[".",".",".",".",".",".","."],weekdaysMin:["","","","","","",""],longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:function(){switch(this.day()){case 0:return"[] [] [] LT";case 3:return"[] [] [] LT";case 6:return"[] [] [] LT";case 1:case 2:case 4:case 5:return"[] dddd [] LT"}},lastDay:"[ ] LT",lastWeek:function(){var e=["[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT"];return e[this.day()]},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:ns.translate,mm:ns.translate,h:ns.translate,hh:ns.translate,d:"",dd:ns.translate,M:"",MM:ns.translate,y:"",yy:ns.translate},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}}),{words:{m:["jedan minut","jedne minute"],mm:["minut","minute","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mesec","meseca","meseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(e,t){return 1===e?t[0]:e>=2&&4>=e?t[1]:t[2]},translate:function(e,t,n){var i=is.words[n];return 1===n.length?t?i[0]:i[1]:e+" "+is.correctGrammaticalCase(e,i)}}),as=(hr.defineLocale("sr",{months:["januar","februar","mart","april","maj","jun","jul","avgust","septembar","oktobar","novembar","decembar"],monthsShort:["jan.","feb.","mar.","apr.","maj","jun","jul","avg.","sep.","okt.","nov.","dec."],weekdays:["nedelja","ponedeljak","utorak","sreda","etvrtak","petak","subota"],weekdaysShort:["ned.","pon.","uto.","sre.","et.","pet.","sub."],weekdaysMin:["ne","po","ut","sr","e","pe","su"],longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedelju] [u] LT";case 3:return"[u] [sredu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jue u] LT",lastWeek:function(){var e=["[prole] [nedelje] [u] LT","[prolog] [ponedeljka] [u] LT","[prolog] [utorka] [u] LT","[prole] [srede] [u] LT","[prolog] [etvrtka] [u] LT","[prolog] [petka] [u] LT","[prole] [subote] [u] LT"];return e[this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"pre %s",s:"nekoliko sekundi",m:is.translate,mm:is.translate,h:is.translate,hh:is.translate,d:"dan",dd:is.translate,M:"mesec",MM:is.translate,y:"godinu",yy:is.translate},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}}),hr.defineLocale("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mndag_tisdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_mn_tis_ons_tor_fre_lr".split("_"),weekdaysMin:"s_m_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igr] LT",nextWeek:"[P] dddd LT",lastWeek:"[I] dddd[s] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"fr %s sedan",s:"ngra sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},ordinalParse:/\d{1,2}(e|a)/,ordinal:function(e){var t=e%10,n=1===~~(e%100/10)?"e":1===t?"a":2===t?"a":"e";return e+n},week:{dow:1,doy:4}}),hr.defineLocale("ta",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[ ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:" ",mm:"%d ",h:"  ",hh:"%d  ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinalParse:/\d{1,2}/,ordinal:function(e){return e+""},meridiemParse:/|||||/,meridiem:function(e,t,n){return 2>e?" ":6>e?" ":10>e?" ":14>e?" ":18>e?" ":22>e?" ":" "},meridiemHour:function(e,t){return 12===e&&(e=0),""===t?2>e?e:e+12:""===t||""===t?e:""===t&&e>=10?e:e+12},week:{dow:0,doy:6}}),hr.defineLocale("th",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"._._._._._._.".split("_"),longDateFormat:{LT:"H  m ",LTS:"LT s ",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY  LT",LLLL:"dddd D MMMM YYYY  LT"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,n){return 12>e?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd[ ] LT",lastDay:"[ ] LT",lastWeek:"[]dddd[ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}}),hr.defineLocale("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM DD, YYYY LT"},calendar:{sameDay:"[Ngayon sa] LT",nextDay:"[Bukas sa] LT",nextWeek:"dddd [sa] LT",lastDay:"[Kahapon sa] LT",lastWeek:"dddd [huling linggo] LT",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},ordinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}}),{1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'nc",4:"'nc",100:"'nc",6:"'nc",9:"'uncu",10:"'uncu",30:"'uncu",60:"'nc",90:"'nc"}),rs=(hr.defineLocale("tr",{months:"Ocak_ubat_Mart_Nisan_Mays_Haziran_Temmuz_Austos_Eyll_Ekim_Kasm_Aralk".split("_"),monthsShort:"Oca_ub_Mar_Nis_May_Haz_Tem_Au_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal_aramba_Perembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_ar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_a_Pe_Cu_Ct".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[yarn saat] LT",nextWeek:"[haftaya] dddd [saat] LT",lastDay:"[dn] LT",lastWeek:"[geen hafta] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s nce",s:"birka saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir yl",yy:"%d yl"},ordinalParse:/\d{1,2}'(inci|nci|nc|nc|uncu|nc)/,ordinal:function(e){if(0===e)return e+"'nc";var t=e%10,n=e%100-t,i=e>=100?100:null;return e+(as[t]||as[n]||as[i])},week:{dow:1,doy:7}}),hr.defineLocale("tzm-latn",{months:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",m:"minu",mm:"%d minu",h:"saa",hh:"%d tassain",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}}),hr.defineLocale("tzm",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:"   %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d o",M:"o",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}}),hr.defineLocale("uk",{months:Yi,monthsShort:"___________".split("_"),weekdays:ji,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:Ni("[ "),nextDay:Ni("[ "),lastDay:Ni("[ "),nextWeek:Ni("[] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return Ni("[] dddd [").call(this);case 1:case 2:case 4:return Ni("[] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:Di,mm:Di,h:"",hh:Di,d:"",dd:Di,M:"",MM:Di,y:"",yy:Di},meridiemParse:/|||/,isPM:function(e){return/^(|)$/.test(e)},meridiem:function(e,t,n){return 4>e?"":12>e?"":17>e?"":""},ordinalParse:/\d{1,2}-(|)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e+"-";case"D":return e+"-";default:return e}},week:{dow:1,doy:7}}),hr.defineLocale("uz",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"D MMMM YYYY, dddd LT"},calendar:{sameDay:"[ ] LT []",nextDay:"[] LT []",nextWeek:"dddd [ ] LT []",lastDay:"[ ] LT []",lastWeek:"[] dddd [ ] LT []",sameElse:"L"},relativeTime:{future:" %s ",past:"  %s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}}),hr.defineLocale("vi",{months:"thng 1_thng 2_thng 3_thng 4_thng 5_thng 6_thng 7_thng 8_thng 9_thng 10_thng 11_thng 12".split("_"),monthsShort:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_"),weekdays:"ch nht_th hai_th ba_th t_th nm_th su_th by".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM [nm] YYYY",LLL:"D MMMM [nm] YYYY LT",LLLL:"dddd, D MMMM [nm] YYYY LT",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[Hm nay lc] LT",nextDay:"[Ngy mai lc] LT",nextWeek:"dddd [tun ti lc] LT",lastDay:"[Hm qua lc] LT",lastWeek:"dddd [tun ri lc] LT",sameElse:"L"},relativeTime:{future:"%s ti",past:"%s trc",s:"vi giy",m:"mt pht",mm:"%d pht",h:"mt gi",hh:"%d gi",d:"mt ngy",dd:"%d ngy",M:"mt thng",MM:"%d thng",y:"mt nm",yy:"%d nm"},ordinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}}),hr.defineLocale("zh-cn",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahmm",LTS:"Ahms",L:"YYYY-MM-DD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYY-MM-DD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"},meridiemParse:/|||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t||""===t||""===t?e:""===t||""===t?e+12:e>=11?e:e+12},meridiem:function(e,t,n){var i=100*e+t;return 600>i?"":900>i?"":1130>i?"":1230>i?"":1800>i?"":""},calendar:{sameDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},nextDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},lastDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},nextWeek:function(){var e,t;return e=hr().startOf("week"),t=this.unix()-e.unix()>=604800?"[]":"[]",0===this.minutes()?t+"dddAh":t+"dddAhmm"},lastWeek:function(){var e,t;return e=hr().startOf("week"),t=this.unix()<e.unix()?"[]":"[]",0===this.minutes()?t+"dddAh":t+"dddAhmm"},sameElse:"LL"},ordinalParse:/\d{1,2}(||)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"";case"M":return e+"";case"w":case"W":return e+"";default:return e}},relativeTime:{future:"%s",past:"%s",s:"",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "},week:{dow:1,doy:4}}),hr.defineLocale("zh-tw",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahmm",LTS:"Ahms",L:"YYYYMMMD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"},meridiemParse:/||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t||""===t?e:""===t?e>=11?e:e+12:""===t||""===t?e+12:void 0},meridiem:function(e,t,n){var i=100*e+t;return 900>i?"":1130>i?"":1230>i?"":1800>i?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:"[]ddddLT",lastDay:"[]LT",lastWeek:"[]ddddLT",sameElse:"L"},ordinalParse:/\d{1,2}(||)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"";case"M":return e+"";case"w":case"W":return e+"";default:return e}},relativeTime:{future:"%s",past:"%s",s:"",m:"",mm:"%d",h:"",hh:"%d",d:"",dd:"%d",M:"",MM:"%d",y:"",yy:"%d"}}),hr);return rs}),function(){define("component/notification/store",["require","exports","module","xss","moment","cui/core/events/pubsub","../../util/index","module/common/globalService"],function(e,t,n){function i(e,t){function n(){}var i;if(n.prototype=e,i=new n,$.isPlainObject(t))for(var a in t)t.hasOwnProperty(a)&&(i[a]=t[a]);return i}function a(e,t){return t?t.toUpperCase():""}function r(e){return e==v[1]?"InMailFb":e.replace(w,a)}function s(e){var t,n={bgClass:"bg-default",iconClass:"iconunknownapp"};return"string"==typeof e&&e.length?(e=e.toLowerCase(),t=M[e],null==t?n:(t[0]&&(n.bgClass=t[0]),t[1]&&(n.iconClass=t[1]),n)):n}var o=e("xss"),l=e("moment"),c=e("cui/core/events/pubsub"),d=e("../../util/index"),u=d.i18n,p=d.size,h=e("module/common/globalService"),f=new c("component.notification"),m=new c("component.notification.online"),g=new c("component.notification.history"),v={1:1,in_mail:"in_mail",in_auto_fwd:"in_auto_fwd",in_auto_reply:"in_auto_reply",out_ds:"out_ds",out_read:"out_read",mail_quota:"mail_quota",offsite_remind:"offsite_remind",meeting_new:"meeting_new",meeting_request:"meeting_request"},_={showDuration:5e3,_initUIInfo:function(){this.uiInfo=s(this.type)},_formatEmail:function(e){return o(e)},_formatMailSubject:function(e){var t,n=100;return e=o(e),t=null!=Array.from?Array.from(e).length:e.length,t>n&&(e=e.substr(0,n)+"..."),e},_formatTime:function(e){return l(e).format("YYYY-MM-DD HH:mm")},exportTitle:function(){return this.title}},y=i(_,{initFid:function(){var e=parseInt(this.payload.fid);e=isNaN(e)?1:e,this.payload.fid=e},updateFolder:function(){var e=this.payload.fid;f.sendMessage("mail","folder:refresh",{ids:e}),f.sendMessage("mail.list","view:refresh",{fid:e,keepScrollPosition:!0,resetPagination:!0})},handleDetail:function(){var e=h.getUser(),t=e.preview_layout?"mail.previewlayout":"mail.list";f.sendMessage("dispatcher","history:add",{module:t,param:{historyUrl:encodeURIComponent(t),fid:this.payload.fid}})},isPermitPush:function(){var e=h.getConfig("setting.supportmsgnotifyfolder"),t=h.getUser().ws_msg_notify_folder;return!(e&&null!=t&&"@all"!==t&&("@none"===t||-1===$.inArray(this.payload.fid.toString(),t.split(","))))}}),b={InMailFbProto:i(y,{init:function(e,t){return this.type=v[1],this.title=u.t("common/lbl_notification_in_email_title"),this.payload=e.payload,t=parseInt(t,10),(isNaN(t)||!t)&&(t=1),this.length=t,this.initFid(),this._initUIInfo(),this.updateFolder(),this.isPermitPush()},exportContent:function(){return u.t("common/lbl_notification_in_email_fb_content",{count:this.length})}}),InMailProto:i(y,{init:function(e){return this.payload=e.payload,this.type=v.in_mail,this.title=u.t("common/lbl_notification_in_email_title"),this.initFid(),this._initUIInfo(),this.updateFolder(),this.isPermitPush()},exportContent:function(){var e=this.payload;return[u.t("common/lbl_notification_in_email_from",{from:this._formatEmail(e.Sender)}),"\n",u.t("common/lbl_notification_in_email_subject",{subject:this._formatMailSubject(e.sub)})].join("")}}),InAutoFwdProto:i(_,{showDuration:1e4,init:function(e){this.payload=e.payload,this.type=v.in_auto_fwd,this.title=u.t("common/lbl_notification_in_auto_fwd_title"),this._initUIInfo()},exportContent:function(){var e=this.payload;return u.t("common/lbl_notification_auto_forward_content",{subject:this._formatMailSubject(e.subject),time:this._formatTime(e.time),forwardTo:this._formatEmail(e.forwardTo)})},handleDetail:function(){f.sendMessage("dispatcher","history:add",{module:"setting.filter.letter"})}}),InAutoReplyProto:i(_,{init:function(e){this.payload=e.payload,this.type=v.in_auto_reply,this.title=u.t("common/lbl_notification_in_auto_reply_title"),this._initUIInfo()},exportContent:function(){var e=this.payload;return u.t("common/lbl_notification_auto_reply_content",{subject:this._formatMailSubject(e.subject),time:this._formatTime(e.time)})}}),OutDsProto:i(_,{init:function(e){this.payload=e.payload,this.type=v.out_ds,this.title=u.t("common/lbl_notification_out_ds_title"),this._initUIInfo()},exportContent:function(){var e=this.payload;return u.t("common/lbl_notification_delivery_state_content",{subject:this._formatMailSubject(e.subject),time:this._formatTime(e.time),toName:this._formatEmail(e.toName||e.to)})}}),OutReadProto:i(_,{init:function(e){this.payload=e.payload,this.type=v.out_read,this.title=u.t("common/lbl_notification_out_read_title"),this._initUIInfo()},exportContent:function(){var e=this.payload;return u.t("common/lbl_notification_read_content",{subject:this._formatMailSubject(e.subject),time:this._formatTime(e.time),toName:this._formatEmail(e.toName||e.to)})}}),OffsiteRemindProto:i(_,{showDuration:1e4,init:function(e){this.payload=e.payload,this.type=v.offsite_remind,this.title=u.t("common/lbl_notification_offsite_remind_title"),this._initUIInfo()},exportContent:function(){var e=this.payload;return u.t("common/lbl_notification_offsite_content",{ip:e.last.ip,time:this._formatTime(e.last.time)})},handleDetail:function(){f.sendMessage("dispatcher","history:add",{module:"logs.login"})}}),MailQuotaProto:i(_,{init:function(e){this.payload=e.payload,this.type=v.mail_quota,this.title=u.t("common/lbl_notification_mail_quota_title"),this._initUIInfo()},exportContent:function(){var e=this.payload;return u.t("common/lbl_notification_mail_quota_content",{total:p.bytesToSize(e.mail_quota),used:p.bytesToSize(e.used_space)})},handleDetail:function(){f.sendMessage("dispatcher","history:add",{module:"setting.folder.folder"})}}),MeetingNewProto:i(_,{init:function(e){this.payload=e.payload,this.type=v.meeting_new,this.title=u.t("common/lbl_notification_meeting_new_title"),this._initUIInfo()},exportContent:function(){return this.title}}),MeetingRequestProto:i(_,{init:function(e){this.payload=e.payload,this.type=v.meeting_request,this.title=u.t("common/lbl_notification_meeting_request_title"),this._initUIInfo()},exportContent:function(){return this.title}})},w=/(?:^|[_])(\w)/g,M={in_mail:["bg-in-mail","iconemail"],in_auto_fwd:["bg-in-auto-fwd","iconemail"],in_auto_reply:["bg-in-auto-reply","iconemail"],out_ds:["bg-out-ds","iconemail"],out_read:["bg-out-read","iconemail"],mail_quota:["bg-mail-quota","iconsms"],offsite_remind:["bg-offsite-remind","iconhead"],meeting_new:["bg-meeting-new","iconschedule"],meeting_request:["bg-meeting-request","iconschedule"]};n.exports={createObj:i,MsgTypes:v,MsgInfoProtos:b,classifyMsgType:r,pubSub:f,onlinePubSub:m,historyPubSub:g,getMsgTypeUIInfo:s}})}(),function(){define("component/notification/online",["require","exports","module","i18n!main,common","jquery","handlebars","cui/ui/overlay/overlay","widget/notification/notification","../../util/visibly","../wsStore","module/common/globalService","text!../../template/component/notificationOnline.tpl.html","./store"],function(e,t,n){e("i18n!main,common");var i=e("jquery"),a=e("handlebars"),r=e("cui/ui/overlay/overlay"),s=e("widget/notification/notification"),o=e("../../util/visibly"),l=e("../wsStore"),c=e("module/common/globalService"),d=e("text!../../template/component/notificationOnline.tpl.html"),u=e("./store"),p={_uid:0,_model:{before:[],email:null,after:[]},push:function(e){var t=this._model,n=e.type,i=u.createObj(u.MsgInfoProtos[u.classifyMsgType(n)+"Proto"]);if(i.uid=this._uid++,n==u.MsgTypes[1]){if(!i.init(e,null==t.email?0:t.email.length+1))return!1;t.email=i,t.after=t.after.concat(t.before.splice(0,t.before.length))}else{if(i.init(e)===!1)return!1;t.before.unshift(i)}return!0},prev:function(e){var t,n,i=this._model;if(null==e)return this.getLength()?this.next():!1;if(t=this.getMsgPosition(e),t===!1)return this.next();if(t===!1)return!1;switch(t[0]){case"email":n=i.before[i.before.length-1];break;case"before":n=i.before[t[1]-1];break;case"after":n=0===t[1]?i.email||i.before[i.before.length-1]:i.after[t[1]-1]}return n},next:function _(e){var t,_,n=this._model;if(null==e)t=this.getLength()?["before",-1]:!1;else if(t=this.getMsgPosition(e),t===!1)return this.next();if(t===!1)return!1;switch(t[0]){case"email":_=n.after[0];break;case"before":_=t[1]===n.before.length-1?n.email||n.after[0]:n.before[t[1]+1];break;case"after":_=n.after[t[1]+1]}return _},close:function(e){var t=this.getMsgPosition(e),n=this._model;if(t===!1)return!1;switch(t[0]){case"email":n.email=null;break;case"before":n.before.splice(t[1],1);break;case"after":n.after.splice(t[1],1)}return!0},clean:function(){var e=this._model;e.before=[],e.email=null,e.after=[]},getLength:function(e){var t=this._model,n=t.before.length,i=null==t.email?0:1,a=t.after.length;return e===!0?[n,i,a]:n+i+a},_checkMsgIndexInArr:function(e,t){if(e=parseInt(e,10),isNaN(e))return-1;for(var n=0;n<t.length;++n)if(t[n].uid===parseInt(e,10))return n;return-1},getMsgPosition:function(e){var t,n=this._model,i=e.type;return e?i==u.MsgTypes[1]?["email"]:(t=this._checkMsgIndexInArr(e.uid,n.before),t>=0?["before",t]:(t=this._checkMsgIndexInArr(e.uid,n.after),t>=0?["after",t]:!1)):!1},getMsgIndex:function(e){var t,n=this.getLength(!0),i=this.getMsgPosition(e);if(i===!1)return!1;switch(i[0]){case"email":t=n[0];break;case"before":t=i[1];break;case"after":t=n[0]+n[1]+i[1]}return{index:t,total:n[0]+n[1]+n[2]}}},h={msgInfo:null,emailInstance:null,icon:CC.projectRevision()+"/style/img/notification.jpg",init:function(){return s.checkAvailable()&&s.initPermission(),h},destroy:function(){},popMsg:function(){var e=h,t=p.next(),n={};return t?(n.title=t.exportTitle(),n.body=t.exportContent(),n.icon=e.icon,n.timeout=t.showDuration,n._meta={msgInfo:t},n.onClick=function(){var e=this._meta.msgInfo;this.close(),o.hidden()&&window.focus(),setTimeout(function(){i.isFunction(e.handleDetail)&&e.handleDetail()},100)},n.onClose=function(){var e=this._meta.msgInfo;return e?(!this._skipClean&&p.close(e),void delete this._meta.msgInfo):!1},void s.createThreshold(n,function(t){var n;t._meta.msgInfo.type===u.MsgTypes[1]&&((n=e.emailInstance)&&!n._closed&&(n._skipClean=!0,n.close()),e.emailInstance=t)})):!1}},f=r.extend({hideClass:"f-dni",attrs:{template:a.compile(d)(),align:!1,msgInfo:null,showDurationTimeoutId:null,isBlock:!1,visibleState:null},events:{mouseenter:"_handleMouseEnter",mouseleave:"_handleMouseLeave","click .j-action":"_handleActionClick"},setup:function(){f.superclass.setup.call(this),o.visibilitychange(i.proxy(this._handleVisibleChange,this)),this.after("render",function(){this.$header=this.$(".j-header"),this.$content=this.$(".j-content"),this.$footer=this.$(".j-footer"),this.$title=this.$(".j-title"),this.$pageWrap=this.$(".j-page-wrap"),this.$pagePrev=this.$(".j-page-prev"),
this.$pageInfo=this.$(".j-page-info"),this.$pageNext=this.$(".j-page-next")},this)},destroy:function(){clearTimeout(this.get("popTimeoutId")),this._close(),f.superclass.destroy.call(this)},popMsg:function(){if(this.show(),this.get("isBlock")){var e=this.get("msgInfo"),t=p.getMsgIndex(e);this._renderPager(t)}else this.set("msgInfo",p.next())},_close:function(){this._stopMsgAutoHide(),this.hide()},_renderMsgItem:function(){var e=this.get("msgInfo"),t=p.getMsgIndex(e);this._enableMsgAutoHide(),this._renderPager(t),this._toggleDetailBtn(i.isFunction(e.handleDetail)),this.$content.text(i.trim(e.exportContent())),this.$title.html(e.exportTitle())},_renderPager:function(e){var t="disabled",n="f-dn";if(e===!1)return void this.$pageWrap.addClass(n);this.$pageWrap.removeClass(n);var i=e.index,a=e.total;0===i?this.$pagePrev.addClass(t):this.$pagePrev.removeClass(t),i+1===a?this.$pageNext.addClass(t):this.$pageNext.removeClass(t),this.$pageInfo.html([i+1,"/",a].join(""))},_toggleDetailBtn:function(e){var t=this.$footer.find('[data-role="detail"]');e===!0?t.removeClass(this.hideClass):t.addClass(this.hideClass)},_handleActionClick:function(e,t){var n=i(t),a=n.data("action");switch(e.preventDefault(),a){case"prev":this._handlePrevMsg(n);break;case"next":this._handleNextMsg(n);break;case"clean":this._handleCleanMsgs();break;case"close":this._handleCloseMsg();break;case"detail":this._handleMsgDetail()}},_handlePrevMsg:function(e){return e&&e.hasClass("disabled")?!1:void this.set("msgInfo",p.prev(this.get("msgInfo")))},_handleNextMsg:function(e){return e&&e.hasClass("disabled")?!1:void this.set("msgInfo",p.next(this.get("msgInfo")))},_handleCleanMsgs:function(){p.clean(),this._close()},_handleCloseMsg:function(){var e=this.get("msgInfo"),t=p.next(e);!t&&p.getLength()&&(t=p.prev(e)),p.close(e),t?this.set("msgInfo",t):this._close()},_handleMsgDetail:function(){var e=this.get("msgInfo");i.isFunction(e.handleDetail)&&e.handleDetail()},_handleMouseEnter:function(){this.set("isBlock",!0),this._stopMsgAutoHide()},_handleMouseLeave:function(){this.set("isBlock",!1),this._enableMsgAutoHide()},_handleVisibleChange:function(e){return console.log(e),this.set("visibleState",e),"hidden"===e&&null!=this.get("showDurationTimeoutId")?void this._stopMsgAutoHide():"visible"===e&&this.get("visible")&&null==this.get("showDurationTimeoutId")?void this._enableMsgAutoHide():void 0},_enableMsgAutoHide:function(){var e=this.get("msgInfo"),t=this.get("visibleState");this._stopMsgAutoHide(),null==t&&this.set("visibleState",t=o.hidden()?"hidden":"visible"),"hidden"!==t&&(this.get("isBlock")||this.set("showDurationTimeoutId",setTimeout(i.proxy(function(){this.set("showDurationTimeoutId",null),this._handleCloseMsg()},this),e.showDuration||1e4)))},_stopMsgAutoHide:function(){var e=this.get("showDurationTimeoutId");null!=e&&clearTimeout(e),this.set("showDurationTimeoutId",null)},_onChangeMsgInfo:function(e){e===!1?this._close():this._renderMsgItem()}}),m={overlayView:null,desktopView:null,onDuty:!1,init:function(){this.overlayView=new f,this.desktopView=h.init(),this.onDuty=!0},destroy:function(){this.overlayView&&this.overlayView.destroy(),this.desktopView&&this.desktopView.destroy(),this.onDuty=!1,this.overlayView=null,this.desktopView=null},pushMsg:function(e){this.onDuty&&p.push(e)&&this._doPush()},_doPush:function(){var e=this;s.checkAvailable()?s.checkPermission(function(t){t===s.permissionTypes.GRANTED?e.desktopView.popMsg():e.overlayView.popMsg()}):this.overlayView.popMsg()}},g={cancelObservers:[],init:function(){function e(e){m.pushMsg(e)}this.cancelObservers.push(l.subscribe(l.topicList.IN_MAIL,e)),this.cancelObservers.push(l.subscribe(l.topicList.IN_AUTO_FWD,e)),this.cancelObservers.push(l.subscribe(l.topicList.OUT_READ,e)),this.cancelObservers.push(l.subscribe(l.topicList.MAIL_QUOTA,e)),this.cancelObservers.push(l.subscribe(l.topicList.OFFSITE_REMIND,e)),this.cancelObservers.push(l.subscribe(l.topicList.MEETING_NEW,e)),this.cancelObservers.push(l.subscribe(l.topicList.MEETING_REQUEST,e))},destroy:function(){i.each(this.cancelObservers,function(e,t){null!=t&&t()}),this.cancelObservers.length=0}},v={_onlineView:null,init:function(){u.pubSub.onMessage("notificationReset",function(){v._toggle()}),v._toggle()},_toggle:function(){var e=c.getUser().ws_msg_notify;e=!("undefined"==typeof e||"0"==e),e?v.on():v.destroy()},on:function(){m.init(),g.init()},destroy:function(){m.destroy(),g.destroy()}};n.exports=v})}(),define("component/screenlock/module",["require","jquery","../../util/index","../../module/common/globalService"],function(e){var t=e("jquery"),n=e("../../util/index"),i=e("../../module/common/globalService"),a={_locked:!1,_listeners:{},_enableLock:i.getConfig("user.enablelockscreen"),_listenerId:0,_notifyListener:function(e){var n,i;if(a._enableLock)for(n in a._listeners)a._listeners.hasOwnProperty(n)&&(i=a._listeners[n],"function"==t.type(i.callback)&&i.callback.call(i.context,e))}},r=function(e){"boolean"==typeof e&&a._locked!==e&&(a._notifyListener(e),a._locked=e)},s=function(){return a._locked},o=function(e,n){var i;if(a._enableLock)return i=++a._listenerId,e="function"==t.type(e)?e:t.noop,n=t.isPlainObject(n)?n:{},a._listeners[i]={callback:e,context:n},i},l=function(e){a._enableLock&&"undefined"!=typeof e&&delete a._listeners[e]},c=function(){var e=t.Deferred();return n.xhr.simpleCall({onlyVar:!1,query:{func:"user:lockScreen",sid:i.getSid()}},function(t){r(!0),e.resolve(t)},function(t){e.reject(t)}),e.promise()},d=function(e){var a=t.Deferred();return n.xhr.simpleCall({onlyVar:!1,query:{func:"user:unlockScreen",sid:i.getSid()},data:{password:e}},function(e){r(!1),a.resolve(e)},function(e){a.reject(e)}),a.promise()};return{setLockStatus:r,getLockStatus:s,addListener:o,removeListener:l,lockScreenService:c,unlockScreenService:d}}),define("module/common/intervalcheck",["require","i18n!main,common,error","jquery","../../util/index","cui/core/events/pubsub","./globalService","../../component/screenlock/module"],function(e){e("i18n!main,common,error");var t=e("jquery"),n=e("../../util/index"),i=n.i18n,a=e("cui/core/events/pubsub"),r=e("./globalService"),s=e("../../component/screenlock/module"),o=3e5,l=function(){var e=t.Deferred(),i={doCheck:!0,noSessionSet:!0};return n.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:n.xhr.getRequestURL({url:"/XT5/jsp/common.jsp",query:{func:"common:intervalCheck",sid:r.getSid()}}),data:t.param(i)},function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise()},c={_intervalId:-1,_pubSub:null,_checksum:null,_init:function(){c._pubSub=new a("common.intervalcheck"),c._intervalId=setInterval(c._check,o)},_destroy:function(){clearInterval(c._intervalId)},_check:function(){t.when(l()).then(function(e){s.setLockStatus(e.isLocked),!e.isLocked&&e.checksum&&(c._checksum&&e.checksum!=c._checksum&&c._updateMailFolder(),c._checksum=e.checksum)},function(e){var n=e.responseJSON;t.isPlainObject(n)&&"FA_INVALID_SESSION"===n.errorCode&&(c._alertInvalidSession(),c._destroy())})},_alertInvalidSession:function(){t.notify({body:i.t("error/FA_INVALID_SESSION"),type:"error"})},_updateMailFolder:function(){c._pubSub.sendMessage("mail","folder:refresh",{type:"all"})}};return{init:function(){c._init()},destroy:function(){c._destroy()}}}),define("components/requirejs-text/text!component/../../template/component/screenlock.tpl.html",[],function(){return'<div class="u-screenlock">\r\n  <div class="c-mask c-mask-img">\r\n    <img src="796e441f/style/img/scrbg.jpg" />\r\n  </div>\r\n  <div class="c-mask c-mask-color">\r\n\r\n  </div>\r\n  <div class="c-main">\r\n    <div class="c-header skin-primary-bg">&nbsp;</div>\r\n    <div class="c-content">\r\n      <h1>{{ i18n "scr/unlock_screen_msg_statu" }}</h1>\r\n\r\n      <div class="c-content-icon">\r\n        <i class="iconfont iconlock"></i>\r\n      </div>\r\n\r\n      <div class="c-content-form">\r\n        <div class="u-form-item">\r\n          <label>\r\n            {{ i18n "scr/password" }}\r\n          </label>\r\n          <input type="password"class="u-input j-password u-screenlock-password">\r\n        </div>\r\n\r\n        <div class="u-form-item">\r\n          <button class="u-btn u-btn-primary j-submit u-screenlock-submit" data-role="confirm">{{ i18n "common/confirm" }}</button>\r\n        </div>\r\n\r\n        <p class="u-form-explain f-dn j-explain"></p>\r\n      </div>\r\n\r\n    </div>\r\n    <div class="c-footer">\r\n      <ul class="u-list u-list-horizontal">\r\n        <li><a href="{{ helpIndexUrl }}" target="_blank">{{ i18n "main/Help" }}</a></li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</div>'}),define("component/screenlock/view",["require","i18n!main,common,scr,error","text!../../../template/component/screenlock.tpl.html","jquery","handlebars","../../util/i18n","../confirmbox","./module","../../module/common/globalService"],function(e){e("i18n!main,common,scr,error");var t=e("text!../../../template/component/screenlock.tpl.html"),n=e("jquery"),i=e("handlebars"),a=e("../../util/i18n"),r=e("../confirmbox"),s=e("./module"),o=e("../../module/common/globalService"),l={_doc:n(document.body),_failLimit:o.getConfig("user.unlockFailCountLimit"),_failCurrent:0,$element:null,init:function(){s.addListener(l._onChangeLockStatus,l)},confirm:function(){r.confirm(a.t("scr/lock_screen_confirm_msg"),function(){s.lockScreenService()},function(){},{title:a.t("scr/lock_screen_confirm_title"),confirmTpl:a.t("scr/lock_screen_confirm_ok"),cancelTpl:a.t("common/cancel")})},_onChangeLockStatus:function(e){"boolean"==typeof e&&(e?l._render():l._close())},_render:function(){return l.$element?!1:(l.$element=n(i.compile(t)({helpIndexUrl:o.getConfig("context.helpurl")})),l.$element.appendTo(l._doc),l.$element.on("click",".j-submit",n.proxy(l._submit,l)),void l.$element.on("keyup",".j-password",function(e){e.preventDefault(),13==e.which&&l._submit(e)}))},_submit:function(e){var t,i,r=l.$element.find(".j-password"),o=l.$element.find(".j-explain"),c=a.t("scr/password_empty"),d=a.t("scr/unauthorizedHead"),u=a.t("scr/unauthorizedTail");return e.preventDefault(),!r||r.length<=0?!1:(t=r.val(),i=r.parent(".u-form-item"),0==t.length?(i.addClass("error"),o.html(c).removeClass("f-dn"),!1):void n.when(s.unlockScreenService(t)).then(function(){l._close()},function(e){"FA_UNAUTHORIZED"==e.responseJSON.code&&(++l._failCurrent,r.val(""),i.addClass("error"),o.html([d,l._failLimit-l._failCurrent,u].join("")).removeClass("f-dn"))}))},_close:function(){!!l.$element&&l.$element.remove(),delete l.$element,l._failCurrent=0}};return l}),function(e){function t(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1}function n(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function i(e){for(y in w)w[y]=e[S[y]]}function a(e){var n,a,r,s,l,c;if(n=e.keyCode,-1==t(C,n)&&C.push(n),(93==n||224==n)&&(n=91),n in w){w[n]=!0;for(r in T)T[r]==n&&(o[r]=!0)}else if(i(e),o.filter.call(this,e)&&n in b)for(c=h(),s=0;s<b[n].length;s++)if(a=b[n][s],a.scope==c||"all"==a.scope){l=a.mods.length>0;for(r in w)(!w[r]&&t(a.mods,+r)>-1||w[r]&&-1==t(a.mods,+r))&&(l=!1);(0!=a.mods.length||w[16]||w[18]||w[17]||w[91])&&!l||a.method(e,a)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function r(e){var n,i=e.keyCode,a=t(C,i);if(a>=0&&C.splice(a,1),(93==i||224==i)&&(i=91),i in w){w[i]=!1;for(n in T)T[n]==i&&(o[n]=!1)}}function s(){for(y in w)w[y]=!1;for(y in T)o[y]=!1}function o(e,t,n){var i,a;i=m(e),void 0===n&&(n=t,t="all");for(var r=0;r<i.length;r++)a=[],e=i[r].split("+"),e.length>1&&(a=g(e),e=[e[e.length-1]]),e=e[0],e=x(e),e in b||(b[e]=[]),b[e].push({shortcut:i[r],scope:t,method:n,key:i[r],mods:a})}function l(e,t){var i,a,r,s,o,l=[];for(i=m(e),s=0;s<i.length;s++){if(a=i[s].split("+"),a.length>1&&(l=g(a)),e=a[a.length-1],e=x(e),void 0===t&&(t=h()),!b[e])return;for(r=0;r<b[e].length;r++)o=b[e][r],o.scope===t&&n(o.mods,l)&&(b[e][r]={})}}function c(e){return"string"==typeof e&&(e=x(e)),-1!=t(C,e)}function d(){return C.slice(0)}function u(e){var t=(e.target||e.srcElement).tagName;return!("INPUT"==t||"SELECT"==t||"TEXTAREA"==t)}function p(e){M=e||"all"}function h(){return M||"all"}function f(e){var t,n,i;for(t in b)for(n=b[t],i=0;i<n.length;)n[i].scope===e?n.splice(i,1):i++}function m(e){var t;return e=e.replace(/\s/g,""),t=e.split(","),""==t[t.length-1]&&(t[t.length-2]+=","),t}function g(e){for(var t=e.slice(0,e.length-1),n=0;n<t.length;n++)t[n]=T[t[n]];return t}function v(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,function(){n(window.event)})}function _(){var t=e.key;return e.key=k,t}var y,b={},w={16:!1,18:!1,17:!1,91:!1},M="all",T={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,command:91},L={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},x=function(e){return L[e]||e.toUpperCase().charCodeAt(0)},C=[];for(y=1;20>y;y++)L["f"+y]=111+y;var S={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(y in T)o[y]=!1;v(document,"keydown",function(e){a(e)}),v(document,"keyup",r),v(window,"focus",s);var k=e.key;e.key=o,e.key.setScope=p,e.key.getScope=h,e.key.deleteScope=f,e.key.filter=u,e.key.isPressed=c,e.key.getPressedKeyCodes=d,e.key.noConflict=_,e.key.unbind=l,"undefined"!=typeof module&&(module.exports=o)}(this),define("components/keymaster/keymaster",function(){}),define("component/hotkeys/hotkeys",["require","exports","module","components/keymaster/keymaster","jquery","cui/core/events/pubsub","../../module/common/globalService"],function(e,t,n){e("components/keymaster/keymaster");var i=e("jquery"),a=e("cui/core/events/pubsub"),r=e("../../module/common/globalService"),s=new a("component.hotkeys"),o=window.key,l={setup:function(){r.getConfig("user.supportshortcut")&&(o.filter=function(e){var t=e.target||e.srcElement,n=t.tagName,a=i(t).closest(".m-thread").length>0||i(t).closest(".m-read").length>0||i(t).closest(".m-mllist").length>0||i(t).attr("disabledhotkey");return o.setScope(/^(INPUT|TEXTAREA|SELECT)$/.test(n)?a?"disabled":"input":"other"),!0},o("r,a,f",function(e,t){var n,i=r.getCurrentState(),a=r.getUser(),l=i.module,c=i.param.mid;if("disabled"!==o.getScope()&&"input"!==o.getScope()&&0!==a.shortcut&&!e.ctrlKey&&("mail.read"===l||"mail.thread"===l)){switch(t.shortcut){case"r":n="reply";break;case"a":n="replyall";break;case"f":n="forward"}s.sendMessage(l+":"+c,"mail:op",{action:n})}}),o("k, j",function(e,t){var n,i=r.getCurrentState(),a=r.getUser(),l=i.module,c=i.param.mid;if("disabled"!==o.getScope()&&"input"!==o.getScope()&&0!==a.shortcut&&("mail.read"===l||"mail.thread"===l)){switch(t.shortcut){case"k":n="prev";break;case"j":n="next"}s.sendMessage(l+":"+c,"mail:op",{action:n})}}),o("shift+m",function(){var e=r.getUser();"disabled"!==o.getScope()&&1===e.shortcut&&s.sendMessage("mail","checknewmsg")}),o("c",function(){var e=r.getUser();"disabled"!==o.getScope()&&1===e.shortcut&&s.sendMessage("mail","compose")}),o("delete",function(){var e=r.getCurrentState(),t=r.getUser(),n=e.module,i=e.param.mid;"disabled"!==o.getScope()&&"input"!==o.getScope()&&0!==t.shortcut&&("mail.previewlayout"===n||"mail.list"===n||"mail.search"===n||("mail.read"===n||"mail.thread"===n)&&t.preview_layout?s.sendMessage("mail.list","mail:op",{action:"delete"}):("mail.read"===n||"mail.thread"===n)&&s.sendMessage(n+":"+i,"mail:op",{action:"delete"}))}),o("+a, ctrl+a",function(e){var t=r.getCurrentState(),n=t.module,i=r.getUser();"disabled"!==o.getScope()&&"input"!==o.getScope()&&0!==i.shortcut&&("mail.previewlayout"===n||"mail.list"===n||"mail.search"===n||("mail.read"===n||"mail.thread"===n)&&i.preview_layout)&&(e.preventDefault(),e.stopPropagation(),s.sendMessage("mail.list","mail:select",{action:"inverse:curPage"}))}),o("+enter, ctrl+enter",function(e){var t=r.getCurrentState(),n=r.getUser(),a=t.module,l=t.param.id,c=t.param.mid,d=e.target;"disabled"===o.getScope()||"input"===o.getScope()&&"replyContent"!==i(d).attr("name")||0===n.shortcut||("mail.compose"===a?s.sendMessage(a+":"+l,"mail:op","sendmail"):("mail.read"===a||"mail.thread"===a)&&s.sendMessage(a+":"+c,"mail:op",{action:"quickreply",target:d}))}),o("+s, ctrl+s",function(e){e.preventDefault(),e.stopPropagation();var t=r.getCurrentState(),n=r.getUser(),i=t.module,a=t.param.id;"disabled"!==o.getScope()&&"input"!==o.getScope()&&0!==n.shortcut&&"mail.compose"===i&&s.sendMessage(i+":"+a,"mail:op",{action:"savedraft"})}))}};n.exports=l}),define("app",["require","es5-shim","jquery","./configstore","cui/core/view/viewmanager","cui/util/detector/detector","cui/util/history/hash","component/confirmbox","util/index","widget/intro/introduce","module/common/globalService","module/file/fileService","./dispatcher","component/wsStore","component/notification/online","module/common/intervalcheck","component/screenlock/view","component/hotkeys/hotkeys","i18n!common,main,mail,mbox,contact,pab","i18n!faces,compose,file,cal"],function(e){function t(){for(var e=JSON.stringify(s.getConfig("mail.menu")),t=/\$([^\$]+)\$/g;e&&t.test(e);)e=e.replace(t,function(e,t){return u.i18n.t(t)});s.setConfig("mail.menu",JSON.parse(e))}function n(){u.i18n.translateDataApi("html")}function i(){var e=u.url.getUrlParamValue(location.href,"sid");return h.initUser(e)}function a(){var e,t;u.detector.isDetachMode()?(e=c.getHash(),!e.module&&(e.module="mail"),h.setCurrentState(e),t=e.module.split("."),"true"===e.param.nest&&t[0]||!t[1]?o.module(t[0]).render():t[1]&&o.module(e.module).render(),g.init()):(o.module("layout").render(),setTimeout(function(){g.init(),v.init()},100)),y.init(),_.init()}e("es5-shim");var r=e("jquery"),s=e("./configstore"),o=e("cui/core/view/viewmanager"),l=e("cui/util/detector/detector"),c=e("cui/util/history/hash"),d=e("component/confirmbox"),u=e("util/index"),p=e("widget/intro/introduce"),h=e("module/common/globalService"),f=e("module/file/fileService"),m=e("./dispatcher"),g=e("component/wsStore"),v=e("component/notification/online"),_=e("module/common/intervalcheck"),y=e("component/screenlock/view"),b=e("component/hotkeys/hotkeys");e("i18n!common,main,mail,mbox,contact,pab"),e("i18n!faces,compose,file,cal"),r(function(){r("body").addClass(l.os.name).addClass(l.browser.name+l.browser.version).addClass(h.getConfig("context.locale")),r.when(t()).then(n).then(i).then(p.initIntro()).then(function(){h.updateConfig("file.xnfengines",f.initValidXNFEngines()),m.start(),b.setup(),a(),r(".j-layout-loading").fadeOut()},function(){d.alert(u.i18n.t("common/msg_user_init_failed"),function(){location.href="/"})})})}),require(["./requireConfig"],function(){require(["cui/util/global-supports","./configstore"],function(e,t){var n=document.getElementById("config-script");t.initConfig(window.CM.config),n.parentNode.removeChild(n),require(["init"],function(){require(["app"])})})}),window._handleTackPageView(),require.config({bundles:{m2:["module/mail/compose/index","module/contact/index","module/contact/oab/index","module/contact/pab/index","module/contact/pabPrint/index","module/setting/index","module/setting/account/index","module/setting/account/externalauth/index","module/setting/account/password/index","module/setting/account/personal/index","module/setting/account/question/index","module/setting/account/signature/index","module/setting/advance/index","module/setting/advance/bindmobile/index","module/setting/advance/hotkeys/index","module/setting/advance/loginnotification/index","module/setting/advance/mailpush/index","module/setting/advance/mboxshare/index","module/setting/advance/pop/index","module/setting/advance/pop3set/index","module/setting/advance/searchinrange/index","module/setting/advance/smsnotification/index","module/setting/calendar/index","module/setting/calendar/calendar/index","module/setting/client/index","module/setting/client/mailpush/index","module/setting/client/pop/index","module/setting/delivery/index","module/setting/delivery/autoreply/index","module/setting/delivery/compose/index","module/setting/delivery/forward/index","module/setting/delivery/read/index","module/setting/delivery/reply/index","module/setting/delivery/template/index","module/setting/display/index","module/setting/display/general/index","module/setting/display/list/index","module/setting/filter/index","module/setting/filter/letter/index","module/setting/filter/vip/index","module/setting/folder/index","module/setting/folder/folder/index","module/setting/security/index","module/setting/security/antivirus/index","module/setting/security/auth2lock/index","module/setting/security/blacklist/index","module/setting/security/junkfilter/index","module/setting/security/junknotify/index","module/setting/security/logindevices/index","module/setting/security/offsiteremind/index","module/setting/security/smime/index","module/setting/security/twofactorauth/index","module/setting/security/whitelist/index"],"detach/twofactorauth/main":["module/setting/security/twofactorauth/index"],"module/appcenter/index":[],"module/calendar/index":[],"module/file/index":["module/file/accessory/index","module/file/enterprisenf/index","module/file/personalnf/index","module/file/transitcenter/index"],"module/logs/index":["module/logs/delete/index","module/logs/login/index","module/logs/receive/index","module/logs/send/index","module/logs/trs/index"],"module/selfservice/index":[],"module/skins/index":[]}}),define("main",function(){}),define("cui/core/view/view",["require","jquery","../base/base","../events/pubsub"],function(e){function t(){return"view-"+w++}function n(e){return"[object String]"===b.call(e)}function i(e){return"[object Function]"===b.call(e)}function a(e){return M(document.documentElement,e)}function r(e){return e.charAt(0).toUpperCase()+e.substring(1)}function s(e){return i(e.events)&&(e.events=e.events()),e.events}function o(e,t){var n=e.match(T),i=n[1]+f+t.cid,a=n[2]||void 0;return a&&a.indexOf("{{")>-1&&(a=l(a,t)),{type:i,selector:a}}function l(e,t){return e.replace(L,function(e,i){for(var a,r=i.split("."),s=t;a=r.shift();)s=s===t.attrs?t.get(a):s[a];return n(s)?s:x})}function c(e){return null===e||void 0===e}function d(e){for(var t=e.length-1;t>=0&&void 0===e[t];t--)e.pop();return e}var u=e("jquery"),p=e("../base/base"),h=e("../events/pubsub"),f=".delegate-events-",m="_onRender",g="data-view-cid",v="data-view-name",_={},y=p.extend({propsInAttrs:["name","element","events","config"],name:"",element:null,events:null,config:null,attrs:{id:null,className:null,style:null,template:"",model:null,parentNode:document.body},initialize:function(e){this.cid=t(),y.superclass.initialize.call(this,e||{}),this.parseElement(),this.initProps(),this.initPubSub(),this.delegateEvents(),this.setup(),this._stamp(),this._isTemplate=!(e&&e.element)},parseElement:function(){var e=this.element;if(e?this.element=u(e):this.get("template")&&this.parseElementFromTemplate(),!this.element||!this.element[0])throw new Error("element is invalid")},parseElementFromTemplate:function(){this.element=u(this.get("template"))},initProps:function(){},initPubSub:function(){var e,t;if(this.get("name")){this.pubsub=new h(this.get("name")),e=h.prototype;for(t in e)e.hasOwnProperty(t)&&(this[t]=u.proxy(this.pubsub[t],this.pubsub))}},delegateEvents:function(e,t,a){var r=d(Array.prototype.slice.call(arguments));if(0===r.length?(t=s(this),e=this.element):1===r.length?(t=e,e=this.element):2===r.length?(a=t,t=e,e=this.element):(e||(e=this.element),this._delegateElements||(this._delegateElements=[]),this._delegateElements.push(u(e))),n(t)&&i(a)){var l={};l[t]=a,t=l}for(var c in t)if(t.hasOwnProperty(c)){var p=o(c,this),h=p.type,f=p.selector;!function(t,n){var a=function(e){i(t)?t.call(n,e,this):n[t](e,this)};f?u(e).on(h,f,a):u(e).on(h,a)}(t[c],this)}return this},undelegateEvents:function(e,t){var n=d(Array.prototype.slice.call(arguments));if(t||(t=e,e=null),0===n.length){var i=f+this.cid;if(this.element&&this.element.off(i),this._delegateElements)for(var a in this._delegateElements)this._delegateElements.hasOwnProperty(a)&&this._delegateElements[a].off(i)}else{var r=o(t,this);e?u(e).off(r.type,r.selector):this.element&&this.element.off(r.type,r.selector)}return this.pubsub&&(this.offMessage(),this.unsubscribe()),this},setup:function(){},render:function(){this.rendered||(this._renderAndBindAttrs(),this.rendered=!0);var e=this.get("parentNode");if(e&&!a(this.element[0])){var t=this.constructor.outerBoxClass;if(t){var n=this._outerBox=u("<div></div>").addClass(t);n.append(this.element).appendTo(e)}else this.element.appendTo(e)}return this},_renderAndBindAttrs:function(){var e=this,t=e.attrs;for(var n in t)if(t.hasOwnProperty(n)){var i=m+r(n);if(this[i]){var a=this.get(n);c(a)||this[i](a,void 0,n),function(t){e.on("change:"+n,function(n,i,a){e[t](n,i,a)})}(i)}}},_onRenderId:function(e){this.element.attr("id",e)},_onRenderClassName:function(e){this.element.addClass(e)},_onRenderStyle:function(e){this.element.css(e)},_stamp:function(){var e=this.cid;this.element.attr(g,e).attr(v,this.get("name")),_[e]=this},$:function(e){return this.element.find(e)},destroy:function(){this.undelegateEvents(),delete _[this.cid],this.element&&this._isTemplate&&(this.element.off(),this._outerBox?this._outerBox.remove():this.element.remove()),this.element=null,y.superclass.destroy.call(this)}});u(window).unload(function(){for(var e in _)_[e].destroy()}),y.query=function(e){var t,n=u(e).eq(0);return n&&(t=n.attr(g)),_[t]},y.queryByName=function(e){var t=u("["+v+"="+e+"]").eq(0);return y.query(t)};var b=Object.prototype.toString,w=0,M=u.contains||function(e,t){var n=!1;if(e.compareDocumentPosition)n=!!(16&e.compareDocumentPosition(t));else for(;t=t.parentNode;)t===e&&(n=!0);return n},T=/^(\S+)\s*(.*)$/,L=/{{([^}]+)}}/g,x="INVALID_SELECTOR";return y}),define("cui/ui/tabview/tabview",["require","jquery","../../core/widget/widget"],function(e){function t(e){return u("<ul />").addClass(e)}function n(e,t){var n=u("<li>",{"data-trigger":e.sid,"class":t,title:d(e.stitle)}).append(u("<a>",{href:"javascript:void(0)",html:e.stitle,"trigger-title":""}));return n}function i(e){return u("<div />").addClass(e)}function a(e,t){return u("<div />",{"data-panel":e.sid,"class":t,style:"display:none",html:""})}function r(){return u("<div />",{"class":"iconfont iconcloseall closeall"})}function s(){return u("<div />",{"class":"menu",html:"&#8226;&#8226;&#8226;",style:"display:none"}).append(u("<ul />",{"class":"u-menu u-menu-right"}))}function o(e){return u("<li />",{html:'<a href="javascript:void(0);">'+e.stitle+'</a><i class="iconfont icontabclose tabclose right"></i>'}).data("tab",e)}function l(e){return{UI_TABVIEW:e||"",NAV_CLASS:e?e+"-nav":"",TRIGGER_CLASS:e?e+"-trigger":"",CONTENT_CLASS:e?e+"-content":"",PANEL_CLASS:e?e+"-panel":""}}function c(e){return e?e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):e}function d(e){return e?e.replace(/&amp;/gi,"&").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/(&quot;|&#034;|&#34;)/gi,'"').replace(/(&#039;|&#39;)/gi,"'").replace(/&nbsp;/gi," "):e}var u=e("jquery"),p=e("../../core/widget/widget"),h=p.extend({attrs:{tabs:[],generateTriggerMarkup:null,generateCloseAllMarkup:null,generatePanelMarkup:null,classPrefix:"u-tabview",activeTabId:"",onlyRenderActive:!1,manageType:"",firstTabFixedWidth:!0,elemWidth:{readOnly:!0,getter:function(){return this.element.width()}},length:{readOnly:!0,getter:function(){return this.get("tabs").length}},activeTriggerClass:{getter:function(e){return e||this.get("classPrefix")+"-active"}},closeTriggerClass:{getter:function(e){return e||this.get("classPrefix")+"-close"}}},setup:function(){this._initConstClass(),this._initElement(),this._initHistory(),this._initTabs(),this._initTriggers(),this._initPanels(),this._initManageType(),this._bindTriggers(),this._bindManageType()},_initConstClass:function(){this.CONST=l(this.get("classPrefix"))},_initElement:function(){this.element.addClass(this.CONST.UI_TABVIEW)},_initHistory:function(){this.history=[]},_initTabs:function(){u.each(this.get("tabs"),function(e,t){t.isDefault="boolean"===u.type(t.isDefault)?t.isDefault:!0,t.sid=u.isFunction(t.id)?t.id():t.id,t.stitle=c(u.isFunction(t.title)?t.title():t.title)}),!this.get("activeTabId")&&this.get("tabs").length>0&&this.set("activeTabId",this.get("tabs")[0].sid)},_initPanels:function(){var e,t,n=this,r=n.get("tabs");n.content=n.$("."+n.CONST.CONTENT_CLASS),n.content.length<=0&&(n.content=i(n.CONST.PANEL_CLASS).appendTo(n.element)),n.get("onlyRenderActive")&&n.get("activeTabId")?(e=n.find(n.get("activeTabId")),t=n._findPanel(e.sid),t.length<=0&&(t=(n.get("generatePanelMarkup")||a)(e,n.CONST.PANEL_CLASS),n.content.append(t)),n._addPanel(e,t)):u.each(r,function(e,i){t=n._findPanel(i.sid),t.length<=0&&(t=(n.get("generatePanelMarkup")||a)(i,n.CONST.PANEL_CLASS),n.content.append(t)),n._addPanel(i,t)})},_initManageType:function(){var e,t,n,i,a,l=this.get("manageType"),c=this.get("elemWidth"),d=this.nav.find("."+this.CONST.TRIGGER_CLASS);switch(this.triggerWidth=Math.ceil(this.nav.width()/d.length),e=this.triggerWidth*(d.length+1),l){case"close":this.closeAll=(this.get("generateCloseAllMarkup")||r)().insertAfter(this.nav);break;case"menu":if(this.triggerMenu=s(),e>=c){for(t=Math.ceil((e-c)/this.triggerWidth),n=d.length-1;n>=0&&t>0;n--,t--)i=d.get(n).hide(),a=this.find(i.attr("data-trigger")),this.triggerMenu.prepend(o(a));this.triggerMenu.insertAfter(this.nav).show()}else this.triggerMenu.insertAfter(this.nav)}},_addPanel:function(e,t){e.rendered=!0,e.templateUrl?t.append('<iframe src="'+e.templateUrl+'" frameborder="0" border="0" allowtransparency="true" style="width:100%;">'):e.module&&u.isFunction(e.module.render)&&e.module.render(t),this.trigger("render",e.sid)},_refreshPanel:function(e){e.module&&u.isFunction(e.module.refresh)&&e.module.refresh(),this.trigger("refresh",e.sid)},_findPanel:function(e){return this.content.find('[data-panel="'+e+'"]')},_initTriggers:function(){var e,i,a=this,r=a.get("tabs");a.nav=a.$("."+a.CONST.NAV_CLASS),a.nav.length<=0&&(a.nav=t(a.CONST.NAV_CLASS).appendTo(this.element)),a.get("onlyRenderActive")&&a.get("activeTabId")?(e=a._findTrigger(a.get("activeTabId")),e.length<=0&&(i=a.find(a.get("activeTabId")),e=(a.get("generateTriggerMarkup")||n)(i,a.CONST.TRIGGER_CLASS),e.appendTo(a.nav)),e.addClass(a.get("activeTriggerClass"))):u.each(r,function(t,i){e=a._findTrigger(i.sid),e.length<=0&&(e=(a.get("generateTriggerMarkup")||n)(i,a.CONST.TRIGGER_CLASS),e.appendTo(a.nav)),i.sid===a.get("activeTabId")&&e.addClass(a.get("activeTriggerClass"))})},_bindTriggers:function(){var e=this,t=this.get("closeTriggerClass");this.nav.on("click","[data-trigger]",function(t){t.preventDefault(),e.switchTo(u(this).attr("data-trigger"))}),t&&this.nav.on("click","."+t,function(t){var n=u(this).closest("[data-trigger]").attr("data-trigger"),i=e._getRemovedTab(n);null!==i&&(i.module&&i.module.confirmbeforedestroy()?i.module.beforedestroy(function(){e.close(n)}):e.close(n)),t.preventDefault(),t.stopPropagation()}),e._adjustTriggerNodeWidth(),u(window).off("resize.tabview").on("resize.tabview",function(){e._adjustTriggerNodeWidth()})},_bindManageType:function(){var e=this;this.closeAll&&this.closeAll.on("click",function(t){e.closeTabs(),t.preventDefault(),t.stopPropagation()}),this.triggerMenu&&this.triggerMenu.on("click",function(t){e.triggerMenu.show(),t.preventDefault(),t.stopPropagation()})},_findTrigger:function(e){return this.nav.find('[data-trigger="'+e+'"]')},switchTo:function(e){this.set("activeTabId",e)},_onRenderActiveTabId:function(e,t){this._switchTo(e,t)},_switchTo:function(e,t){this.trigger("switch",e,t),this._switchTrigger(e,t),this._switchPanel(this._getPanelInfo(e,t)),this.history.push(e),this.trigger("switched",e,t)},_switchTrigger:function(e,t){this.nav&&(this._findTrigger(t).removeClass(this.get("activeTriggerClass")),
this._findTrigger(e).addClass(this.get("activeTriggerClass")))},_switchPanel:function(e){var t=this.find(e.toTabId);e.fromPanels.hide(),e.toPanels.show(),t.rendered=!0,e.add?this._addPanel(t,e.toPanels):e.refresh&&this._refreshPanel(t)},_getPanelInfo:function(e,t){var n,i,r,s=!1,o=!1;return t&&(n=this._findPanel(t)),i=this._findPanel(e),r=this.find(e),r&&(0===i.length?(i=(this.get("generatePanelMarkup")||a)(r,this.CONST.PANEL_CLASS),this.content.append(i),s=!0):i.length>0&&!r.rendered?s=!0:o=!0),{toTabId:e,fromTabId:t,toPanels:u(i),fromPanels:u(n),add:s,refresh:o}},getRenderedTabs:function(){var e=[],t=this.get("tabs");return u.each(t,function(t,n){n.rendered&&e.push(n)}),e},getRenderedLength:function(){return this.getRenderedTabs().length},isRendered:function(e){var t=this.getRenderedTabs(),n=!1;return e?(u.each(t,function(t,i){return i.sid===e?(n=!0,!1):void 0}),n):!1},current:function(){return this.find(this.get("activeTabId"))},find:function(e){var t=null,n=this;return u.each(this.get("tabs"),function(i,a){return a.sid===e?(t=a,t.active=e===n.get("activeTabId"),!1):void 0}),t},addTabEntity:function(e){var t=this.get("tabs");t.push(e),this.set("tabs",t)},findAndReplace:function(e,t){var n,i=null,a=this;return u.each(this.get("tabs"),function(n,r){var s=r.sid;return r.sid===e?(r.module&&u.isFunction(r.module.destroy)&&r.module.destroy(),i=u.extend(r,t),i.replacedSid=s,i.active=e===a.get("activeTabId"),!1):void 0}),i||t.noreg||(n=new RegExp(e,"i"),u.each(this.get("tabs"),function(e,r){var s=r.sid;return n.test(r.sid)?(r.module&&u.isFunction(r.module.destroy)&&r.module.destroy(),i=u.extend(r,t),i.replacedSid=s,i.active=r.sid===a.get("activeTabId"),!1):void 0})),i},refreshTab:function(e){var t;e.sid=e.sid||e.id,e.stitle=c(e.stitle||e.title),t=this.find(e.sid),t&&(u.extend(t,e),this._findTrigger(t.sid).find("[trigger-title]").html(t.stitle).attr("title",d(t.stitle)))},closeTabs:function(e){e=e||this.getRenderedTabs();var t,n,i,a,r=this,s=!1;for(t=e.length-1;t>=0;t--)n=e[t],n.isDefault||(n.module&&n.module.confirmbeforedestroy()?(a=n.sid,s=!0,n.module.beforedestroy(function(){r.close(a)})):r.close(n.sid));s||(i=this.nav.find("[data-trigger]").eq(0).attr("data-trigger"),this.set("activeTabId",i),this.trigger("closed"))},_getRemovedTab:function(e){var t,n,i=this.get("tabs");for(n=i.length-1;n>=0;n--)if(t=i[n],t.sid===e&&!t.isDefault)return t;return null},close:function(e,t){e=e||this.get("activeTabId"),t="boolean"==typeof t?t:!1;var n,i,a,r=this.get("tabs"),s=e===this.get("activeTabId");for(i=r.length-1;i>=0;i--)if(a=r[i],a.sid===e&&!a.isDefault){n=!0;break}n&&(r.splice(i,1),this.set("tabs",r),a.module&&u.isFunction(a.module.destroy)&&a.module.destroy(),this._findTrigger(e).remove(),this._findPanel(e).remove(),this.history.pop(),s&&!t&&this.set("activeTabId",this._prev()),this.trigger("closed",e),u(window).trigger("resize.tabview"))},_prev:function(){var e,t;for(t=this.history.length-1;t>=0&&(e=this.history.pop(),!this.find(e));t--)e="";return e||(e=this.nav.find("[data-trigger]").eq(0).attr("data-trigger")),e},_adjustTriggerNodeWidth:function(){var e=this,t=this.nav.find("."+this.CONST.TRIGGER_CLASS),n=this.get("elemWidth"),i=t.first().outerWidth(!0);i*(t.length+1)>n&&(i=e.get("firstTabFixedWidth")?Math.floor((n-i)/t.length):Math.floor(n/(t.length+1)),i>0&&u.each(t,function(t,n){(t>0||!e.get("firstTabFixedWidth"))&&u(n).outerWidth(i)}))},_getCloseAllOrMenuWidth:function(){var e=this.get("manageType");return e?"close"===e?this.closeAll.outerWidth(!0):this.triggerMenu.outerWidth(!0):0},addTab:function(e){var t,i,r,s,o=this.get("tabs");return e&&e.id&&e.title?(e.sid=u.isFunction(e.id)?e.id():e.id,e.stitle=c(u.isFunction(e.title)?e.title():e.title),void(e.hasOwnProperty("replaceId")&&(s=this.findAndReplace(e.replaceId,e))?(t=this._findTrigger(s.replacedSid),i=this._findPanel(s.replacedSid),r=t.find("[trigger-title]"),r.length>0&&r.html(s.stitle),t.attr("title",d(s.stitle)).attr("data-trigger",s.sid),i.attr("data-panel",s.sid).html(""),s.rendered=!1,this.set("activeTabId",s.sid)):this.find(e.sid)||(o.push(e),this.set("tabs",o),this.nav.append((this.get("generateTriggerMarkup")||n)(e,this.CONST.TRIGGER_CLASS)),i=(this.get("generatePanelMarkup")||a)(e,this.CONST.PANEL_CLASS),this.content.append(i),e.rendered=!1,this.set("activeTabId",e.sid),this._adjustTriggerNodeWidth()))):!1},destroy:function(){h.superclass.destroy.call(this)}});return h}),define("cui/ui/autocomplete/datasource",["require","exports","module","jquery","../../core/base/base"],function(e,t,n){function i(e){return"[object String]"===Object.prototype.toString.call(e)}function a(e){return e.charAt(0).toUpperCase()+e.substring(1)}var r=e("jquery"),s=e("../../core/base/base"),o=s.extend({attrs:{source:null,type:"array"},initialize:function(e){o.superclass.initialize.call(this,e),this.id=0,this.callbacks=[];var t=this.get("source");if(i(t))this.set("type","url");else if(r.isArray(t))this.set("type","array");else if(r.isPlainObject(t))this.set("type","object");else{if(!r.isFunction(t))throw new Error("Source Type Error");this.set("type","function")}},getData:function(e){return this["_get"+a(this.get("type")||"")+"Data"](e)},abort:function(){this.callbacks=[]},_done:function(e){this.trigger("data",e)},_getUrlData:function(e){var t,n=this,i={query:e?encodeURIComponent(e):"",timestamp:(new Date).getTime()},a=this.get("source").replace(/\{\{(.*?)\}\}/g,function(e,t){return i[t]}),s="callback_"+this.id++;this.callbacks.push(s),t=/^(https?:\/\/)/.test(a)?{dataType:"jsonp"}:{dataType:"json"},r.ajax(a,t).success(function(e){r.inArray(s,n.callbacks)>-1&&(delete n.callbacks[s],n._done(e))}).error(function(){r.inArray(s,n.callbacks)>-1&&(delete n.callbacks[s],n._done({}))})},_getArrayData:function(){var e=this.get("source");return this._done(e),e},_getObjectData:function(){var e=this.get("source");return this._done(e),e},_getFunctionData:function(e){function t(e){~r.inArray(a,n.callbacks)&&(delete n.callbacks[a],n._done(e))}var n=this,i=this.get("source"),a="callback_"+this.id++;n.callbacks.push(a),i.call(this,e,t)}});n.exports=o}),define("cui/ui/autocomplete/filter",["require","exports","module","jquery"],function(e,t,n){function i(e){return(e||"").replace(o,"\\$1")}function a(e,t){for(var n=[],i=e.split(""),a=0,r=t.split(""),s=0,o=i.length;o>s;s++){var l=i[s];if(l===r[a]){if(a===r.length-1){n.push([s-r.length+1,s+1]),a=0;continue}a++}else a=0}return n}var r=e("jquery"),s={"default":function(e){return e},startsWith:function(e,t){t=t||"";var n=[],a=t.length,s=new RegExp("^"+i(t));return a?(r.each(e,function(e,t){for(var i,r=[t.value].concat(t.alias);i=r.shift();)if(s.test(i)){t.label===i&&(t.highlightIndex=[[0,a]]),n.push(t);break}}),n):[]},stringMatch:function(e,t){t=t||"";var n=[],i=t.length;return i?(r.each(e,function(e,i){for(var r,s=[i.value].concat(i.alias);r=s.shift();)if(r.indexOf(t)>-1){i.label===r&&(i.highlightIndex=a(r,t)),n.push(i);break}}),n):[]}};n.exports=s;var o=/(\[|\[|\]|\^|\$|\||\(|\)|\{|\}|\+|\*|\?|\\)/g}),define("cui/ui/autocomplete/input",["require","exports","module","jquery","../../core/base/base"],function(e,t,n){function i(e,t){return function(){e.apply(t,arguments)}}function a(e,t){return e=(e||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "),t=(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "),e===t}function r(e){return e.charAt(0).toUpperCase()+e.substring(1)}var s=e("jquery"),o=e("../../core/base/base"),l=/\bMSIE [6789]\.0\b/.test(navigator.userAgent),c={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},d=o.extend({attrs:{element:{value:null,setter:function(e){return s(e)}},query:null,delay:150},initialize:function(){d.superclass.initialize.apply(this,arguments),this._bindEvents(),this.set("query",this.getValue())},focus:function(){this.get("element").focus()},blur:function(){this.get("element").blur()},getValue:function(){return this.get("element").val()},setValue:function(e,t){this.get("element").val(e),!t&&this._change()},destroy:function(){d.superclass.destroy.call(this)},_bindEvents:function(){var e,t=this.get("element");t.attr("autocomplete","off").on("focus.autocomplete",i(this._handleFocus,this)).on("blur.autocomplete",i(this._handleBlur,this)).on("keydown.autocomplete",i(this._handleKeydown,this));var n,a=this;n=l?["keydown.autocomplete","keypress.autocomplete","cut.autocomplete","paste.autocomplete"]:["input.autocomplete"],t.on(n.join(" "),i(function(t){t.which&&c[t.which]||(clearTimeout(e),e=setTimeout(function(){a.get("element")&&a._change.call(a,t)},this.get("delay")))},this))},_change:function(){var e=this.getValue(),t=this.get("query"),n=a(t,e),i=n?e.length!==t.length:!1;i&&this.trigger("whitespaceChanged",t),n||(this.set("query",e),this.trigger("queryChanged",e,t))},_handleFocus:function(e){this.trigger("focus",e)},_handleBlur:function(e){this.trigger("blur",e)},_handleKeydown:function(e){var t=c[e.which];if(t){var n="key"+r(t);this.trigger(e.type=n,e)}}});n.exports=d}),define("cui/ui/autocomplete/autocomplete",["require","exports","module","jquery","../overlay/overlay","../../util/templatable/templatable","./datasource","./filter","./input"],function(e,t,n){function i(e){return"[object String]"===Object.prototype.toString.call(e)}function a(e){return"[object Object]"===Object.prototype.toString.call(e)}function r(e,t){if(e){if(d.isFunction(e))return e.call(this,t);if(!d.isArray(t)&&i(e)){for(var n=e.split("."),a=t;n.length;){var r=n.shift();if(!a[r])break;a=a[r]}return a}}return t}function s(e){var t=[];return d.each(e,function(e,n){if(i(n))t.push({label:n,value:n,target:n,alias:[]});else if(a(n)){if(!n.value&&!n.label)return;n.value||(n.value=n.label),n.label||(n.label=n.value),n.target||(n.target=n.label),n.alias||(n.alias=[]),t.push(n)}}),t}function o(e,t){return i(e)?e=f[e]?f[e]:f["default"]:d.isFunction(e)||(e="url"===t.get("type")?f["default"]:f.startsWith),e}function l(e){function t(e){for(var t in e)n[t]=e[t]}var n={};return t(this),t(e.hash),e.fn(n)}function c(e){var t=this.highlightIndex,n=this.parent?this.parent.classPrefix:"",i=0,a=e||this.label||"",r="";if(d.isArray(t)){for(var s=0,o=t.length;o>s;s++){var l,c,u=t[s];if(d.isArray(u)?(l=u[0],c=u[1]-u[0]):(l=u,c=1),l>i&&(r+=a.substring(i,l)),l<a.length){var p=n?'class="'+n+'-item-hl"':"";r+="<span "+p+">"+a.substr(l,c)+"</span>"}if(i=l+c,i>=a.length)break}return a.length>i&&(r+=a.substring(i,a.length)),r}return a}var d=e("jquery"),u=e("../overlay/overlay"),p=e("../../util/templatable/templatable"),h=e("./datasource"),f=e("./filter"),m=e("./input"),g=/\bMSIE [678]\.0\b/.test(navigator.userAgent),v='<div class="{{classPrefix}}"><div class="{{classPrefix}}-content">{{> header}}<ul data-role="items">{{#each items}}<li data-role="item" class="{{../classPrefix}}-item">{{#include parent=.. }}{{> html}}{{/include}}</li>{{/each}}</ul>{{> footer}}</div></div>',_=u.extend({Implements:p,attrs:{trigger:null,classPrefix:"u-select",align:{baseXY:[0,"100%"]},submitOnEnter:!0,dataSource:{value:[],getter:function(e){var t=this;return d.isFunction(e)?function(){return e.apply(t,arguments)}:e}},locator:"data",filter:null,disabled:!1,disableHide:!1,selectFirst:!1,delay:150,model:{value:{items:[]},getter:function(e){return e.classPrefix||(e.classPrefix=this.get("classPrefix")),e}},template:v,footer:"",header:"",html:"{{label}}",selectedIndex:null,data:[]},events:{"mousedown [data-role=items]":"_handleMouseDown","click [data-role=item]":"_handleSelection","mouseenter [data-role=item]":"_handleMouseMove"},templateHelpers:{highlightItem:c,include:l},parseElement:function(){var e=this;this.templatePartials||(this.templatePartials={}),d.each(["header","footer","html"],function(t,n){e.templatePartials[n]=e.get(n)}),_.superclass.parseElement.call(this)},setup:function(){_.superclass.setup.call(this),this._isOpen=!1,this._initInput(),this._initDataSource(),this._initFilter(),this._bindHandle(),this._blurHide([d(this.get("trigger"))]),this._tweakAlignDefaultValue(),this.on("indexChanged",function(e){var t=parseInt(this.get("height"),10)||this.element.height();if(t){var n=this.items.parent().height()/this.items.length,i=Math.max(0,n*(e+1)-t);this.element.children().scrollTop(i)}})},show:function(){this._isOpen=!0,this._isEmpty()||_.superclass.show.call(this)},hide:function(){this._timeout&&clearTimeout(this._timeout),this.dataSource.abort(),this._hide()},destroy:function(){this._clear(),this.input&&(this.input.destroy(),this.input=null),_.superclass.destroy.call(this)},selectItem:function(e){this.items&&(e&&this.items.length>e&&e>=-1&&this.set("selectedIndex",e),this._handleSelection())},setInputValue:function(e){this.input.setValue(e)},_filterData:function(e){var t=this.get("filter"),n=this.get("locator");e=r(n,e),e=t.call(this,s(e),this.input.get("query")),this.set("data",e)},_onRenderData:function(e){e||(e=[]),this.set("model",{items:e,query:this.input.get("query"),length:e.length}),this.renderPartial(),this.items=this.$("[data-role=items]").children("[data-role=item]"),this.get("selectFirst")&&this.set("selectedIndex",0),this._isOpen&&this.show()},_onRenderSelectedIndex:function(e){var t=this.get("classPrefix")+"-item-hover";this.items&&this.items.removeClass(t),-1!==e&&(this.items.eq(e).addClass(t),this.trigger("indexChanged",e,this.lastIndex),this.lastIndex=e)},_initDataSource:function(){this.dataSource=new h({source:this.get("dataSource")})},_initInput:function(){this.input=new m({element:this.get("trigger"),delay:this.get("delay")})},_initFilter:function(){var e=this.get("filter");e=o(e,this.dataSource),this.set("filter",e)},_bindHandle:function(){var e=this;this.dataSource.on("data",this._filterData,this),this.input.on("blur",this.hide,this).on("focus",this._handleFocus,this).on("keyEnter",this._handleSelection,this).on("keyEsc",this.hide,this).on("keyUp keyDown",this.show,this).on("keyUp keyDown",this._handleStep,this).on("queryChanged",this._handleQueryChange,this).on("queryChanged",this.show,this),this.after("hide",function(){this.set("selectedIndex",-1)}),this.on("itemSelected",function(){e.delegateEvents({"mouseenter [data-role=item]":"_handleMouseMove"}),e.input.blur()})},_handleSelection:function(e){if(this.items&&this.get("visible")){var t=e?"click"===e.type:!1,n=t?this.items.index(e.currentTarget):this.get("selectedIndex"),i=this.items.eq(n),a=this.get("data")[n];n>=0&&i&&a&&(this.input.setValue(a.target,!0),this.set("selectedIndex",n,{silent:!0}),!e||t||this.get("submitOnEnter")||e.preventDefault(),this.trigger("itemSelected",a,i))}},_handleFocus:function(){this._isOpen=!0},_handleMouseMove:function(e){var t=this.get("classPrefix")+"-item-hover";this.items.removeClass(t);var n=this.items.index(e.currentTarget);this.items.eq(n).addClass(t)},_handleMouseDown:function(e){if(g){var t=this.input.get("element")[0];t.onbeforedeactivate=function(){window.event.returnValue=!1,t.onbeforedeactivate=null}}e.preventDefault()},_handleStep:function(e){e.preventDefault(),this.undelegateEvents(this.element,"mouseenter [data-role=item]"),this.get("visible")&&this._step("keyUp"===e.type?-1:1)},_handleQueryChange:function(e,t){this.get("disabled")||(this._clear(),this._hide(),this.dataSource.abort(),this.dataSource.getData(e))},_step:function(e){var t=this.get("selectedIndex");-1===e?t>0?this.set("selectedIndex",t-1):this.set("selectedIndex",this.items.length-1):1===e&&(t<this.items.length-1?this.set("selectedIndex",t+1):this.set("selectedIndex",0))},_clear:function(){this.$("[data-role=items]").empty(),this.set("selectedIndex",-1),delete this.items,delete this.lastIndex},_hide:function(){this.get("disableHide")||(this._isOpen=!1,_.superclass.hide.call(this))},_isEmpty:function(){var e=this.get("data");return!(e&&e.length>0)},_tweakAlignDefaultValue:function(){var e=this.get("align");e.baseElement=this.get("trigger"),this.set("align",e)}});n.exports=_}),define("widget/iframeTransport/jquery.iframe-transport",["require","jquery"],function(e){var t=e("jquery");t.ajaxPrefilter(function(e){return e.useiframe?(e.originalURL=e.url,"useiframe"):void 0}),t.ajaxTransport("useiframe",function(e,n){function i(){o.each(function(e,n){var i=t(n);i.data("clone").replaceWith(i)}),a.remove(),r.one("load",function(){r.remove()}),r.attr("src","javascript:false;")}var a=null,r=null,s="iframe-"+t.now(),o=t(e.files).filter(":file:enabled"),l=n.forceIframeTransport||!1;return e.dataTypes.shift(),e.data=n.data,o.length||l?(a=t("<form>").hide().attr({method:"post",action:e.originalURL,target:s,enctype:"multipart/form-data"}),"string"==typeof e.data&&e.data.length>0&&t.error("data must not be serialized"),t.each(e.data||{},function(e,n){t.isPlainObject(n)&&(e=n.name,n=n.value),t("<input type='hidden' />").attr({name:e,value:n}).appendTo(a)}),o.after(function(){var e=t(this),n=e.clone().prop("disabled",!0);return e.data("clone",n),n}).next(),o.appendTo(a),{send:function(e,n){r=t("<iframe src='javascript:false;' name='"+s+"' id='"+s+"' style='display:none'></iframe>"),r.one("load",function(){r.one("load",function(){var e=this.contentWindow?this.contentWindow.document:this.contentDocument?this.contentDocument:this.document,t=e.documentElement?e.documentElement:e.body,a=t.getElementsByTagName("textarea")[0],r=a&&a.getAttribute("data-status")||200,s=a&&a.getAttribute("data-statusText")||"OK",o={html:t.innerHTML,text:a&&a.value||t.innerText||t.textContent};i(),n(r,s,o,"Content-Type: application/json")}),a[0].submit()}),t("body").append(a,r)},abort:function(){null!==r&&(r.unbind("load").attr("src","javascript:false;"),i())}}):void 0})}),define("components/requirejs-text/text!component/../../template/component/userauth2.tpl.html",[],function(){return'<div class="m-userauth2">\r\n    <p class="tip j-tip">{{i18n "common/lbl_user_auth2_tip"}}</p>\r\n    <p class="please j-please">{{i18n "common/lbl_user_auth2_please"}}</p>\r\n    <div class="form-item j-item">\r\n        <input type="password" class="u-input" role="password"/>\r\n        <button type="button" class="u-btn u-btn-primary" role="submit" >{{i18n "common/op_user_auth2_unlock"}}</button>\r\n    </div>\r\n    <p class="explain j-explain">&nbsp;</p>\r\n</div>'}),define("component/userauth2",["require","exports","module","i18n!main,common","text!../../template/component/userauth2.tpl.html","jquery","handlebars","cui/ui/dialog/confirmbox","cui/core/events/pubsub","../util/index","../module/common/globalService"],function(e,t,n){function i(e){var t=s.Deferred();return e?(d.xhr.simpleCall({onlyVar:!1,query:{func:"user:authenticate2",sid:u.getSid()},data:{password:e}},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()):t.reject()}function a(e){"boolean"===s.type(e)&&u.updateConfig("user.auth2unlocked",e)}e("i18n!main,common");var r=e("text!../../template/component/userauth2.tpl.html"),s=e("jquery"),o=e("handlebars"),l=e("cui/ui/dialog/confirmbox"),c=e("cui/core/events/pubsub"),d=e("../util/index"),u=e("../module/common/globalService"),p=function(e){return!this instanceof p?new p(e):(this.i18nMsg={err:d.i18n.t("common/lbl_user_auth2_err"),errPwd:d.i18n.t("common/lbl_user_auth2_pwd_err"),emptyPwd:d.i18n.t("common/lbl_user_auth2_pwd_empty")},this.$element=null,this._doc=s(e.root?e.root:document.body),this.tip=e.tip,this.successCb=e.successCb,this.errorCb=e.errorCb,this._render(),void this._bindEvent())};p.prototype.getElement=function(){return this.$element},p.prototype.close=p.prototype.destroy=function(){this.cancel()},p.prototype.cancel=function(){this._unbindEvent(),this.$element&&this.$element.remove(),delete this.tip,delete this.successCb,delete this.errorCb,this.$element=null},p.prototype._render=function(){this.$element=s(o.compile(r)({})),"undefined"!=typeof this.tip&&this.$element.find(".j-tip").html(this.tip),this._doc&&this._doc.append(this.$element)},p.prototype._bindEvent=function(){null!=this.$element&&this.$element.on("keydown",".form-item input[role=password]",s.proxy(this._keydownSubmit,this)).on("click",".form-item button[role=submit]",s.proxy(this._clickSubmit,this))},p.prototype._unbindEvent=function(){null!=this.$element&&this.$element.off("keydown",".form-item input[role=password]").off("click",".form-item input[role=submit]")},p.prototype._keydownSubmit=function(e){13===e.keyCode?(e.preventDefault(),this._doSubmit()):this.$element.find(".j-item").removeClass("error").end().find(".j-explain").html("&nbsp;")},p.prototype._clickSubmit=function(){this._doSubmit()},p.prototype._doSubmit=function(){var e=this,t=this.$element.find(".j-item"),n=t.find("input[role=password]"),r=this.$element.find(".j-explain"),o="error",l=n.val(),c=this.successCb;return 0===l.length?(t.addClass(o),r.html(this.i18nMsg.emptyPwd),!1):void i(l).then(function(){a(!0),p.pubsub.sendMessage("mail","folder:refresh",{type:"auth2Locked"}),p.pubsub.sendMessage("setting.folder.folder","folder:refresh"),p.pubsub.publish("auth2Unlocked"),"function"===s.type(c)&&c()},function(i){i.responseJSON&&"FA_UNAUTHORIZED"===i.responseJSON.code?r.html(e.i18nMsg.errPwd):r.html(e.i18nMsg.err),t.addClass(o),n.val("")})},p.pubsub=new c("component.userauth2"),p.box=function(e){var t,n,i,a,r=d.i18n.t("common/lbl_user_auth2_title"),o=!1,c=d.i18n.t("common/cancel"),u=function(){"function"==typeof e.cancelCb&&e.cancelCb(),t.hide()},h={message:"",title:r,confirmTpl:o,cancelTpl:c,closeTpl:"",onCancel:u};h=s.extend(!0,{},s.isPlainObject(e.boxOption)&&e.boxOption,h),t=new l(h),t.show().after("hide",function(){!!a&&a.close(),t.destroy()}),n=t.get("classPrefix"),i=s(t.$("."+n+"-message")),a=new p({root:i,tip:e.tip,successCb:function(){t.hide(),"function"==typeof e.successCb&&e.successCb()}})},n.exports=p}),define("module/setting/service",["require","util/i18n!common","jquery.iframeTransport","jquery","../../util/index","module/common/globalService","component/userauth2","i18n"],function(e){function t(e,t){e=e||{},t=t||{};var n=e.condictions||[],i={};he.each(n,function(e,t){i[t.field]=t});var a=e.actions||[],r={};return he.each(a,function(e,t){r[t.type]=t}),e.conditions2=i,e.actions2=r,e.cellNumber=t.cellNumber,e}function n(e,t){t=t||[];var n={};return he.each(t,function(t,i){return i.id==e?(n=i,!1):void 0}),n}function i(){var e=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:getFaces",sid:me.getSid()}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function a(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:changeFaceSettings",sid:me.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function r(e){e=e||[],e="string"==typeof e?e.split(","):e;var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:getAttrs",sid:me.getSid()},data:{attrIds:e}},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function s(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:changePassword",sid:me.getSid()},data:e,onlyVar:!1,preprocess:!1},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function o(e){var t=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"user:bindAuthKey",sid:me.getSid()}}),data:he.param(e),preprocess:!1},function(e){t.resolve(e)}),t.promise()}function l(e){var t=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"user:unbindAuthKey",sid:me.getSid()}}),data:he.param(e),preprocess:!1},function(e){t.resolve(e)}),t.promise()}function c(e){var t=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"user:changeLockPwd",sid:me.getSid()}}),data:he.param(e),preprocess:!1},function(e){t.resolve(e)},function(e,n,i){t.reject(i)}),t.promise()}function d(e){var t=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"user:changeAuth2Lock",sid:me.getSid()}}),data:he.param(e)},function(e){t.resolve(e)},function(e,n,i){t.reject(i)}),t.promise()}function u(e){var t=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"verifyLockPwd",sid:me.getSid()}}),data:he.param({current_password:e})},function(e){t.resolve(e)},function(e,n,i){t.reject(i)}),t.promise()}function p(e){var t=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"user:closeAuth2Lock",sid:me.getSid()}}),data:he.param(e)},function(e){t.resolve(e)},function(e,n,i){t.reject(i)}),t.promise()}function h(e){var t=he.Deferred();return e?(fe.xhr.simpleCall({onlyVar:!1,query:{func:"user:authenticate2",sid:me.getSid()},data:{password:e}},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()):t.reject()}function f(){var e=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:getAVOption",sid:me.getSid()}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function m(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:setAVOption",sid:me.getSid()},data:{attrs:e}},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function g(){var e=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:getATOption",sid:me.getSid()}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function v(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:setATOption",sid:me.getSid()},data:{attrs:e}},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function _(){var e=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:getPasswordPolicy",sid:me.getSid()}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function y(){var e=he.Deferred();return fe.xhr.simpleCall({query:{func:"mbox:getFolderStats",sid:me.getSid()},data:{flush:!0,stats:!0,threads:!0,order:"custom"}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function b(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:createPOPAccounts",sid:me.getSid()},data:{items:e},onlyVar:!1,preprocess:!1},function(e){_e=[],t.resolve(e)},function(){t.reject()}),t.promise()}function w(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:deletePOPAccounts",sid:me.getSid()},data:{ids:e,autoDeleteFolder:!0}},function(e){_e=[],t.resolve(e)},function(){t.reject()}),t.promise()}function M(e,t){var n=he.Deferred();if(t="boolean"===he.type(t)?t:!0,e=e||[],_e.length>0&&t){var i=[];if(e.length>0){for(var a=0;a<_e.length;a++){var r=_e[a];r.id==e&&i.push(r)}n.resolve(i)}else n.resolve(_e);return n.promise()}var s={stats:!0};return e.length>0&&(s.ids=e),fe.xhr.simpleCall({query:{func:"user:getPOPAccounts",sid:me.getSid()},data:s},function(e){_e=e,n.resolve(e)},function(){n.resolve(_e)}),n.promise()}function T(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:updatePOPAccounts",sid:me.getSid()},data:{items:e}},function(e){_e=[],t.resolve(e)},function(){t.reject()}),t.promise()}function L(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:checkPOPAccount",sid:me.getSid()},data:e,onlyVar:!1,preprocess:!1,timeout:2e4},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function x(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:syncPOPAccounts",sid:me.getSid()},data:{ids:e}},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function C(){var e=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:syncAllPOPAccounts",sid:me.getSid()}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function S(){var e=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:syncAutoSyncPOPAccounts",sid:me.getSid()}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function k(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"mbox:deleteFolders",sid:me.getSid()},preprocess:!1,data:{ids:e}},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function D(e,t){var n=he.Deferred(),i={};return i.id=e,i.permanently=void 0==t?!1:t,fe.xhr.simpleCall({query:{func:"mbox:emptyFolder",sid:me.getSid()},data:i},function(e){n.resolve(e)},function(){n.reject()}),n.promise()}function Y(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"mbox:updateFolders",sid:me.getSid()},data:{items:e},onlyVar:!1,preprocess:!1},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function j(e,t,n){var i=he.trim(e),a=n||"%'\"\\/:*?<>|=,^";return t=t||24,i?N(i)>t?"maxLength":P(i,a)?"invalidChars":"valid":"empty"}function N(e){for(var t=0,n=0;n<e.length;n++)e.charCodeAt(n)>127||94==e.charCodeAt(n)?t+=2:t++;return t}function P(e,t){for(var n=0;n<t.length;n++){var i=t.substring(n,n+1);if(e.indexOf(i)>-1)return!0}return!1}function E(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"mbox:createUserFolders",sid:me.getSid()},data:{items:e},onlyVar:!1,preprocess:!1},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function A(e,t){var n,i,a,r=he.Deferred(),s=fe.detector.supportAjaxUpload();return n={url:fe.xhr.getFullRequestURL({url:"/XT5/jsp/mformdata.jsp",query:{func:"mbox:importMail",sid:me.getSid(),fid:e}}),type:"post",processData:!1,contentType:!1},s?(i=new FormData,he.each(t[0].files,function(e,t){i.append("files[]",t)}),n.data=i):(n.files=t,n.useiframe=!0),he.ajax(n).complete(function(e){a=JSON.parse(e.responseText),r.resolve(a)}).fail(function(){r.reject()}),r.promise()}function F(){var e=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:getMailRules",sid:me.getSid()}},function(t){e.resolve(t)},function(){}),e.promise()}function I(e){var i=he.Deferred(),a={};return e=he.extend({isCreate:!1},e||{}),e.isCreate?(he.when(X()).then(function(n){a=t(e.mailRule||{"continue":!0},n),a.isCreate=!0,i.resolve(a)}),i.promise()):(he.when(F(),X()).then(function(r,s){r=r||[],a=n(e.id,r),a=t(a,s),i.resolve(a)}),i.promise())}function H(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:removeMailRules",sid:me.getSid()},data:{ids:e}},function(){t.resolve()},function(){t.reject()}),t.promise()}function Z(e){var t=he.Deferred();return e=e||{},fe.xhr.simpleCall({query:{func:"user:adjustMailRuleOrder",sid:me.getSid()},data:e},function(){t.resolve()},function(){t.reject()}),t.promise()}function R(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:addMailRules",sid:me.getSid()},data:e},function(e){t.resolve(e)},function(e,n,i){t.reject(e,n,i)}),t.promise()}function O(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:updateMailRules",sid:me.getSid()},data:e},function(){t.resolve()},function(e,n,i){t.reject(i.code)}),t.promise()}function X(){var e=he.Deferred();return fe.xhr.simpleCall({query:{func:"sms:getAttrs",sid:me.getSid()}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function J(e,t){var n=he.Deferred();return fe.xhr.simpleCall({query:{func:e?"cal:updateCalFolder":"cal:createCalFolder",sid:me.getSid()},data:t},function(e){n.resolve(e)},function(){n.reject()}),n.promise()}function B(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"cal:deleteCalFolder",sid:me.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function W(){var e=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"cal:listAllCalFolder",sid:me.getSid()}})},function(t){e.resolve(t)}),e.promise()}function q(){var e=he.Deferred();return fe.xhr.simpleCall({query:{func:"cal:listAccessedCalFolder",sid:me.getSid()},data:{showHidden:!0}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function Q(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"cal:setAccessedCalFolderVisible",sid:me.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function $(e){var t=he.Deferred();
return fe.xhr.simpleCall({query:{func:"cal:deleteAccessedCalFolder",sid:me.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function z(){var e=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"mbox:listSharedAccessMbox",sid:me.getSid()}})},function(t){e.resolve(t)}),e.promise()}function U(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"mbox:setSharedAccessMboxVisible",sid:me.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function G(){var e=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"mbox:getShareACL",sid:me.getSid()}})},function(t){e.resolve(t)}),e.promise()}function K(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"mbox:putShareACL",sid:me.getSid()},data:{acl:e}},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function V(){var e=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"user:getActiveSyncDeviceInfos",sid:me.getSid()}})},function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise()}function ee(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:showRecoveryPassword",sid:me.getSid()},data:{password:e.password,deviceId:e.deviceId}},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function te(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:removeActiveSyncDevice",sid:me.getSid()},data:{deviceId:e.deviceId}},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function ne(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:wipeActiveSyncDevice",sid:me.getSid()},data:{password:e.password,deviceId:e.deviceId}},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function ie(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:cancelWipeActiveSyncDevice",sid:me.getSid()},data:{deviceId:e.deviceId}},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function ae(e,t){var n=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"XT5/checkUserForShare.jsp",query:{sid:me.getSid(),uid:e,userList:t},onlyVar:!1,preprocess:!1})},function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise()}function re(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"user:setPrefOpHistoryRecord",sid:me.getSid()},data:{recordItems:e}},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function se(e){var t=he.Deferred();return fe.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:fe.xhr.getRequestURL({url:"/XT5/jsp/setting.jsp",query:{func:"user:setForgetPasswordAttrs",sid:me.getSid()}}),data:he.param(e),onlyVar:!1},function(){t.resolve()},function(e,n,i){t.reject(i)}),t.promise()}function oe(e){var t=he.Deferred(),n=me.getUser().def_sec_op;return he.inArray(e,n)>=0?me.getFolderLockedStatus().isAuth?t.resolve():ge.box({tip:ve.t("common/lbl_user_auth2_tip_op"),successCb:function(){t.resolve()}}):t.resolve(),t.promise()}function le(t){t=he.extend({enableFilter:!0,filterAll:!1,filterIdList:[],isSupportNF:!1,useCache:!0},t);var n=he.Deferred(),i=this;return e(["module/mail/service"],function(e){he.when(e.getFolders(!t.useCache),i.getPOPAccounts()).then(function(e,i){function a(e){return~he.inArray(""+e.id,t.filterIdList)?(e.selected=!0,o.push(e)):u=!1,e}var r=[],s=[],o=[],l=[],c=[],d={id:me.getConfig("file.nfrootid"),name:ve.t("pref/personal/netfolder"),ispermitnf:me.getConfig("file.ispermitnf"),selected:!1},u=!0;if(he.each(i,function(e,t){c.push(t.fid)}),he.each(e,function(e,n){return~he.inArray(""+n.id,c)?!1:(t.filterAll?(n.selected=!0,o.push(n),n.children&&he.each(n.children,function(e,t){t.selected=!0,o.push(t)})):t.enableFilter&&(n=a(n),n.children&&he.each(n.children,function(e,t){t=a(t)})),void(n.flags&&n.flags.hasOwnProperty("system")?r.push(n):s.push(n)))}),t.filterAll&&t.isSupportNF?(d.selected=!0,o.push(d)):t.enableFilter&&t.isSupportNF&&(~he.inArray(d.id+"",t.filterIdList)?(d.selected=!0,o.push(d)):u=!1),0==o.length)l=ve.t("setting/lbl_no_folder");else if(u)l=ve.t("setting/lbl_all_folder");else{var p="";he.each(o,function(e,t){p+="["+t.name+"]"}),l=fe.messageFormat.format(ve.t("setting/lbl_folders_selected"),[p,o.length])}n.resolve({otherFolders:s,sysFolders:r,filtedFolders:o,filtedFoldersName:l,netDiskFolderInfo:d})})}),n.promise()}function ce(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"sms:sendVerifyCode",sid:me.getSid()},data:{cellNumber:e}},function(e){t.resolve(e)},function(e,n,i){t.reject(i)}),t.promise()}function de(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"sms:isCellnumberBinded",sid:me.getSid()},data:{cellnumber:e}},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function ue(e){var t=he.Deferred();return fe.xhr.simpleCall({query:{func:"sms:setAttrs",sid:me.getSid()},data:e},function(e){t.resolve(e)},function(e,n,i){t.reject(i)}),t.promise()}function pe(){return le({filterAll:!0}).then(function(e){e.filtedFolders})}e("util/i18n!common"),e("jquery.iframeTransport");var he=e("jquery"),fe=e("../../util/index"),me=e("module/common/globalService"),ge=e("component/userauth2"),ve=e("i18n"),_e=[];return{getAttrs:r,getFacesetting:i,changeFacesetting:a,changePassword:s,bindAuthKey:o,unbindAuthKey:l,changeLockPwd:c,changeAuth2Lock:d,verifyLockPwd:u,closeAuth2Lock:p,userVerifyAuth2:h,getAVInfo:f,saveAVInfo:m,getJunkFilterInfo:g,setJunkFilterInfo:v,getPasswordPolicy:_,getAllFolderStats:y,createPOPAccount:b,checkPOPAccount:L,deletePOPAccounts:w,updatePOPAccounts:T,getPOPAccounts:M,syncPOPAccounts:x,syncAllPOPAccounts:C,syncAutoSyncPOPAccounts:S,doEmptyFolder:D,updateFolders:Y,deleteFolders:k,createFolders:E,importEMLToFolder:A,isValidString:j,getMailRules:F,editMailRule:I,removeMailRules:H,adjustMailRules:Z,updateMailRule:O,addMailRule:R,getSMSAttrs:X,deleteCalendar:B,upsetCalendar:J,listAllCalFolder:W,listAccessedCalFolder:q,setAccessedCalFolderVisible:Q,deleteAccessedCalFolder:$,listSharedAccessMbox:z,setSharedAccessMboxVisible:U,getMboxShareACL:G,putMboxShareACL:K,checkUserForShare:ae,getActiveSyncDevice:V,getRecoveryPass:ee,removeActiveSyncDevice:te,remoteWipeDevice:ne,cancelRemoteWipeDevice:ie,setPrefOpHistoryRecord:re,setForgetPasswordAttrs:se,auth2continue:oe,generateFolderFilterData:le,sendVerifyCode:ce,isCellnumberBinded:de,updateSmsAttrs:ue,parseMsgNotifyRange:pe}}),define("module/contact/service",["require","i18n!contact","jquery","moment","util/index","util/sitenode","module/common/globalService"],function(e){function t(e){var t={},n=0,i=0,a=0,r={};return H.each(e,function(e,t){n++;var s=t.groups||[];if(0===s.length)i++;else if(1===s.length){var o=s[0];r[o]?r[o].count+=1:(r[o]={},r[o].count=1,r[o].coexistCount=0,a++)}else H.each(s,function(e,t){r[t]?(r[t].count+=1,r[t].coexistCount+=1):(r[t]={},r[t].count=1,r[t].coexistCount=1,a++)})}),t.noGroupContactsCount=i,t.globalContactsCount=n,t.globalGroupsCount=a,t.groups=r,t}function n(e,t){e=e||{};var n=e.groups;return H.each(t,function(e,i){var a=!1;for(var r in n)if(r==i.id){i=H.extend(n[r],i),a=!0;break}a||(i=H.extend({count:0,coexistCount:0},i)),t[e]=i}),{gcCount:e.globalContactsCount,groups:t,noGroupContactsCount:e.noGroupContactsCount}}function i(e,t){var n,i,a=[];return H.each(e,function(e,r){n='"'+(r.name||"")+'" <'+r.emailaddr+">";var s=null;null!=(i=R.py.match(n,t,null))?(s=H.extend({},r,{matchText:n},i,{isOab:!1}),a.push(s)):null!=(i=R.py.match(n,t,r.fullPY))&&(s=H.extend({},r,{matchText:n},i,{isOab:!1,startIndex:1}),a.push(s))}),a}function a(e){return H.each(e,function(e,t){H.extend(t,{id:t["@id"],ou:t["@ou"],type:t["@type"],location:t["@location"],duty:t["@duty"],emailaddr:t.email})}),e}function r(e){return H.each(e,function(e,t){H.extend(t,{name:t.FN,emailaddr:t["EMAIL;PREF"],birthday:t.BDAY,icq:t.ICQ,url:t.URL,address:t["ADR;HOME"],mobile:t["TEL;CELL;VOICE"],telephone:t["TEL;HOME;VOICE"],company:t.ORGNAME,companyNumber:t["TEL;WORK;VOICE"],companyFax:t["TEL;WORK;FAX"],companyAddress:t["ADR;WORK"],companyPostalCode:t["PC;WORK"],postalCode:t["PC;HOME"],remark:t.ZS})}),e}function s(e){var t=H.Deferred();return R.xhr.simpleCall({query:{func:"pab:searchContacts",sid:X.getSid()},data:e},function(e){t.resolve(e)}),t.promise()}function o(e){var t,n=H.Deferred(),a=R.cache.getItem("cm_contact_pabContacts")||{};return a.timeout&&a.timeout>=Z().valueOf()?(t=i(a.list,e),t=w(t,!1,!1),n.resolve(t)):s({returnAttrs:["id","FN","EMAIL;PREF"],fullPY:!0}).then(function(a){a=r(a),R.cache.setItem("cm_contact_pabContacts",{timeout:Z().valueOf()+6e5,list:a}),t=i(a,e),t=w(t,!1,!1),n.resolve(t)}),n.promise()}function l(e){var t=H.Deferred();e="boolean"===H.type(e)?e:!1;var n=R.cache.getItem("cm_contact_pGroups")||{};return e&&n.timeout&&n.timeout>=Z().valueOf()?t.resolve(n.grps):R.xhr.simpleCall({query:{func:"pab:getAllGroups",sid:X.getSid()}},function(n){e&&R.cache.setItem("cm_contact_pGroups",{timeout:Z().valueOf()+6e5,grps:n}),t.resolve(n)}),t.promise()}function c(e){var t=H.Deferred();return R.xhr.simpleCall({query:{func:"oab:getDirectories",sid:X.getSid()},data:{dn:e,attrIds:["email"]}},function(e){t.resolve(e)}),t.promise()}function d(e,t,n,i,a){var r=-1===n,s=H.Deferred();return H.when(c(e)).then(function(o){var l=o.name;o=(o||{}).ou||[];var c=r?o:o.slice(t,t+n),d=O.getOrg(e);if(H.each(c,function(e,t){t.id=O.getDN(d,t.id)}),!r){var p=t+n-o.length;0>p?(n=0,t=0):n>p?(n=p,t=0):t-=o.length}H.when(u(e,t,n,i,a)).then(function(e,t){e=e||[];var n=c.concat(e);s.resolve(n,t+o.length,o.length,l)})}),s.promise()}function u(e,t,n,i,a){var r=H.Deferred();return R.xhr.simpleCall({query:{func:"oab:listEx",sid:X.getSid()},data:{dn:e,returnAttrs:a||X.getConfig("contact.oab.returnattrs"),start:t,limit:n,order:i,defaultReturnMeetingRoom:X.getConfig("contact.oab.defaultreturnmeetingroom")||!1},onlyVar:!1},function(e){r.resolve(e["var"],e.total)}),r.promise()}function p(e){var t=H.Deferred();return R.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:R.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"oab:search",sid:X.getSid()}}),data:H.param(e),onlyVar:!1},function(e){t.resolve(e.list,e.total||0)}),t.promise()}function h(e){var t=H.Deferred();e=H.extend({limit:parseInt(X.getConfig("contact.itemperpage"))||20},e);var n,i,a,s;return n="boolean"===H.type(e.useCache)?e.useCache:!1,s="boolean"===H.type(e.returnTotalVal)?e.returnTotalVal:!0,n&&(i=R.cache.getItem("cm_contact_psearch")||{},a=i[e.keyword],a&&Z().valueOf()<=a.timeout)?t.resolve(a.value):(R.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:R.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab:search",sid:X.getSid()}}),data:H.param(e),onlyVar:!1},function(a){var o,l,c,d=[];if(n){for(c=r(a.list),o=0,l=c.length;l>o;o++){var u,p=c[o];p.emailaddr&&(u='"'+(p.name||"")+'" <'+p.emailaddr+">",R.py.indexOf(u,e.keyword)>-1&&(H.extend(p,{matchText:u},R.py.match(u,e.keyword,null),{isOab:!1}),d.push(p)))}i[e.keyword]={timeout:Z().valueOf()+6e5,value:d},R.cache.setItem("cm_contact_psearch",i),s?t.resolve(d,a.total):t.resolve(d)}else t.resolve(a.list,a.total,a.grpName)}),t.promise())}function f(e){var t=H.Deferred(),n=g(e),i=R.cache.getItem("cm_contact_osearch")||{},a=i[e.keyword];return a&&Z().valueOf()<=a.timeout?t.resolve(a.value):(R.xhr.simpleCall({query:{func:"oab:autoMatch",sid:X.getSid()},data:n},function(n){a=v(n,e),i[e.keyword]={timeout:Z().valueOf()+6e5,value:a},R.cache.setItem("cm_contact_osearch",i),t.resolve(a)},function(){t.reject()}),t.promise())}function m(e){function t(e,t,n){return e=e||[],t=t||U,n=n||0,e.slice(n,n+t)}var n=H.Deferred(),i=g(e);i.limit=z,i.returnLimit=z,i.matchPhone=!0;var a=e.limit||U,r=R.cache.getItem("cm_contact_oab_quickSearch")||{};return e.keyword?(R.xhr.simpleCall({query:{func:"oab:autoMatch",sid:X.getSid()},data:i,onlyVar:!1},function(i){var s=i.count,o=v(i["var"],e),l=o.length;r={value:o,searchTotal:s,returnTotal:l},R.cache.setItem("cm_contact_oab_quickSearch",r),n.resolve(t(o,a,0),l)},function(){n.reject()}),n.promise()):H.isEmptyObject(r)?n.resolve([],0):n.resolve(t(r.value,a,e.start),r.returnTotal)}function g(e){var t;return e=e||{},t=H.extend({keyword:"",attrIds:["m","@id","@type","security_level"],"@type":"U,L,X",enableNickNameAC:X.getConfig("contact.oab.enablenicknameac"),enableAliasAC:X.getConfig("contact.oab.enablealiasac"),enableVirtualUserAC:X.getConfig("contact.oab.enablevirtualuserac"),matchDuty:q},e),W&&t.attrIds.push("location"),q&&t.attrIds.push("@duty"),$&&t.attrIds.push("fullPY"),t}function v(e,t){var n=[];return e&&H.isArray(e)&&e.length?(e=a(e),H.each(e,function(e,i){function a(){var e=i.alias_emails;H.each(e,function(e,n){var a='"'+(i.true_name||i.nick_name||"")+'" <'+n+"> ",s=R.py.match(a,t.keyword);s&&r(H.extend({matchText:a,emailaddr:n,isAliasEmailMatch:!0},s))})}function r(e){e=e||{};var t=H.extend({isAliasEmailMatch:!1,name:i.true_name||i.nick_name||R.Email.parse(c).name||"",email:i.email,emailaddr:s,startIndex:o,matchLength:l,matchText:c,isOab:!0,type:i["@type"],id:"X"===i["@type"]?i["@id"]:i.email},e);W&&(t.location=i.location),Q&&(t.securityLevel=i.security_level),n.push(t)}var s,o=-1,l=-1,c="",d=!1;if(s=i.email){if(i.m){var u=i.m[0].split(":",3);o=parseInt(u[0],10),l=parseInt(u[1],10),c=u[2],o>=0&&l>0?c===i.true_name?(c='"'+i.true_name+'" <'+i.email+">",o+='"'.length):c===i.nick_name?(c='"'+i.nick_name+'" <'+i.email+">",o+='"'.length):c===i.email?(c='"'+(i.true_name||i.nick_name||"")+'" <'+i.email+">",o+=('"'+(i.true_name||i.nick_name||"")+'" <').length):q&&c===i.duty?(c='"'+(i.true_name||i.nick_name||"")+'" <'+i.email+"> "+i.duty,o+=('"'+(i.true_name||i.nick_name||"")+'" <'+i.email+"> ").length):(c=R.Email.test(c)?'"'+(i.true_name||i.nick_name||"")+'" <'+i.email+">":'"'+(i.true_name||i.nick_name||c||"")+'" <'+i.email+">",d=!0):(c=R.Email.test(c)?'"'+(i.true_name||i.nick_name||"")+'" <'+i.email+">":'"'+(i.true_name||i.nick_name||c||"")+'" <'+i.email+">",d=!0)}else c='"'+(i.true_name||i.nick_name||"")+'" <'+i.email+">",d=!0;d&&R.py.indexOf(c,t.keyword)>-1&&(H.extend(i,R.py.match(c,t.keyword,null)),o=i.startIndex,l=i.matchLength),d&&void 0===i.startIndex||r(),a()}}),n):[]}function _(e){var t,n,i,a=H.Deferred();return e=H.extend({keyword:"",limit:U,useCache:!0,uniqueContacts:!1,returnTotalVal:!1},e),e.keyword?(i=!!e.uniqueContacts,t=R.cache.getItem("cm_contact_search")||{},n=t[e.keyword],n&&Z().valueOf()<=n.timeout?a.resolve(n.value):(H.when(B&&W?l(!0):H.noop(),B?h(e):H.noop()).then(function(r,s){r=r||[],s=s||[],s.length>U?(n=w(s,e.style),n=b(n,r),t[e.keyword]={timeout:Z().valueOf()+6e5,value:n},a.resolve(n)):H.when(J?f(e):H.noop()).then(function(o){o=o||[],i&&H.each(s,function(e,t){for(var n,i,a=o.length-1;a>=0;a--)i=o[a],n='"'+i.name+'" <'+(i.email||i.emailaddr)+">",(n===t.matchText||i.emailaddr===t.emailaddr)&&o.splice(a,1)}),n=w(s.concat(o.sort(y("type"))),e.style),n=b(n,r),t[e.keyword]={timeout:Z().valueOf()+6e5,value:n},a.resolve(n)},function(){a.reject()})},function(){a.reject()}),a.promise())):a.reject()}function y(e){return function(t,n){var i=t[e],a=n[e];return i>a?1:a>i?-1:0}}function b(e,t){return W&&H.each(e,function(e,n){if(n.isOab){var i=n.location.split("/");i=i.reverse(),i.forEach(function(e,t,n){n[t]=R.html.encode(e)}),n.location="/"+i.join("/")}else if(void 0===n.groups||0===n.groups.length)n.location="/"+R.i18n.t("contact/tab_pab")+"/"+R.i18n.t("contact/gp_other");else{var a=n.groups[n.groups.length-1];H.each(t,function(e,t){return t.id==a?(n.location="/"+R.i18n.t("contact/tab_pab")+"/"+R.html.encode(t.name),!1):void 0})}}),e}function w(e,t,n){var i=[],a=H("<div><b>{0}</b></div>");return n="boolean"===H.type(n)?n:!0,"object"===H.type(t)?a.find("b").css(t):"string"===H.type(t)&&a.find("b").attr("class",t),a=a.html(),n?H.each(e,function(e,t){var n,r,s,o=H.extend(!0,{},t);o.matchText&&o.startIndex>-1&&o.matchLength>0&&(n=o.matchText.substring(0,o.startIndex),r=R.html.encode(o.matchText.substring(o.startIndex,o.startIndex+o.matchLength)),s=o.matchText.substring(o.startIndex+o.matchLength),o.matchText=R.html.encode(n)+a.replace("{0}",r)+R.html.encode(s),i.push(o))}):H.each(e,function(e,t){var n,r,s,o,l,c=t.matchText.lastIndexOf("<");t.startIndex>c?(n=t.matchText.substr(c+1,t.matchText.length-c-2),r=t.startIndex-c-1):(n=t.matchText.substr(1,c-3),r=t.startIndex-1),s=n.substring(0,r),o=R.html.encode(n.substring(r,r+t.matchLength)),l=n.substring(r+t.matchLength),t.matchPart=R.html.encode(s)+a.replace("{0}",o)+R.html.encode(l),i.push(t)}),i}function M(){var e=H.Deferred();return H.when(s({returnAttrs:["id","FN","EMAIL;PREF","groups"]}),l()).then(function(t,n){for(var i={},a=0,s=[],o=0;!0&&o!=n.length;o++)i[n[o].id]=n[o];t=r(t),H.each(t||[],function(e,t){t.oName=t.name,t.name=t.name||t.emailaddr;var n=t.groups;if(0==n.length)a++,s.push(t);else for(var r=0;!0&&r!=n.length;r++){var o=n[r];i[o].children||(i[o].children=[],i[o].count=0),i[o].children.push(t),i[o].count++}});var l=[];H.each(n,function(e,t){t.count&&l.push(t)}),0!=a&&l.push({id:"OTHER",children:s,count:a}),e.resolve(l)}),e.promise()}function T(e){var t=H.Deferred();return e=e||"",R.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:R.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab:getHitCounter",sid:X.getSid()}}),data:"key=oab&limit="+e},function(e){e=a(e),e=r(e);var n=[],i=[];H.each(e,function(t,a){a.emailaddr==(e[t+1]||{}).emailaddr&&(a=H.extend(a,e[t+1])),i.indexOf(a.emailaddr)<0&&(n.push(a),i.push(a.emailaddr))}),t.resolve(n)}),t.promise()}function L(){var e=H.Deferred();return H.when(s(),l()).then(function(i,a){i=i||[];var r=t(i),s=n(r,a);e.resolve(s)}),e.promise()}function x(){var e=H.Deferred();return R.xhr.simpleCall({query:{func:"pab:getContactSchema",sid:X.getSid()}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function C(e,t){var n=H.Deferred();return t=t||[],R.xhr.simpleCall({query:{func:"pab:getContacts",sid:X.getSid()},data:{ids:e,returnAttrs:t}},function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise()}function S(e,t){var n=H.Deferred();return e=e||[],"array"==H.type(e)&&(e=e.join(",")),t=t||["true_name","nick_name","gender","@ou","email","mobile_number","company_phone","fax_number","address","@location","zipcode","home_phone","city","province","duty","@id"],R.xhr.simpleCall({query:{func:"oab:get",sid:X.getSid()},data:{list:e,returnAttrs:t},preprocess:!1},function(e){"array"===H.type(e)?n.resolve(e):H.isPlainObject(e)&&"array"===H.type(e["var"])?n.resolve(e["var"]):n.resolve([])},function(){n.reject()}),n.promise()}function k(e){var t=H.Deferred();return e.groups&&(e.groups=e.groups.join(" ")),R.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:R.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab:saveContact",sid:X.getSid()}}),data:H.param(e),onlyVar:!1,preprocess:!1},function(e){"FA_FORBIDDEN"==e.code?t.reject(e["var"].msg):t.resolve(e["var"])}),t.promise()}function D(e,t){var n=H.Deferred();return t="boolean"===H.type(t)?t:!1,R.xhr.simpleCall({query:{func:"pab:createContacts",sid:X.getSid()},data:{items:e||[],dontEnforceEmail:!1,emailExistsAction:"ignore",returnItemInfo:t},preprocess:!1},function(e){e.code&&"S_PARTIAL_OK"==e.code?n.resolve(e["var"]):n.resolve(e)},function(e){n.reject(e)}),n.promise()}function Y(e){var t=H.Deferred();return e&&0!==e.length?(R.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:R.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab:addOrUpdate",sid:X.getSid()}}),data:R.params.serialize({contacts:e})},function(e){t.resolve(e)},function(){t.reject()}),t.promise()):t.reject()}function j(e,t){var n=H.Deferred();return R.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:R.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab"===e?"pab:getContactAvatar":"oab:getHeadImageData",sid:X.getSid()}}),data:H.param({uids:t}),onlyVar:!1},function(e){H.each(e.list,function(e,t){1==t.hasHeadImage&&(t.avatarUrl+="&sid="+X.getSid()+"&uid="+(t.email||t.uid)+"&time="+(new Date).getTime())}),n.resolve(e.list)}),n.promise()}function N(e){var t=H.Deferred(),n=e.func;return delete e.func,R.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:R.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"edit"==n?"pab:editGroup":"pab:addGroup",sid:X.getSid()}}),data:H.param(e)},function(e){t.resolve(e)}),t.promise()}function P(e,t){var n=H.Deferred();return R.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:R.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab:getContactByEmail",sid:X.getSid()}}),data:H.param({emails:e,returnAttrs:t})},function(e){n.resolve(e)},function(){n.resolve()}),n.promise()}function E(e){var t=H.Deferred();return R.xhr.simpleCall({query:{func:"pab:updateContacts",sid:X.getSid()},data:{items:e||[],dontEnforceEmail:!0}},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function A(e,t,n){if(!(e instanceof Array)){var i=[];return i.push(e),A(i,t,n)}for(var a=[],r=0;r<e.length;r++){var s=e[r].id;n?(s=t+"/"+s,F(s,n)):t=s;var o=e[r].name||R.i18n.t("common/none");if(e[r].ou){var l=A(e[r].ou,t,s);a.push({name:o,dn:s,children:l})}else a.push({name:o,dn:s})}return a}function F(e,t){G[e]=t}function I(e){return G[e]}e("i18n!contact");var H=e("jquery"),Z=e("moment"),R=e("util/index"),O=e("util/sitenode"),X=e("module/common/globalService"),J=X.getConfig("user.supportoab"),B=X.getConfig("user.supportpab"),W=X.getConfig("user.showaddresslocation"),q=X.getConfig("user.enabledutyac"),Q=X.getConfig("user.enablesecuritylevel"),$=X.getConfig("contact.enablefullpy"),z=parseInt(X.getConfig("contact.oab.quicksearchlimit"),10);isNaN(z)&&(z=4e3);var U=50,G={};return{filterOabContacts:a,filterPabContacts:r,getAllPabContacts:s,getAllPabGroups:l,getPabGroupsWithCount:L,getPabHitCounterWithDetails:T,getPabGroupsAndItsMembers:M,getOabDirectories:c,getOabOuUserList:d,getPabContactSchema:x,getPabAttrs:C,getOabAttrs:S,getContactAvatar:j,searchPabContacts:h,matchPabContacts:o,searchOabContacts:f,searchContacts:_,advanceSearchOabContacts:p,quickSearchOabContacts:m,createOrEditPabContact:k,createPabContacts:D,createOrUpdatePabContacts:Y,savePabGroup:N,updatePabContacts:E,getPabContactsByEmail:P,highLightContacts:w,format2TreeAndSetIndex:A,getDNIndex:I}}),function(){define("module/mail/subjectPrefixFormatter",["require","exports","module","module/common/globalService"],function(e,t,n){function i(){return u.getConfig("setting.supportsubjectprefixexpand")&&1===u.getUser().subject_refw_prefix_expand}function a(e,t,n){var i,a=!1;if(!e||!t)return!1;n="boolean"==typeof n?n:!0,i=h[e]||[];for(var r=0;r<i.length;++r)if(n?i[r].toLowerCase()===t.toLowerCase():i[r]===t){a=!0;break}return a}function r(e){var t;return"string"==typeof e&&(t=e.length)?$.inArray(e[t-1],p)>=0?e.slice(0,t-1):e:""}function s(e){for(var t,n=[],i=0;i<e.length;++i)t=r(e[i]),">"===t?n.push(t):n.push(t+"["+p.join("")+"]");return new RegExp("^("+n.join("|")+")(\\s*)","gi")}function o(e){var t,n=[],i=0;if(arguments.length)for(;i<arguments.length;++i)t=arguments[i],h.hasOwnProperty(t)&&(n=n.concat(h[t]));else for(t in h)h.hasOwnProperty(t)&&(n=n.concat(h[t]));return n}function l(e,t){function n(e){e.lastIndex=0}function i(e,t){var s;return n(t),s=t.exec(e),null==s?!1:(e=e.slice(t.lastIndex),a.push({prefix:s[0],prefixWithoutColon:r(s[1]),right:e}),e.length?i(e,t):!1)}var a=[];return"string"==typeof e&&e.length?(i(e,t),a):a}function c(e){var t=s(o()),n=l(e,t),a=1,r={isSubtract:!1,origin:e,prefixes:null,right:null,afterSubtract:null,parseResult:n};if(!i()&&n.length>a){r.isSubtract=!0,r.right=n[n.length-1].right,r.afterSubtract=[r.prefixes,r.right].join(""),r.prefixes=[];for(var c=0;a>c;++c)r.prefixes.push(n[c].prefix);r.prefixes=r.prefixes.join("")}return r}function d(e,t){var n,r,c,d=e;return"string"==typeof t&&t.length&&(c=f[t])?(n=s(o(c)),r=l(e,n),!i()&&r.length>1&&a(c,r[1].prefixWithoutColon)&&(d=r[0].prefix+r[1].right),d):d}var u=e("module/common/globalService"),p=[":",""],h={re:["Re","Reply",">","","","","",""],fw:["Fw","",""],fwd:["Fwd"]},f={reply:"re",replyall:"re","reply-attach":"re","replyall-attach":"re",forward:"fw",forwardd:"fwd"};n.exports={subtractPrefixes:c,subtractComposePrefix:d}})}(),define("module/mail/service",["require","exports","module","i18n!mail","jquery","moment","../../util/index","../common/globalService","../setting/service","../contact/service","./subjectPrefixFormatter"],function(e,t,n){function i(){return{vip:-1,unread:-2,flagged:-3,other:-4,defer:-5,mboxshare:-6,extranet:-7,inbox:1,draft:2,sent:3,trash:4,junk:5,virus:6,advertisements:7,reclaimable:8,trs:9,document:10,picture:11,music:12,mms:13,sms:14,collect:15,subscribe:18,sys:19}}function a(e){var t=ge.getUser();return 1===t.display_list?!r(e):!1}function r(e){var t,n=i(),a=me.mboxa.disassembly(e),r=a.mboxa;return e=a.fid,r.length>0&&"shareFolder"===ne(r)?!0:isNaN(e)?!0:(t=[n.draft,n.sent,n.trash,n.junk,n.defer],t.indexOf(e)>=0)}function s(e,t,n){var i,a=he.Deferred();return e="boolean"==typeof e?e:!1,t="boolean"==typeof t?t:!1,n="boolean"==typeof n?n:!0,i=n?t?JSON.parse(JSON.stringify(be.flatOriginalFolders)):JSON.parse(JSON.stringify(be.originalFolders)):t?JSON.parse(JSON.stringify(be.flatFolders)):JSON.parse(JSON.stringify(be.folders)),!e&&i.length>0?a.resolve(i):(me.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:me.xhr.getRequestURL({url:"/XT5/jsp/mail.jsp",query:{func:"getAllFolders",sid:ge.getSid()}}),data:he.param({stats:!0,threads:!0})},function(e){be.folders=ee(e),be.originalFolders=V(e),be.flatFolders=K(be.folders),be.flatOriginalFolders=K(be.originalFolders),n?a.resolve(JSON.parse(JSON.stringify(t?be.flatOriginalFolders:be.originalFolders))):a.resolve(JSON.parse(JSON.stringify(t?be.flatFolders:be.folders)))},function(){a.reject()}),a.promise())}function o(e){var t=he.Deferred(),n=he.extend({messages:!0,threads:!0},e);return me.xhr.simpleCall({query:{func:"mbox:getFolderStats",sid:ge.getSid()},data:n},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function l(e){var t={};return he.each(be.flatFolders||[],function(n,i){return i.id==e?(t=he.extend(!0,{},i),!1):void 0}),t}function c(){return be.flatOriginalFolders}function d(e){e="boolean"==typeof e?e:!0;var t=he.Deferred();return me.xhr.simpleCall({query:{func:"mbox:listSharedAccessMbox",sid:ge.getSid()},data:{showHidden:e}},function(e){he.each(e,function(e,t){t.id="@"+t.id,t.name=t.email}),t.resolve(e)},function(){t.reject()}),t.promise()}function u(e,t){var n=he.Deferred();return e=e||"list",t.nocache=!0,"list"===e?p(t).then(function(e){n.resolve(e)}):"search"===e&&g(t).then(function(e){var t={total:e.total,list:e["var"],limit:e.limit};n.resolve(t)}),n.promise()}function p(e){var t,n,r,s=he.Deferred(),o=i();if(r=m(e),e.flush="boolean"===he.type(e.flush)?e.flush:!0,!e.flush&&be.mailList.list.length>0)s.resolve(be.mailList);else{switch(t=!r.ruleConditions&&a(e.fid)?"mbox:listThreads":"mbox:listMessages",t=e.hasOwnProperty("mboxa")&&-1!==e.mboxa.indexOf("@")?"mbox:listMessages":t,e.fid){case o.vip:n=Z("vip"),delete r.fid,r.filter=he.extend(!0,r.filter||{},n[2]);break;case o.unread:n=Z("unread"),delete r.fid,r.filter=he.extend(!0,r.filter||{},n[2]);break;case o.flagged:n=Z("flagged"),delete r.fid,r.filter=he.extend(!0,r.filter||{},n[2]);break;case o.defer:n=Z("defer"),delete r.fid,r.filter=he.extend(!0,r.filter||{},n[2])}me.xhr.simpleCall({query:{func:t,sid:ge.getSid()},data:r,onlyVar:!1,preprocess:!1},function(t){var n={};"S_OK"===t.code||"FA_INVALID_BIND_MID"===t.code?(n.total=t.total||0,n.list=t["var"]||[],e.nocache||(be.mailList=n),s.resolve(n)):s.reject(t)},function(){s.reject()})}return s.promise()}function h(){return be.mailList}function f(e,t){var n=h().list||[];he.each(n,function(n,i){return i.id===e?(he.extend(!0,i,t),!1):void 0})}function m(e){var t=ge.getUser(),n=i();e.fid===n.defer&&(e.order="deferredDate",e.desc=!1);var a={start:e.start||0,limit:e.limit||t.maxlist||20,mode:"count",order:e.order||"receivedDate",desc:"boolean"===he.type(e.desc)?e.desc:!0,returnTotal:!0,summaryWindowSize:e.limit||t.maxlist||20,detailLevel:3};return void 0!==e.fid&&(a.fid=e.fid,e.fid<0&&(a.skipLockedFolders=!0)),he.isArray(e.fids)&&e.fids.length>0&&(delete a.fid,a.fids=e.fids),void 0!==e.topFirst&&(a.topFirst=e.topFirst),he.isPlainObject(e.filter)&&(a.filter=e.filter),he.isPlainObject(e.filterFlags)&&(a.filterFlags=e.filterFlags),void 0!==e.ruleConditions&&(a.ruleConditions=e.ruleConditions),e.mboxa&&(a.mboxa=e.mboxa),a}function g(e){var t,n,i,a=he.Deferred();return t=_(e),n=JSON.stringify(t),i=v(n),i&&!e.refresh?a.resolve(i):me.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:me.xhr.getRequestURL({url:"/XT5/jsp/mail.jsp",query:{func:"searchMessages",sid:ge.getSid()}}),data:he.param(t),onlyVar:!1},function(i){i.limit=t.limit,i.mboxa=t.mboxa,e.nocache||te({condition:n,result:i}),a.resolve(he.extend(!0,{},i))},function(){a.reject()}),a.promise()}function v(e){var t=null;return e=he.isPlainObject(e)?JSON.stringify(_(e)):e,e===be.searchedMailList.condition&&be.searchedMailList.timeout>=(new Date).getTime()?t=he.extend(!0,{},be.searchedMailList.result):e||(t=be.searchedMailList.result),t}function _(e){var t=ge.getUser(),n={start:e.start||0,limit:e.limit||t.maxlist||20};return e.hasOwnProperty("refresh")&&(n.refresh=e.refresh),e.pattern&&(n.pattern=e.pattern),e.mboxa&&(n.mboxa=e.mboxa),e.hasOwnProperty("fid")&&(n.fid=e.fid),e.subject&&(n.subject=e.subject),e.from&&(n.from=e.from),e.fromAddress&&(n.fromAddress=e.fromAddress),e.fromEmail&&(n.fromEmail=e.fromEmail),e.fromType&&(n.fromType=e.fromType),e.to&&(n.to=e.to),e.sentDate&&(n.sentDate=e.sentDate),e.receivedDate&&(n.receivedDate=e.receivedDate),e.attachType&&(n.attachType=e.attachType),e.flagType&&(n.flagType=e.flagType),e.priority&&(n.priority=e.priority),e.hasOwnProperty("read")&&(n.read=e.read),e.hasOwnProperty("draft")&&(n.draft=e.draft),e.size&&(n.size=e.size),e.dealings&&(n.dealings=e.dealings),n}function y(e){return me.Email.parse(e||"").every(function(e){var t=e.address,n=(t.split("@")[1]||"").toLowerCase(),i=-1===(ge.getConfig("user.alldomains")||[]).indexOf(n);return i&&-1===we.indexOf(t)})}function b(e){var t=ge.getUser(),n=i(),a=ge.getConfig("mail.enabledeliverystatus"),r=e.flags||{},s=!(!e.composeExtra||!e.composeExtra.autoDel),o=s&&de(e.composeExtra.autoDel);return r.system?(e.icon="state-icon icon-SYSTEM",e.iconMsg=me.i18n.t("mail/source_system")):r.draft?(e.icon="state-icon icon-DRAFT",e.iconMsg=me.i18n.t("main/alt_m_DRAFT")):r.scheduleDelivery?(e.icon="state-icon icon-SCHEDULED",e.iconMsg=me.i18n.t("main/alt_m_SCHEDULED")):r.encrypted&&r.signed?(e.icon="state-icon icon-SIGN_ENCRYPT",e.iconMsg=me.i18n.t("main/alt_m_SIGN_ENCRYPT")):r.signed?(e.icon="state-icon icon-SIGNED",e.iconMsg=me.i18n.t("main/alt_m_SIGNED")):r.encrypted?(e.icon="state-icon icon-ENCRYPTED",e.iconMsg=me.i18n.t("main/alt_m_ENCRYPTED")):r.forwarded&&r.replied?(e.icon="state-icon icon-REPLIED_FORWARDED",e.iconMsg=me.i18n.t("main/alt_m_REPLIED_FORWARDED")):r.forwarded?(e.icon="state-icon icon-FORWARDED",e.iconMsg=me.i18n.t("main/alt_m_FORWARDED")):r.replied?(e.icon="iconback",e.iconMsg=me.i18n.t("main/alt_m_REPLIED")):y(e.from)||y(e.sender)?(e.icon="state-icon icon-stranger",e.iconMsg=me.i18n.t("mail/externalEmail")):r.calendar?(e.icon="iconschedule",e.iconMsg=me.i18n.t(r.read?"mail/alt_m_READED_CALENDAR_MAIL":"mail/alt_m_UNREAD_CALENDAR_MAIL")):r.read||(e.icon="state-icon icon-mUNREAD",e.iconMsg=me.i18n.t("main/alt_m_UNREAD")),t.display_size&&(e.display_size=me.size.bytesToSize(e.size)),
1===e.priority||2===e.priority?(e.priorityIcon="state-icon icon-pHIGH",e.priorityMsg=me.i18n.t("main/alt_p_HIGH")):(4===e.priority||5===e.priority)&&(e.priorityIcon="state-icon icon-pLOW",e.priorityMsg=me.i18n.t("main/alt_p_LOW")),"unscaned"===e.antiVirusStatus||"novirus"===e.antiVirusStatus||("cleaned"===e.antiVirusStatus?(e.icon="state-icon icon-avsCLEANED",e.iconMsg=me.i18n.t("main/alt_avs_CLEANED")):"infected"===e.antiVirusStatus?(e.icon="state-icon icon-avsINFECTED",e.iconMsg=me.i18n.t("main/alt_avs_INFECTED")):"undetermined"===e.antiVirusStatus&&(e.icon="state-icon icon-avsUNDETERMINED",e.iconMsg=me.i18n.t("main/alt_avs_UNDETERMINED"))),a&&3===e.rclStatus?(e.icon="state-icon mail_rcl_state_3",e.iconMsg=me.i18n.t("main/alt_m_RCPT_RECALLED_SUCC")):a&&5===e.rclStatus?(e.icon="state-icon mail_rcl_state_5",e.iconMsg=me.i18n.t("main/alt_m_RCPT_RECALLED_PART")):a&&r.rcptRead?(e.icon="state-icon "+(r.rcptFailed?"icon-RCPT_SUCC_FL":"icon-RCPT_READ"),e.iconMsg=me.i18n.t(r.rcptFailed?"main/alt_m_RCPT_SUCC_FL":"main/alt_m_RCPT_READ")):a&&r.rcptSucceed?(e.icon="state-icon "+(r.rcptFailed?"icon-RCPT_SUCC_FL":"icon-RCPT_SUCC"),e.iconMsg=me.i18n.t(r.rcptFailed?"main/alt_m_RCPT_SUCC_FL":"main/alt_m_RCPT_SUCC")):a&&r.rcptFailed?(e.icon="state-icon icon-mRCPT_FAIL",e.iconMsg=me.i18n.t("main/alt_m_RCPT_FAIL")):a&&r.rcptQueued&&(e.icon="state-icon icon-RCPT_QUEUED",e.iconMsg=me.i18n.t("main/alt_m_RCPT_QUEUED")),a&&s&&(e.icon=o?"state-icon icon-mAutoDelDestroy":"state-icon icon-mAutoDel",e.iconMsg=o?me.i18n.t("mail/alt_m_AUTODELDESTROY"):me.i18n.t("mail/alt_m_AUTODEL")),e.fid===n.sent&&(e.displayTo=!0),e.formatfrom=M(e.from),e.formatTo=M(e.to),e.subjectPrefixFormatted=ye.subtractPrefixes(e.subject),e.formatReceivedDate=T(e.receivedDate),e.fid===n.defer&&(e.formatDeferDate=w(e.defer)),e}function w(e){var t,n=fe(e?e.substring(0,10):"","YYYY-MM-DD"),i=fe(fe().format("YYYY-MM-DD")),a=ge.getConfig("context.locale")||"";return t=i.diff(n),t>0?me.i18n.t("mail/defer_status_unhandled"):me.i18n.t("mail/defer_date_pattern",{date:n.locale(a).format("MMM Do")})}function M(e){var t,n=me.Email.parse(e)||[],i="";return he.each(n,function(e,n){t=n.trueName?n.trueName.replace(/^-|^\+/,""):"",t||(t=n.address?n.address.split("@")[0]:""),i=i+t+","}),i.replace(/,$/,"")}function T(e){var t,n,i,a,r=ge.getUser(),s=j();return e=fe(e),t=fe(),n=t.year()===e.year(),i=t.month()===e.month(),a=t.date()===e.date(),n?i&&a?1===r.clock_system?e.hour()>12?me.i18n.t("common/clock_system_afternoon").replace("{0}",e.format("hh:mm a").substring(0,5)):me.i18n.t("common/clock_system_morning").replace("{0}",e.format("hh:mm a").substring(0,5)):e.format("HH:mm"):e.format("MM-DD"):e.format(s)}function L(e,t){var n,i=he.Deferred(),a=ge.getOpStack(),r=he.extend(!0,{},a);if(r.attrs={},"move"===e){for(r.attrs.fid=4,r.ids=[],n=0;n<r.ids.length;n++)r.ids.push(r.ids[n]);for(n=0;n<r.mids.length;n++)r.ids.push(r.mids[n].mid);delete r.mids,delete r.fid,r.expandThreadMid=!1,r.returnOriginalMsgInfos=!0,me.xhr.simpleCall({query:{func:"mbox:updateMessageInfos",sid:ge.getSid()},data:r},function(e){i.resolve(e)},function(){i.reject()})}return i.promise()}function x(e,t){var n,i=he.Deferred(),a=ge.getOpStack(),r=he.extend(!0,{},a);if("move"===e&&parseInt(t,10)>0){for(r.attrs.fid=parseInt(t,10),r.ids=[],n=0;n<r.mids.length;n++)r.ids.push(r.mids[n].mid);delete r.mids,me.xhr.simpleCall({query:{func:"mbox:updateMessageInfos",sid:ge.getSid()},data:r},function(e){i.resolve(e)},function(){i.reject()})}else{var s,o,l=[];for(n=0;n<r.mids.length;n++)s=he.extend(!0,{},{attrs:{}}),r.mboxa&&(s.mboxa=r.mboxa),o=r.mids[n],s.ids=[o.mid],"move"===e&&he.extend(s.attrs,{fid:o.fid}),("urgent"===e||"general"===e||"slow"===e)&&he.extend(s.attrs,{priority:o.priority}),("read"===e||"unread"===e)&&he.extend(s.attrs,{flags:{read:"boolean"==typeof o.flags.read?o.flags.read:!1}}),("top"===e||"notop"===e)&&he.extend(s.attrs,{flags:{top:"boolean"==typeof o.flags.top?o.flags.top:!1}}),0===e.indexOf("label0:")&&he.extend(s.attrs,{flags:{flagged:o.label0>0?!0:o.flags.flagged},label0:o.label0}),("vip"===e||"novip"===e)&&he.extend(s.attrs,{flags:{vip:o.flags.vip}}),("flagged"===e||"noflagged"===e)&&he.extend(s.attrs,{flags:{flagged:!!o.flags.flagged},label0:o.flags.flagged?o.label0:0}),"deferHandle"===e&&he.extend(s.attrs,{flags:{deferHandle:!!o.flags.deferHandle},defer:o.flags.deferHandle?fe(o.defer).toDate():new Date("1970","0","1")}),l.push({func:"mbox:updateMessageInfos","var":s});me.xhr.simpleCall({query:{func:"global:sequential",sid:ge.getSid()},data:{items:l}},function(e){var t=0;for(e=e||[],n=0;n<e.length;n++)"S_OK"!==e[n].code&&t++;i.resolve(t)},function(){i.reject()})}return i.promise()}function C(e,t){var n,i,a,r=he.Deferred(),s={},o=!1;if(t=t||{},n={ids:[],fid:15},"string"===(i=he.type(t.mid)))n.ids.push(t.mid);else{if("array"!==i)return r.reject();n.ids=t.mid}if(0===n.ids.length&&"rule"!==e)return r.reject();switch(t.mboxa&&(n.mboxa=t.mboxa),e){case"collect":void 0!=t.fid&&(o=!0)}return o?me.xhr.simpleCall({query:{func:"mbox:cloneMessages",sid:ge.getSid()},data:n},function(e){if(a=e.clones){s=n,s.mids=[];for(var t=0;t<a.length;t++){var i=a[t];s.mids.push({mid:i,fid:i.fid,priority:i.priority,label0:i.label0,flags:i.flags,defer:i.defer})}ge.setOpStack(s)}r.resolve(e)},function(e,t,n){r.reject(n)}):r.reject(),r.promise()}function S(e,t){var n,i,r,s=he.Deferred(),o={},l=!1;if(t=t||{},n={ids:[],attrs:{},expandThreadMid:t.hasOwnProperty("expandThreadMid")?t.expandThreadMid:a(t.fromFid),returnOriginalMsgInfos:!0},"string"===(i=he.type(t.mid)))n.ids.push(t.mid);else{if("array"!==i)return s.reject();n.ids=t.mid}if(0===n.ids.length&&"rule"!==e)return s.reject();switch(t.mboxa&&(n.mboxa=t.mboxa),e){case"mark":t.flags&&(he.extend(n.attrs,t.flags),l=!0);break;case"move":void 0!=t.fid&&(n.attrs=ae(t),l=!0);break;case"rule":he.extend(n,t||{}),l=!0;break;case"defer":he.extend(n.attrs,{flags:t.flags,defer:t.defer}),n.expandThreadMid=!1,t.mboxa&&(n.mboxa=t.mboxa),l=!0}return l?me.xhr.simpleCall({query:{func:"mbox:updateMessageInfos",sid:ge.getSid()},data:n},function(e){if(r=e.originalMsgInfos){delete n.mids,delete n.attrs.fid,o=n,o.mids=[];for(var t=0;t<r.length;t++){var i=r[t];o.mids.push({mid:i.id,fid:i.fid,priority:i.priority,label0:i.label0,flags:i.flags,defer:i.defer})}ge.setOpStack(o)}s.resolve(e)},function(e,t,n){s.reject(n)}):s.reject(),s.promise()}function k(e){var t,n=he.Deferred(),i=e.mids;return i&&0!==i.length?(i="string"===he.type(i)?[i]:i,t={ids:i,expandThreadMid:e.hasOwnProperty("expandThreadMid")?e.expandThreadMid:a(e.fromFid)},e.mboxa&&(t.mboxa=e.mboxa),me.xhr.simpleCall({query:{func:"mbox:deleteMessages",sid:ge.getSid()},data:t},function(e){n.resolve(e)},function(){n.reject()}),n.promise()):n.reject()}function D(e,t,n){var i,a,r,s=he.Deferred(),o=!1,l=0;return r=Z(n.flag),r[2]&&r[2].flags&&r[2].flags.flagged&&!r[2].label0&&(r[2].label0=0),t="array"===he.type(t)?t:[t],"list"===e?(a=h(),a=a?a.list:[]):"search"===e?(a=v(),a=a?a["var"]:[]):(a=[],o=!0),a.length<t.length?o=!0:he.each(a,function(e,n){var i=n.flags,a=n.hasOwnProperty(r[0]),s=n.label0||0,c="flagged"===r[0]?parseInt(s)!==parseInt(r[2].label0||0):!1,d=i.hasOwnProperty(r[0]);return he.each(t,function(e,t){return n.id===t?((c||!a&&!d&&r[1]||a&&n[r[0]]!==r[1]||d&&i[r[0]]!==r[1])&&(o=!0),l++,!1):void 0}),o||l>=t.length?!1:void 0}),i={mid:t,flags:r[2],mboxa:n.mboxa,fromFid:n.fromFid},n.hasOwnProperty("expandThreadMid")&&(i.expandThreadMid=n.expandThreadMid),o?S("mark",i).then(function(){s.resolve(!0)},function(){s.reject()}):s.resolve(!1),s.promise()}function Y(e){var t=ge.getConfig(e),n=/"@([^@]+)@"/g;for(t=t&&JSON.stringify(t);t&&n.test(t);)t=t.replace(n,function(e,t){return JSON.stringify(ge.getConfig(t)||"")});return t&&JSON.parse(t)}function j(){var e=ge.getConfig("mail.datepattern");switch(e){case"@default":default:e="YYYY-MM-DD"}return e}function N(e){var t=he.Deferred();return e=e||{},e.mid?(me.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:me.xhr.getRequestURL({url:"/XT5/jsp/mail.jsp",query:{func:"readMessage",sid:ge.getSid()}}),data:he.param({mid:e.mid,part:e.part,mboxa:e.mboxa,mailCipherPassword:e.mailCipherPassword,supportSMIME:e.supportSMIME})},function(n){var i,a,r,s,o,l;n=n||{},i=n.mail||{},a=n.mailInfo||{},r=i.headers||{},s=r["Content-Type"]||"",o=s.indexOf("pkcs7-mime")>-1||s.indexOf("pkcs7-signature")>-1,l=r["X-IBC-SecMail"]||r["X-CM-SecMail"]||!1,i.flags=a.flags,i.subject=a.subject,i.sentDate=a.sentDate,i.composeExtra=a.composeExtra,i.encrypted=i.flags.signed||i.flags.encrypted||!1,i.sMimeClientEncrypted=i.encrypted&&o,i.sMimeServerEncrypted=i.encrypted&&l,i.smimeAttachs=i.sMimeServerEncrypted,i.mailCipherEncrypted=n.mailCipherEncrypted||!1,i.mailCipherPassword=n.mailCipherPassword||"",i.encpwd=a.encpwd||"",i.delegatedSender=a.delegatedSender,i.antiVirusStatus=a.antiVirusStatus,i.priority=a.priority,i.label0=a.label0,i.memo=a.memo,i.recallable=a.recallable,i.sndStatus=a.sndStatus,i.rclStatus=a.rclStatus,i.defer=a.defer?a.defer.substring(0,10):"",i.sspurl=!(!a.sspurl||!a.sspurl.malware&&!a.sspurl.phish),i.ctrls=a.ctrls,i.hasAttachment=he.isArray(i.attachments)&&i.attachments.length>0,e.part&&(i.part=e.part,i.isNestedMsg=!0),t.resolve(i)},function(e,n,i){t.reject(i)}),t.promise()):t.reject()}function P(e){var t=he.Deferred();return e=he.extend({toAll:!1,dontCcDelegateAddress:!0,quoteTextLinePrefix:!0,action:"deliver",withAttachments:!1},e),me.xhr.simpleCall({query:{func:"mbox:replyMessage",sid:ge.getSid()},data:e},function(e){t.resolve(e)},function(e,n,i){var a,r,s="",o="",l="",c=i.code;if("FA_MTA_RCPT_ERROR"===c){for(var d in i.errorRcpts){o=d,l=i.errorRcpts[d];break}switch(l){case"MTA5101":case"MTA5102":case"MTA5103":case"MTA5104":case"MTA5105":case"MTA5106":case"MTA5107":s=me.i18n.t("mail/"+c+"."+l),("MTA5105"===l||"MTA5106"===l||"MTA5107"===l)&&(s=s.replace("{0}",o));break;default:s=me.i18n.t("mail/"+c+".MTA_OTHER").replace("{0}",o)}}else a="mail/"+c,r=me.i18n.t(a),"FA_NO_RECEIPT"===c?s=me.i18n.t(a+".ONLY_REPLY_SELF"):a!==r?s=r:(console.log("unknown exception code:"+c),s=me.i18n.t("mail/FA_FORBIDDEN"));t.reject(s)}),t.promise()}function E(){var e=he.Deferred();return me.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:me.xhr.getRequestURL({url:"/XT5/jsp/mail.jsp",query:{func:"getAllAccounts",sid:ge.getSid()}})},function(t){e.resolve(t)},function(t,n,i){e.reject(i)}),e.promise()}function A(e){var t,n,i,a,r,s,o=he.Deferred();if(e=e||{},n=e.mid,r=e.ctype,i=e.composeId||e.id,a="boolean"==typeof e.returnInfo?e.returnInfo:!1,s={func:"getInitCompose",sid:ge.getSid()},!r&&!i)return o.reject();if(i)t={composeId:i};else{switch(r){case"draft":case"reply":case"edit":case"attach":case"trsAttach":t={ctype:r,mid:n};break;case"replyall":t={ctype:"reply",mid:n,rall:!0};break;case"reply-attach":t={ctype:"reply",mid:n,ratt:!0};break;case"replyall-attach":t={ctype:"reply",mid:n,rall:!0,ratt:!0};break;case"forward":case"forwarda":t={ctype:r,mid:he.isArray(n)?n:[n]};break;case"attach_part":t={ctype:"attach_part",part:e.part};break;case"normal":t={ctype:"normal",to:e.to?e.to:"",isHtml:"boolean"==typeof e.isHtml?e.isHtml:ge.getUser().edit_mode,content:e.content?encodeURIComponent(e.content):""};break;default:return o.reject()}t.subject=ye.subtractComposePrefix(t.subject,e.ctype)}return e.mboxa&&(t.mboxa=e.mboxa),e.isDecodeMail&&(t.isDecodeMail=e.isDecodeMail),e.to&&(t.to=e.to),e.hasOwnProperty("expandThreadMid")&&(t.expandThreadMid=e.expandThreadMid),t.returnInfo=a,e.uid&&he.trim(e.uid)&&he.extend(s,{uid:e.uid}),me.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:me.xhr.getRequestURL({url:"/XT5/jsp/mail.jsp",query:s}),data:me.params.serialize(t)},function(t){if(t.formatTo="array"===he.type(t.to)?t.to.join(","):t.to,t.formatCc="array"===he.type(t.cc)?t.cc.join(","):t.cc,t.formatBcc="array"===he.type(t.bcc)?t.bcc.join(","):t.bcc,e.sMimeClientEncrypted)if(0===t.content.indexOf("\n\n\n> -----")&&/\n\n\n--([\s\S]+)$/gm.test(t.content)){var n="> "+e.content.replace(/\n/g,"\n> ");t.content=t.content.replace(/(\n\n\n--([\s\S]+)$)/gm,n+"$1")}else t.content=t.content+"> "+e.content.replace(/\n/g,"\n> "),t.attachId=e.attachId,t.isSigned=e.isSigned,t.isEncrypted=e.isEncrypted,t.isHtml=!1,t.useCacompose=!0;o.resolve(t)},function(e,t,n){o.reject(n)}),o.promise()}function F(e){var t=he.Deferred();return me.xhr.simpleCall({query:{func:"user:listDeliveryHistory",sid:ge.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function I(e){var t=he.Deferred();return me.xhr.simpleCall({query:{func:"mbox:sendMDN",sid:ge.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function H(e){var t=he.Deferred();return e.expandThreadMid=a(e.fid),me.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:me.xhr.getRequestURL({url:"/XT5/jsp/mail.jsp",query:{func:"allSetRead",sid:ge.getSid()}}),data:he.param(e)},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function Z(e){var t=["flagged",!0,{flags:{flagged:!0}}];-1!==e.indexOf("label0")&&(t[2].label0=parseInt(e.split(":")[1]),e="flagged");var n={all:["all",!0,{}],read:["read",!0,{flags:{read:!0}}],unread:["read",!1,{flags:{read:!1}}],vip:["vip",!0,{flags:{vip:!0}}],novip:["vip",!1,{flags:{vip:!1}}],top:["top",!0,{flags:{top:!0}}],notop:["top",!1,{flags:{top:!1}}],urgent:["priority",1,{priority:1}],general:["priority",3,{priority:3}],slow:["priority",5,{priority:5}],flagged:t,noflagged:["flagged",!1,{flags:{flagged:!1},label0:0}],replied:["replied",!0,{flags:{replied:!0}}],forwarded:["forwarded",!0,{flags:{forwarded:!0}}],attached:["attached",!0,{flags:{attached:!0}}],linkAttached:["linkAttached",!0,{flags:{linkAttached:!0}}],noattach:["noattach",!0,{flags:{attached:!1,linkAttached:!1}}],defer:["defer",!0,{flags:{deferHandle:!0}}],draft:["draft",!0,{flags:{draft:!0}}],nodraft:["draft",!1,{flags:{draft:!1}}]};return n[e]}function R(e,t,n,i,a){var r={message:"",options:{}};if(a&&(r.options={extendBtn:me.i18n.t("mail/op_recover"),callback:function(){a()}}),e)switch(n&&-1!==n.indexOf("label0")&&(n="flagged"),n){case"unread":case"read":case"urgent":case"general":case"slow":case"vip":case"top":case"flagged":t?(r.message=me.i18n.t("mail/msg_mark_success",{action:i}),he.notify.success(r.message,r.options)):he.notify.error(me.i18n.t("mail/msg_mark_failed",{action:i}));break;case"novip":t?(r.message=me.i18n.t("mail/msg_mark_cancel_success",{action:me.i18n.t("common/op_vip")}),he.notify.success(r.message,r.options)):he.notify.success(me.i18n.t("mail/msg_mark_cancel_failed",{action:me.i18n.t("common/op_vip")}));break;case"notop":t?(r.messsage=me.i18n.t("mail/msg_mark_cancel_success",{action:me.i18n.t("common/op_top")}),he.notify.success(r.messsage,r.options)):he.notify.success(me.i18n.t("mail/msg_mark_cancel_failed",{action:me.i18n.t("common/op_top")}));break;case"noflagged":t?(r.message=me.i18n.t("mail/msg_mark_cancel_flag_success"),he.notify.success(r.message,r.options)):he.notify.success(me.i18n.t("mail/msg_mark_cancel_flag_failed"));break;default:t?(r.message=me.i18n.t("mail/msg_mark_success",{action:i}),he.notify.success(r.message,r.options)):he.notify.error(me.i18n.t("mail/msg_mark_failed",{action:i}))}else he.notify.warning(me.i18n.t("mail/msg_mark_noneed"))}function O(e,t){var n,i,a="mbox/mail_sent_state_";return t?(a="mbox/mail_rcl_state_",n=a+t,i=me.i18n.t(n)):(ge.getConfig("mail.notdisplayaudit")&&e.indexOf("mail_sent_state_60")>-1&&(e=0),n=a+e,i=me.i18n.t(a+e)),i===n&&(e%=100,i=me.i18n.t("mbox/mail_sent_state_"+e)),i}function X(e,t){var n=he.Deferred();return(-1!==(""+t).indexOf("@")||-1!==(""+e).indexOf("@"))&&n.resolve(!1),ve.getPOPAccounts().then(function(t){he.each(t,function(t,i){i.fid===e&&n.resolve(i.username)}),n.resolve(!0)}),n.promise()}function J(){var e,t=he.Deferred(),n=[],i=[];return ve.getAttrs(["prefOp"]).then(function(a){e=a.prefOp||[],0===e.length&&t.resolve({}),he.each(e,function(e,t){he.each((t.userattr.forwarddes||t.userattr.fltforward||"").split(","),function(e,t){t&&-1===he.inArray(t,n)&&n.push(t)})}),he.each(e,function(e,t){i.push({id:t.id,confirm:1})}),t.resolve({forwardList:n,recordItems:i})}),t.promise()}function B(){var e=he.Deferred(),t=ge.getConfig("user.enableautoreply");return t||e.resolve({enableAutoReply:!1,showAutoReplyTips:!1}),ve.getAttrs("autorepmode,autorep_condition,autorep_welcometip").then(function(t){var n=new Date;1===t.autorepmode&&t.autorep_condition.begintime&&fe(t.autorep_condition.begintime).valueOf()<n.getTime()&&(!t.autorep_condition.endtime||fe(t.autorep_condition.endtime).valueOf()>n.getTime())?1==t.autorep_welcometip?e.resolve({enableAutoReply:!0,showAutoReplyTips:!0}):e.resolve({enableAutoReply:!0,showAutoReplyTips:!1}):e.resolve({enableAutoReply:!1,showAutoReplyTips:!1})}),e.promise()}function W(e,t){var n,r,s,o=he.Deferred(),l=i();if(he.extend(t,{start:0,refresh:!0}),"list"===e)if(a(t.fid))"boolean"==typeof t.draftFlagFilter&&(t.filter=he.extend(!0,t.filter||{},Z(t.draftFlagFilter?"draft":"nodraft")[2])),p(t).then(function(e){for(var t=e.list||[],n=[],i=0,a=t.length;a>i;i++)n.push(t[i].id);o.resolve(n)},function(){o.reject()});else{switch(n={fid:t.fid,mboxa:t.mboxa},r={field:"flags",operand:{}},n.fid){case l.vip:s=Z("vip");break;case l.unread:s=Z("unread");break;case l.flagged:s=Z("flagged");break;case l.defer:s=Z("defer")}s&&(delete n.fid,he.extend(!0,r.operand,s[2].flags)),"boolean"==typeof t.draftFlagFilter&&he.extend(!0,r.operand,Z(t.draftFlagFilter?"draft":"nodraft")[2].flags),(s||"boolean"==typeof t.draftFlagFilter)&&(n.condictions=r),q(n).then(function(e){o.resolve(e)},function(){o.reject()})}else"search"===e&&("boolean"==typeof t.draftFlagFilter&&(t.draft=t.draftFlagFilter),g(t).then(function(e){for(var t=e["var"]||[],n=[],i=0,a=t.length;a>i;i++)n.push(t[i].id);o.resolve(n)}));return o.promise()}function q(e){var t=he.Deferred();return he.extend(e,{pattern:e.pattern||""}),me.xhr.simpleCall({query:{func:"mbox:searchMessages",sid:ge.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function Q(){var e=he.Deferred();return me.xhr.simpleCall({query:{func:"user:offSiteRemind",sid:ge.getSid()}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function $(e){var t,n=e.mboxa||"",i=e.mids||[],r=ge.getSid(),s=a(e.fid),o="";he.each(i,function(e,t){o=o+'<input type="hidden" name="mid" value="'+t+'" />'}),o&&(o=o+'<input type="hidden" name="mboxa" value="'+n+'" /><input type="hidden" name="expandThreadMid" value="'+s+'" />',t=he("<form>",{id:"packForm",method:"post"}).html(o).attr("action","mbox/packmessages.jsp?sid="+r),he("body").append(t),t.submit().remove())}function z(e){var t=he.grep(be.folders,function(e){return-6==e.id}),n=he.grep(be.folders,function(e){return-7==e.id}),i=[],a=[];return e="boolean"==typeof e?e:!1,t.length>0&&(a=t[0].children),n.length>0&&(a=a.concat(n[0].children)),a.length>0&&he.each(a,function(t,n){i.push(he.extend({id:n.id,name:n.name,rw:n.rw,send:n.send},{folder:e?n.children:void 0}))}),i}function U(e){var t,n=he.Deferred();return e||n.reject(),he.each(z,function(n,i){return i.id===e?(t=i,!1):void 0}),t?n.resolve(t):d().then(function(i){he.each(i,function(n,i){return i.id===e?(t=i,!1):void 0}),n.resolve(t)},function(){n.reject()}),n.promise()}function G(e){var t=he.Deferred();return me.xhr.simpleCall({query:{func:"mbox:getMessageInfos",sid:ge.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function K(e,t,n){var i=[];return e=he.extend(!0,[],e),he.each(e,function(e,a){var r;he.extend(a,{parent:t,fullPath:n?n+"/"+a.id:a.id}),a.deepLevel="string"===he.type(a.fullPath)?a.fullPath.split("/").length:1,i.push(a),a.children&&(r=a.children,delete a.children,i=i.concat(K(r,a.id,a.fullPath)))}),i}function V(e){var t;e=he.extend(!0,[],e);for(var n=e.length-1;n>=0;n--)t=e[n],t.id<0&&e.splice(n,1);return e}function ee(e){function t(t,i){"number"==he.type(t)?he.each(e,function(a,r){return r.id==t?-6==t?(he.each(r.items,function(e,t){t.stats.unreadMessageCount=0,t.remote?n=t:i.children=i.children.concat(t)}),e.splice(a,1),!1):(i.push(e.splice(a,1)[0]),!1):void 0}):i.children=i.children.concat(e)}var n,a,r,s,o=[],l=i();return e=he.extend(!0,[],e),t(l.vip,o),t(l.unread,o),t(l.inbox,o),t(l.collect,o),t(l.defer,o),t(l.flagged,o),t(l.draft,o),t(l.sent,o),a={id:l.other,name:me.i18n.t("main/links_mboxUserFolder"),stats:{unreadMessageCount:0,unreadThreadCount:0},flags:{system:!1},children:[]},r={id:l.mboxshare,name:me.i18n.t("main/links_mboxShrWebFolder"),stats:{unreadMessageCount:0,unreadThreadCount:0},flags:{system:!1},children:[]},t(l.trash,a.children),t(l.junk,a.children),t(l.virus,a.children),t(l.mboxshare,r),t(null,a),o.push(a),r.children.length>0&&o.push(r),n&&(s={id:l.extranet,name:me.i18n.t("main/links_extranetFolder"),stats:{unreadMessageCount:0,unreadThreadCount:0},flags:{system:!1},children:[n]},o.push(s)),o}function te(e){he.extend(be.searchedMailList,{condition:e.condition,result:e.result,timeout:(new Date).getTime()+3e5})}function ne(e){var t="";return e=e||"",e.indexOf("@")>-1?t="shareFolder":"2"==e&&(t="archiveFolder"),t}function ie(e,t){var n,a,r,s,o,l,c,d,u,p,h,f=ge.getUser(),m=i();switch(n=t==m.defer?"deferredDate":ge.getConfig("mail.mailgroupprecision")||"recentOneWeek",a=ge.getConfig("mail.enabletopmail"),r=fe(fe().format("YYYY-MM-DD")),s=[{id:"top",list:[],list_style:f.list_style},{id:"today",list:[],list_style:f.list_style},{id:"yesterday",list:[],list_style:f.list_style},{id:"before_yesterday",list:[],list_style:f.list_style},{id:"saturday",list:[],list_style:f.list_style},{id:"friday",list:[],list_style:f.list_style},{id:"thursday",list:[],list_style:f.list_style},{id:"wednesday",list:[],list_style:f.list_style},{id:"tuesday",list:[],list_style:f.list_style},{id:"monday",list:[],list_style:f.list_style},{id:"sunday",list:[],list_style:f.list_style},{id:"last_week",list:[],list_style:f.list_style},{id:"earlier",list:[],list_style:f.list_style},{id:"todayDeferred",list:[],list_style:f.list_style},{id:"greenDeferred",list:[],list_style:f.list_style}],he.each(s,function(e,t){t.name=me.i18n.t("mail/list_"+t.id)}),n){case"recentOneDay":for(o=0,l=e.length;l>o;o++)c=e[o],b(c),d=fe(c.receivedDate,"YYYY-MM-DD"),u=r.diff(d,"days"),a&&c.flags&&c.flags.top?s[0].list.push(c):0>=u?s[1].list.push(c):s[12].list.push(c);break;case"recentThreeDay":for(o=0,l=e.length;l>o;o++)c=e[o],b(c),d=fe(c.receivedDate,"YYYY-MM-DD"),u=r.diff(d,"days"),a&&c.flags&&c.flags.top?s[0].list.push(c):0>u?s[1].list.push(c):u>=0&&3>u?s[u+1].list.push(c):s[12].list.push(c);break;case"recentOneWeek":for(o=0,l=e.length;l>o;o++)c=e[o],b(c),d=fe(c.receivedDate,"YYYY-MM-DD"),u=r.diff(d,"days"),p=r.day(),h=d.day(),a&&c.flags&&c.flags.top?s[0].list.push(c):0>u?s[1].list.push(c):3>u?s[u+1].list.push(c):p>=u?s[10-h].list.push(c):s[12].list.push(c);break;case"recentTwoWeek":for(o=0,l=e.length;l>o;o++)c=e[o],b(c),d=fe(c.receivedDate,"YYYY-MM-DD"),u=r.diff(d,"days"),p=r.day(),h=d.day(),a&&c.flags&&c.flags.top?s[0].list.push(c):0>u?s[1].list.push(c):3>u?s[u+1].list.push(c):p>=u?s[10-h].list.push(c):p+7>=u?s[11].list.push(c):s[12].list.push(c);break;case"deferredDate":for(o=0,l=e.length;l>o;o++)c=e[o],d=fe(c.defer?c.defer.substring(0,10):"","YYYY-MM-DD"),c.fid=t,b(c),u=r.diff(d,"days"),u>=0?s[13].list.push(c):s[14].list.push(c)}return s}function ae(e){var t=i(),n=e.fromFid,a={fid:e.fid};return e.fid===t.trash&&(n===t.vip&&(a.flags={vip:!1}),n===t.flagged&&(a.flags={flagged:!1},a.label0=0)),a}function re(e){var t=[],n=null;return s(!1,!1,!0).then(function(i){t=i,he.each(t,function(t,i){return i.name===e?(n=i,!1):void 0})}),n}function se(e){var t=he.Deferred();return e=e||{},me.xhr.simpleCall({query:{func:"user:authenticateSmimeKeyPass",sid:ge.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function oe(e){var t=he.Deferred();return me.xhr.simpleCall({query:{func:"mbox:recallMessage2",sid:ge.getSid()},data:e},function(e){var n=ce(e);t.resolve(n)},function(e,n,i){t.reject(i)}),t.promise()}function le(e){var t=he.Deferred();return me.xhr.simpleCall({query:{func:"mbox:destroyAutoDelMail",sid:ge.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function ce(e){var t=[];for(var n in e){var i=me.i18n.t("mbox/mail_rcl_state_"+e[n]);t.push({emailAddress:n,recallMessage:i})}return t}function de(e){var t=e.readLimit,n=e.readcnt||{},i=ge.getConfig("mail.servertime"),a=!1;return fe(e.expiryDate)<fe(i)?a=!0:he.each(n,function(e,n){return n>=t-1?(a=!0,!1):void 0}),a}function ue(e){var t=he.Deferred();return me.xhr.simpleCall({query:{func:"mbox:setFolderPosition",sid:ge.getSid()},data:e},function(){t.resolve()},function(){t.reject()}),t.promise()}function pe(e,t){var n=i();return t>0&&e!=t&&e!=n.draft&&t!=n.draft}e("i18n!mail");var he=e("jquery"),fe=e("moment"),me=e("../../util/index"),ge=e("../common/globalService"),ve=e("../setting/service"),_e=e("../contact/service"),ye=e("./subjectPrefixFormatter"),be={folders:[],originalFolders:[],flatFolders:[],flatOriginalFolders:[],mailList:{total:0,list:[]},searchedMailList:{condition:"",timeout:null,result:{}}},we=[];_e.getAllPabContacts({returnAttrs:["EMAIL;PREF"]}).done(function(e){we=he.map(e,function(e){return e["EMAIL;PREF"]})}),n.exports={isStranger:y,getFoldersMap:i,isExpandThreadMid:a,isFidThreadForbid:r,getFolders:s,getCacheFolder:l,getCacheOriginalFolders:c,getAllFolderStats:o,getAllAccounts:E,getListData:u,getMailList:p,getCacheMailList:h,updateCacheMailList:f,makeListCondition:m,searchMailList:g,getCacheSearchMailList:v,makeSearchCondition:_,formatMail:b,formatThreadFromOrTo:M,formatMailDate:T,updateMailAttrs:S,collectMailAttrs:C,realDeleteMails:k,markMails:D,markUnreadMails:H,getToolbarMenu:Y,getDatePattern:j,readMessage:N,quickReplyMessage:P,getComposeInfo:A,listDeliveryHistory:F,getFlagsMap:Z,showMarkNotify:R,sendReadReceipt:I,getDeliveryStatusI18n:O,isPopOrShareFolder:X,getAutoForwardInfo:J,getAllListMid:W,getFolderCategory:ne,groupMailList:ie,getOffSiteInfo:Q,listSharedAccessMbox:d,getMailboxShareInfo:z,getMailBoxShareInfoById:U,packMessages:$,searchMessages:q,getMessageInfos:G,recallMessage:oe,recoverOpStack:x,recoverCollectStack:L,getCacheFolderByName:re,authenticateSmimeKeyPass:se,checkAutoDelMailExpired:de,destroyAutoDelMail:le,isMailMovable:pe,getAutoReplyInfo:B,setFolderPosition:ue}}),function(e){"function"==typeof define&&define.amd?define("components/datepicker/dist/datepicker",["jquery"],e):e(jQuery)}(function(e){"use strict";var t=e(window),n=e(document),i=function(t,n){this.$element=e(t),this.defaults=e.extend({},i.defaults,this.$element.data(),e.isPlainObject(n)?n:{}),this.init()};i.prototype={constructor:i,init:function(){var t=this.defaults.trigger;this.$trigger=t?e(t):this.$element,this.$picker=e(this.defaults.template),this.$years=this.$picker.find("[data-type='years picker']"),this.$months=this.$picker.find("[data-type='months picker']"),this.$days=this.$picker.find("[data-type='days picker']"),this.$picker.appendTo("body"),this.place(),this.hide(),this.format=i.fn.parseFormat(this.defaults.dateFormat),this.fillWeek(),this.enable()},enable:function(){this.enabled||(this.$element.is("input")&&(this.$element.on("keyup",e.proxy(this.update,this)),this.defaults.trigger||this.$element.on("focus",e.proxy(this.show,this))),this.$trigger.on("click",e.proxy(this.show,this)),this.$picker.on({click:e.proxy(this.click,this),mousedown:e.proxy(this.mousedown,this)}),this.update(),this.enabled=!0)},disable:function(){this.enabled&&(this.$element.is("input")&&(this.$element.off("keyup",this.update),this.defaults.trigger||this.$element.off("focus",this.show)),this.$trigger.off("click",this.show),this.$picker.off({click:this.click,mousedown:this.mousedown}),this.hide(),this.enabled=!1)},showView:function(e){var t=this.format;if(t.year||t.month||t.day)switch(e){case 2:case"years":this.$months.hide(),this.$days.hide(),t.year?(this.fillYears(),this.$years.show()):this.showView(0);break;case 1:case"months":this.$years.hide(),this.$days.hide(),t.month?(this.fillMonths(),this.$months.show()):this.showView(2);break;default:this.$years.hide(),this.$months.hide(),t.day?(this.fillDays(),this.$days.show()):this.showView(1)}},hideView:function(){this.defaults.autoClose&&this.hide()},place:function(){var e=this.$trigger.offset(),t=this.$trigger.outerHeight();this.$picker.css({top:e.top+t,left:e.left})},show:function(){this.enabled&&(this.$picker.show(),t.on("resize",e.proxy(this.place,this)),n.on("mousedown",e.proxy(this.hide,this)),this.place(),this.showView(this.defaults.viewStart))},hide:function(){this.$picker.hide(),t.off("resize",this.place),n.off("mousedown",this.hide)},mousedown:function(e){e.stopPropagation(),e.preventDefault()},update:function(){var e=this.$element.is("input")?this.$element.prop("value"):this.$element.text();this.date=i.fn.parseDate(e,this.format),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate(),0,0,0,0),this.fillAll()},output:function(){var e=this.$element,t=i.fn.formatDate(this.date,this.format);e.is("input")?e.prop("value",t).trigger("change"):e.text(t)},template:function(t){var n={text:"",type:"",selected:!1,disabled:!1};return e.extend(n,t),["<"+this.defaults.itemTag+" ",n.selected?'class="'+this.defaults.selectedClass+'"':n.disabled?'class="'+this.defaults.disabledClass+'"':"",n.type?' data-type="'+n.type+'"':"",">",n.text,"</"+this.defaults.itemTag+">"].join("")},fillAll:function(){this.fillYears(),this.fillMonths(),this.fillDays()},fillYears:function(){var e,t,n="",i=[],a=this.defaults.yearSuffix||"",r=this.date.getFullYear(),s=this.viewDate.getFullYear();for(n=s-5+a+" - "+(s+6)+a,t=-5;7>t;t++)e=s+t===r,i.push(this.template({text:s+t,type:e?"year selected":"year",selected:e,disabled:-5===t||6===t}));this.$picker.find("[data-type='years current']").html(n),this.$picker.find("[data-type='years']").empty().html(i.join(""))},fillMonths:function(){var e,t,n="",i=[],a=this.defaults.monthsShort,r=this.date.getFullYear(),s=this.date.getMonth(),o=this.viewDate.getFullYear();for(n=o.toString()+this.defaults.yearSuffix||"",t=0;12>t;t++)e=o===r&&t===s,i.push(this.template({text:a[t],type:e?"month selected":"month",selected:e}));this.$picker.find("[data-type='year current']").html(n),this.$picker.find("[data-type='months']").empty().html(i.join(""))},fillWeek:function(){var t,n=[],i=this.defaults.daysMin,a=parseInt(this.defaults.weekStart,10)%7;for(i=e.merge(i.slice(a),i.slice(0,a)),t=0;7>t;t++)n.push(this.template({text:i[t]}));this.$picker.find("[data-type='week']").empty().html(n.join(""))},fillDays:function(){var t,n,a,r,s,o,l="",c=[],d=[],u=[],p=[],h=this.defaults.monthsShort,f=this.defaults.yearSuffix||"",m=this.date.getFullYear(),g=this.date.getMonth(),v=this.date.getDate(),_=this.viewDate.getFullYear(),y=this.viewDate.getMonth(),b=parseInt(this.defaults.weekStart,10)%7;for(l=this.defaults.showMonthAfterYear?_+f+" "+h[y]:h[y]+" "+_+f,a=0===y?i.fn.getDaysInMonth(_-1,11):i.fn.getDaysInMonth(_,y-1),s=1;a>=s;s++)d.push(this.template({text:s,type:"day prev",disabled:!0}));for(r=new Date(_,y,1,0,0,0,0),o=(7+(r.getDay()-b))%7,o=o>0?o:7,d=d.slice(a-o),a=11===y?i.fn.getDaysInMonth(_+1,0):i.fn.getDaysInMonth(_,y+1),s=1;a>=s;s++)p.push(this.template({text:s,type:"day next",disabled:!0}));for(a=i.fn.getDaysInMonth(_,y),r=new Date(_,y,a,0,0,0,0),o=(7-(r.getDay()+1-b))%7,o=o>=42-(d.length+a)?o:o+7,p=p.slice(0,o),s=1;a>=s;s++)t=_===m&&y===g&&s===v,n=this.defaults.isDisabled(new Date(_,y,s)),u.push(this.template({text:s,type:n?"day disabled":t?"day selected":"day",selected:t,disabled:n}));e.merge(c,d),e.merge(c,u),e.merge(c,p),this.$picker.find("[data-type='month current']").html(l),this.$picker.find("[data-type='days']").empty().html(c.join(""))},click:function(t){var n,i,a,r,s,o=e(t.target),l=/^\d{2,4}$/,c=!1;if(t.stopPropagation(),t.preventDefault(),0!==o.length)switch(n=this.viewDate.getFullYear(),i=this.viewDate.getMonth(),a=this.viewDate.getDate(),s=o.data().type){case"years prev":
case"years next":n="years prev"===s?n-10:n+10,r=o.text(),c=l.test(r),c&&(n=parseInt(r,10),this.date=new Date(n,i,Math.min(a,28),0,0,0,0)),this.viewDate=new Date(n,i,Math.min(a,28),0,0,0,0),this.fillYears(),c&&(this.showView(1),this.output());break;case"year prev":case"year next":n="year prev"===s?n-1:n+1,this.viewDate=new Date(n,i,Math.min(a,28),0,0,0,0),this.fillMonths();break;case"year current":this.format.year&&this.showView(2);break;case"year selected":this.format.month?this.showView(1):this.hideView();break;case"year":n=parseInt(o.text(),10),this.date=new Date(n,i,Math.min(a,28),0,0,0,0),this.viewDate=new Date(n,i,Math.min(a,28),0,0,0,0),this.format.month?this.showView(1):this.hideView(),this.output();break;case"month prev":case"month next":i="month prev"===s?i-1:"month next"===s?i+1:i,this.viewDate=new Date(n,i,Math.min(a,28),0,0,0,0),this.fillDays();break;case"month current":this.format.month&&this.showView(1);break;case"month selected":this.format.day?this.showView(0):this.hideView();break;case"month":i=o.parent().children().index(o),this.date=new Date(n,i,Math.min(a,28),0,0,0,0),this.viewDate=new Date(n,i,Math.min(a,28),0,0,0,0),this.format.day?this.showView(0):this.hideView(),this.output();break;case"day prev":case"day next":case"day":i="day prev"===s?i-1:"day next"===s?i+1:i,a=parseInt(o.text(),10),this.date=new Date(n,i,a,0,0,0,0),this.viewDate=new Date(n,i,a,0,0,0,0),this.fillDays(),"day"===s&&this.hideView(),this.output();break;case"day selected":this.hideView(),this.output();break;case"day disabled":this.hideView()}}},i.fn={isLeapYear:function(e){return e%4===0&&e%100!==0||e%400===0},getDaysInMonth:function(e,t){return[31,this.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},parseFormat:function(e){var t,n,i=e.match(/[.\/\-\s].*?/)||"/",a=e.split(/\W+/);if(!a||0===a.length)throw new Error("Invalid date format.");for(e={separator:i[0],parts:a},n=0,t=a.length;t>n;n++)switch(a[n]){case"dd":case"d":e.day=!0;break;case"mm":case"m":e.month=!0;break;case"yyyy":case"yy":e.year=!0}return e},parseDate:function(e,t){var n,i,a,r,s,o,l;if(n="string"==typeof e&&e.length>0?e.split(t.separator):[],i=t.parts.length,e=new Date,a=e.getFullYear(),r=e.getDate(),s=e.getMonth(),n.length===i)for(l=0;i>l;l++)switch(o=parseInt(n[l],10)||1,t.parts[l]){case"dd":case"d":r=o;break;case"mm":case"m":s=o-1;break;case"yy":a=2e3+o;break;case"yyyy":a=o}return new Date(a,s,r,0,0,0,0)},formatDate:function(e,t){var n,i={d:e.getDate(),m:e.getMonth()+1,yy:e.getFullYear().toString().substring(2),yyyy:e.getFullYear()},a=[],r=t.parts.length;for(i.dd=(i.d<10?"0":"")+i.d,i.mm=(i.m<10?"0":"")+i.m,n=0;r>n;n++)a.push(i[t.parts[n]]);return a.join(t.separator)}},i.defaults={autoClose:!1,dateFormat:"mm/dd/yyyy",days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],disabledClass:"disabled",isDisabled:function(){return!1},itemTag:"li",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],selectedClass:"selected",showMonthAfterYear:!1,template:['<div class="datepicker-container" data-type="datepicker">','<div class="datepicker-arrow"></div>','<div class="datepicker-content">','<div class="content-years" data-type="years picker">','<ul class="datepicker-title">','<li class="datepicker-prev" data-type="years prev">&lsaquo;</li>','<li class="col-5" data-type="years current"></li>','<li class="datepicker-next" data-type="years next">&rsaquo;</li>',"</ul>",'<ul class="datepicker-years" data-type="years"></ul>',"</div>",'<div class="content-months" data-type="months picker">','<ul class="datepicker-title">','<li class="datepicker-prev" data-type="year prev">&lsaquo;</li>','<li class="col-5" data-type="year current"></li>','<li class="datepicker-next" data-type="year next">&rsaquo;</li>',"</ul>",'<ul class="datepicker-months" data-type="months"></ul>',"</div>",'<div class="content-days" data-type="days picker">','<ul class="datepicker-title">','<li class="datepicker-prev" data-type="month prev">&lsaquo;</li>','<li class="col-5" data-type="month current"></li>','<li class="datepicker-next" data-type="month next">&rsaquo;</li>',"</ul>",'<ul class="datepicker-week" data-type="week"></ul>','<ul class="datepicker-days" data-type="days"></ul>',"</div>","</div>","</div>"].join(""),trigger:void 0,viewStart:0,weekStart:0,yearSuffix:""},i.setDefaults=function(t){e.extend(i.defaults,t)},e.fn.datepicker=function(t){return this.each(function(){var n=e(this),a=n.data("datepicker");a||(a=new i(this,t),n.data("datepicker",a)),"string"==typeof t&&e.isFunction(a[t])&&a[t]()})},e.fn.datepicker.constructor=i,e.fn.datepicker.setDefaults=i.setDefaults,e(function(){e("[datepicker]").datepicker()})}),function(e){"function"==typeof define&&define.amd?define("components/datepicker/i18n/datepicker.zh-CN",["jquery"],e):e(jQuery)}(function(e){"use strict";e.fn.datepicker.setDefaults({autoClose:!1,dateFormat:"yyyy-mm-dd",days:["","","","","","",""],daysShort:["","","","","","",""],daysMin:["","","","","","",""],months:["","","","","","","","","","","",""],monthsShort:["1","2","3","4","5","6","7","8","9","10","11","12"],showMonthAfterYear:!0,viewStart:0,weekStart:1,yearSuffix:""})}),function(e){"function"==typeof define&&define.amd?define("components/datepicker/i18n/datepicker.en-US",["jquery"],e):e(jQuery)}(function(e){"use strict";e.fn.datepicker.setDefaults({autoClose:!1,dateFormat:"mm/dd/yy",days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],showMonthAfterYear:!1,viewStart:0,weekStart:0,yearSuffix:""})}),define("widget/datepicker/datepicker",["require","module/common/globalService"],function(e){e(["components/datepicker/dist/datepicker"],function(){var t=e("module/common/globalService"),n=t.getConfig("context.locale")||"";console.log(n),e("zh_TW"==n||"zh_CN"==n?["components/datepicker/i18n/datepicker.zh-CN"]:["components/datepicker/i18n/datepicker.en-US"])})}),define("components/requirejs-text/text!component/../../template/component/advancedsearch.tpl.html",[],function(){return'<form id="advancedSearch" class="advanced-search grid">\r\n\r\n    <div class="conditions-item grid-row">\r\n        <label class="grid-col3 conditions-types" for="pattern">{{i18n \'mbox/pattern_search\'}} : </label>\r\n        <div class="grid-col9"><input class="u-input" id="pattern" name="pattern" type="text" placeholder="{{i18n \'common/mail_search_tips\'}}" value="{{pattern}}"/></div>\r\n    </div>\r\n\r\n    {{#if accounts}}\r\n    <div class="conditions-item grid-row">\r\n        <label class="grid-col3 conditions-types" for="mboxa">{{i18n \'mail/search_account\'}} : </label>\r\n        <div class="grid-col9">\r\n            <select name="mboxa" id="mboxa">\r\n                {{#each accounts}}\r\n                <option value="{{id}}" {{#if selected}} selected {{/if}} data-name="{{name}}">{{name}}</option>\r\n                {{/each}}\r\n            </select>\r\n        </div>\r\n    </div>\r\n    {{/if}}\r\n\r\n    <div class="conditions-item grid-row">\r\n        <label class="grid-col3 conditions-types" for="fid">{{i18n \'common/folders\'}} : </label>\r\n        <div class="grid-col9">\r\n            {{#each accounts}}\r\n            <div class="{{#compare @index \'!=\' 0}} f-dn {{/compare}} j-accounts-folder" data-name="{{name}}">\r\n                <select name="fid" data-account="{{name}}">\r\n                    <option value="0" data-name="{{i18n \'main/fdr_root\'}}">{{i18n "main/fdr_root"}}</option>\r\n                    {{#each (lookup ../foldersMap name)}}\r\n                    <option value="{{id}}" data-name= "{{name}}"  data-indent="{{countIndent deepLevel}}">{{name}}</option>\r\n                    {{/each}}\r\n                </select>\r\n            </div>\r\n            {{/each}}\r\n        </div>\r\n    </div>\r\n\r\n    <div class="conditions-item grid-row">\r\n        <label class="grid-col3 conditions-types" for="subject">{{i18n \'mbox/subject_search\'}} : </label>\r\n        <div class="grid-col9"><input class="u-input" id="subject" name="subject" type="text" placeholder="{{i18n \'main/search_key_hint\'}}"/></div>\r\n    </div>\r\n\r\n    <div class="conditions-item grid-row">\r\n        <label class="grid-col3 conditions-types" for="from">{{i18n \'mbox/from_search\'}} : </label>\r\n        <div class="grid-col9"><input class="u-input" id="from" name="from" type="text"/></div>\r\n    </div>\r\n\r\n    <div class="conditions-item grid-row">\r\n        <label class="grid-col3 conditions-types" for="to">{{i18n \'mbox/to_search\'}} : </label>\r\n        <div class="grid-col9"><input class="u-input" id="to" name="to" type="text"/></div>\r\n    </div>\r\n\r\n    <div class="conditions-item grid-row">\r\n        <label class="grid-col3 conditions-types" for="sentDate">{{i18n \'mbox/sentDate_search\'}} : </label>\r\n        <div class="grid-col9">\r\n            <select name="sentDate" id="sentDate">\r\n                <option value="">{{i18n \'mbox/sendDate_option_ignore\'}}</option>\r\n                <option value="1">{{i18n \'mbox/sendDate_option_oneday\'}}</option>\r\n                <option value="3">{{i18n \'mbox/sendDate_option_threeday\'}}</option>\r\n                <option value="1w">{{i18n \'mbox/sendDate_option_oneweek\'}}</option>\r\n                <option value="1m">{{i18n \'mbox/sendDate_option_onemonth\'}}</option>\r\n                <option value="3m">{{i18n \'mbox/sendDate_option_threemonth\'}}</option>\r\n                <option value="6m">{{i18n \'mbox/sendDate_option_halfyear\'}}</option>\r\n                <option value="1y">{{i18n \'mbox/sendDate_option_oneyear\'}}</option>\r\n                <option value="specify">{{i18n \'mbox/detailDate_search\'}}</option>\r\n            </select>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="conditions-item grid-row f-dn j-sentDate">\r\n        <label class="grid-col3 conditions-types" for="sentDateBegin">{{i18n \'common/date_begin\'}} : </label>\r\n        <div class="grid-col9">\r\n            <input class="u-input" id="sentDateBegin" name="sentDateBegin" type="text" placeholder="{{i18n \'main/search_key_hint\'}}"/>\r\n        </div>\r\n    </div>\r\n\r\n    <div class="conditions-item grid-row f-dn j-sentDate">\r\n        <label class="grid-col3 conditions-types" for="sentDateEnd">{{i18n \'common/date_end\'}} : </label>\r\n        <div class="grid-col9">\r\n            <input class="u-input" id="sentDateEnd" name="sentDateEnd" type="text" placeholder="{{i18n \'main/search_key_hint\'}}"/>\r\n        </div>\r\n    </div>\r\n\r\n    <!--  -->\r\n    <div class="conditions-item grid-row">\r\n        <a class="grid-col3 conditions-types toggle-more j-toggle" href="javascript:void(0)">\r\n            {{i18n \'common/op_more\'}} <i class="j-toggle-icon iconfont {{#if moreVisible}}iconcollapse{{^}}iconunfold{{/if}}"></i>\r\n        </a>\r\n    </div>\r\n\r\n    <div class="j-more-conditions {{#unless moreVisible}}f-dn{{/unless}}">\r\n        <div class="conditions-item grid-row">\r\n            <label class="grid-col3 conditions-types" for="attachType">{{i18n \'common/attachment_types\'}} : </label>\r\n            <div class="grid-col9">\r\n                <select name="attachType" id="attachType">\r\n                    <option value="">{{i18n \'common/attachment_all_types\'}}</option>\r\n                    <option value="linkAttached">{{i18n \'common/attachment_large\'}}</option>\r\n                    <option value="attached">{{i18n \'common/attachment_general\'}}</option>\r\n                    <option value="noAttach">{{i18n \'common/attachment_without\'}}</option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n\r\n        {{#if enableMailFlagged}}\r\n        <div class="conditions-item grid-row">\r\n            <label class="grid-col3 conditions-types" for="flagType">{{i18n \'common/flags_types\'}} : </label>\r\n            <div class="grid-col9">\r\n                <select name="flags" id="flagType">\r\n                    <option value="">{{i18n \'mbox/radio_ignore\'}}</option>\r\n                    <option value="flagged">{{i18n \'mbox/flagged_option_true\'}}</option>\r\n                    {{#each flagsData}}\r\n                    <option value="{{value}}">{{name}}</option>\r\n                    {{/each}}\r\n                    <option value="noflagged">{{i18n \'mbox/flagged_option_false\'}}</option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n        {{/if}}\r\n\r\n        <div class="conditions-item grid-row">\r\n            <label class="grid-col3 conditions-types" for="priority">{{i18n \'mbox/priority_search\'}} : </label>\r\n            <div class="grid-col9">\r\n                <select name="priority" id="priority">\r\n                    <option value="">{{i18n \'mbox/priority_option_all\'}}</option>\r\n                    <option value="1">{{i18n \'mbox/priority_option_1\'}}</option>\r\n                    <option value="3">{{i18n \'mbox/priority_option_3\'}}</option>\r\n                    <option value="5">{{i18n \'mbox/priority_option_5\'}}</option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="conditions-item grid-row">\r\n            <label class="grid-col3 conditions-types" for="read">{{i18n \'common/mail_status\'}} : </label>\r\n            <div class="grid-col9">\r\n                <select name="read" id="read">\r\n                    <option value="">{{i18n \'mbox/read_ignore\'}}</option>\r\n                    <option value="true">{{i18n \'mbox/read_yes\'}}</option>\r\n                    <option value="false">{{i18n \'mbox/read_no\'}}</option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n\r\n        <div class="conditions-item grid-row">\r\n            <label class="grid-col3 conditions-types" for="size">{{i18n \'mbox/size_search\'}} : </label>\r\n            <div class="grid-col9">\r\n                <select name="size" id="size">\r\n                    <option value="">{{i18n \'mbox/radio_ignore\'}}</option>\r\n                    <option value="0:102400">{{i18n \'mbox/mail_size_1\'}}</option>\r\n                    <option value="102400:10485760">{{i18n \'mbox/mail_size_2\'}}</option>\r\n                    <option value="10485760">{{i18n \'mbox/mail_size_3\'}}</option>\r\n                </select>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n</form>'}),define("cui/ui/select/select",["require","exports","module","jquery","../overlay/overlay","../../util/templatable/templatable"],function(e,t,n){function i(e,t){var n,i=[],a=e.options,r=a.length,s=!1;for(n=0;r>n;n++){var o,l={},d=a[n],u=["text","value","defaultSelected","selected","disabled"];for(o in u){var p=u[o];l[p]=d[p]}l.indent=c(d).data("indent")||0,d.selected&&(s=!0),i.push(l)}return!s&&i.length&&(i[0].selected="true"),{select:i,classPrefix:t}}function a(e,t){var n,i,a,r,s=[],o=[];for(n=0,a=e.length;a>n;n++){var l=c.extend({},e[n]);l.selected&&o.push(n),l.selected=l.defaultSelected=!!l.selected,l.disabled=!!l.disabled,s.push(l)}if(o.length>0)for(o.pop(),i=0,r=o.length;r>i;i++)s[o[i]].selected=!1;else s[0].selected=!0;return{select:s,classPrefix:t}}function r(e,t){var n;return n=c.isNumeric(e)?e:"string"==typeof e?t.index(t.parent().find(e)):t.index(e)}function s(e,t){if(e&&e[0]&&(e=e[0],"select"===e.tagName.toLowerCase())){c(e).find("option").remove();for(var n in t){var i=t[n],a=document.createElement("option");a.text=i.text,a.value=i.value,e.add(a)}}}function o(e,t){return e?e+"-"+t:""}function l(e){var t=0;return e.find("li").each(function(e,n){t+=c(n).outerHeight()}),t}var c=e("jquery"),d=e("../overlay/overlay"),u=e("../../util/templatable/templatable"),p='<div class="{{classPrefix}}"><ul class="{{classPrefix}}-content" data-role="content">{{#each select}}<li data-role="item" title="{{text}}"class="{{../classPrefix}}-item {{#if disabled}}{{../../classPrefix}}-item-disabled{{/if}}" data-value="{{value}}" data-defaultSelected="{{output defaultSelected}}" data-selected="{{output selected}}" data-disabled="{{output disabled}}">{{#compare indent ">" 0}}<span class="indent" style="width: {{indent}}px"></span>{{/compare}}{{text}}</li>{{/each}}</ul></div>',h=d.extend({Implements:u,attrs:{trigger:{value:null,getter:function(e){return c(e).eq(0)}},classPrefix:"ui-select",template:p,align:{baseXY:[0,"100%-1px"]},triggerTpl:'<a href="javascript:void(0)"></a>',name:"",value:"",length:0,selectedIndex:-1,multiple:!1,disabled:!1,maxHeight:null,autoSetWidth:!0,selectSource:null},events:{click:function(e){e.stopPropagation()},"click [data-role=item]":function(e){var t=c(e.currentTarget);t.data("disabled")||this.select(t)},"mouseenter [data-role=item]":function(e){var t=c(e.currentTarget);t.data("disabled")||t.addClass(o(this.get("classPrefix"),"hover"))},"mouseleave [data-role=item]":function(e){var t=c(e.currentTarget);t.data("disabled")||t.removeClass(o(this.get("classPrefix"),"hover"))}},templateHelpers:{output:function(e){return e+""}},initAttrs:function(e,t){h.superclass.initAttrs.call(this,e,t);var n,r=this.get("trigger");if(r.addClass(o(this.get("classPrefix"),"trigger")),"select"===r[0].tagName.toLowerCase()){n=r.attr("name"),n&&this.set("name",n),this.set("selectSource",r);var s=c(this.get("triggerTpl")).addClass(o(this.get("classPrefix"),"trigger"));this.set("trigger",s),this._initFromSelect=!0,r.after(s).css({position:"absolute",left:"-99999px",zIndex:-100}),this.set("model",i(r[0],this.get("classPrefix")))}else{if(n=this.get("name")){var l=c('input[name="'+n+'"]').eq(0);l[0]||(l=c('<input type="text" id="select-'+n.replace(/\./g,"-")+'" name="'+n+'" />').css({position:"absolute",left:"-99999px",zIndex:-100}).insertAfter(r)),this.set("selectSource",l)}this.set("model",a(this.get("model"),this.get("classPrefix")))}},setup:function(){this._bindEvents(),this._initOptions(),this._initHeight(),this._tweakAlignDefaultValue(),this._blurHide(this.get("trigger")),h.superclass.setup.call(this)},render:function(){return h.superclass.render.call(this),this._setTriggerWidth(),this},destroy:function(){this._initFromSelect&&this.get("trigger").remove(),this.get("selectSource")&&this.get("selectSource").remove(),this.element.remove(),h.superclass.destroy.call(this)},select:function(e){var t=r(e,this.options),n=this.get("selectedIndex");this.set("selectedIndex",t);var i=this.get("model");if(n>=0&&(i.select[n].selected=!1),t>=0&&(i.select[t].selected=!0),this.set("model",i),n!==t){var a=this.options.eq(t),s=this.options.eq(n);this.trigger("change",a,s)}return this.hide(),this},syncModel:function(e){this.set("model",a(e,this.get("classPrefix"))),this.renderPartial("[data-role=content]"),s(this.get("selectSource"),e),this.options=this.$("[data-role=content]").children(),this.set("length",this.options.length),this.set("selectedIndex",-1),this.set("value","");var t=r("[data-selected=true]",this.options);return this.set("selectedIndex",t),this._setTriggerWidth(),this},getOption:function(e){var t=r(e,this.options);return this.options.eq(t)},addOption:function(e){var t=this.get("model").select;return t.push(e),this.syncModel(t),this},removeOption:function(e){var t=r(e,this.options),n=this.get("selectedIndex"),i=this.options.eq(t);return i.remove(),this.options=this.$("[data-role=content]").children(),this.set("length",this.options.length),t===n?this.set("selectedIndex",0):n>t&&this.set("selectedIndex",n-1),this},enableOption:function(e){var t=r(e,this.options),n=this.get("model").select;return n[t].disabled=!1,this.syncModel(n),this},disableOption:function(e){var t=r(e,this.options),n=this.get("model").select;return n[t].disabled=!0,this.syncModel(n),this},_onRenderSelectedIndex:function(e){if(-1!==e){var t=this.options.eq(e),n=this.currentItem,i=t.attr("data-value");if(!n||t[0]!==n[0]){var a=this.get("selectSource");a&&("select"===a[0].tagName.toLowerCase()?a[0].selectedIndex=e:a[0].value=i),n&&n.attr("data-selected","false").removeClass(o(this.get("classPrefix"),"selected")),t.attr("data-selected","true").addClass(o(this.get("classPrefix"),"selected")),this.set("value",i);var r=this.get("trigger"),s=r.find("[data-role=trigger-content]");s.length?s.html(t.html()):r.html(t.html()+'<i class="iconfont icondrop"></i>'),this.currentItem=t}}},_onRenderDisabled:function(e){var t=o(this.get("classPrefix"),"disabled"),n=this.get("trigger");n[e?"addClass":"removeClass"](t);var i=this.options.eq(this.get("selectedIndex"));this.trigger("disabledChange",i,e)},_bindEvents:function(){var e=this.get("trigger");this.delegateEvents(e,"mousedown",this._triggerHandle),this.delegateEvents(e,"click",function(e){e.preventDefault()}),this.delegateEvents(e,"mouseenter",function(){e.addClass(o(this.get("classPrefix"),"trigger-hover"))}),this.delegateEvents(e,"mouseleave",function(){e.removeClass(o(this.get("classPrefix"),"trigger-hover"))})},_initOptions:function(){this.options=this.$("[data-role=content]").children(),this.select("[data-selected=true]"),this.set("length",this.options.length)},_setTriggerWidth:function(){var e=this.get("trigger");if("boolean"===c.type(this.get("autoSetWidth"))&&this.get("autoSetWidth")){var t=this.element.outerWidth(),n=parseInt(e.css("padding-left"),10),i=parseInt(e.css("padding-right"),10),a=parseInt(e.css("border-left-width"),10)||0,r=parseInt(e.css("border-right-width"),10)||0;e.css("width",t-n-i-a-r)}else e.addClass(e.prev("select").data("class")||"")},_tweakAlignDefaultValue:function(){var e=this.get("align");"VIEWPORT"===e.baseElement._id&&(e.baseElement=this.get("trigger")),this.set("align",e)},_triggerHandle:function(e){e.preventDefault(),this.get("disabled")||(this.get("visible")?this.hide():this.show())},_initHeight:function(){this.after("show",function(){var e=this.get("maxHeight");if(e){var t=this.$("[data-role=content]"),n=l(t);this.set("height",n>e?e:""),t.scrollTop(0)}})}});n.exports=h}),define("component/advancedSearchBox",["require","i18n!mbox,mail","jquery.datepicker","text!../../template/component/advancedsearch.tpl.html","jquery","../util/index","cui/util/templatable/templatable","cui/ui/dialog/confirmbox","cui/ui/select/select","../module/common/globalService","../module/mail/service","moment"],function(e){e("i18n!mbox,mail"),e("jquery.datepicker");var t=e("text!../../template/component/advancedsearch.tpl.html"),n=e("jquery"),i=e("../util/index"),a=e("cui/util/templatable/templatable"),r=e("cui/ui/dialog/confirmbox"),s=e("cui/ui/select/select"),o=e("../module/common/globalService"),l=e("../module/mail/service"),c=e("moment"),d=r.extend({Implements:a,attrs:{width:"455",title:i.i18n.t("mbox/advanced_search"),confirmTpl:i.i18n.t("common/confirm"),uncertainTpl:i.i18n.t("common/reset"),uncertainColor:"default",cancelTpl:i.i18n.t("common/cancel"),message:"",classPrefix:"u-advancedsearchbox",dnd:!1,hasMask:!1,selectFidInstance:[],align:{getter:function(e){var t=this.get("baseElement");return t?n.extend(e,{baseElement:t,selfXY:["100%","0"],baseXY:["100%","100%"]}):this.activeTrigger.length>0?n.extend(e,{baseElement:this.activeTrigger,selfXY:["100%","0"],baseXY:["100%","100%"]}):e}}},events:{"click .j-toggle":"_toggleMoreConditions"},templateHelpers:{},setup:function(){var e=this;d.superclass.setup.call(this),e._initConfig(),e._initView(),e._blurHide(e.get("trigger")),e.on("confirm",function(){e.hide(),e._handleSearchConditions(),e.trigger("updatePattern",e.$("#pattern").val())}),e.on("uncertain",function(){e._initView("")}),e.on("update:pattern",function(t){e.$("#pattern").val(t)}),e.before("show",function(){e.trigger("update:pattern",e.get("pattern"))})},render:function(){d.superclass.render.call(this)},_initConfig:function(){var e="";this.config={enableMailFlagged:o.getConfig("mail.enablemailflagged"),shareMailBoxFolder:o.getConfig("mail.enablemailboxview")&&l.getFolderCategory(e),mailFlaggedColorCount:o.getConfig("mail.mailflaggedcolorcount")}},destroy:function(){d.superclass.destroy.call(this)},_initView:function(e){var i=this,a={enableMailFlagged:i.config.enableMailFlagged&&!i.config.shareMailBoxFolder,childFolderTpl:i.$("#childfoldertpl").html(),moreVisible:i.moreVisible,pattern:"string"==typeof e?e:i.get("pattern")};a.enableMailFlagged&&i.config.mailFlaggedColorCount>1&&(a.flagsData=l.getToolbarMenu("mail.menu.label0-color")),i.set("message",""),n.when(l.getCacheOriginalFolders(),l.getMailboxShareInfo(!0)).then(function(e,r){e="array"===n.type(e)?e:[],r="array"===n.type(e)?r:[];var s=o.getUser().email,l=[],c={};c[s]=e,l.push({id:-1,name:s,selected:!0}),r.length>0&&n.each(r,function(e,t){c[t.name]=t.folder,l.push({id:t.id,name:t.name})}),a.foldersMap=c,a.accounts=l,i.show().set("message",i.compile(t,a))._initSelect()._initDate()},function(){i.show().set("message",i.compile(t,a))._initSelect()._initDate()})},_initSelect:function(){var e=this,t=[];return this.$("select").each(function(){var i=new s({trigger:n(this),classPrefix:"u-select",className:"ly-select",parentNode:e.element,width:"252",maxHeight:200,effect:"slide",onChange:function(){var t=n(this.get("selectSource")),i=t.find("option:selected");switch(t.attr("id")){case"sentDate":e.$(".j-sentDate").toggleClass("f-dn","specify"!==i.val());break;case"mboxa":e.$(".j-accounts-folder").hide().removeClass("selected").filter('[data-name="'+i.data("name")+'"]').show().addClass("selected"),e._resetFidSelection()}}}).render();this.name&&"fid"===this.name&&t.push(i)}),this.set("selectFidInstance",t),this},_resetFidSelection:function(){var e=this.get("selectFidInstance");n.each(e,function(e,t){t.select(0)})},_initDate:function(){return this.$("#sentDateBegin,#sentDateEnd").datepicker({autoClose:!0,dateFormat:"yyyy-mm-dd"}),this},_handleSearchConditions:function(){var e,t,i=this,a={};if(e=i.$("#pattern"),t=n.trim(e.val()),t&&(a.pattern=t),e=i.$("#mboxa"),t=n.trim(e.val()),t&&-1!=t&&(a.mboxa=t),e=i.$(".j-accounts-folder.selected select"),t=e.val(),t&&(t=-1!=t.indexOf("@")?t.substring(0,t.indexOf("@")):t,a.fid=t),e=i.$("#subject"),t=n.trim(e.val()),t&&(a.subject=t),e=i.$("#from"),t=n.trim(e.val()),t&&(a.from=t),e=i.$("#to"),t=n.trim(e.val()),t&&(a.to=t),e=i.$("#sentDate"),t=e.val(),"specify"===t){var r=i.$("#sentDateEnd").val();a.sentDate=i.$("#sentDateBegin").val()+":"+(r?c(r,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD"):"")}else t&&(a.sentDate=t);i.$(".j-more-conditions").hasClass("f-dn")||(e=i.$("#attachType"),t=e.val(),t&&(a.attachType=t),e=i.$("#flagType"),t=e.val(),t&&(a.flagType=t),e=i.$("#priority"),t=e.val(),t&&(a.priority=t),e=i.$("#read"),t=e.val(),t&&(a.read="true"===t),e=i.$("#size"),t=e.val(),t&&(a.size=t)),this.trigger("search",a)},_toggleMoreConditions:function(e,t){var i=this,a=n(t),r=a.find(".j-toggle-icon"),s=i.$(".j-more-conditions");i.moreVisible=!i.moreVisible,r.hasClass("iconunfold")?r.removeClass("iconunfold").addClass("iconcollapse"):r.removeClass("iconcollapse").addClass("iconunfold"),s.is(":visible")?s.slideUp().addClass("f-dn"):s.slideDown().removeClass("f-dn")}});return d}),define("components/requirejs-text/text!component/../../template/component/contactcard.tpl.html",[],function(){return'<!---->\r\n<div class="u-contactcard">\r\n    <div class="card-content">\r\n        <img class="card-content-avatar j-avatar" src="{{avatarUrl}}" alt="" />\r\n        <div class="card-content-item" title="{{#if true_name}}{{true_name}}{{else}}{{emailAddress}}{{/if}}">\r\n            <span class="oab-info oab-name j-truename">{{#if true_name}}{{true_name}}{{else}}{{emailAddress}}{{/if}}</span>\r\n            {{#unless currentUser}}\r\n            {{#if contactInOab}}\r\n            <a class="view-address j-op-contact iconfont iconeye" role="viewOab" href="javascript:void(0)"></a>\r\n            {{else}}\r\n                {{#if contactInPab}}\r\n                <a class="view-address j-op-contact iconfont iconeye" role="viewPab" href="javascript:void(0)"></a>\r\n                {{/if}}\r\n            {{/if}}\r\n            {{/unless}}\r\n        </div>\r\n        <div class="card-content-item" title="{{emailAddress}}{{#if mainEmailAddress}}({{mainEmailAddress}}){{/if}}">\r\n            <span class="oab-info">{{emailAddress}}{{#if mainEmailAddress}}({{mainEmailAddress}}){{/if}}</span>\r\n        </div>\r\n        <div class="card-content-item" title="{{location}}">\r\n            <span class="oab-info">{{location}}</span>\r\n        </div>\r\n        {{#and contactInOab config.enableSecurityLevel}}\r\n        <div class="card-content-item" title="{{i18n \'common/lbl_sender_security_level\'}}{{translateSL sender_security_level \'sender_security_level\'}} ; {{i18n \'common/lbl_security_level\'}}{{translateSL security_level \'security_level\'}}">\r\n            <span class="oab-info">\r\n                {{i18n \'common/lbl_sender_security_level\'}}{{translateSL sender_security_level \'sender_security_level\'}} ;\r\n                {{i18n \'common/lbl_security_level\'}}{{translateSL security_level \'security_level\'}}\r\n            </span>\r\n        </div>\r\n        {{/and}}\r\n    </div>\r\n    <div class="card-toolbar u-btns">\r\n        {{#if currentUser}}\r\n            <span class="u-btn u-btn-default card-toolbar-setting j-op-contact" role="setting">{{i18n "common/op_user_setting"}}</span>\r\n            <span class="u-btn u-btn-default card-toolbar-logout j-op-contact" role="logout">{{i18n "common/op_user_logout"}}</span>\r\n        {{else}}\r\n            <span class="u-btn u-btn-default card-toolbar-dealings j-op-contact" role="dealings">{{i18n "common/op_mail_dealings"}}</span>\r\n            {{#if config.supportPab}}\r\n            {{#if contactInPab}}\r\n                <span class="u-btn u-btn-default j-op-contact" role="editPab">{{i18n "common/op_edit_pab"}}</span>\r\n            {{else}}\r\n                <span class="u-btn u-btn-default j-op-contact" role="addToAddressbook">{{i18n "common/op_to_addressbook"}}</span>\r\n            {{/if}}\r\n            {{else}}\r\n                <span class="u-btn u-btn-default j-op-contact" role="viewOab">{{i18n "common/op_view_details"}}</span>\r\n            {{/if}}\r\n            <span class="u-btn u-btn-default card-toolbar-option j-op-contact-more" data-dropdown="contact-more">\r\n                {{i18n "common/op_more"}}\r\n                <span class="iconfont icondown"></span>\r\n            </span>\r\n        {{/if}}\r\n    </div>\r\n</div>\r\n\r\n'}),define("cui/ui/popup/popup",["require","jquery","../overlay/overlay"],function(e){function t(e,t,n,i,a){var r=i&&i[0];a.delegateEvents(r?i:t,r?e+" "+t.selector:e,function(e){n.call(e.currentTarget,e)})}var n=e("jquery"),i=e("../overlay/overlay"),a=i.extend({attrs:{trigger:{value:null,getter:function(e){return n(e)}},triggerType:"hover",delegateNode:{value:null,getter:function(e){return n(e)}},align:{value:{baseXY:[0,"100%"],selfXY:[0,0]},setter:function(e){return e?(e.baseElement?this._specifiedBaseElement=!0:this.activeTrigger&&(e.baseElement=this.activeTrigger),e):void 0},getter:function(e){return n.extend({},e,this._specifiedBaseElement?{}:{baseElement:this.activeTrigger})}},delay:70,disabled:!1,effect:"",duration:250},setup:function(){a.superclass.setup.call(this),this._bindTrigger(),this._blurHide(this.get("trigger")),this.activeTrigger=this.get("trigger").eq(0);var e=this;this.get("delegateNode")&&this.before("show",function(){e._relativeElements=e.get("trigger"),e._relativeElements.push(e.element)})},render:function(){return a.superclass.render.call(this),this.element.hide(),
this},show:function(){return this.get("disabled")?void 0:a.superclass.show.call(this)},hide:function(e){return e?this:a.superclass.hide.call(this)},_bindTrigger:function(){var e=this.get("triggerType");"click"===e?this._bindClick():"focus"===e?this._bindFocus():this._bindHover()},_bindClick:function(){function e(e){i.get("disabled")||i.get("trigger").each(function(t,a){e==a?(a._active=!0,i.activeTrigger=n(a)):a._active=!1})}var i=this;t("click",this.get("trigger"),function(t){t.preventDefault(),t.stopPropagation(),this._active===!0?i.hide():(e(this),i.show())},this.get("delegateNode"),this),this.before("hide",function(){e()})},_bindFocus:function(){var e=this;t("focus",this.get("trigger"),function(){e.activeTrigger=n(this),e.show()},this.get("delegateNode"),this),t("blur",this.get("trigger"),function(){setTimeout(function(){!e._downOnElement&&e.hide(),e._downOnElement=!1},e.get("delay"))},this.get("delegateNode"),this),this.delegateEvents("mousedown",function(e){this._downOnElement=!0})},_bindHover:function(){function e(e){clearTimeout(i),i=null,l.get("visible")&&(a=setTimeout(function(){l.hide()},o))}var i,a,r=this.get("trigger"),s=this.get("delegateNode"),o=this.get("delay"),l=this;return 0>o?void this._bindTooltip():(t("mouseenter",r,function(){clearTimeout(a),a=null,l.activeTrigger=n(this),i=setTimeout(function(){l.show()},o)},s,this),t("mouseleave",r,e,s,this),this.delegateEvents("mouseenter",function(){clearTimeout(a)}),this.delegateEvents("mouseleave",e),void this.element.on("mouseleave","select",function(e){e.stopPropagation()}))},_bindTooltip:function(){var e=this.get("trigger"),i=this.get("delegateNode"),a=this;t("mouseenter",e,function(){a.activeTrigger=n(this),a.show()},i,this),t("mouseleave",e,function(){a.hide()},i,this)},_onRenderVisible:function(e,t){if(void 0!=t){var n=-1!==this.get("effect").indexOf("fade"),i=-1!==this.get("effect").indexOf("slide"),a={};i&&(a.height=e?"show":"hide"),n&&(a.opacity=e?"show":"hide");var r=this,s=e?function(){r.trigger("animated")}:function(){r.hide(!0),r.trigger("animated")};n||i?this.element.stop(!0,!0).animate(a,this.get("duration"),s).css({visibility:"visible"}):this.element[e?"show":"hide"]()}}});return a}),define("cui/ui/tip/basic-tip",["require","exports","module","../popup/popup"],function(e,t,n){var i=e("../popup/popup");n.exports=i.extend({attrs:{content:null,direction:"up",distance:8,arrowShift:22,pointPos:"50%"},_setAlign:function(){var e={},t=this.get("arrowShift"),n=this.get("distance"),i=this.get("pointPos"),a=this.get("direction");0>t&&(t="100%"+t),"up"===a?(e.baseXY=[i,0],e.selfXY=[t,"100%+"+n]):"down"===a?(e.baseXY=[i,"100%+"+n],e.selfXY=[t,0]):"left"===a?(e.baseXY=[0,i],e.selfXY=["100%+"+n,t]):"right"===a&&(e.baseXY=["100%+"+n,i],e.selfXY=[0,t]),e.comeFromArrowPosition=!0,this.set("align",e)},_onRenderContent:function(e){var t=this.$('[data-role="content"]');"string"!=typeof e&&e.call&&(e=e.call(this)),t&&t.html(e)}})}),define("cui/ui/tip/tip",["require","jquery","./basic-tip"],function(e){var t=e("jquery"),n=e("./basic-tip"),i='<div class="u-poptip"><div class="u-poptip-main"><div class="u-poptip-container"><div class="u-poptip-arrow"><em></em><span></span></div><div class="u-poptip-content" data-role="content"></div></div></div></div>',a=n.extend({attrs:{template:i,content:"loading...",arrowPosition:7,align:{setter:function(e){return e&&!e.comeFromArrowPosition&&(this._specifiedAlign=!0),e}},theme:"",inViewport:!0},setup:function(){n.superclass.setup.call(this),this._originArrowPosition=this.get("arrowPosition"),this.after("show",function(){this._makesureInViewport()})},_makesureInViewport:function(){if(this.get("inViewport")){var e=this._originArrowPosition,n=t(window).scrollTop(),i=t(window).scrollLeft(),a=t(window).outerHeight(),r=t(window).outerWidth(),s=this.element.height()+this.get("distance"),o=this.element.width()+this.get("distance"),l=this.get("trigger").offset(),c=this.get("trigger").height(),d=this.get("trigger").width(),u={left:1==e||2==e||5==e,up:5==e||7==e};l.top+c>n+a-s?u.up=!0:l.top<n+s&&(u.up=!1),l.left+d>i+r-o?u.left=!0:l.left<i+o&&(u.left=!1),u.left&&u.up?2!=e&&5!=e?this.set("arrowPosition",5):this.set("arrowPosition",e):u.left&&!u.up?2!=e&&1!=e?this.set("arrowPosition",1):this.set("arrowPosition",e):!u.left&&u.up?7!=e&&10!=e?this.set("arrowPosition",7):this.set("arrowPosition",e):11!=e&&10!=e?this.set("arrowPosition",11):this.set("arrowPosition",e)}},_onRenderArrowPosition:function(e,t){e=parseInt(e,10);var n=this.$(".u-poptip-arrow");if(n.removeClass("u-poptip-arrow-"+t).addClass("u-poptip-arrow-"+e),!this._specifiedAlign){var i="",a=0;10===e?(i="right",a=20):11===e?(i="down",a=22):1===e?(i="down",a=-22):2===e?(i="left",a=20):5===e?(i="up",a=-22):7===e&&(i="up",a=22),this.set("direction",i),this.set("arrowShift",a),this._setAlign()}},_onRenderWidth:function(e){this.$('[data-role="content"]').css("width",e)},_onRenderHeight:function(e){this.$('[data-role="content"]').css("height",e)},_onRenderTheme:function(e,t){this.element.removeClass("u-poptip-"+t),this.element.addClass("u-poptip-"+e)}});return a}),function(e){"function"==typeof define&&define.amd?define("components/cropper/dist/cropper",["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function t(e){return"number"==typeof e}function n(e){return"undefined"==typeof e}function i(e,n){var i=[];return t(n)&&i.push(n),i.slice.apply(e,i)}function a(e,t){var n=i(arguments,2);return function(){return e.apply(t,n.concat(i(arguments)))}}function r(e){var t=e.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return t&&(t[1]!==h.protocol||t[2]!==h.hostname||t[3]!==h.port)}function s(e){var t="timestamp="+(new Date).getTime();return e+(-1===e.indexOf("?")?"?":"&")+t}function o(e){return e?"rotate("+e+"deg)":"none"}function l(e,t){var n,i,a=O(e.degree)%180,r=(a>90?180-a:a)*Math.PI/180,s=X(r),o=J(r),l=e.width,c=e.height,d=e.aspectRatio;return t?(n=l/(o+s/d),i=n/d):(n=l*o+c*s,i=l*s+c*o),{width:n,height:i}}function c(t,n){var i=e("<canvas>")[0],a=i.getContext("2d"),r=n.naturalWidth,s=n.naturalHeight,o=n.rotate,c=l({width:r,height:s,degree:o});return o?(i.width=c.width,i.height=c.height,a.save(),a.translate(c.width/2,c.height/2),a.rotate(o*Math.PI/180),a.drawImage(t,-r/2,-s/2,r,s),a.restore()):(i.width=r,i.height=s,a.drawImage(t,0,0,r,s)),i}function d(t,n){this.$element=e(t),this.options=e.extend({},d.DEFAULTS,e.isPlainObject(n)&&n),this.ready=!1,this.built=!1,this.rotated=!1,this.cropped=!1,this.disabled=!1,this.load()}var u=e(window),p=e(document),h=window.location,f=".cropper",m=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,g="cropper-modal",v="cropper-hide",_="cropper-hidden",y="cropper-invisible",b="cropper-move",w="cropper-crop",M="cropper-disabled",T="cropper-bg",L="mousedown touchstart",x="mousemove touchmove",C="mouseup mouseleave touchend touchleave touchcancel",S="wheel mousewheel DOMMouseScroll",k="dblclick",D="resize"+f,Y="build"+f,j="built"+f,N="dragstart"+f,P="dragmove"+f,E="dragend"+f,A="zoomin"+f,F="zoomout"+f,I=e.isFunction(e("<canvas>")[0].getContext),H=Math.sqrt,Z=Math.min,R=Math.max,O=Math.abs,X=Math.sin,J=Math.cos,B=parseFloat,W={};W.load=function(t){var n,i,a,o=this.options,l=this.$element;t||(l.is("img")?t=l.prop("src"):l.is("canvas")&&I&&(t=l[0].toDataURL())),t&&(i=e.Event(Y),l.one(Y,o.build).trigger(i),i.isDefaultPrevented()||(o.checkImageOrigin&&r(t)&&(n=" crossOrigin",l.prop("crossOrigin")||(t=s(t))),this.$clone=a=e("<img>"),a.one("load",e.proxy(function(){var e=a.prop("naturalWidth")||a.width(),n=a.prop("naturalHeight")||a.height();this.image={naturalWidth:e,naturalHeight:n,aspectRatio:e/n,rotate:0},this.url=t,this.ready=!0,this.build()},this)).attr({src:t,crossOrigin:n}),a.addClass(v).insertAfter(l)))},W.build=function(){var t,n,i=this.$element,a=this.$clone,r=this.options;this.ready&&(this.built&&this.unbuild(),this.$cropper=t=e(d.TEMPLATE),i.addClass(_),a.removeClass(v),this.$container=i.parent().append(t),this.$canvas=t.find(".cropper-canvas").append(a),this.$dragBox=t.find(".cropper-drag-box"),this.$cropBox=n=t.find(".cropper-crop-box"),this.$viewBox=t.find(".cropper-view-box"),this.addListeners(),this.initPreview(),r.aspectRatio=B(r.aspectRatio)||NaN,r.autoCrop?(this.cropped=!0,r.modal&&this.$dragBox.addClass(g)):n.addClass(_),r.background&&t.addClass(T),r.highlight||n.find(".cropper-face").addClass(y),r.guides||n.find(".cropper-dashed").addClass(_),r.movable||n.find(".cropper-face").data("drag","move"),r.resizable||n.find(".cropper-line, .cropper-point").addClass(_),this.setDragMode(r.dragCrop?"crop":"move"),this.built=!0,this.render(),i.one(j,r.built).trigger(j))},W.unbuild=function(){this.built&&(this.built=!1,this.removeListeners(),this.$preview.empty(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},e.extend(W,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox()},initContainer:function(){var e=this.$element,t=this.$container,n=this.$cropper,i=this.options;n.addClass(_),e.removeClass(_),n.css(this.container={width:R(t.width(),B(i.minContainerWidth)||200),height:R(t.height(),B(i.minContainerHeight)||100)}),e.addClass(_),n.removeClass(_)},initCanvas:function(){var t=this.options,n=this.container,i=n.width,a=n.height,r=this.image,s=r.aspectRatio,o={aspectRatio:s,width:i,height:a,left:0,top:0,minLeft:-i,minTop:-a,maxLeft:i,maxTop:a,minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0};a*s>i?t.strict?o.width=a*s:o.height=i/s:t.strict?o.height=i/s:o.width=a*s,o.oldLeft=o.left=(i-o.width)/2,o.oldTop=o.top=(a-o.height)/2,this.canvas=o,this.limitCanvas(),this.initialImage=e.extend({},r),this.initialCanvas=e.extend({},this.canvas),this.renderCanvas()},limitCanvas:function(){var e=this.options,t=this.container,n=t.width,i=t.height,a=this.canvas,r=a.aspectRatio,s=n,o=i;i*r>n?e.strict?s=i*r:o=n/r:e.strict?o=n/r:s=i*r,e.strict?(a.minWidth=s,a.minHeight=o,a.maxLeft=0,a.maxTop=0,a.minLeft=n-s,a.minTop=i-o):(a.minLeft=-s,a.minTop=-o)},renderCanvas:function(t){var n,i,a,r=this.options,s=this.container,c=this.canvas,d=this.image;this.rotated&&(this.rotated=!1,a=l({width:d.width,height:d.height,degree:d.rotate}),n=a.width/a.height,n!==c.aspectRatio&&(c.left-=(a.width-c.width)/2,c.top-=(a.height-c.height)/2,c.width=a.width,c.height=a.height,c.aspectRatio=n,this.limitCanvas())),(c.width>c.maxWidth||c.width<c.minWidth)&&(c.left=c.oldLeft),(c.height>c.maxHeight||c.height<c.minHeight)&&(c.top=c.oldTop),c.width=Z(R(c.width,c.minWidth),c.maxWidth),c.height=Z(R(c.height,c.minHeight),c.maxHeight),r.strict?(c.minLeft=s.width-c.width,c.minTop=s.height-c.height):(c.minLeft=-c.width,c.minTop=-c.height),c.oldLeft=c.left=Z(R(c.left,c.minLeft),c.maxLeft),c.oldTop=c.top=Z(R(c.top,c.minTop),c.maxTop),this.$canvas.css({width:c.width,height:c.height,left:c.left,top:c.top}),d.rotate?(i=l({width:c.width,height:c.height,degree:d.rotate,aspectRatio:d.aspectRatio},!0),e.extend(d,{width:i.width,height:i.height,left:(c.width-i.width)/2,top:(c.height-i.height)/2})):e.extend(d,{width:c.width,height:c.height,left:0,top:0}),this.$clone.css({width:d.width,height:d.height,marginLeft:d.left,marginTop:d.top,transform:o(d.rotate)}),t&&(this.preview(),r.crop&&r.crop.call(this.$element,this.getData()))},initCropBox:function(){var t=this.options,n=this.container,i=this.canvas,a=t.strict,r=t.aspectRatio,s=B(t.minCropBoxWidth)||0,o=B(t.minCropBoxHeight)||0,l=B(t.autoCropArea)||.8,c=n.width,d=n.height,u={width:a?c:i.width,height:a?d:i.height,minWidth:s,minHeight:o,maxWidth:c,maxHeight:d};r&&(d*r>c?(u.height=u.width/r,u.maxHeight=c/r):(u.width=u.height*r,u.maxWidth=d*r),a||(u.height*i.aspectRatio>u.width?(u.height=i.height,u.width=u.height*r):(u.width=i.width,u.height=u.width/r)),s?u.minHeight=u.minWidth/r:o&&(u.minWidth=u.minHeight*r)),u.minWidth=Z(u.maxWidth,u.minWidth),u.minHeight=Z(u.maxHeight,u.minHeight),u.width=R(u.minWidth,u.width*l),u.height=R(u.minHeight,u.height*l),u.oldLeft=u.left=(c-u.width)/2,u.oldTop=u.top=(d-u.height)/2,this.initialCropBox=e.extend({},u),this.cropBox=u,this.cropped&&this.renderCropBox()},renderCropBox:function(){var e=this.options,t=this.container,n=t.width,i=t.height,a=this.$cropBox,r=this.cropBox;(r.width>r.maxWidth||r.width<r.minWidth)&&(r.left=r.oldLeft),(r.height>r.maxHeight||r.height<r.minHeight)&&(r.top=r.oldTop),r.width=Z(R(r.width,r.minWidth),r.maxWidth),r.height=Z(R(r.height,r.minHeight),r.maxHeight),r.oldLeft=r.left=Z(R(r.left,0),n-r.width),r.oldTop=r.top=Z(R(r.top,0),i-r.height),e.movable&&a.find(".cropper-face").data("drag",r.width===n&&r.height===i?"move":"all"),a.css({width:r.width,height:r.height,left:r.left,top:r.top}),this.disabled||(this.preview(),e.crop&&e.crop.call(this.$element,this.getData()))}}),W.initPreview=function(){var t=this.url;this.$preview=e(this.options.preview),this.$viewBox.html('<img src="'+t+'">'),this.$preview.each(function(){var n=e(this);n.data({width:n.width(),height:n.height()}).html('<img src="'+t+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation: 0deg!important">')})},W.preview=function(){var t=this.image,n=this.canvas,i=this.cropBox,a=t.width,r=t.height,s=i.left-n.left-t.left,l=i.top-n.top-t.top,c=t.rotate;this.cropped&&!this.disabled&&(this.$viewBox.find("img").css({width:a,height:r,marginLeft:-s,marginTop:-l,transform:o(c)}),this.$preview.each(function(){var t=e(this),n=t.data(),d=n.width/i.width,u=n.width,p=i.height*d;p>n.height&&(d=n.height/i.height,u=i.width*d,p=n.height),t.width(u).height(p).find("img").css({width:a*d,height:r*d,marginLeft:-s*d,marginTop:-l*d,transform:o(c)})}))},W.addListeners=function(){var t=this.options;this.$element.on(N,t.dragstart).on(P,t.dragmove).on(E,t.dragend).on(A,t.zoomin).on(F,t.zoomout),this.$cropper.on(L,e.proxy(this.dragstart,this)).on(k,e.proxy(this.dblclick,this)),t.zoomable&&t.mouseWheelZoom&&this.$cropper.on(S,e.proxy(this.wheel,this)),p.on(x,this._dragmove=a(this.dragmove,this)).on(C,this._dragend=a(this.dragend,this)),t.responsive&&u.on(D,this._resize=a(this.resize,this))},W.removeListeners=function(){var e=this.options;this.$element.off(N,e.dragstart).off(P,e.dragmove).off(E,e.dragend).off(A,e.zoomin).off(F,e.zoomout),this.$cropper.off(L,this.dragstart).off(k,this.dblclick),e.zoomable&&e.mouseWheelZoom&&this.$cropper.off(S,this.wheel),p.off(x,this._dragmove).off(C,this._dragend),e.responsive&&u.off(D,this._resize)},e.extend(W,{resize:function(){var t,n,i,a=this.$container,r=this.container;this.disabled||(i=a.width()/r.width,(1!==i||a.height()!==r.height)&&(t=this.getCanvasData(),n=this.getCropBoxData(),this.render(),this.setCanvasData(e.each(t,function(e,n){t[e]=n*i})),this.setCropBoxData(e.each(n,function(e,t){n[e]=t*i}))))},dblclick:function(){this.disabled||(this.$dragBox.hasClass(w)?this.setDragMode("move"):this.setDragMode("crop"))},wheel:function(e){var t=e.originalEvent,n=1;this.disabled||(e.preventDefault(),t.deltaY?n=t.deltaY>0?1:-1:t.wheelDelta?n=-t.wheelDelta/120:t.detail&&(n=t.detail>0?1:-1),this.zoom(.1*n))},dragstart:function(t){var n,i,a,r=this.options,s=t.originalEvent,o=s&&s.touches,l=t;if(!this.disabled){if(o){if(a=o.length,a>1){if(!r.zoomable||!r.touchDragZoom||2!==a)return;l=o[1],this.startX2=l.pageX,this.startY2=l.pageY,n="zoom"}l=o[0]}if(n=n||e(l.target).data("drag"),m.test(n)){if(t.preventDefault(),i=e.Event(N,{originalEvent:s,dragType:n}),this.$element.trigger(i),i.isDefaultPrevented())return;this.dragType=n,this.cropping=!1,this.startX=l.pageX,this.startY=l.pageY,"crop"===n&&(this.cropping=!0,this.$dragBox.addClass(g))}}},dragmove:function(t){var n,i,a=this.options,r=t.originalEvent,s=r&&r.touches,o=t,l=this.dragType;if(!this.disabled){if(s){if(i=s.length,i>1){if(!a.zoomable||!a.touchDragZoom||2!==i)return;o=s[1],this.endX2=o.pageX,this.endY2=o.pageY}o=s[0]}if(l){if(t.preventDefault(),n=e.Event(P,{originalEvent:r,dragType:l}),this.$element.trigger(n),n.isDefaultPrevented())return;this.endX=o.pageX,this.endY=o.pageY,this.change()}}},dragend:function(t){var n,i=this.dragType;if(!this.disabled&&i){if(t.preventDefault(),n=e.Event(E,{originalEvent:t.originalEvent,dragType:i}),this.$element.trigger(n),n.isDefaultPrevented())return;this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(g,this.cropped&&this.options.modal)),this.dragType=""}}}),e.extend(W,{reset:function(){this.disabled||(this.image=e.extend({},this.initialImage),this.canvas=e.extend({},this.initialCanvas),this.renderCanvas(),this.cropped&&(this.cropBox=e.extend({},this.initialCropBox),this.renderCropBox()))},clear:function(){this.cropped&&!this.disabled&&(e.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.renderCropBox(),this.cropped=!1,this.$dragBox.removeClass(g),this.$cropBox.addClass(_))},destroy:function(){var e=this.$element;this.ready||this.$clone.off("load").remove(),this.unbuild(),e.removeClass(_).removeData("cropper")},replace:function(e){this.ready&&!this.disabled&&e&&this.load(e)},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass(M))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass(M))},move:function(e,n){var i=this.canvas;this.built&&!this.disabled&&t(e)&&t(n)&&(i.left+=e,i.top+=n,this.renderCanvas(!0))},zoom:function(t){var n,i,a,r=this.canvas;if(t=B(t),t&&this.built&&!this.disabled&&this.options.zoomable){if(n=t>0?e.Event(A):e.Event(F),this.$element.trigger(n),n.isDefaultPrevented())return;t=-1>=t?1/(1-t):1>=t?1+t:t,i=r.width*t,a=r.height*t,r.left-=(i-r.width)/2,r.top-=(a-r.height)/2,r.width=i,r.height=a,this.renderCanvas(!0),this.setDragMode("move")}},rotate:function(e){var t=this.image;e=B(e),e&&this.built&&!this.disabled&&this.options.rotatable&&(t.rotate=(t.rotate+e)%360,this.rotated=!0,this.renderCanvas(!0))},getData:function(){var t,n,i=this.cropBox,a=this.canvas,r=this.image,s=r.rotate;return this.built&&this.cropped?(n={x:i.left-a.left,y:i.top-a.top,width:i.width,height:i.height},t=r.width/r.naturalWidth,e.each(n,function(e,i){i/=t,n[e]=i})):n={x:0,y:0,width:0,height:0},n.rotate=s,n},getContainerData:function(){return this.built?this.container:{}},getImageData:function(){return this.ready?this.image:{}},getCanvasData:function(){var e,t=this.canvas;return this.built&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCanvasData:function(n){var i=this.canvas,a=i.aspectRatio;this.built&&!this.disabled&&e.isPlainObject(n)&&(t(n.left)&&(i.left=n.left),t(n.top)&&(i.top=n.top),t(n.width)?(i.width=n.width,i.height=n.width/a):t(n.height)&&(i.height=n.height,i.width=n.height*a),this.renderCanvas(!0))},getCropBoxData:function(){var e,t=this.cropBox;return this.built&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(n){var i=this.cropBox,a=this.options.aspectRatio;this.built&&this.cropped&&!this.disabled&&e.isPlainObject(n)&&(t(n.left)&&(i.left=n.left),t(n.top)&&(i.top=n.top),a?t(n.width)?(i.width=n.width,i.height=i.width/a):t(n.height)&&(i.height=n.height,i.width=i.height*a):(t(n.width)&&(i.width=n.width),t(n.height)&&(i.height=n.height)),this.renderCropBox())},getCroppedCanvas:function(t){var n,i,a,r,s,o,l,d,u,p,h;if(this.built&&this.cropped&&I)return e.isPlainObject(t)||(t={}),h=this.getData(),n=h.width,i=h.height,d=n/i,e.isPlainObject(t)&&(s=t.width,o=t.height,s?(o=s/d,l=s/n):o&&(s=o*d,l=o/i)),a=s||n,r=o||i,u=e("<canvas>")[0],u.width=a,u.height=r,p=u.getContext("2d"),t.fillColor&&(p.fillStyle=t.fillColor,p.fillRect(0,0,a,r)),p.drawImage.apply(p,function(){var e,t,a,r,s,o,d=c(this.$clone[0],this.image),u=d.width,p=d.height,f=[d],m=h.x,g=h.y;return-n>=m||m>u?m=e=a=s=0:0>=m?(a=-m,m=0,e=s=Z(u,n+m)):u>=m&&(a=0,e=s=Z(n,u-m)),0>=e||-i>=g||g>p?g=t=r=o=0:0>=g?(r=-g,g=0,t=o=Z(p,i+g)):p>=g&&(r=0,t=o=Z(i,p-g)),f.push(m,g,e,t),l&&(a*=l,r*=l,s*=l,o*=l),s>0&&o>0&&f.push(a,r,s,o),f}.call(this)),u},setAspectRatio:function(e){var t=this.options;this.disabled||n(e)||(t.aspectRatio=B(e)||NaN,this.built&&this.initCropBox())},setDragMode:function(e){var t=this.$dragBox,n=!1,i=!1;if(this.ready&&!this.disabled){switch(e){case"crop":this.options.dragCrop?(n=!0,t.data("drag",e)):i=!0;break;case"move":i=!0,t.data("drag",e);break;default:t.removeData("drag")}t.toggleClass(w,n).toggleClass(b,i)}}}),W.change=function(){var e,t=this.dragType,n=this.canvas,i=this.container,a=i.width,r=i.height,s=this.cropBox,o=s.width,l=s.height,c=s.left,d=s.top,u=c+o,p=d+l,h=!0,f=this.options.aspectRatio,m={x:this.endX-this.startX,y:this.endY-this.startY};switch(f&&(m.X=m.y*f,m.Y=m.x/f),t){case"all":c+=m.x,d+=m.y;break;case"e":if(m.x>=0&&(u>=a||f&&(0>=d||p>=r))){h=!1;break}o+=m.x,f&&(l=o/f,d-=m.Y/2),0>o&&(t="w",o=0);break;case"n":if(m.y<=0&&(0>=d||f&&(0>=c||u>=a))){h=!1;break}l-=m.y,d+=m.y,f&&(o=l*f,c+=m.X/2),0>l&&(t="s",l=0);break;case"w":if(m.x<=0&&(0>=c||f&&(0>=d||p>=r))){h=!1;break}o-=m.x,c+=m.x,f&&(l=o/f,d+=m.Y/2),0>o&&(t="e",o=0);break;case"s":if(m.y>=0&&(p>=r||f&&(0>=c||u>=a))){h=!1;break}l+=m.y,f&&(o=l*f,c-=m.X/2),0>l&&(t="n",l=0);break;case"ne":if(f){if(m.y<=0&&(0>=d||u>=a)){h=!1;break}l-=m.y,d+=m.y,o=l*f}else m.x>=0?a>u?o+=m.x:m.y<=0&&0>=d&&(h=!1):o+=m.x,m.y<=0?d>0&&(l-=m.y,d+=m.y):(l-=m.y,d+=m.y);0>o&&0>l?(t="sw",l=0,o=0):0>o?(t="nw",o=0):0>l&&(t="se",l=0);break;case"nw":if(f){if(m.y<=0&&(0>=d||0>=c)){h=!1;break}l-=m.y,d+=m.y,o=l*f,c+=m.X}else m.x<=0?c>0?(o-=m.x,c+=m.x):m.y<=0&&0>=d&&(h=!1):(o-=m.x,c+=m.x),m.y<=0?d>0&&(l-=m.y,d+=m.y):(l-=m.y,d+=m.y);0>o&&0>l?(t="se",l=0,o=0):0>o?(t="ne",o=0):0>l&&(t="sw",l=0);break;case"sw":if(f){if(m.x<=0&&(0>=c||p>=r)){h=!1;break}o-=m.x,c+=m.x,l=o/f}else m.x<=0?c>0?(o-=m.x,c+=m.x):m.y>=0&&p>=r&&(h=!1):(o-=m.x,c+=m.x),m.y>=0?r>p&&(l+=m.y):l+=m.y;0>o&&0>l?(t="ne",l=0,o=0):0>o?(t="se",o=0):0>l&&(t="nw",l=0);break;case"se":if(f){if(m.x>=0&&(u>=a||p>=r)){h=!1;break}o+=m.x,l=o/f}else m.x>=0?a>u?o+=m.x:m.y>=0&&p>=r&&(h=!1):o+=m.x,m.y>=0?r>p&&(l+=m.y):l+=m.y;0>o&&0>l?(t="nw",l=0,o=0):0>o?(t="sw",o=0):0>l&&(t="ne",l=0);break;case"move":n.left+=m.x,n.top+=m.y,this.renderCanvas(!0),h=!1;break;case"zoom":this.zoom(function(e,t,n,i){var a=H(e*e+t*t),r=H(n*n+i*i);return(r-a)/a}(O(this.startX-this.startX2),O(this.startY-this.startY2),O(this.endX-this.endX2),O(this.endY-this.endY2))),this.startX2=this.endX2,this.startY2=this.endY2,h=!1;break;case"crop":m.x&&m.y&&(e=this.$cropper.offset(),c=this.startX-e.left,d=this.startY-e.top,o=s.minWidth,l=s.minHeight,m.x>0?m.y>0?t="se":(t="ne",d-=l):m.y>0?(t="sw",c-=o):(t="nw",c-=o,d-=l),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(_)))}h&&(s.width=o,s.height=l,s.left=c,s.top=d,this.dragType=t,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},e.extend(d.prototype,W),d.DEFAULTS={aspectRatio:NaN,autoCropArea:.8,crop:null,preview:"",strict:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,highlight:!0,background:!0,autoCrop:!0,dragCrop:!0,movable:!0,resizable:!0,rotatable:!0,zoomable:!0,touchDragZoom:!0,mouseWheelZoom:!0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,dragstart:null,dragmove:null,dragend:null,zoomin:null,zoomout:null},d.setDefaults=function(t){e.extend(d.DEFAULTS,t)},d.TEMPLATE=function(e,t){return t=t.split(","),e.replace(/\d+/g,function(e){return t[e]})}('<0 6="5-container"><0 6="5-canvas"></0><0 6="5-2-9" 3-2="move"></0><0 6="5-crop-9"><1 6="5-view-9"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,drag,data,point,cropper,class,line,dashed,box"),d.other=e.fn.cropper,e.fn.cropper=function(t){var a,r=i(arguments,1);return this.each(function(){var n,i=e(this),s=i.data("cropper");s||i.data("cropper",s=new d(this,t)),"string"==typeof t&&e.isFunction(n=s[t])&&(a=n.apply(s,r))}),n(a)?this:a},e.fn.cropper.Constructor=d,e.fn.cropper.setDefaults=d.setDefaults,e.fn.cropper.noConflict=function(){return e.fn.cropper=d.other,this}}),function(e){"function"==typeof define&&define.amd?define("jquery.ui/widget",["jquery"],e):e(jQuery)}(function(e){var t=0,n=Array.prototype.slice;return e.cleanData=function(t){return function(n){var i,a,r;for(r=0;null!=(a=n[r]);r++)try{i=e._data(a,"events"),i&&i.remove&&e(a).triggerHandler("remove")}catch(s){}t(n)}}(e.cleanData),e.widget=function(t,n,i){var a,r,s,o,l={},c=t.split(".")[0];return t=t.split(".")[1],a=c+"-"+t,i||(i=n,n=e.Widget),e.expr[":"][a.toLowerCase()]=function(t){return!!e.data(t,a)},e[c]=e[c]||{},r=e[c][t],s=e[c][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},e.extend(s,r,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),o=new n,o.options=e.widget.extend({},o.options),e.each(i,function(t,i){return e.isFunction(i)?void(l[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},a=function(e){return n.prototype[t].apply(this,e)};return function(){var t,n=this._super,r=this._superApply;return this._super=e,this._superApply=a,t=i.apply(this,arguments),this._super=n,this._superApply=r,t}}()):void(l[t]=i)}),s.prototype=e.widget.extend(o,{widgetEventPrefix:r?o.widgetEventPrefix||t:t},l,{constructor:s,namespace:c,widgetName:t,widgetFullName:a}),r?(e.each(r._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,s,n._proto)}),delete r._childConstructors):n._childConstructors.push(s),e.widget.bridge(t,s),s},e.widget.extend=function(t){for(var i,a,r=n.call(arguments,1),s=0,o=r.length;o>s;s++)for(i in r[s])a=r[s][i],r[s].hasOwnProperty(i)&&void 0!==a&&(e.isPlainObject(a)?t[i]=e.isPlainObject(t[i])?e.widget.extend({},t[i],a):e.widget.extend({},a):t[i]=a);return t},e.widget.bridge=function(t,i){var a=i.prototype.widgetFullName||t;e.fn[t]=function(r){var s="string"==typeof r,o=n.call(arguments,1),l=this;return r=!s&&o.length?e.widget.extend.apply(null,[r].concat(o)):r,s?this.each(function(){var n,i=e.data(this,a);return"instance"===r?(l=i,!1):i?e.isFunction(i[r])&&"_"!==r.charAt(0)?(n=i[r].apply(i,o),n!==i&&void 0!==n?(l=n&&n.jquery?l.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+r+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+r+"'")}):this.each(function(){var t=e.data(this,a);t?(t.option(r||{}),t._init&&t._init()):e.data(this,a,new i(r,this))}),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(n,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),n),this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,n){var i,a,r,s=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(s={},i=t.split("."),t=i.shift(),i.length){for(a=s[t]=e.widget.extend({},this.options[t]),r=0;r<i.length-1;r++)a[i[r]]=a[i[r]]||{},a=a[i[r]];if(t=i.pop(),1===arguments.length)return void 0===a[t]?null:a[t];a[t]=n}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];s[t]=n}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,n,i){var a,r=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=a=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,a=this.widget()),e.each(i,function(i,s){function o(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?r[s]:s).apply(r,arguments):void 0}"string"!=typeof s&&(o.guid=s.guid=s.guid||o.guid||e.guid++);var l=i.match(/^([\w:-]*)\s*(.*)$/),c=l[1]+r.eventNamespace,d=l[2];d?a.delegate(d,c,o):n.bind(c,o)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,i){var a,r,s=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],r=n.originalEvent)for(a in r)a in n||(n[a]=r[a]);return this.element.trigger(n,i),!(e.isFunction(s)&&s.apply(this.element[0],[n].concat(i))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,a,r){"string"==typeof a&&(a={effect:a});var s,o=a?a===!0||"number"==typeof a?n:a.effect||n:t;a=a||{},"number"==typeof a&&(a={duration:a}),s=!e.isEmptyObject(a),a.complete=r,a.delay&&i.delay(a.delay),s&&e.effects&&e.effects.effect[o]?i[t](a):o!==t&&i[o]?i[o](a.duration,a.easing,r):i.queue(function(n){e(this)[t](),r&&r.call(i[0]),n()})}}),e.widget}),function(e){"use strict";"function"==typeof define&&define.amd?define("components/jquery-file-upload/js/jquery.fileupload",["jquery","jquery.ui.widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(e){"use strict";function t(t){var n="dragover"===t;return function(i){i.dataTransfer=i.originalEvent&&i.originalEvent.dataTransfer;var a=i.dataTransfer;a&&-1!==e.inArray("Files",a.types)&&this._trigger(t,e.Event(t,{delegatedEvent:i}))!==!1&&(i.preventDefault(),n&&(a.dropEffect="copy"))}}e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file">').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,
limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){return t.isDefaultPrevented()?!1:void((n.autoUpload||n.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()}))},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var i=e-this.timestamp;return(!this.bitrate||!n||i>n)&&(this.bitrate=(t-this.loaded)*(1e3/i)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var i,a=Date.now?Date.now():(new Date).getTime();if(n._time&&n.progressInterval&&a-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=a,i=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=i-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(a,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=i,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(a,i,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,i=t.xhr?t.xhr():e.ajaxSettings.xhr();i.upload&&(e(i.upload).bind("progress",function(e){var i=e.originalEvent;e.lengthComputable=i.lengthComputable,e.loaded=i.loaded,e.total=i.total,n._onProgress(e,t)}),t.xhr=function(){return i})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var n,i=this,a=t.files[0],r=t.multipart||!e.support.xhrFileUpload,s="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),r&&!t.blob&&this._isInstanceOf("File",a)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(a.name)+'"'),r?e.support.xhrFormDataFileUpload&&(t.postMessage?(n=this._getFormData(t),t.blob?n.push({name:s,value:t.blob}):e.each(t.files,function(i,a){n.push({name:"array"===e.type(t.paramName)&&t.paramName[i]||s,value:a})})):(i._isInstanceOf("FormData",t.formData)?n=t.formData:(n=new FormData,e.each(this._getFormData(t),function(e,t){n.append(t.name,t.value)})),t.blob?n.append(s,t.blob,a.name):e.each(t.files,function(a,r){(i._isInstanceOf("File",r)||i._isInstanceOf("Blob",r))&&n.append("array"===e.type(t.paramName)&&t.paramName[a]||s,r,r.uploadName||r.name)})),t.data=n):(t.contentType=a.type||"application/octet-stream",t.data=t.blob||a),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var n=e(t.fileInput),i=t.paramName;return i?e.isArray(i)||(i=[i]):(i=[],n.each(function(){for(var t=e(this),n=t.prop("name")||"files[]",a=(t.prop("files")||[1]).length;a;)i.push(n),a-=1}),i.length||(i=[n.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,i){var a=e.Deferred(),r=a.promise();return n=n||this.options.context||r,t===!0?a.resolveWith(n,i):t===!1&&a.rejectWith(n,i),r.abort=a.promise,this._enhancePromise(r)},_addConvenienceMethods:function(t,n){var i=this,a=function(t){return e.Deferred().resolveWith(i,t).promise()};n.process=function(t,r){return(t||r)&&(n._processQueue=this._processQueue=(this._processQueue||a([this])).pipe(function(){return n.errorThrown?e.Deferred().rejectWith(i,[n]).promise():a(arguments)}).pipe(t,r)),this._processQueue||a([this])},n.submit=function(){return"pending"!==this.state()&&(n.jqXHR=this.jqXHR=i._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&i._onSend(t,this)),this.jqXHR||i._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",i._trigger("fail",null,this),i._getXHRPromise(!1))},n.state=function(){return this.jqXHR?i._getDeferredState(this.jqXHR):this._processQueue?i._getDeferredState(this._processQueue):void 0},n.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===i._getDeferredState(this._processQueue)},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),i=n&&n.length>1&&parseInt(n[1],10);return i&&i+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var i,a,r=this,s=t.files[0],o=s.size,l=t.uploadedBytes,c=t.maxChunkSize||o,d=this._blobSlice,u=e.Deferred(),p=u.promise();return this._isXHRUpload(t)&&d&&(l||o>c)&&!t.data?n?!0:l>=o?(s.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",s.error])):(a=function(){var n=e.extend({},t),p=n._progress.loaded;n.blob=d.call(s,l,l+c,s.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+l+"-"+(l+n.chunkSize-1)+"/"+o,r._initXHRData(n),r._initProgressListener(n),i=(r._trigger("chunksend",null,n)!==!1&&e.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(i,s,c){l=r._getUploadedBytes(c)||l+n.chunkSize,p+n.chunkSize-n._progress.loaded&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-n.uploadedBytes,total:l-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=l,n.result=i,n.textStatus=s,n.jqXHR=c,r._trigger("chunkdone",null,n),r._trigger("chunkalways",null,n),o>l?a():u.resolveWith(n.context,[i,s,c])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,r._trigger("chunkfail",null,n),r._trigger("chunkalways",null,n),u.rejectWith(n.context,[e,t,i])})},this._enhancePromise(p),p.abort=function(){return i.abort()},a(),p):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,i,a){var r=a._progress.total,s=a._response;a._progress.loaded<r&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:r,total:r}),a),s.result=a.result=t,s.textStatus=a.textStatus=n,s.jqXHR=a.jqXHR=i,this._trigger("done",null,a)},_onFail:function(e,t,n,i){var a=i._response;i.recalculateProgress&&(this._progress.loaded-=i._progress.loaded,this._progress.total-=i._progress.total),a.jqXHR=i.jqXHR=e,a.textStatus=i.textStatus=t,a.errorThrown=i.errorThrown=n,this._trigger("fail",null,i)},_onAlways:function(e,t,n,i){this._trigger("always",null,i)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var i,a,r,s,o=this,l=o._getAJAXSettings(n),c=function(){return o._sending+=1,l._bitrateTimer=new o._BitrateTimer,i=i||((a||o._trigger("send",e.Event("send",{delegatedEvent:t}),l)===!1)&&o._getXHRPromise(!1,l.context,a)||o._chunkedUpload(l)||e.ajax(l)).done(function(e,t,n){o._onDone(e,t,n,l)}).fail(function(e,t,n){o._onFail(e,t,n,l)}).always(function(e,t,n){if(o._onAlways(e,t,n,l),o._sending-=1,o._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>o._sending)for(var i=o._slots.shift();i;){if("pending"===o._getDeferredState(i)){i.resolve();break}i=o._slots.shift()}0===o._active&&o._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(r=e.Deferred(),this._slots.push(r),s=r.pipe(c)):(this._sequence=this._sequence.pipe(c,c),s=this._sequence),s.abort=function(){return a=[void 0,"abort","abort"],i?i.abort():(r&&r.rejectWith(l.context,a),c())},this._enhancePromise(s)):c()},_onAdd:function(t,n){var i,a,r,s,o=this,l=!0,c=e.extend({},this.options,n),d=n.files,u=d.length,p=c.limitMultiFileUploads,h=c.limitMultiFileUploadSize,f=c.limitMultiFileUploadSizeOverhead,m=0,g=this._getParamName(c),v=0;if(!h||u&&void 0!==d[0].size||(h=void 0),(c.singleFileUploads||p||h)&&this._isXHRUpload(c))if(c.singleFileUploads||h||!p)if(!c.singleFileUploads&&h)for(r=[],i=[],s=0;u>s;s+=1)m+=d[s].size+f,(s+1===u||m+d[s+1].size+f>h||p&&s+1-v>=p)&&(r.push(d.slice(v,s+1)),a=g.slice(v,s+1),a.length||(a=g),i.push(a),v=s+1,m=0);else i=g;else for(r=[],i=[],s=0;u>s;s+=p)r.push(d.slice(s,s+p)),a=g.slice(s,s+p),a.length||(a=g),i.push(a);else r=[d],i=[g];return n.originalFiles=d,e.each(r||d,function(a,s){var c=e.extend({},n);return c.files=r?s:[s],c.paramName=i[a],o._initResponseObject(c),o._initProgressObject(c),o._addConvenienceMethods(t,c),l=o._trigger("add",e.Event("add",{delegatedEvent:t}),c)}),l},_replaceFileInput:function(t){var n=t.fileInput,i=n.clone(!0);t.fileInputClone=i,e("<form></form>").append(i)[0].reset(),n.after(i).detach(),e.cleanData(n.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===n[0]?i[0]:t}),n[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,n){var i,a=this,r=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t),r.resolve([e])},o=function(e){a._handleFileTreeEntries(e,n+t.name+"/").done(function(e){r.resolve(e)}).fail(s)},l=function(){i.readEntries(function(e){e.length?(c=c.concat(e),l()):o(c)},s)},c=[];return n=n||"",t.isFile?t._file?(t._file.relativePath=n,r.resolve(t._file)):t.file(function(e){e.relativePath=n,r.resolve(e)},s):t.isDirectory?(i=t.createReader(),l()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,n){var i=this;return e.when.apply(e,e.map(t,function(e){return i._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n,i,a=t.prop("webkitEntries")||t.prop("entries");if(a&&a.length)return this._handleFileTreeEntries(a);if(n=e.makeArray(t.prop("files")),n.length)void 0===n[0].name&&n[0].fileName&&e.each(n,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(i=t.prop("value"),!i)return e.Deferred().resolve([]).promise();n=[{name:i.replace(/^.*\\/,"")}]}return e.Deferred().resolve(n).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,i={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(a){i.files=a,n.options.replaceFileInput&&n._replaceFileInput(i),n._trigger("change",e.Event("change",{delegatedEvent:t}),i)!==!1&&n._onAdd(t,i)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,i={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&i.files.push(n)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),i)!==!1&&this._onAdd(t,i))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,i=t.dataTransfer,a={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){a.files=i,n._trigger("drop",e.Event("drop",{delegatedEvent:t}),a)!==!1&&n._onAdd(t,a)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,n){var i=-1!==e.inArray(t,this._specialOptions);i&&this._destroyEventHandlers(),this._super(t,n),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return"url"!==t&&"string"===e.type(n)&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,i=this.element.data();e.each(this.element[0].attributes,function(e,a){var r,s=a.name.toLowerCase();/^data-/.test(s)&&(s=s.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),r=i[s],t._isRegExpOption(s,r)&&(r=t._getRegExp(r)),n[s]=r)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n,i,a=this,r=e.Deferred(),s=r.promise();return s.abort=function(){return i=!0,n?n.abort():(r.reject(null,"abort","abort"),s)},this._getFileInputFiles(t.fileInput).always(function(e){if(!i){if(!e.length)return void r.reject();t.files=e,n=a._onSend(null,t),n.then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})}}),this._enhancePromise(s)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),define("components/requirejs-text/text!component/../../template/component/addcontactbox.tpl.html",[],function(){return'<!--\n  ~ Copyright (c) 2021 Mailtech.cn, Ltd. All Rights Reserved.\n  -->\n\n<div class="u-addcontactbox">\n  <div class="u-main-wrapper j-main-wrapper"></div>\n\n  {{#raw}}\n  <script id="maincontenttpl" type="text/x-handlebars-template">\n    <form name="contactInfo" action="#" enctype="multipart/form-data" id="contactInfo" >\n      <input type="hidden" name="hashId">\n\n      [[#each attrs]]\n      <div class="form-item-block">\n        [[#compare blockId \'==\' \'grp\']]\n        <div class="form-item j-groups u-groups [[#if_gt blockContent.checkedGroups.length compare=6]]u-groups-collapse[[/if_gt]]">\n          <div class="u-groups-detailed">\n            <label class="label">[[blockContent.label]]:</label>\n            [[#each blockContent.checkedGroups]]\n            <div class="input">\n              <input type="checkbox" name="groups[]" [[isChecked]] value="[[id]]" id="[[id]]">\n              <label for="[[id]]">[[name]]</label>\n            </div>\n            [[/each]]\n          </div>\n          [[#if_gt blockContent.checkedGroups.length compare=6]]\n          <div class="input">\n            <a href="javascript:void(0)" class="u-toggle-btn" data-operation="toggleGroups">\n              <span class="op-collapse">[[i18n "contact/op_collapse_groups"]]</span>\n              <span class="op-expand">[[i18n "contact/op_expand_groups"]]</span>\n            </a>\n          </div>\n          [[/if_gt]]\n        </div>\n        [[^]]\n        [[#each blockContent]]\n        <div class="form-item">\n          [[#compare id \'==\' \'FN\']]\n          <a href="javascript:void(0)" class="u-avatar" data-operation="modifyAvatar">\n            <img src="/coremail/XT5/796e441f/style/img/man.png" alt="avatar" class="j-avatar"/>\n          </a>\n          [[^]]\n          <label class="label">[[label]]:</label>\n          [[/compare]]\n          <div class="input">\n            <input type="text" class="u-input [[#compare id \'==\' \'BDAY\']]j-pickDate[[/compare]]" [[#compare id \'==\' \'FN\']]placeholder="{{i18n "contact/lbl_name"}}"[[/compare]] value="[[value]]" name="[[id]]"/>\n            [[#compare id \'==\' \'FN\']]\n            <label class="required">**</label>\n            <label class="error f-dn"></label>\n            [[/compare]]\n            [[#compare id \'==\' \'EMAIL;PREF\']]\n            <label class="icon-wrapper"><i class="iconfont iconadd" data-operation="addInput"></i></label>\n            <label class="error f-dn"></label>\n            [[/compare]]\n            [[#compare id \'==\' \'TEL;CELL;VOICE\']]\n            &nbsp;<label class="error f-dn"></label>\n            [[/compare]]\n            [[#contains id \'EMAIL;#\']]\n            <label class="icon-wrapper"><i class="iconfont iconremove" data-operation="removeInput"></i></label>\n            <label class="error f-dn"></label>\n            [[/contains]]\n          </div>\n        </div>\n        [[/each]]\n        [[/compare]]\n      </div>\n      [[/each]]\n    </form>\n  </script>\n\n  <script type="text/x-handlebar-template" id="avatarContainer">\n    <div class="u-avatar-dialog">\n      <form>\n        <div class="avt-tips">{{i18n "contact/lbl_uploadAvatarTips"}}</div>\n        <div class="avt-content">\n          <div class="cnt-cropper j-wrapper">\n          </div>\n          <div class="cnt-preview">\n            <div class="u-btn u-btn-primary">\n              <span>{{i18n "contact/lbl_selectLocalImage"}}</span>\n              <input type="file" id="avatarInput" name="signImgFile" class="avt-upload"/>\n            </div>\n            <div class="avt-preview j-preview">\n              <img alt="avatar" src="[[avatar]]"/>\n            </div>\n          </div>\n        </div>\n        <div class="avt-size">\n          {{i18n "contact/lbl_uploadAvatarButtonTips"}}\n        </div>\n        <div class="err-msg-wrapper">\n          <p class="j-err-msg"></p>\n        </div>\n      </form>\n    </div>\n  </script>\n\n  <script type="text/x-handlebars-template" id="addInputTpl">\n    <div class="form-item">\n      <label class="label">[[label]]:</label>\n      <div class="input">\n        <input type="text" class="u-input" name="[[id]]">\n        <label class="icon-wrapper"><i class="iconfont iconremove" data-operation="removeInput"></i></label>\n        <label class="error f-dn"></label>\n      </div>\n    </div>\n  </script>\n  {{/raw}}\n</div>'}),define("module/contact/pab/service",["require","jquery.iframeTransport","jquery","util/index","module/contact/service","module/common/globalService"],function(e){function t(e){var t=_.Deferred();return e.isCreate="boolean"===_.type(e.isCreate)?e.isCreate:!1,e.isCreate?(t.resolve({}),t.promise()):(b.getPabAttrs(e.ids).then(function(e){e=b.filterPabContacts(e),t.resolve(e[0])}),t.promise())}function n(e){var t=_.Deferred();return y.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:y.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab:deleteGroup",sid:w.getSid()}}),data:"groupid="+e,onlyVar:!1},function(){t.resolve()}),t.promise()}function i(e){var t=_.Deferred();return y.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:y.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab:cleanGroup",sid:w.getSid()}}),data:"groupid="+e,onlyVar:!1},function(){t.resolve()}),t.promise()}function a(e,t){var n=_.Deferred();return y.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:y.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab:renameGroup",sid:w.getSid()}}),data:"groupid="+e+"&groupname="+t,onlyVar:!1},function(){n.resolve()}),n.promise()}function r(e){var t=_.Deferred(),n={};return b.getAllPabContacts({groups:e.groups,returnAttrs:["id","FN","EMAIL;PREF"]}).then(function(e){e=e||[],_.each(e,function(e,t){t.emailaddr=t["EMAIL;PREF"]}),n.contacts=e,t.resolve(n)}),t.promise()}function s(e){var t=_.Deferred();return y.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:y.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab:addToGroup",sid:w.getSid()}}),data:_.param(e),onlyVar:!1},function(){t.resolve()}),t.promise()}function o(e){var t=_.Deferred();return y.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:y.xhr.getRequestURL({url:"/XT5/jsp/contact.jsp",query:{func:"pab:moveToGroup",sid:w.getSid()}}),data:_.param(e),onlyVar:!1},function(){t.resolve()}),t.promise()}function l(e){var t=_.Deferred();return y.xhr.simpleCall({query:{func:"pab:getContactKeys",sid:w.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function c(e){var t,n,i,a=_.Deferred(),r=y.detector.supportAjaxUpload();return t={url:y.xhr.getFullRequestURL({url:"/XT5/jsp/mformdata.jsp",query:{func:"pab:addContactKeyStd",sid:w.getSid()}}),type:"post",processData:!1,contentType:!1},r?(n=new FormData,n.append("publicKeyFile",e[0].files[0]),t.data=n):(t.files=e,t.useiframe=!0),_.ajax(t).complete(function(e){i=JSON.parse(e.responseText),a.resolve(i)}).fail(function(){a.reject()}),a.promise()}function d(e){var t=_.Deferred();return y.xhr.simpleCall({query:{func:"pab:saveContactKey",sid:w.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function u(e){var t=_.Deferred();return y.xhr.simpleCall({query:{func:"pab:deleteContactKey",sid:w.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function p(e){var t=_.Deferred();return y.xhr.simpleCall({query:{func:"pab:setContactDefaultKey",sid:w.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function h(e){var t=_.Deferred();return y.xhr.simpleCall({query:{func:"pab:getContactSingleKeyContent",sid:w.getSid()},data:e},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function f(e){var t=_.Deferred();return y.xhr.simpleCall({query:{func:"pab:deleteContacts",sid:w.getSid()},data:{ids:e||[]}},function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise()}function m(e){var t=_.Deferred();return y.xhr.simpleCall({query:{func:"pab:updateAllGroups",sid:w.getSid()},data:e},function(){t.resolve()},function(){t.reject()}),t.promise()}function g(e,t,n){var i=_.Deferred(),a={};return _.extend(a,{url:y.xhr.getFullRequestURL({url:"/XT5/jsp/mformdata.jsp",query:_.extend({func:"pab:importContacts",sid:w.getSid()},n)}),type:"post",processData:!1,contentType:!1,useiframe:!0,files:t,data:e}),_.ajax(a).complete(function(e){i.resolve(window.JSON.parse(e.responseText))}).fail(function(){i.reject()}),i.promise()}function v(e){var t=_.Deferred();return e.imgData?y.xhr.simpleCall({query:{func:"pab:addContactAvatar",sid:w.getSid()},data:e,onlyVar:!1,preprocess:!1},function(e){t.resolve(e)},function(){t.reject()}):_.ajax({url:y.xhr.getFullRequestURL({url:"/XT5/jsp/mformdata.jsp",query:{func:"pab:addContactAvatarStd",sid:w.getSid(),uid:e.uid}}),type:"post",files:e.file,iframe:!0,contentType:!1}).complete(function(e){t.resolve(window.JSON.parse(e.responseText))}).fail(function(){t.reject()}),t.promise()}e("jquery.iframeTransport");var _=e("jquery"),y=e("util/index"),b=e("module/contact/service"),w=e("module/common/globalService");return{executeCreateOrEditContact:t,deleteGroup:n,cleanGroup:i,renameGroup:a,executeEditGroup:r,addToGroup:s,moveToGroup:o,importContacts:g,updateAllGroups:m,deleteContacts:f,addContactAvatar:v,getContactKeys:l,saveContactKey:d,deleteContactKey:u,setContactDefaultKey:p,addContactKeyStd:c,getContactSingleKeyContent:h}}),define("module/contact/contactBase",["require","jquery","util/email"],function(e){function t(e){return!!(e||"").match(/^\+?[-#0-9.( )]*$/)}function n(e){var t=[];return e&&0!==r.trim(e).length||t.push({name:"FN",index:0,causes:"nameEmpty"}),t}function i(e){return t(e)?[]:[{name:"TEL;CELL;VOICE",index:0,causes:"onlyNumber"}]}function a(e,t){var n,i,a=[],o=[],l=t||[];return l.unshift(e||""),r.each(l,function(e,t){n=!0,t?1!==s.parse(t).length?i="emailExceed":s.test(t)?-1!==r.inArray(t,a)?i="emailDuplicate":n=!1:i="emailFormat":n=!1,n?o.push({name:0===e?"EMAIL;PREF":"EMAIL;#[]",index:0===e?e:e-1,causes:i}):t&&a.push(t)}),o}var r=e("jquery"),s=e("util/email");return{checkName:n,checkPhone:i,checkEmail:a}}),define("component/addcontactbox",["require","i18n!contact,mail,common,pab","jquery.datepicker","jquery.imageCropper","components/jquery-file-upload/js/jquery.fileupload","text!../../template/component/addcontactbox.tpl.html","jquery","util/i18n","util/detector","util/url","../util/file","cui/util/templatable/templatable","cui/ui/dialog/confirmbox","util/messageformat","../configstore","module/contact/service","module/contact/pab/service","module/contact/contactBase"],function(e){function t(){return s.supportBlobURL()&&s.supportAjaxUpload()}function n(e,t){return-1!==a.inArray(t,e)}e("i18n!contact,mail,common,pab"),e("jquery.datepicker"),e("jquery.imageCropper"),e("components/jquery-file-upload/js/jquery.fileupload");var i=e("text!../../template/component/addcontactbox.tpl.html"),a=e("jquery"),r=e("util/i18n"),s=e("util/detector"),o=e("util/url").addUrlParams,l=e("../util/file").isAllowableUploadImage,c=e("cui/util/templatable/templatable"),d=e("cui/ui/dialog/confirmbox"),u=e("util/messageformat"),p=e("../configstore"),h=e("module/contact/service"),f=e("module/contact/pab/service"),m=e("module/contact/contactBase"),g=d.extend({attrs:{width:600,subClass:"acb-wrapper",title:r.t("contact/lbl_addContact"),confirmTpl:r.t("common/confirm"),cancelTpl:r.t("common/cancel"),message:c.compile(i,{}),data:{},saved:null,onConfirm:function(){var e=this,t=e.get("saved"),n=e.$('form[name="contactInfo"]').serializeJSON({parseBooleans:!0}),i=n["EMAIL;#"],s=m.checkName(n.FN),o=m.checkEmail(n["EMAIL;PREF"],i),l=m.checkPhone(n["TEL;CELL;VOICE"]),c=s.concat(o,l);return e.trigger("restoreInputError"),0!==c.length?(e.trigger("showInputError",c),!1):(n["EMAIL;#"]=i?i.join(","):"",h.createOrEditPabContact(n).then(function(n){a.notify(u.format(r.t("pab/ok_add"),n.FN)),e.hide(),t&&t(n)},function(e){d.alert(e)}),!1)}},events:{"click [data-operation]":"dispatchOperation","change #avatarInput":"uploadAvatar"},render:function(){function e(e){return a.map(a.grep(e,function(e){return"groups"!==e&&"EMAIL;#"!==e}),function(e){return{id:e,label:o[e],value:u[e]}})}function t(){i.element.on("focus",".j-pickDate",function(){a(this).datepicker()}).on("click","i.ckeckbox",function(){a(this).prev().prop("checked",a(this).hasClass("checkbox-checked"))}),i.on("restoreInputError",function(){i.$("#contactInfo .error").html("").addClass("f-dn")}).on("showInputError",function(e){a.each(e,function(e,t){var n=r.t("contact/lbl_"+t.causes+"Error"),a='#contactInfo [name="'+t.name+'"]:eq('+t.index+")";i.$(a).siblings(".error").html(n).removeClass("f-dn")})})}g.superclass.render.call(this);var i=this,s=p.getConfig("contact.pab"),o=s.schema,l=s.editfieldsbase,c=s.editfieldsopt,d=s.editfieldsadv,u=i.get("data");h.getAllPabGroups().then(function(s){i.$(".j-main-wrapper").html(i.compile(i.$("#maincontenttpl").html(),{attrs:a.grep([{blockId:"base",blockContent:e(l),blockName:r.t("contact/lbl_basic")},(n(l,"groups")||n(c,"groups")||n(d,"groups"))&&{blockId:"grp",blockContent:{label:o.groups,checkedGroups:s},blockName:r.t("contact/lbl_group_info")},{blockId:"opt",blockContent:e(c),blockName:r.t("contact/lbl_contact_info")},{blockId:"adv",blockContent:e(d),blockName:r.t("contact/lbl_extraInfo")}],function(e){return e})})),i.element&&i.element.customRadioCheckbox(),t()})},dispatchOperation:function(e,t){var n=this;switch(a(t).data("operation")){case"modifyAvatar":n.handleModifyAvatar();break;case"addInput":var i=n.compile(n.$("#addInputTpl").html(),{id:"EMAIL;#[]",label:p.getConfig("contact.pab.schema")["EMAIL;PREF"]});a(t).closest(".form-item-block").append(i);break;case"removeInput":a(t).closest(".form-item").remove();break;case"toggleGroups":n.$(".j-groups").toggleClass("u-groups-collapse")}},uploadAvatar:function(e,n){function i(){return c.$(".j-err-msg").text(r.t("contact/msg_invalidImageType"))}function s(e){var t=a('<img src="'+e+'"/>');a(".acb-wrapper div.j-wrapper").empty().html(t),t.cropper({aspectRatio:1,preview:a(".acb-wrapper div.j-preview").selector,minContainerWidth:200,minContainerHeight:200,zoomable:!1})}var c=this;if(t()){var d=a(n).prop("files");if(d.length>0){var u=d[0];l(u)?(a("#avatar-tips").empty(),s(window.URL.createObjectURL(u))):i()}}else{if(!l(a(n).val()))return i(),!1;var p=c.$('#contactInfo [name="id"]').val()||"-1";f.addContactAvatar({uid:p,file:c.$("#avatarInput")}).then(function(e){0===e.code.indexOf("FA_")?"FA_ATTR_SIZE_EXCEEDED"===e.code||"FA_FILE_SIZE_EXCEEDED"===e.code||"FA_OVERFLOW"===e.code?a.notify(r.t("error/"+e.code)):a.notify(r.t("common/FA_OTHER_CODE",{code:e.code})):(a.notify(r.t("contact/msg_successfullySaveAvatar")),c.$("div.j-preview img").attr("src",o("pab:getContactAvatar",{uid:p,time:(new Date).getTime()})))})}},handleModifyAvatar:function(){var e=this,n=e.$("img.j-avatar"),i=n.attr("src"),s=e.compile(e.$("#avatarContainer").html(),{avatar:i});d.confirm(s,function(){if(t()){var s=a("div.j-wrapper > img").cropper("getCroppedCanvas",{
width:132,height:132});if(!s.toDataURL)return!0;var o=s.toDataURL("image/jpeg");o.length>0&&i!==o&&f.addContactAvatar({uid:"-1",imgData:o}).then(function(t){var i=t["var"];"S_OK"===t.code?(a.notify(r.t("contact/msg_successfullySaveAvatar")),n.attr("src",o),i.hashId&&e.$('[name="contactInfo"] [name="hashId"]').val(i.hashId)):"FA_ATTR_SIZE_EXCEEDED"===t.code||"FA_FILE_SIZE_EXCEEDED"===t.code||"FA_OVERFLOW"===t.code?a.notify(r.t("error/"+t.code)):a.notify(r.t("common/FA_OTHER_CODE",{code:t.code}))})}else n.attr("src",e.$("div.j-preview img").attr("src"))},a.noop(),{title:r.t("contact/lbl_uploadAvatarInit"),effect:"fade",parentNode:".acb-wrapper",subClass:"avatar-upload-box"})}});return function(e,t){return new g({data:e,saved:t}).show()}}),define("component/contactcard",["require","i18n!mail,mbox,main,faces","text!../../template/component/contactcard.tpl.html","jquery","../util/index","cui/ui/tip/tip","component/confirmbox","cui/util/templatable/templatable","../module/common/globalService","../module/contact/service","../module/mail/service","../util/email","./addcontactbox"],function(e){e("i18n!mail,mbox,main,faces");var t=e("text!../../template/component/contactcard.tpl.html"),n=e("jquery"),i=e("../util/index"),a=e("cui/ui/tip/tip"),r=e("component/confirmbox"),s=e("cui/util/templatable/templatable"),o=e("../module/common/globalService"),l=e("../module/contact/service"),c=e("../module/mail/service"),d=e("../util/email"),u=e("./addcontactbox"),p=a.extend({propsInAttrs:["parent","emailAddress"],attrs:{parent:null,arrowPosition:11,theme:"white",distance:0,delay:200,effect:"fade",emailAddress:null},cachedData:{},events:{"click .j-op-contact":"_handleOpContact"},setup:function(){var e=this;p.superclass.setup.call(e),e._initConfig(),e._initTemplateHelpers(),e.before("show",function(){return e.get("trigger").is(":visible")&&(e.config.supportPab||e.config.supportOab)?(e.set("disabled",!1),void(n.isEmptyObject(e.cachedData)&&e._getContactData().then(function(i){e.cachedData=i;var a=n.extend({},{config:e.config,emailAddress:e.emailAddress},i);e.set("content",s.compile(t,a)),e._initDropDown()}))):(e.set("disabled",!0),!1)}),e.after("hide",function(){e.$('[role="dropdown"]').each(function(){n(this).dropdown("hide")})})},render:function(){p.superclass.render.call(this)},_initConfig:function(){this.config={supportPab:o.getConfig("user.supportpab"),supportOab:o.getConfig("user.supportoab"),enableSendMail:o.getConfig("mail.enablesendmail"),enableSecurityLevel:o.getConfig("user.enablesecuritylevel"),allEmails:o.getConfig("user.allemails")},n.extend(!0,this.config,this.parent.config)},_initTemplateHelpers:function(){s.templateHelpers={translateSL:function(e,t){return i.securityLevel.i18n(e,t)}}},destroy:function(){p.superclass.destroy.call(this)},_getContactData:function(){function e(){var e=n.Deferred();return l.quickSearchOabContacts({keyword:c,limit:100}).then(function(t){var i="";n.each(t,function(e,t){return t.email===c?(i=t.id,!1):void 0}),i=i||c,l.getOabAttrs(i,u).then(function(t){e.resolve(t)},function(){e.resolve(void 0)})},function(){e.resolve(void 0)}),e.promise()}var t,i,a,r=n.Deferred(),s=this,c=s.emailAddress,d={contactInPab:!1,contactInOab:!1,currentUser:o.getUser().email===s.emailAddress},u=["true_name","@ou","email","@location","@id"];return c||r.resolve(null),s.config.enableSecurityLevel&&u.push("sender_security_level","security_level"),t=[{field:"EMAIL;PREF",operator:"=",operand:c}],i=s.config.supportPab?l.getAllPabContacts({condictions:t}):n.noop(),a=s.config.supportOab?e():n.noop(),n.when(i,a).always(function(e,t){n.isArray(e)&&0!==e.length&&(d.contactInPab=!0,n.extend(d,e[0])),t&&t[0]&&(n.extend(d,t[0]),c!==d.email&&(d.mainEmailAddress=d.email),d.contactInOab=!0),d.location=d["@location"]||"",d.currentUser&&(d.true_name=o.getUser().true_name),d.contactInOab||d.contactInPab?l.getContactAvatar(d.contactInOab?"oab":"pab",c).always(function(e){d.avatarUrl=n.isArray(e)?e[0].avatarUrl:"796e441f/style/img/man.png",r.resolve(d)}):r.resolve(d)}),r.promise()},_initDropDown:function(){var e=this,t=c.getToolbarMenu("mail.menu.contact-more"),i=e._formatMoreMenu(t);e.$("[data-dropdown]").not('[role="dropdown"]').each(function(){n(this).dropdown({data:i,parent:n(this),callback:function(t){var n=t.value;e.hide(),e._handleContact(n)}})})},_formatMoreMenu:function(e){e=e||{};var t=this,i={};return n.each(e,function(e,n){switch(e){case"send":t.config.enableSendMail&&(i[e]=n);break;default:i[e]=n}}),i},_handleOpContact:function(e,t){var n=this.$(t).attr("role");this.hide(),this._handleContact(n)},_handleContact:function(e){var t=this;switch(e){case"viewPab":t._handleGoToContacts(e);break;case"viewOab":t._handleGoToContacts(e);break;case"addToAddressbook":t._handleAddToAddressbook();break;case"dealings":t._handleListMail();break;case"editPab":t._handleGoToContacts(e);break;case"send":t._handleComposeMail();break;case"reject":t._handleRejectMail();break;case"addtosafelist":t._handleSaveToListInfo("safelist");break;case"setting":t.parent.sendMessage("dispatcher","history:add",{module:"setting.account.personal",param:{}});break;case"logout":t._handleUserLogout()}},_handleGoToContacts:function(e){var t,n,a=this,r=a.cachedData;t={editPab:{module:"contact.pab",param:{type:"edit",id:r.id}},viewPab:{module:"contact.pab",param:{type:"detail",id:r.id}},viewOab:{module:"contact.oab",param:{type:"detail",id:r["@id"],cid:r["@ou"]}}},n=t[e],a.parent.sendMessage("dispatcher","history:add",n),i.detector.isDetachMode()&&location.reload()},_handleAddToAddressbook:function(){var e=this,t=e.cachedData.true_name,a=e.emailAddress;l.getPabContactsByEmail(a).then(function(r){r[0]?n.notify.warning(i.messageFormat.format(i18n.t("common/aready_exists_address"),new d(t,a))):u({"EMAIL;PREF":a,FN:t||a.split("@")[0]},function(){e.parent.trigger("view:active")})})},_handleListMail:function(){var e=this,t=e.cachedData.currentUser?{type:"FULL",pattern:e.emailAddress}:{dealings:e.emailAddress};t.vid="search",e.parent.sendMessage("dispatcher","history:add",{module:"mail.search",param:t})},_handleComposeMail:function(){var e=this;i.detector.isDetachMode()?(c.getComposeInfo({ctype:"normal",to:e.emailAddress}).then(function(t){e.parent.sendMessage("dispatcher","history:add",{module:"mail.compose",param:{id:t.id}})}),location.reload()):c.getComposeInfo({ctype:"normal",to:e.emailAddress}).then(function(t){e.parent.sendMessage("mail","view:change",{module:"mail.compose",param:{id:t.id}})})},_handleRejectMail:function(){var e=this;e.rejectBox?e.rejectBox.show():e.rejectBox=new r({parentNode:e.parent.element,title:i.i18n.t("main/sys_info"),message:i.i18n.t("mail/msg_confirm_reject_mail"),onConfirm:function(){e._handleSaveToListInfo("refuselist"),this.hide()}}).show()},_handleSaveToListInfo:function(e){var t,a=this,r={},s=o.getUser(),l=s.refuselist?s.refuselist.replace(/, /g,",").split(","):[],c=s.safelist?s.safelist.replace(/, /g,",").split(","):[],d=s[e]?s[e].split(","):[],u=!1,p=!1,h=a.emailAddress,f=!1;if("refuselist"===e&&(t=a.config.allEmails||[],n.each(t,function(e,t){return t.addr===h?(f=!0,!1):void 0}),f))return void n.notify.warning(i.i18n.t("mbox/reject_by_mailfrom_fail"));if(h){if(u=-1!==n.inArray(h,l),p=-1!==n.inArray(h,c),u)return n.notify.warning(i.i18n.t("mail/msg_errMailExistInBlackList").replace("{0}",h)),!1;if(p)return n.notify.warning(i.i18n.t("mail/msg_errMailExistInWhiteList").replace("{0}",h)),!1;d.push(h),r[e]=d.join(","),o.updateUser(r,!0).then(function(){n.notify.success("refuselist"===e?i.i18n.t("mbox/reject_by_mailfrom_succeed"):i.i18n.t("mbox/addToSafeList_succeed")),a.parent.sendMessage("refuselist"===e?"setting.security.blacklist":"setting.security.whitelist","list:reload")})}},_handleUserLogout:function(){o.logoutUser().then(function(e){var t=e.startReferer,n="/"===t[0];window.location.href=n?CC.path(t):t})}});return p}),define("components/requirejs-text/text!component/../../template/component/sspurl.tpl.html",[],function(){return'<div class="sspurl-container">\r\n    <h3>{{i18n \'mail/msg_sspurl_tips\'}}</h3>\r\n    <p>{{gourl}}</p>\r\n    <p class="tip">{{i18n \'mail/msg_sspurl_advice\'}}</p>\r\n    <div class="more" id="more">\r\n        <a href="javascript:void(0)" class="link">\r\n            {{i18n \'mail/op_sspurl_toggle\'}}<span class="arrow arrow-down"/>\r\n        </a>\r\n        <div class="detail"> {{i18n \'mail/msg_sspurl_detail\'}}</div>\r\n    </div>\r\n</div>'}),define("component/sspurl",["require","i18n!mbox,mail","text!../../template/component/sspurl.tpl.html","jquery","../util/index","cui/util/templatable/templatable","cui/ui/dialog/confirmbox"],function(e){e("i18n!mbox,mail");var t=e("text!../../template/component/sspurl.tpl.html"),n=e("jquery"),i=e("../util/index"),a=e("cui/util/templatable/templatable"),r=e("cui/ui/dialog/confirmbox"),s=r.extend({Implements:a,attrs:{width:550,title:i.i18n.t("main/sys_info"),message:"",confirmTpl:i.i18n.t("mail/op_sspurl_continue"),cancelTpl:i.i18n.t("common/cancel")},events:{"click #more .link":function(e,t){var i=n(t).next(".detail"),a=n(t).find(".arrow");i.is(":visible")?(a.addClass("arrow-down").removeClass("arrow-up"),i.slideUp()):(a.addClass("arrow-up").removeClass("arrow-down"),i.slideDown())}},setup:function(){var e=this;s.superclass.setup.call(this),e.show().set("message",e.compile(t,{gourl:e.get("gourl")})),e.on("confirm",function(){e.hide(),window.open(e.get("gourl"))})},render:function(){s.superclass.render.call(this)},destroy:function(){s.superclass.destroy.call(this)}});return s}),function(){define("component/notification/service",["require","exports","module","jquery","../../util/index","module/common/globalService"],function(e,t,n){function i(e){var t=r.Deferred();return e.key&&null!=e.key.beginid||i.notSupportMQ!==!0?(s.xhr.simpleCall({query:{func:"mq:historyQuery",sid:o.getSid()},data:e,onlyVar:!1},function(e){t.resolve(e["var"],e.total,e.lastId)},function(e,n,a){a&&"FA_MQ_NOT_SUPPORTED"===a.code?(i.notSupportMQ=!0,t.resolve([],0,null)):t.reject("query history message failed.")}),t.promise()):t.resolve([],0,null)}function a(e){var t=r.Deferred();return null==e?t.reject("invalid parameters"):i.notSupportMQ===!0?t.reject("history set last id failed."):(s.xhr.simpleCall({query:{func:"mq:historySetLastId",sid:o.getSid()},data:{lastId:e}},function(n){a.lastId=e,t.resolve(n)},function(){t.reject("history set last id failed.")}),t.promise())}var r=e("jquery"),s=e("../../util/index"),o=e("module/common/globalService");n.exports={historyQuery:i,historySetLastId:a}})}(),define("components/requirejs-text/text!template/component/notificationHistory.tpl.html",[],function(){return'<div class="c-notification-history" tabindex="-1">\r\n  <div class="history-wrapper">\r\n    <ul class="history-list j-history-list u-scroll"></ul>\r\n  </div>\r\n\r\n  {{#raw}}\r\n  <script type="x-handlebars-template" id="msgItemTpl">\r\n    <li class="msg-item j-msg-item [[#if clickable]]clickable[[/if]]" data-id="[[id]]">\r\n      <div class="msg-item-icon [[uiInfo.bgClass]]">\r\n        <i class="iconfont [[uiInfo.iconClass]]"></i>\r\n      </div>\r\n      <div class="msg-item-content">\r\n        <p class="title">[[title]]<span class="time">[[time]]</span></p>\r\n        <p class="brief">[[brief]]</p>\r\n      </div>\r\n    </li>\r\n  </script>\r\n  <script type="x-handlebars-template" id="EmptyTpl">\r\n    <li class="msg-item history-empty j-history-empty">\r\n      <div class="msg-item-icon bg-default">\r\n        <i class="iconfont iconinfo"></i>\r\n      </div>\r\n      <div class="msg-item-content">\r\n        {{ i18n "common/lbl_notification_history_empty" }}\r\n      </div>\r\n    </li>\r\n  </script>\r\n  <script type="x-handlebars-template" id="NewTipTpl">\r\n  <div class="msg-new-tip j-msg-new-tip">\r\n    <span>{{i18n "common/lbl_notification_history_new_tip"}}</span>\r\n    <a href="javascript:void(0);" class="j-msg-load-new" data-action="loadNew">[{{i18n "common/lbl_notification_history_new_tip_load"}}]</a>\r\n  </div>\r\n  </script>\r\n  <script type="x-handlebars-template" id="ListEndTpl">\r\n    <li class="msg-item history-end j-history-end">\r\n      {{i18n "common/lbl_notification_history_end"}}\r\n    </li>\r\n  </script>\r\n  {{/raw}}\r\n</div>'}),function(){define("component/notification/history",["require","exports","module","i18n!main,common","jquery","handlebars","moment","cui/ui/tip/tip","../wsStore","./service","./store","text!../../template/component/notificationHistory.tpl.html"],function(e,t,n){e("i18n!main,common");var i=e("jquery"),a=e("handlebars"),r=e("moment"),s=e("cui/ui/tip/tip"),o=e("../wsStore"),l=e("./service"),c=e("./store"),d=e("text!../../template/component/notificationHistory.tpl.html"),u={_uid:0,list:{unread:[],read:[],unMergeRead:[]},prepend:function(e){return this._doAddMsgs(e,!0),this.getLength()},append:function(e){return this._doAddMsgs(e),this.getLength()},_doAddMsgs:function(e,t){var n=this,a=[];return i.isArray(e)?i.each(e,function(e,t){null!=t.id&&(n.format(t),a.push(t))}):(this.format(e),a.push(e)),a.length?void(t===!0?this.list.unread=a.concat(this.list.unread):this.list.unMergeRead=this.list.unMergeRead.concat(a)):!1},format:function(e){var t=e.type;return e.id=parseInt(e.id,10),isNaN(e.id)?e:(e.uid=++this._uid,e.time=e.time||r().format("YYYY-MM-DD HH:mm:SS"),e.formatted=c.createObj(c.MsgInfoProtos[c.classifyMsgType(t)+"Proto"]),void e.formatted.init(e))},getItemById:function(e){function t(t){for(var n,i=0;i<t.length;++i)if(n=t[i],n.id===e)return n;return!1}var n=this.list;return e=parseInt(e,10),isNaN(e)?null:t(n.unread)||t(n.read)||t(n.unMergeRead)||null},getLength:function(){var e=this.list;return e.unMergeRead.length+e.read.length+e.unread.length},exportUnread:function(){var e=this.list.unread.splice(0,this.list.unread.length);return this.list.read=e.concat(this.list.read),e},exportUnMergeRead:function(){var e=this.list.unMergeRead.splice(0,this.list.unMergeRead.length);return this.list.read=this.list.read.concat(e),e},getUnreadBeginId:function(){return this.list.unread.length?this.list.unread[0].id:!1},getReadBeginId:function(){return this.list.read.length?this.list.read[0].id:this.list.unMergeRead.length?this.list.unMergeRead[0].id:!1},getBeginId:function(){return this.getUnreadBeginId()||this.getReadBeginId()},getUnreadEndId:function(){var e=this.list.unread.length;return e?this.list.unread[e-1].id:!1},getReadEndId:function(){var e,t;return(t=this.list.unMergeRead.length)?this.list.unMergeRead[t-1].id:(e=this.list.read.length)?this.list.read[e-1].id:!1},getEndId:function(){return this.getReadEndId()||this.getUnreadEndId()},cleanUnread:function(){return this.list.unread=[],this},cleanRead:function(){return this.list.read=[],this.list.unMergeRead=[],this},clean:function(){this.cleanUnread().cleanRead()}},p=s.extend({unReadClass:"unread",$msgList:null,msgItemTpl:null,msgEmptyTpl:null,msgNewTipTpl:null,listEndTpl:null,cancelObservers:null,queryLimit:20,attrs:{maxHeight:600,width:360,triggerType:"click",content:a.compile(d)(),inViewport:!0,arrowPosition:1,rendered:!1},events:{"click .j-msg-load-new":"_renderNewerHistory","click .j-msg-item.clickable":"_handleMsgItemClick"},setup:function(){p.superclass.setup.call(this),this._initOnlineMsgObserve(),this.after("render",function(){this.set("rendered",!0),this.element.addClass("c-notification-history-poptip"),this.$msgList=this.$(".j-history-list"),this.msgItemTpl=this.$("#msgItemTpl"),this.msgEmptyTpl=this.$("#EmptyTpl"),this.msgNewTipTpl=this.$("#NewTipTpl"),this.listEndTpl=this.$("#ListEndTpl"),this.$msgList.css("maxHeight",this.get("maxHeight")||600),this._initScrollEvent(),setTimeout(i.proxy(function(){this._initWrapScroll()},this),300)}),this.after("show",function(){this._renderNewerHistory()})},destroy:function(){this._destroyOnlineMsgObserve(),this._offScrollEvent(),this.hide(),this.$msgList=null,u.clean(),p.superclass.destroy.call(this)},_initOnlineMsgObserve:function(){function e(){t.get("rendered")&&t._toggleNewTip(!0),t._toggleTriggerUnread(!0)}var t=this;this.cancelObservers=[],this.cancelObservers.push(o.subscribe(o.topicList.IN_AUTO_FWD,e)),this.cancelObservers.push(o.subscribe(o.topicList.IN_AUTO_REPLY,e)),this.cancelObservers.push(o.subscribe(o.topicList.OUT_DS,e)),this.cancelObservers.push(o.subscribe(o.topicList.OUT_READ,e)),this.cancelObservers.push(o.subscribe(o.topicList.MAIL_QUOTA,e)),this.cancelObservers.push(o.subscribe(o.topicList.OFFSITE_REMIND,e)),this.cancelObservers.push(o.subscribe(o.topicList.MEETING_NEW,e)),this.cancelObservers.push(o.subscribe(o.topicList.MEETING_REQUEST,e))},_destroyOnlineMsgObserve:function(){null!=this.cancelObservers&&(i.each(this.cancelObservers,function(e,t){null!=t&&t()}),this.cancelObservers=null)},initHistorySet:function(e){var t=this;i.isFunction(e)||(e=null),l.historyQuery({key:{},limit:this.queryLimit}).then(function(n){return u.prepend(n),null!=e?e(null,n):(n.length&&t._toggleTriggerUnread(!0),void t._fetchOlderHistory(e))},function(){null!=e&&e("query history failed")})},_fetchNewerHistory:function(e){var t=u.getBeginId(),n={key:{}};t!==!1&&(n.key.beginid=t+1),l.historyQuery(n).then(function(t){u.prepend(t),e(null)},function(){e("fetch newer history failed")})},_fetchOlderHistory:function(e){var t=u.getEndId(),n={key:{beginid:""},limit:this.queryLimit};t!==!1&&(n.key.endid=t-1),e=i.isFunction(e)?e:i.noop,l.historyQuery(n).then(function(t,n){u.append(t),e(null,n)},function(){e("fetch older history failed")})},_toggleHistoryEmpty:function(e){e===!0?this.$msgList.html(this.msgEmptyTpl.html()):this.$msgList.find(".j-history-empty").remove()},_toggleNewTip:function(e){e===!0?this.$(".j-msg-new-tip").length||this.$msgList.before(this.msgNewTipTpl.html()):this.$(".j-msg-new-tip").remove()},_toggleTriggerUnread:function(e){var t=this.get("trigger");e===!0?t&&t.addClass(this.unReadClass):t&&t.removeClass(this.unReadClass)},_renderHistoryEnd:function(){this.$msgList.find(".j-history-end").remove(),this.$msgList.append(a.compile(this.listEndTpl.html())())},_renderMsgSet:function(e,t){var n,a=this.$msgList,r=[];if(!u.getLength())return this._toggleHistoryEmpty(!0);this._toggleHistoryEmpty(),n=t===!0?"prepend":"append",i.isArray(e)||(e=[e]);for(var s=0;s<e.length;++s)r.push(this._compileMsgItem(e[s]));a[n](r.join(""))},_compileMsgItem:function(e){var t=e.formatted;return a.compile(this.msgItemTpl.html())({id:e.id,time:e.time||"",uiInfo:t.uiInfo,title:t.exportTitle(),brief:t.exportContent(),clickable:!!t.handleDetail})},_initScrollEvent:function(){return this.$msgList.on("scroll",i.proxy(this._handleWrapScroll,this)),this},_offScrollEvent:function(){return this.$msgList&&this.$msgList.off("scroll"),this},_checkMsgListScrollToBottom:function(){var e=this.$msgList;return e[0].scrollHeight-e.scrollTop()-e.outerHeight()<20},_initWrapScroll:function(){var e=this;this._checkMsgListScrollToBottom()&&this._renderOlderHistory(function(t,n){return t?console.log(t):void(n?e._initWrapScroll():u.getLength()&&e._renderHistoryEnd())})},_handleWrapScroll:function(){var e=this;clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(function(){e._checkMsgListScrollToBottom()&&(e._offScrollEvent(),e._handleScrollToBt())},300)},_renderOlderHistory:function(e){var t=this;e=i.isFunction(e)?e:i.noop,this._fetchOlderHistory(function(n,i){return n?e(n):(i&&t._renderMsgSet(u.exportUnMergeRead()),void e(null,i))})},_renderNewerHistory:function(){var e,t=this,n=l.historySetLastId.lastId,i=function(e){e&&console.log(e),t.set("visible",!0),t._toggleTriggerUnread(),t._renderMsgSet(u.exportUnread(),!0),t._renderMsgSet(u.exportUnMergeRead()),t._setAlign()};this._toggleNewTip(),this._fetchNewerHistory(function(){e=u.getBeginId(),e!==!1&&(null==n||e>n)?l.historySetLastId(e).then(function(){i()},function(e){i(e)}):i()})},_handleScrollToBt:function(){var e=this;this._renderOlderHistory(function(t,n){return t?console.log(t):void(n?e._offScrollEvent()._initScrollEvent():(e._renderHistoryEnd(),e._offScrollEvent()))})},_handleMsgItemClick:function(e){var t,n=i(e.currentTarget);return e.preventDefault(),n.hasClass("clickable")?(t=u.getItemById(n.attr("data-id")),null==t?!1:void(t.formatted&&i.isFunction(t.formatted.handleDetail)&&t.formatted.handleDetail())):!1}}),h={_historyView:null,init:function(e){e=e instanceof i?e:i(e),h._historyView=new p({trigger:e}),h._historyView.initHistorySet()},destroy:function(){h._historyView&&h._historyView.destroy()}};n.exports=h})}(),define("module/layout/index",["require","i18n!main,common","jquery","cui/core/view/view","cui/util/templatable/templatable","cui/core/view/viewmanager","cui/ui/tabview/tabview","cui/ui/autocomplete/autocomplete","../../util/index","../common/globalService","../mail/service","../../component/advancedSearchBox","../../component/contactcard","../../component/screenlock/view","../../component/confirmbox","../../component/sspurl","component/notification/history"],function(e){function t(e,t,n){var i=e.width(),a=e.height();i>0&&a>0&&(i/a>=t/n?i>t&&(e.width(t+"px"),e.height(a*t/i+"px")):a>n&&(e.height(n+"px"),e.width(i*n/a+"px")))}e("i18n!main,common");var n=e("jquery"),i=e("cui/core/view/view"),a=e("cui/util/templatable/templatable"),r=e("cui/core/view/viewmanager"),s=e("cui/ui/tabview/tabview"),o=e("cui/ui/autocomplete/autocomplete"),l=e("../../util/index"),c=e("../common/globalService"),d=e("../mail/service"),u=e("../../component/advancedSearchBox"),p=e("../../component/contactcard"),h=e("../../component/screenlock/view"),f=e("../../component/confirmbox"),m=e("../../component/sspurl"),g=e("component/notification/history"),v=i.extend({Implements:a,element:"section.j-layout",widgets:{mlsearchac:null,tabview:null},state:null,events:{"click .j-switch-mainpage":"_switchToMainPage","click .j-search":"_handleSearchTrigger","click .j-clear":"handleClearSearchVal","click .j-to-helpcenter":"_handleToHelpcenter"},setup:function(){var e;this.state=c.getCurrentState(),this.state.module?(e=this.state.module.split("."),this.state.module=e[0]):this.state.module="mail",c.setCurrentState(this.state)},render:function(){v.superclass.render.call(this),this._initAvatar(),this._initLogo(),this._initHeadLink(),this._initMLSearchAC(),this._initTabView(),this._initContentBg(),this._initModuleEvent(),n.notify.loading("hide")},destroy:function(){this.widgets.mlsearchac&&this.widgets.mlsearchac.destroy(),this.widgets.tabview&&this.widgets.tabview.destroy(),v.superclass.destroy.call(this)},_initAvatar:function(){var e=this;c.getUserAvatar().then(function(e){n("img.j-avatar").attr("src",e)}),new p({parent:e,trigger:n("img.j-avatar"),arrowPosition:10,emailAddress:c.getUser().email})},_initLogo:function(){var e,i,a=n(".j-lylogo > img");c.getOrgLogo().then(function(r){a.attr("src",r).on("load",function(){e=n(this).width(),i=n(this).height(),n(window).width()<1366?t(a,116,32):t(n(this),152,42)})}),n(window).off("resize.Logo").on("resize.Logo",function(){n(window).width()<1366?t(a,116,32):(a.width(e),a.height(i),t(a,152,42))})},_initMLSearchAC:function(){var e=this,t=e.$("#lyfullsearch");""==t.val()&&t.val(t.attr("placeholder")),t.blur(function(){""==t.val()&&t.val(t.attr("placeholder"))}).focus(function(){t.val()==t.attr("placeholder")&&t.val(""),t.val()||(e.widgets.mlsearchac.input.set("query",""),e.widgets.mlsearchac.input.trigger("queryChanged"))});var i='<div class="{{classPrefix}}"><div class="{{classPrefix}}-content"><ul data-role="items">{{#each items}}{{#and @first searchTips}}<li class="search-tips">{{i18n "common/mail_search_tips"}}</li>{{/and}}{{#if @last}}<li class="u-divider"></li>{{/if}}<li data-role="item" class="{{../classPrefix}}-item">{{#include parent=.. }}{{> html}}{{/include}}</li>{{/each}}</ul></div></div>';e.widgets.mlsearchac=new o({trigger:t,dataSource:[{label:l.i18n.t("common/mail_full_search_all"),value:"pattern"},{label:l.i18n.t("common/mail_full_search_from"),value:"from"},{label:l.i18n.t("common/mail_full_search_subject"),value:"subject"},{label:l.i18n.t("common/mail_advanced_search"),value:"_advanced"}],className:"ly-select",submitOnEnter:!1,selectFirst:!0,template:i,filter:function(e,t){var i=[];return t||(e=[{label:l.i18n.t("common/mail_advanced_search"),value:"_advanced",searchTips:!0}]),n.each(e,function(e,a){var r=n.extend({},a);r.label=r.label.replace("__keyword__",t),r.target=t,i.push(r)}),i},align:{selfXY:["100%",0],baseXY:["100%","100%"]},style:{minWidth:230}}).render(),t.on("focus",function(){e.widgets.mlsearchac.show()}),e.widgets.mlsearchac.on("itemSelected",function(t,n){var i={};if(!i.sentDate){var a=c.getUser().search_sent_date_in_range;i.sentDate=1==a?"6m":2==a?null:"1y"}if("_advanced"!==t.value)i[t.value]=t.target,i=d.makeSearchCondition(i),i.vid="search",e.sendMessage("dispatcher","history:add",{module:"mail.search",param:i});else if("_advanced"===t.value){var r=t.target;e.advancedSearchBox?setTimeout(function(){e.advancedSearchBox.show().trigger("update:pattern",r)},0):e.advancedSearchBox=new u({parentNode:e.element,baseElement:this.get("trigger"),trigger:n,pattern:t.target,onUpdatePattern:function(t){e.widgets.mlsearchac.setInputValue(t)},onSearch:function(t){i=d.makeSearchCondition(t),i.vid="search",e.sendMessage("dispatcher","history:add",{module:"mail.search",param:i})}})}})},_handleSearchTrigger:function(){var e=this,t={};if(t.pattern=e.$("#lyfullsearch").val(),t.pattern==l.i18n.t("common/mail_full_search"))return void f.alert(l.i18n.t("common/mail_search_tips"));if(!t.sentDate){var n=c.getUser().search_sent_date_in_range;t.sentDate=1==n?"6m":2==n?null:"1y"}t=d.makeSearchCondition(t),t.vid="search",e.sendMessage("dispatcher","history:add",{module:"mail.search",param:t})},handleClearSearchVal:function(){this.widgets.mlsearchac.setInputValue("")},_initTabView:function(){var e=this;e.widgets.tabview=new s({element:"section.j-layout",classPrefix:"j-layout",activeTriggerClass:"active",onlyRenderActive:!0,activeTabId:e.state.module,tabs:[{id:"mail",module:r.module("mail")},{id:"calendar",module:r.module("calendar")},{id:"file",module:r.module("file")},{id:"contact",module:r.module("contact")},{id:"appcenter",triggerHandler:!0,module:r.module("appcenter")},{id:"setting",module:r.module("setting")},{id:"logs",module:r.module("logs")},{id:"skins",module:r.module("skins")}]}),e.widgets.tabview.render(),e.widgets.tabview.on("render",function(t){e.state.module=t;var n=c.getCurrentState();0!==n.module.indexOf(t)&&c.setCurrentState({module:t,param:{}}),e.sendMessage("dispatcher","view:render",{module:t,param:{vid:t}})}),e.widgets.tabview.on("refresh",function(t){e.state.module=t,e.sendMessage("dispatcher","view:refresh",t)})},_initModuleEvent:function(){var e=this;e.subscribe("dispatcher","url:changed",function(t){var n=t.message.newState,i=e.widgets.tabview.current(),a=n.module.split(".")[0]||"mail";i&&i.sid!==a&&(c.setCurrentState(n),e.widgets.tabview.switchTo(a))}),e.onMessage("view:change",function(t){var n=t.message||{},i=n.module.split(".")[0];i&&(c.setCurrentState({module:n.module,param:n.param}),e.widgets.tabview.switchTo(i))}),e.subscribe("dispatcher","locationChanged",function(){n.notify.closeLast()}),n(window).on("message",function(t){var i,a=t.originalEvent?t.originalEvent.data:t.data||"";if(a){if(i=JSON.parse(a),!n.isPlainObject(i))return!1;switch(i.type){case"sizeAdjust":!function(){var e=n(n("#mail-"+i.iframeId)[0]);if(i.isThread)return void e.height(i.iHeight+30);i.iScrollTop=i.iScrollTop||0;var t=e.parents(".j-main"),a=t.find(".mail-content")[0].offsetHeight,r=t.find(".j-mail-attachments-wrap")[0].offsetHeight,s=i.iScrollTop+a-i.iHeight-r+2;t.find(".j-back-top").toggleClass("f-dn",i.iScrollTop<500),t.find(".mail-frame").css("top",Math.round(-i.iScrollTop)),t.find(".j-mail-attachments-wrap").css("bottom",Math.round(r&&i.isLoad?s:-999))}();break;case"openLink":!function(){var e=window.open(i.href,"_blank");(null==e||"undefined"==typeof e)&&f.alert(l.messageFormat.format(l.i18n.t("common/mail_open_url_fail"),[i.href]))}();break;case"openSspurl":!function(){new m({parentNode:e.element,gourl:i.href})}();break;case"previewLoaded":e.sendMessage("component.previewBox","preview:loaded",null);break;case"hideMenu":!function(){i.hideMenu&&n(document).trigger("hide.menu")}();break;case"mailOp":!function(){var t=c.getCurrentState(),n=t.module,a=t.param.mid;("mail.read"===n||"mail.thread"===n)&&e.sendMessage(n+":"+a,"mail:op",{action:i.mailOp})}();break;case"viewAttach":!function(){var e=n(n("#mail-"+i.iframeId)[0]),t=e.closest(i.isThread?".j-mail-info":".j-main");t.find(".j-view-attach").removeClass("disabled")}()}}})},_initHeadLink:function(){var e=this,t=e.$(".lyheader [data-trigger]"),n=e.$(".lyheader .j-history-notification-trigger"),i=c.getConfig("user.enablelockscreen");i||t.filter("[data-trigger=screenlock]").remove(),t.off("click").on("click",function(t){e._handleLinkTrigger(t,this)}),g.init(n)},_initContentBg:function(){var e,t,i,a=this.$(".lybg"),r=n(window),s=1878;return t=function(){a.html(a.html().trim()+'<div class="lybg-even"></div>')},a.innerWidth()>s?void t():(e=function(){clearTimeout(i),i=setTimeout(function(){clearTimeout(i),a.innerWidth()>s&&(t(),r.off("resize.layout"),r.off("layoutResize",e))},100)},void setTimeout(function(){r.off("layoutResize").on("layoutResize",e),r.off("resize.layout").on("resize.layout",function(){r.trigger("layoutResize")})},500))},_handleMacConfig:function(){var e,t=this;t.mobileconfig?t.mobileconfig.show():(e='<div class="config-item"><input type="checkbox" name="mailbox" id="mailbox"/><label class="j-mailbox-lb" for="mailbox">{{i18n "common/mailbox"}}</label><input type="radio" name="sType" value="imap" id="imap" checked /><label for="imap">IMAP</label><input type="radio" name="sType" value="pop" id="POP3"/><label for="POP3">POP3</label></div>{{#if enableCal}}<div class="config-item"><input type="checkbox" name="calDav" id="calDav"/><label for="calDav">{{i18n "common/cal"}}</label></div>{{/if}}{{#if enablePab}}<div class="config-item"><input type="checkbox" name="cardDav" id="cardDav"/><label for="cardDav">{{i18n "common/pab"}}</label></div>{{/if}}{{#if enableOab}}<div class="config-item"><input type="checkbox" name="ldap" id="ldap"/><label for="ldap">{{i18n "common/oab"}}</label></div>{{/if}}',t.mobileconfig=new f({parentNode:t.element,title:l.i18n.t("main/MacConfig"),message:t.compile(e,{enableCal:c.getConfig("calendar.enable"),enablePab:c.getConfig("user.supportpab"),enableOab:c.getConfig("user.supportoab")}),onConfirm:function(){var e=this.element,t=[];e.find("#mailbox").prop("checked")&&t.push(e.find("[name=sType]:checked").val()),e.find("#calDav").prop("checked")&&t.push("calDav"),e.find("#cardDav").prop("checked")&&t.push("cardDav"),e.find("#ldap").prop("checked")&&t.push("ldap"),t.length>0&&(location.href="../s?sid="+c.getSid()+"&func=mobileConfig&template="+t.join(",")),this.hide()}}),t.mobileconfig.after("show",function(){function e(e){e.prop("checked")?e.siblings().not(".j-mailbox-lb").show():e.siblings().not(".j-mailbox-lb").hide()}var t=this.element,i=t.find("#mailbox");e(i),i.off("click").on("click",function(){e(n(this))})}).show())},_handleLinkTrigger:function(e,t){var i=this,a=n(t).data("trigger");if(e.stopPropagation(),e.preventDefault(),a)switch(a){case"screenlock":h.confirm();break;case"logout":c.logoutUser().then(function(e){var t=e.startReferer,n="/"===t[0];window.location.href=n?CC.path(t):t});break;case"mobileconfig":i._handleMacConfig();break;default:this.sendMessage("dispatcher","history:add",{module:a,param:{}})}},_switchToMainPage:function(){this.sendMessage("dispatcher","history:add",{module:"mail.welcome",param:{}})},_handleToHelpcenter:function(){window.open(c.getConfig("context.helpurl"))}});r.module("layout",v)}),define("widget/pagination/pagination",["require","jquery"],function(e){function t(){n('ul[role="pagination-menu"]').removeClass(i.JUMP_PAGE_MENU_SHOW_CLASS).addClass(i.JUMP_PAGE_MENU_HIDDEN_CLASS)}var n=e("jquery"),i={UI_PAGING:"u-page",UI_PAGING_ROUND:"u-page-round",JUMP_PAGE_BTNS_CLASS:"u-page-btns",JUMP_PAGE_BTNS_CENTER_CLASS:"u-page-btns-center",JUMP_PAGE_BTN_CLASS:"u-page-btn",JUMP_PAGE_BTNTEXT_CLASS:"u-page-btntext",
JUMP_PAGE_BTNSEL_CLASS:"u-page-btnsel",JUMP_PAGE_MENU_CLASS:"u-page-menu",JUMP_PAGE_MENU_HIDDEN_CLASS:"u-page-menu-hidden",JUMP_PAGE_MENU_SHOW_CLASS:"u-page-menu-show",PREV_LINK_CLASS:"u-page-prev",NEXT_LINK_CLASS:"u-page-next"},a=function(e){this.options=e||{}};n.extend(a.prototype,{numPages:function(){return Math.ceil(this.options.total/this.options.limit)||1},getInterval:function(e){var t,n,i=this.numPages();return t=e-this.options.edge,t=0>=t?0:t,n=e+this.options.edge,n=n>=i?i:n,{start:t,end:n}},appendRange:function(e,t,n,i){for(var a=n;i>a;a++)this.createLink(a,t,{}).appendTo(e)},createLink:function(e,t,i){var a,r=this.numPages();return e=0>e?0:r>e?e:r-1,i=n.extend({text:e+1,classes:""},i||{}),a=e===t?n('<a class="z-current">'+i.text+"</a>"):n("<a>"+i.text+"</a>").attr("href","#"+e),i.classes&&a.addClass(i.classes),i.rel&&a.attr("rel",i.rel),a.data("pageId",e),a},createJumpPageMenu:function(e,t,a,r){var s,o,l,c,d;s=n("<span>",{"class":i.JUMP_PAGE_BTNS_CLASS}),o=n("<button>",{"class":i.JUMP_PAGE_BTN_CLASS}).append(n("<span>",{"class":i.JUMP_PAGE_BTNTEXT_CLASS,html:t+1+"/"+a})).append(n("<span>",{"class":i.JUMP_PAGE_BTNSEL_CLASS})),"boolean"==typeof r&&r&&s.addClass(i.JUMP_PAGE_BTNS_CENTER_CLASS),l=n("<ul>",{"class":i.JUMP_PAGE_MENU_CLASS+" "+i.JUMP_PAGE_MENU_HIDDEN_CLASS,role:"pagination-menu"}),s.append(o).append(l).appendTo(e),a>1?o.on("click",n.proxy(function(t){if(n(document).trigger("hide.menu"),0==l.children().length)for(c=1;a>=c;c++)d=n("<a>",{href:"#",html:c+"/"+a}).data("pageId",c-1),l.append(n("<li></li>").append(d));n("."+i.JUMP_PAGE_MENU_CLASS,e).removeClass(i.JUMP_PAGE_MENU_HIDDEN_CLASS).addClass(i.JUMP_PAGE_MENU_SHOW_CLASS),t.preventDefault(),t.stopPropagation()},this)):s.append(o).appendTo(e)},getLinks:function(e,t){var a=this.getInterval(e),r=this.numPages(),s=n("<div>",{"class":i.UI_PAGING}).data("currentPage",e);return this.options.round&&s.addClass(i.UI_PAGING_ROUND),this.options.menu&&!this.options.menuAlignCenter&&this.createJumpPageMenu(s,e,r),s.append(this.createLink(e-1,e,{text:this.options.prevText,classes:i.PREV_LINK_CLASS,rel:"prev"})),this.options.menu&&this.options.menuAlignCenter&&this.createJumpPageMenu(s,e,r,!0),this.options.internal&&(a.start>0&&s.append(n("<i>",{html:this.options.ellipsisText})),this.appendRange(s,e,a.start,a.end),a.end<r&&s.append(n("<i>",{html:this.options.ellipsisText}))),s.append(this.createLink(e+1,e,{text:this.options.nextText,classes:i.NEXT_LINK_CLASS,rel:"next"})),n(s).on("click","a",t),s}}),n.fn.pagination=function(e){function t(e){e.preventDefault(),e.stopPropagation();var a=s.data("currentPage"),o=n(this).data("pageId");a!==o&&(s.empty().append(r.getLinks(o,t)),s.data("currentPage",o),r.options.callback.call(this,o,a)),s.find('ul[role="pagination-menu"]').removeClass(i.JUMP_PAGE_MENU_SHOW_CLASS).addClass(i.JUMP_PAGE_MENU_HIDDEN_CLASS)}var r,s=this;e=n.extend({total:0,limit:10,currentPage:0,edge:5,prevText:"Prev",nextText:"Next",ellipsisText:"...",internal:!1,menu:!0,menuAlignCenter:!1,classPrefix:"u-page",callback:function(){return!1}},e||{}),e.currentPage=parseInt(e.currentPage,10),s.data("currentPage",e.currentPage),r=new a(e),s.empty().append(r.getLinks(e.currentPage,t))},n(document).on("click.pagination",function(){n(document).trigger("hide.menu")}),n(document).on("hide.menu",function(){t()})}),define("module/mail/entrustmanager/service",["require","jquery","../../../util/index","../../common/globalService"],function(e){function t(e){var t=a.Deferred(),n=s.getUser();return e=a.extend({limit:n.maxlist},e),r.xhr.simpleCall({query:{func:"user:listEntrustMaillist",sid:s.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function n(e){var t=a.Deferred();return r.xhr.simpleCall({query:{func:"user:getEntrustMaillistAttrs",sid:s.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function i(e){var t=a.Deferred();return r.xhr.simpleCall({query:{func:"user:setEntrustMaillistAttrs",sid:s.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}var a=e("jquery"),r=e("../../../util/index"),s=e("../../common/globalService");return{listEntrustMailList:t,getEntrustMailListAttrs:n,setEntrustMailListAttrs:i}}),define("components/requirejs-text/text!template/module/mail/entrustmanager.tpl.html",[],function(){return'<div class="m-entrust-manager">\r\n    <div class="m-menu j-menu">\r\n        <span class="u-btn u-btn-default j-mailrefresh" data-action="refresh">{{i18n "common/op_refresh"}}</span>\r\n        <div id="pagination" class="f-fr"></div>\r\n    </div>\r\n    <div class="m-list j-list">\r\n    </div>\r\n    <div class="m-edit j-edit"></div>\r\n    {{#raw}}\r\n    <script id="listtpl" type="text/x-handlebars-template">\r\n        <div class="list-title f-csp j-listtt">\r\n            <i class="iconfont iconcollapse"></i>\r\n            <span class="mailAddress">{{i18n "main/email"}}</span>\r\n            <span class="mailListName">{{i18n "main/maillist_name"}}</span>\r\n            <span class="status">{{i18n "main/status"}}</span>\r\n        </div>\r\n        <div class="list-body j-listbd">\r\n            <table class="u-table">\r\n                <tbody>\r\n                    [[#each list]]\r\n                    <tr class="j-maillist" email="[[email]]">\r\n                        <td class="emailAddress">[[email]]</td>\r\n                        <td class="listName">[[true_name]]</td>\r\n                        <td class="status [[#compare user_status \'==\' 1]]disabled[[/compare]]">\r\n                            [[#compare user_status \'==\' 0]]{{i18n "main/status_0"}}[[/compare]]\r\n                            [[#compare user_status \'==\' 1]]{{i18n "main/status_1"}}[[/compare]]\r\n                        </td>\r\n                    </tr>\r\n                    [[/each]]\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n    </script>\r\n    {{/raw}}\r\n    {{#raw}}\r\n    <script id="edittpl" type="text/x-handlebars-template">\r\n        <div class="u-btns-top">\r\n            <button type="button" data-action="save" class="u-btn u-btn-primary">[[i18n "main/bt_savec"]] </button>\r\n            <button type="button" data-action="cancel" class="u-btn u-btn-default">[[i18n "main/bt_back"]]</button>\r\n        </div>\r\n        <form name="mailListForm" action="#" method="post" class="u-form">\r\n                <fieldset>\r\n                    <div class="title dotted">\r\n                        <h4>{{i18n "main/MaillistEdit"}}</h4>\r\n                    </div>\r\n                    <div class="u-form-item">\r\n                        <label class="u-form-label">{{i18n "main/email"}}</label>\r\n                        <span class="u-form-text">[[email]]</span>\r\n                        <input type="hidden" value="[[email]]" name="email" />\r\n                    </div>\r\n                    [[#if enableDynamicMailLingList]]\r\n                    <div class="u-form-item">\r\n                        <label class="u-form-label">{{i18n "main/maillist_type"}}</label>\r\n                        <select class="u-select j-type type" name="maillistType">\r\n                            <option value="0" [[#unless maillistFilter]]selected[[/unless]]>{{i18n "main/maillist_type_0"}}</option>\r\n                            <option value="1" [[#if maillistFilter]]selected[[/if]]>{{i18n "main/maillist_type_1"}}</option>\r\n                        </select>\r\n                    </div>\r\n                    [[/if]]\r\n                    <div class="u-form-item filter [[#unless maillistFilter]]f-dn[[/unless]]">\r\n                        <label class="u-form-label">{{i18n "main/maillist_filter_items"}}</label>\r\n                        <div class="filter-item" id="filter_item_0">\r\n                            <select class="u-select disabled j-filter-key filter-key" name="filter_item_0" disabled>\r\n                                <option value="org_id" selected="">{{i18n "main/filter_key_0"}}</option>\r\n                                <option value="org_unit_id">{{i18n "main/filter_key_1"}}</option>\r\n                                <option value="user_id">{{i18n "main/filter_key_2"}}</option>\r\n                                <option value="domain_name">{{i18n "main/filter_key_3"}}</option>\r\n                            </select>\r\n                            <input type=\'text\' class=\'u-input j-filter-value\' id=\'filter_item_value_0\' name=\'filter_item_value_0\' value=\'\' />\r\n                            <div class="itemR">\r\n                                <input type="checkbox" class="j-filter-op" name="wildcard_0" id="wildcard_0" />\r\n                                <span class="label">{{i18n "main/user_wildcard"}}</span><span class="star">*</span>\r\n                                <i class="j-icon icon iconfont iconadd" title=\'{{i18n "main/add_item"}}\'></i>\r\n                            </div>\r\n                        </div>\r\n                        <div class="filter-item f-dn" id="filter_item_1">\r\n                            <select class="u-select j-filter-key filter-key" name="filter_item_1">\r\n                                <option value="org_id">{{i18n "main/filter_key_0"}}</option>\r\n                                <option value="org_unit_id" selected>{{i18n "main/filter_key_1"}}</option>\r\n                                <option value="user_id">{{i18n "main/filter_key_2"}}</option>\r\n                                <option value="domain_name">{{i18n "main/filter_key_3"}}</option>\r\n                            </select>\r\n                            <input type=\'text\' class=\'u-input j-filter-value\' id=\'filter_item_value_1\' name=\'filter_item_value_1\' value=\'\' />\r\n                            <div class="itemR">\r\n                                <input type="checkbox" class="j-filter-op" name="wildcard_1" id="wildcard_1" />\r\n                                <span class="label">{{i18n "main/user_wildcard"}}</span>\r\n                                <i class="j-icon icon iconfont iconremove" title=\'{{i18n "main/delete_item"}}\'></i>\r\n                            </div>\r\n                        </div>\r\n                        <div class="filter-item f-dn" id="filter_item_2">\r\n                            <select class="u-select j-filter-key filter-key" name="filter_item_2">\r\n                                <option value="org_id">{{i18n "main/filter_key_0"}}</option>\r\n                                <option value="org_unit_id">{{i18n "main/filter_key_1"}}</option>\r\n                                <option value="user_id" selected>{{i18n "main/filter_key_2"}}</option>\r\n                                <option value="domain_name">{{i18n "main/filter_key_3"}}</option>\r\n                            </select>\r\n                            <input type=\'text\' class=\'u-input j-filter-value\' id=\'filter_item_value_2\' name=\'filter_item_value_2\' value=\'\' />\r\n                            <div class="itemR">\r\n                                <input type="checkbox" class="j-filter-op" name="wildcard_2" id="wildcard_2" />\r\n                                <span class="label">{{i18n "main/user_wildcard"}}</span>\r\n                                <i class="j-icon icon iconfont iconremove" title=\'{{i18n "main/delete_item"}}\'></i>\r\n                            </div>\r\n                        </div>\r\n                        <div class="filter-item f-dn" id="filter_item_3">\r\n                            <select class="u-select j-filter-key filter-key" name="filter_item_3">\r\n                                <option value="org_id">{{i18n "main/filter_key_0"}}</option>\r\n                                <option value="org_unit_id">{{i18n "main/filter_key_1"}}</option>\r\n                                <option value="user_id">{{i18n "main/filter_key_2"}}</option>\r\n                                <option value="domain_name" selected>{{i18n "main/filter_key_3"}}</option>\r\n                            </select>\r\n                            <input type=\'text\' class=\'u-input j-filter-value\' id=\'filter_item_value_3\' name=\'filter_item_value_3\' value=\'\' />\r\n                            <div class="itemR">\r\n                                <input type="checkbox" class="j-filter-op" name="wildcard_3" id="wildcard_3" />\r\n                                <span class="label">{{i18n "main/user_wildcard"}}</span>\r\n                                <i class="j-icon icon iconfont iconremove" title=\'{{i18n "main/delete_item"}}\'></i>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class="u-form-item">\r\n                        <label class="u-form-label">{{i18n "main/maillist_content"}}</label>\r\n                        <textarea id=\'forwardmaillist\' name=\'forwardmaillist\' class="u-input">[[forwardMaillist]]</textarea>\r\n                        <span class="u-form-explain"></span>\r\n                        <p class="u-form-explain">{{i18n "main/maillist_tip"}}</p>\r\n                    </div>\r\n\r\n                    <div class="u-form-item">\r\n                        <label class="u-form-label">{{i18n "main/maillist_user"}}</label>\r\n                        <select class=\'u-select j-junkfilter junk-filter\' name="junkfilter">\r\n                            <option value="0" [[#compare junkFilter \'==\' 0]]selected[[/compare]]>{{i18n "main/junkfilter_0"}}</option>\r\n                            <option value="2" [[#compare junkFilter \'==\' 2]]selected[[/compare]]>{{i18n "main/junkfilter_2"}}</option>\r\n                            <option value="3" [[#compare junkFilter \'==\' 3]]selected[[/compare]]>{{i18n "main/junkfilter_3"}}</option>\r\n                        </select>\r\n                    </div>\r\n                    <div class="u-form-item">\r\n                        <label class="u-form-label">{{i18n "main/maillist_safelist"}}</label>\r\n                        <textarea id="safelist" name=\'safelist\' class="u-input" [[#compare junkFilter \'==\' 0]]disabled[[/compare]]>[[safeList]]</textarea>\r\n                        <span class="u-form-explain"></span>\r\n                        <p class="u-form-explain">{{i18n "main/maillist_tip"}}</p>\r\n                    </div>\r\n                    [[#if mailListSupportErrorTo]]\r\n                    <div class="u-form-item">\r\n                        <label class="u-form-label">{{i18n "main/maillist_errorto"}}</label>\r\n                        <textarea id=\'maillist_errorto\' name=\'maillist_errorto\' class="u-input">[[errortoList]]</textarea>\r\n                        <span class="u-form-explain"></span>\r\n                        <p class="u-form-explain">{{i18n "main/maillist_tip"}}</p>\r\n                    </div>\r\n                    [[/if]]\r\n                </fieldset>\r\n            </form>\r\n    </script>\r\n    {{/raw}}\r\n</div>'}),define("module/mail/entrustmanager/index",["require","i18n!mail,mbox","../../../widget/pagination/pagination","jquery","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","../../../util/index","../../../component/confirmbox","../../common/globalService","./service","text!template/module/mail/entrustmanager.tpl.html"],function(e){e("i18n!mail,mbox"),e("../../../widget/pagination/pagination");var t=e("jquery"),n=e("cui/core/view/view"),i=e("cui/core/view/viewmanager"),a=e("cui/util/templatable/templatable"),r=e("../../../util/index"),s=e("../../../component/confirmbox"),o=e("../../common/globalService"),l=e("./service"),c=n.extend({Implements:a,events:{"click div.j-listtt":"_handleToggleMailList","click [data-action]":"_dispatchAction","click tr.j-maillist":"_handleEdit","click .j-icon":"_handleFilterItem","change .j-type":"_handleMailListType","change .j-junkfilter":"_initJunkFilter"},setup:function(){this._initConfig(),this._params={}},render:function(){var e=this;c.superclass.render.call(e),e._renderList({initialize:!0})},destroy:function(){c.superclass.destroy.call(this)},_initConfig:function(){this.config={enableDynamicMailLingList:o.getConfig("mail.enabledynamicmaillinglist"),mailListSupportErrorTo:o.getConfig("mail.maillistsupporterrorto")}},_initPagination:function(){var e=this;e.$("#pagination").pagination({total:e._params.total,limit:e._params.limit,currentPage:e._params.currentPage,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',menu:!0,callback:function(t,n){e._renderList({start:t*e._params.limit,limit:e._params.limit,resetPagination:!1}),e._params.currentPage=t}})},_renderList:function(e){var t=this,n=o.getUser(),i=t.$("#listtpl").html(),a=t.$(".j-list");t._switchTo("list"),l.listEntrustMailList(e).then(function(r){r.total>0&&a.html(t.compile(i,{list:r.list})),(e.initialize||e.resetPagination)&&(t._params.total=r.total,t._params.limit=n.maxlist||20,t._params.currentPage=0,t._initPagination())})},_handleEdit:function(e,n){this._renderEdit(t(n).attr("email"))},_renderEdit:function(e){var n=this,i=n.$("#edittpl").html(),a=n.$(".j-edit");n._switchTo("edit"),l.getEntrustMailListAttrs({email:e}).then(function(r){r=t.extend(r,{email:e},n.config),a.html(n.compile(i,r)),n._initFilterItem(r.maillistFilter),n._initJunkFilter(),a.customRadioCheckbox()})},_handleToggleMailList:function(e,n){var i=t(n),a=i.next(".j-listbd");a.animate({height:"toggle"},{duration:200,complete:function(){a.is(":visible")?i.children(".iconfont").removeClass("iconunfold").addClass("iconcollapse"):i.children(".iconfont").removeClass("iconcollapse").addClass("iconunfold")}})},_switchTo:function(e){var t=this.$(".j-menu"),n=this.$(".j-list"),i=this.$(".j-edit");"list"===e?(t.show(),n.show(),i.hide()):(t.hide(),n.hide(),i.show())},_initFilterItem:function(e){if(this.config.enableDynamicMailLingList&&e)for(var n=e.split("&"),i=["org_id","org_unit_id","user_id","domain_name","includelist"],a=0;a<n.length;a++)for(var r=0;r<i.length;r++)if(0==n[a].indexOf(i[r])){var s="";if(n[a].indexOf("~=")==i[r].length)t("#wildcard_"+r).attr("checked",!0),s=n[a].substring(i[r].length+2);else{if("includelist"==i[r]){s=n[a].substring(i[r].length+2,n[a].length-1),t("#forwardmaillist").val(decodeURIComponent(s));continue}s=n[a].substring(i[r].length+1),t("#wildcard_"+r).attr("checked",!1)}t("#filter_item_"+r).show(),t("#filter_item_value_"+r).val(decodeURIComponent(s))}},_handleFilterItem:function(e,n){var i=this,a=t(n);a.hasClass("iconadd")?i.$(".filter-item").each(function(e){return t(this).is(":hidden")?(t(this).show(),!1):void 0}):a.closest(".filter-item").hide()},_handleMailListType:function(e,n){var i=t(n).val(),a=this.$(".filter");"1"===i?a.show():a.hide()},_dispatchAction:function(e,n){var i=this,a=t(n).data("action");switch(a){case"save":var s=i.$("form[name='mailListForm']").serializeJSON({parseNumbers:!0});if(i._validateB4Submit(s)){var o=s.junkfilter,c={junkfilter:o};0!=o&&(c.safelist=s.safelist),i.config.mailListSupportErrorTo&&(c.maillist_errorto=s.maillist_errorto),s.maillist_filter?(c.maillist_filter=s.maillist_filter,c.forwardmaillist=""):(c.maillist_filter="",c.forwardmaillist=s.forwardmaillist),l.setEntrustMailListAttrs({email:s.email,attrs:c}).then(function(e){"S_OK"==e.code&&(i._renderEdit(s.email),t.notify.success(r.i18n.t("main/maillist_editsucc")))})}break;case"cancel":i._renderList({start:i._params.currentPage*i._params.limit,limit:i._params.limit});break;case"refresh":i._renderList({resetPagination:!0})}},_initJunkFilter:function(e,n){var i=t("#safelist");0==this.$(".j-junkfilter").val()?(i.attr("disabled",!0),i.addClass("disabled")):(i.removeAttr("disabled"),i.removeClass("disabled"))},_validateB4Submit:function(e){var n=this,i=1==e.maillistType,a=n._prepareMailListFilter();if(i){if(!e.filter_item_value_0)return s.alert(r.i18n.t("main/filter_orgid_empty"),function(){t("#filter_item_value_0").focus()}),!1;if(!a)return!1}var o=n._verifyAddress("forwardmaillist"),l=0==e.junkfilter||n._verifyAddress("safelist"),c=!0;n.config.mailListSupportErrorTo&&(c=n._verifyAddress("maillist_errorto"));var d=o&&l&&c;return i&&d&&(e.maillist_filter=a+("&includelist=,"+encodeURIComponent(e.forwardmaillist)+",")),!0},_prepareMailListFilter:function(){var e,n,i,a=this,o=[],l=[],c=!0;return a.$(".filter-item").each(function(a){t(this).is(":visible")&&(e=t(this).find(".j-filter-key").val(),n=t(this).find(".j-filter-op").is(":checked")?"~=":"=",i=encodeURIComponent(t(this).find(".j-filter-value").val()),i&&(t.inArray(e,l)>0&&(s.alert(r.i18n.t("main/filter_attr_duplicate"),function(){t(this).find(".j-filter-key").focus()}),c=!1),l.push(e),o.push(e+n+i)))}),c?o.join("&"):!1},_verifyAddress:function(e){function n(e,t){var n=e||"";return t?s(n):r.Email.test(n)}function i(e){var t=new RegExp("^[\\u4e00-\\u9fa5\\w?*][\\u4e00-\\u9fa5\\w\\-?*]*(?:\\.[\\u4e00-\\u9fa5\\w?*][\\u4e00-\\u9fa5\\w\\-?*]*)*$");return null!=e.match(t)}function a(e){var t=new RegExp("^[\\u4e00-\\u9fa5\\w?*][\\u4e00-\\u9fa5\\w\\-?*]*(?:\\.[\\u4e00-\\u9fa5\\w?*][\\u4e00-\\u9fa5\\w\\-?*]*)+$");return null!=e.match(t)}function s(e){var t=e.indexOf("@");if(-1!=t){var n=e.substring(0,t),r=e.substring(t+1,e.length);return i(n)&&a(r)}return!1}var o=[],l=[],c=[],d=t("#"+e),u=d.val();if(u){o=u.split(",");for(var p=0;p<o.length;p++){var h=o[p].trim();if(!(t.inArray(h,c)>0||t.inArray(h,l)>0)){var f="safelist"==e;h&&!n(h,f)?l.push(h):c.push(h)}}if(l.length>0)return d.addClass("error"),d.next("span").html(r.i18n.t("main/invalid_emailaddr")+l.join(", ")),!1;d.next("span").html(""),d.val(c.join(","))}return!0}});i.module({name:"mail.entrustmanager",template:e("text!template/module/mail/entrustmanager.tpl.html")},c)}),function($){var settings={},roots={},caches={},_consts={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch",NAME:"node_name"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error",REMOVE:"ztree_remove",SELECTED:"ztree_selected",UNSELECTED:"ztree_unselected"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:!0,dblClickExpand:!0,expandSpeed:"fast",fontCss:{},nameIsHTML:!1,selectedMulti:!0,showIcon:!0,showLine:!0,showTitle:!0,txtSelectedEnable:!1},data:{key:{isParent:"isParent",children:"children",name:"name",title:"",url:"url",icon:"icon"},simpleData:{enable:!1,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:!1,leaf:!1}},async:{enable:!1,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(e){var t=data.getRoot(e);t||(t={},data.setRoot(e,t)),data.nodeChildren(e,t,[]),t.expandTriggerFlag=!1,t.curSelectedList=[],t.noSelection=!0,t.createdNodes=[],t.zId=0,t._ver=(new Date).getTime()},_initCache=function(e){var t=data.getCache(e);t||(t={},data.setCache(e,t)),t.nodes=[],t.doms=[]},_bindEvent=function(e){var t=e.treeObj,n=consts.event;t.bind(n.NODECREATED,function(t,n,i){tools.apply(e.callback.onNodeCreated,[t,n,i])}),t.bind(n.CLICK,function(t,n,i,a,r){tools.apply(e.callback.onClick,[n,i,a,r])}),t.bind(n.EXPAND,function(t,n,i){tools.apply(e.callback.onExpand,[t,n,i])}),t.bind(n.COLLAPSE,function(t,n,i){tools.apply(e.callback.onCollapse,[t,n,i])}),t.bind(n.ASYNC_SUCCESS,function(t,n,i,a){tools.apply(e.callback.onAsyncSuccess,[t,n,i,a])}),t.bind(n.ASYNC_ERROR,function(t,n,i,a,r,s){tools.apply(e.callback.onAsyncError,[t,n,i,a,r,s])}),t.bind(n.REMOVE,function(t,n,i){tools.apply(e.callback.onRemove,[t,n,i])}),t.bind(n.SELECTED,function(t,n,i){tools.apply(e.callback.onSelected,[n,i])}),t.bind(n.UNSELECTED,function(t,n,i){tools.apply(e.callback.onUnSelected,[n,i])})},_unbindEvent=function(e){var t=e.treeObj,n=consts.event;t.unbind(n.NODECREATED).unbind(n.CLICK).unbind(n.EXPAND).unbind(n.COLLAPSE).unbind(n.ASYNC_SUCCESS).unbind(n.ASYNC_ERROR).unbind(n.REMOVE).unbind(n.SELECTED).unbind(n.UNSELECTED)},_eventProxy=function(e){var t=e.target,n=data.getSetting(e.data.treeId),i="",a=null,r="",s="",o=null,l=null,c=null;if(tools.eqs(e.type,"mousedown")?s="mousedown":tools.eqs(e.type,"mouseup")?s="mouseup":tools.eqs(e.type,"contextmenu")?s="contextmenu":tools.eqs(e.type,"click")?tools.eqs(t.tagName,"span")&&null!==t.getAttribute("treeNode"+consts.id.SWITCH)?(i=tools.getNodeMainDom(t).id,r="switchNode"):(c=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]),c&&(i=tools.getNodeMainDom(c).id,r="clickNode")):tools.eqs(e.type,"dblclick")&&(s="dblclick",c=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]),c&&(i=tools.getNodeMainDom(c).id,r="switchNode")),s.length>0&&0==i.length&&(c=tools.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+consts.id.A}]),c&&(i=tools.getNodeMainDom(c).id)),i.length>0)switch(a=data.getNodeCache(n,i),r){case"switchNode":var d=data.nodeIsParent(n,a);d&&(tools.eqs(e.type,"click")||tools.eqs(e.type,"dblclick")&&tools.apply(n.view.dblClickExpand,[n.treeId,a],n.view.dblClickExpand))?o=handler.onSwitchNode:r="";break;case"clickNode":o=handler.onClickNode}switch(s){case"mousedown":l=handler.onZTreeMousedown;break;case"mouseup":l=handler.onZTreeMouseup;break;case"dblclick":l=handler.onZTreeDblclick;break;case"contextmenu":l=handler.onZTreeContextmenu}var u={stop:!1,node:a,nodeEventType:r,nodeEventCallback:o,treeEventType:s,treeEventCallback:l};return u},_initNode=function(e,t,n,i,a,r,s){if(n){var o=data.getRoot(e),l=data.nodeChildren(e,n);n.level=t,n.tId=e.treeId+"_"+ ++o.zId,n.parentTId=i?i.tId:null,n.open="string"==typeof n.open?tools.eqs(n.open,"true"):!!n.open;var c=data.nodeIsParent(e,n);tools.isArray(l)&&!(c===!1||"string"==typeof c&&tools.eqs(c,"false"))?(data.nodeIsParent(e,n,!0),n.zAsync=!0):(c=data.nodeIsParent(e,n,c),n.open=c&&!e.async.enable?n.open:!1,n.zAsync=!c),n.isFirstNode=a,n.isLastNode=r,n.getParentNode=function(){return data.getNodeCache(e,n.parentTId)},n.getPreNode=function(){return data.getPreNode(e,n)},n.getNextNode=function(){return data.getNextNode(e,n)},n.getIndex=function(){return data.getNodeIndex(e,n)},n.getPath=function(){return data.getNodePath(e,n)},n.isAjaxing=!1,data.fixPIdKeyValue(e,n)}},_init={bind:[_bindEvent],unbind:[_unbindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(e,t){data.getCache(e).nodes[data.getNodeCacheId(t.tId)]=t},getNodeCacheId:function(e){return e.substring(e.lastIndexOf("_")+1)},addAfterA:function(e){_init.afterA.push(e)},addBeforeA:function(e){_init.beforeA.push(e)},addInnerAfterA:function(e){_init.innerAfterA.push(e)},addInnerBeforeA:function(e){_init.innerBeforeA.push(e)},addInitBind:function(e){_init.bind.push(e)},addInitUnBind:function(e){_init.unbind.push(e)},addInitCache:function(e){_init.caches.push(e)},addInitNode:function(e){_init.nodes.push(e)},addInitProxy:function(e,t){t?_init.proxys.splice(0,0,e):_init.proxys.push(e)},addInitRoot:function(e){_init.roots.push(e)},addNodesData:function(e,t,n,i){var a,r=data.nodeChildren(e,t);r?n>=r.length&&(n=-1):(r=data.nodeChildren(e,t,[]),n=-1),r.length>0&&0===n?(r[0].isFirstNode=!1,view.setNodeLineIcos(e,r[0])):r.length>0&&0>n&&(r[r.length-1].isLastNode=!1,view.setNodeLineIcos(e,r[r.length-1])),data.nodeIsParent(e,t,!0),0>n?data.nodeChildren(e,t,r.concat(i)):(a=[n,0].concat(i),r.splice.apply(r,a))},addSelectedNode:function(e,t){var n=data.getRoot(e);data.isSelectedNode(e,t)||n.curSelectedList.push(t)},addCreatedNode:function(e,t){if(e.callback.onNodeCreated||e.view.addDiyDom){var n=data.getRoot(e);n.createdNodes.push(t)}},addZTreeTools:function(e){_init.zTreeTools.push(e)},exSetting:function(e){$.extend(!0,_setting,e)},fixPIdKeyValue:function(e,t){e.data.simpleData.enable&&(t[e.data.simpleData.pIdKey]=t.parentTId?t.getParentNode()[e.data.simpleData.idKey]:e.data.simpleData.rootPId)},getAfterA:function(e,t,n){for(var i=0,a=_init.afterA.length;a>i;i++)_init.afterA[i].apply(this,arguments)},getBeforeA:function(e,t,n){for(var i=0,a=_init.beforeA.length;a>i;i++)_init.beforeA[i].apply(this,arguments)},getInnerAfterA:function(e,t,n){for(var i=0,a=_init.innerAfterA.length;a>i;i++)_init.innerAfterA[i].apply(this,arguments)},getInnerBeforeA:function(e,t,n){for(var i=0,a=_init.innerBeforeA.length;a>i;i++)_init.innerBeforeA[i].apply(this,arguments)},getCache:function(e){return caches[e.treeId]},getNodeIndex:function(e,t){if(!t)return null;for(var n=t.parentTId?t.getParentNode():data.getRoot(e),i=data.nodeChildren(e,n),a=0,r=i.length-1;r>=a;a++)if(i[a]===t)return a;return-1},getNextNode:function(e,t){if(!t)return null;for(var n=t.parentTId?t.getParentNode():data.getRoot(e),i=data.nodeChildren(e,n),a=0,r=i.length-1;r>=a;a++)if(i[a]===t)return a==r?null:i[a+1];return null},getNodeByParam:function(e,t,n,i){if(!t||!n)return null;for(var a=0,r=t.length;r>a;a++){var s=t[a];if(s[n]==i)return t[a];var o=data.nodeChildren(e,s),l=data.getNodeByParam(e,o,n,i);if(l)return l}return null},getNodeCache:function(e,t){if(!t)return null;var n=caches[e.treeId].nodes[data.getNodeCacheId(t)];return n?n:null},getNodePath:function(e,t){if(!t)return null;var n;return n=t.parentTId?t.getParentNode().getPath():[],n&&n.push(t),n},getNodes:function(e){return data.nodeChildren(e,data.getRoot(e))},getNodesByParam:function(e,t,n,i){if(!t||!n)return[];for(var a=[],r=0,s=t.length;s>r;r++){var o=t[r];o[n]==i&&a.push(o);var l=data.nodeChildren(e,o);a=a.concat(data.getNodesByParam(e,l,n,i))}return a},getNodesByParamFuzzy:function(e,t,n,i){if(!t||!n)return[];var a=[];i=i.toLowerCase();for(var r=0,s=t.length;s>r;r++){var o=t[r];"string"==typeof o[n]&&t[r][n].toLowerCase().indexOf(i)>-1&&a.push(o);var l=data.nodeChildren(e,o);a=a.concat(data.getNodesByParamFuzzy(e,l,n,i))}return a},getNodesByFilter:function(e,t,n,i,a){if(!t)return i?null:[];for(var r=i?null:[],s=0,o=t.length;o>s;s++){var l=t[s];if(tools.apply(n,[l,a],!1)){if(i)return l;r.push(l)}var c=data.nodeChildren(e,l),d=data.getNodesByFilter(e,c,n,i,a);if(i&&d)return d;r=i?d:r.concat(d)}return r},getPreNode:function(e,t){if(!t)return null;for(var n=t.parentTId?t.getParentNode():data.getRoot(e),i=data.nodeChildren(e,n),a=0,r=i.length;r>a;a++)if(i[a]===t)return 0==a?null:i[a-1];return null},getRoot:function(e){return e?roots[e.treeId]:null},getRoots:function(){return roots},getSetting:function(e){return settings[e]},getSettings:function(){return settings},getZTreeTools:function(e){var t=this.getRoot(this.getSetting(e));return t?t.treeTools:null},initCache:function(e){for(var t=0,n=_init.caches.length;n>t;t++)_init.caches[t].apply(this,arguments)},initNode:function(e,t,n,i,a,r){for(var s=0,o=_init.nodes.length;o>s;s++)_init.nodes[s].apply(this,arguments)},initRoot:function(e){for(var t=0,n=_init.roots.length;n>t;t++)_init.roots[t].apply(this,arguments)},isSelectedNode:function(e,t){for(var n=data.getRoot(e),i=0,a=n.curSelectedList.length;a>i;i++)if(t===n.curSelectedList[i])return!0;return!1},nodeChildren:function(e,t,n){if(!t)return null;var i=e.data.key.children;return"undefined"!=typeof n&&(t[i]=n),t[i]},nodeIsParent:function(e,t,n){if(!t)return!1;var i=e.data.key.isParent;return"undefined"!=typeof n&&("string"==typeof n&&(n=tools.eqs(n,"true")),n=!!n,t[i]=n),t[i]},nodeName:function(e,t,n){var i=e.data.key.name;return"undefined"!=typeof n&&(t[i]=n),
""+t[i]},nodeTitle:function(e,t){var n=""===e.data.key.title?e.data.key.name:e.data.key.title;return""+t[n]},removeNodeCache:function(e,t){var n=data.nodeChildren(e,t);if(n)for(var i=0,a=n.length;a>i;i++)data.removeNodeCache(e,n[i]);data.getCache(e).nodes[data.getNodeCacheId(t.tId)]=null},removeSelectedNode:function(e,t){for(var n=data.getRoot(e),i=0,a=n.curSelectedList.length;a>i;i++)t!==n.curSelectedList[i]&&data.getNodeCache(e,n.curSelectedList[i].tId)||(n.curSelectedList.splice(i,1),e.treeObj.trigger(consts.event.UNSELECTED,[e.treeId,t]),i--,a--)},setCache:function(e,t){caches[e.treeId]=t},setRoot:function(e,t){roots[e.treeId]=t},setZTreeTools:function(e,t){for(var n=0,i=_init.zTreeTools.length;i>n;n++)_init.zTreeTools[n].apply(this,arguments)},transformToArrayFormat:function(e,t){function n(t){i.push(t);var n=data.nodeChildren(e,t);n&&(i=i.concat(data.transformToArrayFormat(e,n)))}if(!t)return[];var i=[];if(tools.isArray(t))for(var a=0,r=t.length;r>a;a++){var s=t[a];n(s)}else n(t);return i},transformTozTreeFormat:function(e,t){var n,i,a=e.data.simpleData.idKey,r=e.data.simpleData.pIdKey;if(!a||""==a||!t)return[];if(tools.isArray(t)){var s=[],o={};for(n=0,i=t.length;i>n;n++)o[t[n][a]]=t[n];for(n=0,i=t.length;i>n;n++){var l=o[t[n][r]];if(l&&t[n][a]!=t[n][r]){var c=data.nodeChildren(e,l);c||(c=data.nodeChildren(e,l,[])),c.push(t[n])}else s.push(t[n])}return s}return[t]}},event={bindEvent:function(e){for(var t=0,n=_init.bind.length;n>t;t++)_init.bind[t].apply(this,arguments)},unbindEvent:function(e){for(var t=0,n=_init.unbind.length;n>t;t++)_init.unbind[t].apply(this,arguments)},bindTree:function(e){var t={treeId:e.treeId},n=e.treeObj;e.view.txtSelectedEnable||n.bind("selectstart",handler.onSelectStart).css({"-moz-user-select":"-moz-none"}),n.bind("click",t,event.proxy),n.bind("dblclick",t,event.proxy),n.bind("mouseover",t,event.proxy),n.bind("mouseout",t,event.proxy),n.bind("mousedown",t,event.proxy),n.bind("mouseup",t,event.proxy),n.bind("contextmenu",t,event.proxy)},unbindTree:function(e){var t=e.treeObj;t.unbind("selectstart",handler.onSelectStart).unbind("click",event.proxy).unbind("dblclick",event.proxy).unbind("mouseover",event.proxy).unbind("mouseout",event.proxy).unbind("mousedown",event.proxy).unbind("mouseup",event.proxy).unbind("contextmenu",event.proxy)},doProxy:function(e){for(var t=[],n=0,i=_init.proxys.length;i>n;n++){var a=_init.proxys[n].apply(this,arguments);if(t.push(a),a.stop)break}return t},proxy:function(e){var t=data.getSetting(e.data.treeId);if(!tools.uCanDo(t,e))return!0;for(var n=event.doProxy(e),i=!0,a=!1,r=0,s=n.length;s>r;r++){var o=n[r];o.nodeEventCallback&&(a=!0,i=o.nodeEventCallback.apply(o,[e,o.node])&&i),o.treeEventCallback&&(a=!0,i=o.treeEventCallback.apply(o,[e,o.node])&&i)}return i}},handler={onSwitchNode:function(e,t){var n=data.getSetting(e.data.treeId);if(t.open){if(0==tools.apply(n.callback.beforeCollapse,[n.treeId,t],!0))return!0;data.getRoot(n).expandTriggerFlag=!0,view.switchNode(n,t)}else{if(0==tools.apply(n.callback.beforeExpand,[n.treeId,t],!0))return!0;data.getRoot(n).expandTriggerFlag=!0,view.switchNode(n,t)}return!0},onClickNode:function(e,t){var n=data.getSetting(e.data.treeId),i=n.view.autoCancelSelected&&(e.ctrlKey||e.metaKey)&&data.isSelectedNode(n,t)?0:n.view.autoCancelSelected&&(e.ctrlKey||e.metaKey)&&n.view.selectedMulti?2:1;return 0==tools.apply(n.callback.beforeClick,[n.treeId,t,i],!0)?!0:(0===i?view.cancelPreSelectedNode(n,t):view.selectNode(n,t,2===i),n.treeObj.trigger(consts.event.CLICK,[e,n.treeId,t,i]),!0)},onZTreeMousedown:function(e,t){var n=data.getSetting(e.data.treeId);return tools.apply(n.callback.beforeMouseDown,[n.treeId,t],!0)&&tools.apply(n.callback.onMouseDown,[e,n.treeId,t]),!0},onZTreeMouseup:function(e,t){var n=data.getSetting(e.data.treeId);return tools.apply(n.callback.beforeMouseUp,[n.treeId,t],!0)&&tools.apply(n.callback.onMouseUp,[e,n.treeId,t]),!0},onZTreeDblclick:function(e,t){var n=data.getSetting(e.data.treeId);return tools.apply(n.callback.beforeDblClick,[n.treeId,t],!0)&&tools.apply(n.callback.onDblClick,[e,n.treeId,t]),!0},onZTreeContextmenu:function(e,t){var n=data.getSetting(e.data.treeId);return tools.apply(n.callback.beforeRightClick,[n.treeId,t],!0)&&tools.apply(n.callback.onRightClick,[e,n.treeId,t]),"function"!=typeof n.callback.onRightClick},onSelectStart:function(e){var t=e.originalEvent.srcElement.nodeName.toLowerCase();return"input"===t||"textarea"===t}},tools={apply:function(e,t,n){return"function"==typeof e?e.apply(zt,t?t:[]):n},canAsync:function(e,t){var n=data.nodeChildren(e,t),i=data.nodeIsParent(e,t);return e.async.enable&&t&&i&&!(t.zAsync||n&&n.length>0)},clone:function(e){if(null===e)return null;var t=tools.isArray(e)?[]:{};for(var n in e)t[n]=e[n]instanceof Date?new Date(e[n].getTime()):"object"==typeof e[n]?tools.clone(e[n]):e[n];return t},eqs:function(e,t){return e.toLowerCase()===t.toLowerCase()},isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},isElement:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},$:function(e,t,n){return t&&"string"!=typeof t&&(n=t,t=""),"string"==typeof e?$(e,n?n.treeObj.get(0).ownerDocument:null):$("#"+e.tId+t,n?n.treeObj:null)},getMDom:function(e,t,n){if(!t)return null;for(;t&&t.id!==e.treeId;){for(var i=0,a=n.length;t.tagName&&a>i;i++)if(tools.eqs(t.tagName,n[i].tagName)&&null!==t.getAttribute(n[i].attrName))return t;t=t.parentNode}return null},getNodeMainDom:function(e){return $(e).parent("li").get(0)||$(e).parentsUntil("li").parent().get(0)},isChildOrSelf:function(e,t){return $(e).closest("#"+t).length>0},uCanDo:function(e,t){return!0}},view={addNodes:function(e,t,n,i,a){var r=data.nodeIsParent(e,t);if(!e.data.keep.leaf||!t||r)if(tools.isArray(i)||(i=[i]),e.data.simpleData.enable&&(i=data.transformTozTreeFormat(e,i)),t){var s=$$(t,consts.id.SWITCH,e),o=$$(t,consts.id.ICON,e),l=$$(t,consts.id.UL,e);t.open||(view.replaceSwitchClass(t,s,consts.folder.CLOSE),view.replaceIcoClass(t,o,consts.folder.CLOSE),t.open=!1,l.css({display:"none"})),data.addNodesData(e,t,n,i),view.createNodes(e,t.level+1,i,t,n),a||view.expandCollapseParentNode(e,t,!0)}else data.addNodesData(e,data.getRoot(e),n,i),view.createNodes(e,0,i,null,n)},appendNodes:function(e,t,n,i,a,r,s){if(!n)return[];var o,l,c=[],d=i?i:data.getRoot(e),u=data.nodeChildren(e,d);(!u||a>=u.length-n.length)&&(a=-1);for(var p=0,h=n.length;h>p;p++){var f=n[p];r&&(o=(0===a||u.length==n.length)&&0==p,l=0>a&&p==n.length-1,data.initNode(e,t,f,i,o,l,s),data.addNodeCache(e,f));var m=data.nodeIsParent(e,f),g=[],v=data.nodeChildren(e,f);v&&v.length>0&&(g=view.appendNodes(e,t+1,v,f,-1,r,s&&f.open)),s&&(view.makeDOMNodeMainBefore(c,e,f),view.makeDOMNodeLine(c,e,f),data.getBeforeA(e,f,c),view.makeDOMNodeNameBefore(c,e,f),data.getInnerBeforeA(e,f,c),view.makeDOMNodeIcon(c,e,f),data.getInnerAfterA(e,f,c),view.makeDOMNodeNameAfter(c,e,f),data.getAfterA(e,f,c),m&&f.open&&view.makeUlHtml(e,f,c,g.join("")),view.makeDOMNodeMainAfter(c,e,f),data.addCreatedNode(e,f))}return c},appendParentULDom:function(e,t){var n=[],i=$$(t,e);!i.get(0)&&t.parentTId&&(view.appendParentULDom(e,t.getParentNode()),i=$$(t,e));var a=$$(t,consts.id.UL,e);a.get(0)&&a.remove();var r=data.nodeChildren(e,t),s=view.appendNodes(e,t.level+1,r,t,-1,!1,!0);view.makeUlHtml(e,t,n,s.join("")),i.append(n.join(""))},asyncNode:function(setting,node,isSilent,callback){var i,l,isParent=data.nodeIsParent(setting,node);if(node&&!isParent)return tools.apply(callback),!1;if(node&&node.isAjaxing)return!1;if(0==tools.apply(setting.callback.beforeAsync,[setting.treeId,node],!0))return tools.apply(callback),!1;if(node){node.isAjaxing=!0;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({style:"","class":consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={},autoParam=tools.apply(setting.async.autoParam,[setting.treeId,node],setting.async.autoParam);for(i=0,l=autoParam.length;node&&l>i;i++){var pKey=autoParam[i].split("="),spKey=pKey;pKey.length>1&&(spKey=pKey[1],pKey=pKey[0]),tmpParam[spKey]=node[pKey]}var otherParam=tools.apply(setting.async.otherParam,[setting.treeId,node],setting.async.otherParam);if(tools.isArray(otherParam))for(i=0,l=otherParam.length;l>i;i+=2)tmpParam[otherParam[i]]=otherParam[i+1];else for(var p in otherParam)tmpParam[p]=otherParam[p];var _tmpV=data.getRoot(setting)._ver;return $.ajax({contentType:setting.async.contentType,cache:!1,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:setting.async.contentType.indexOf("application/json")>-1?JSON.stringify(tmpParam):tmpParam,dataType:setting.async.dataType,success:function(msg){if(_tmpV==data.getRoot(setting)._ver){var newNodes=[];try{newNodes=msg&&0!=msg.length?"string"==typeof msg?eval("("+msg+")"):msg:[]}catch(err){newNodes=msg}node&&(node.isAjaxing=null,node.zAsync=!0),view.setNodeLineIcos(setting,node),newNodes&&""!==newNodes?(newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes),view.addNodes(setting,node,-1,newNodes?tools.clone(newNodes):[],!!isSilent)):view.addNodes(setting,node,-1,[],!!isSilent),setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]),tools.apply(callback)}},error:function(e,t,n){_tmpV==data.getRoot(setting)._ver&&(node&&(node.isAjaxing=null),view.setNodeLineIcos(setting,node),setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,e,t,n]))}}),!0},cancelPreSelectedNode:function(e,t,n){var i,a,r=data.getRoot(e).curSelectedList;for(i=r.length-1;i>=0;i--)if(a=r[i],t===a||!t&&(!n||n!==a)){if($$(a,consts.id.A,e).removeClass(consts.node.CURSELECTED),t){data.removeSelectedNode(e,t);break}r.splice(i,1),e.treeObj.trigger(consts.event.UNSELECTED,[e.treeId,a])}},createNodeCallback:function(e){if(e.callback.onNodeCreated||e.view.addDiyDom)for(var t=data.getRoot(e);t.createdNodes.length>0;){var n=t.createdNodes.shift();tools.apply(e.view.addDiyDom,[e.treeId,n]),e.callback.onNodeCreated&&e.treeObj.trigger(consts.event.NODECREATED,[e.treeId,n])}},createNodes:function(e,t,n,i,a){if(n&&0!=n.length){var r=data.getRoot(e),s=!i||i.open||!!$$(data.nodeChildren(e,i)[0],e).get(0);r.createdNodes=[];var o,l,c=view.appendNodes(e,t,n,i,a,!0,s);if(i){var d=$$(i,consts.id.UL,e);d.get(0)&&(o=d)}else o=e.treeObj;o&&(a>=0&&(l=o.children()[a]),a>=0&&l?$(l).before(c.join("")):o.append(c.join(""))),view.createNodeCallback(e)}},destroy:function(e){e&&(data.initCache(e),data.initRoot(e),event.unbindTree(e),event.unbindEvent(e),e.treeObj.empty(),delete settings[e.treeId])},expandCollapseNode:function(e,t,n,i,a){var r,s,o=data.getRoot(e);if(!t)return void tools.apply(a,[]);var l=data.nodeChildren(e,t),c=data.nodeIsParent(e,t);if(o.expandTriggerFlag&&(s=a,r=function(){s&&s(),t.open?e.treeObj.trigger(consts.event.EXPAND,[e.treeId,t]):e.treeObj.trigger(consts.event.COLLAPSE,[e.treeId,t])},a=r,o.expandTriggerFlag=!1),!t.open&&c&&(!$$(t,consts.id.UL,e).get(0)||l&&l.length>0&&!$$(l[0],e).get(0))&&(view.appendParentULDom(e,t),view.createNodeCallback(e)),t.open==n)return void tools.apply(a,[]);var d=$$(t,consts.id.UL,e),u=$$(t,consts.id.SWITCH,e),p=$$(t,consts.id.ICON,e);c?(t.open=!t.open,t.iconOpen&&t.iconClose&&p.attr("style",view.makeNodeIcoStyle(e,t)),t.open?(view.replaceSwitchClass(t,u,consts.folder.OPEN),view.replaceIcoClass(t,p,consts.folder.OPEN),0==i||""==e.view.expandSpeed?(d.show(),tools.apply(a,[])):l&&l.length>0?d.slideDown(e.view.expandSpeed,a):(d.show(),tools.apply(a,[]))):(view.replaceSwitchClass(t,u,consts.folder.CLOSE),view.replaceIcoClass(t,p,consts.folder.CLOSE),0!=i&&""!=e.view.expandSpeed&&l&&l.length>0?d.slideUp(e.view.expandSpeed,a):(d.hide(),tools.apply(a,[])))):tools.apply(a,[])},expandCollapseParentNode:function(e,t,n,i,a){if(t){if(!t.parentTId)return void view.expandCollapseNode(e,t,n,i,a);view.expandCollapseNode(e,t,n,i),t.parentTId&&view.expandCollapseParentNode(e,t.getParentNode(),n,i,a)}},expandCollapseSonNode:function(e,t,n,i,a){var r=data.getRoot(e),s=t?data.nodeChildren(e,t):data.nodeChildren(e,r),o=t?!1:i,l=data.getRoot(e).expandTriggerFlag;if(data.getRoot(e).expandTriggerFlag=!1,s)for(var c=0,d=s.length;d>c;c++)s[c]&&view.expandCollapseSonNode(e,s[c],n,o);data.getRoot(e).expandTriggerFlag=l,view.expandCollapseNode(e,t,n,i,a)},isSelectedNode:function(e,t){if(!t)return!1;var n,i=data.getRoot(e).curSelectedList;for(n=i.length-1;n>=0;n--)if(t===i[n])return!0;return!1},makeDOMNodeIcon:function(e,t,n){var i=data.nodeName(t,n),a=t.view.nameIsHTML?i:i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e.push("<span id='",n.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(t,n),"' style='",view.makeNodeIcoStyle(t,n),"'></span><span id='",n.tId,consts.id.SPAN,"' class='",consts.className.NAME,"'>",a,"</span>")},makeDOMNodeLine:function(e,t,n){e.push("<span id='",n.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(t,n),"' treeNode",consts.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(e,t,n){e.push("</li>")},makeDOMNodeMainBefore:function(e,t,n){e.push("<li id='",n.tId,"' class='",consts.className.LEVEL,n.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(e,t,n){e.push("</a>")},makeDOMNodeNameBefore:function(e,t,n){var i=data.nodeTitle(t,n),a=view.makeNodeUrl(t,n),r=view.makeNodeFontCss(t,n),s=[];for(var o in r)s.push(o,":",r[o],";");e.push("<a id='",n.tId,consts.id.A,"' class='",consts.className.LEVEL,n.level,"' treeNode",consts.id.A,' onclick="',n.click||"",'" ',null!=a&&a.length>0?"href='"+a+"'":""," target='",view.makeNodeTarget(n),"' style='",s.join(""),"'"),tools.apply(t.view.showTitle,[t.treeId,n],t.view.showTitle)&&i&&e.push("title='",i.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'"),e.push(">")},makeNodeFontCss:function(e,t){var n=tools.apply(e.view.fontCss,[e.treeId,t],e.view.fontCss);return n&&"function"!=typeof n?n:{}},makeNodeIcoClass:function(e,t){var n=["ico"];if(!t.isAjaxing){var i=data.nodeIsParent(e,t);n[0]=(t.iconSkin?t.iconSkin+"_":"")+n[0],i?n.push(t.open?consts.folder.OPEN:consts.folder.CLOSE):n.push(consts.folder.DOCU)}return consts.className.BUTTON+" "+n.join("_")},makeNodeIcoStyle:function(e,t){var n=[];if(!t.isAjaxing){var i=data.nodeIsParent(e,t),a=i&&t.iconOpen&&t.iconClose?t.open?t.iconOpen:t.iconClose:t[e.data.key.icon];a&&n.push("background:url(",a,") 0 0 no-repeat;"),0!=e.view.showIcon&&tools.apply(e.view.showIcon,[e.treeId,t],!0)||n.push("width:0px;height:0px;")}return n.join("")},makeNodeLineClass:function(e,t){var n=[];return e.view.showLine?0==t.level&&t.isFirstNode&&t.isLastNode?n.push(consts.line.ROOT):0==t.level&&t.isFirstNode?n.push(consts.line.ROOTS):t.isLastNode?n.push(consts.line.BOTTOM):n.push(consts.line.CENTER):n.push(consts.line.NOLINE),data.nodeIsParent(e,t)?n.push(t.open?consts.folder.OPEN:consts.folder.CLOSE):n.push(consts.folder.DOCU),view.makeNodeLineClassEx(t)+n.join("_")},makeNodeLineClassEx:function(e){return consts.className.BUTTON+" "+consts.className.LEVEL+e.level+" "+consts.className.SWITCH+" "},makeNodeTarget:function(e){return e.target||"_blank"},makeNodeUrl:function(e,t){var n=e.data.key.url;return t[n]?t[n]:null},makeUlHtml:function(e,t,n,i){n.push("<ul id='",t.tId,consts.id.UL,"' class='",consts.className.LEVEL,t.level," ",view.makeUlLineClass(e,t),"' style='display:",t.open?"block":"none","'>"),n.push(i),n.push("</ul>")},makeUlLineClass:function(e,t){return e.view.showLine&&!t.isLastNode?consts.line.LINE:""},removeChildNodes:function(e,t){if(t){var n=data.nodeChildren(e,t);if(n){for(var i=0,a=n.length;a>i;i++)data.removeNodeCache(e,n[i]);if(data.removeSelectedNode(e),delete t[e.data.key.children],e.data.keep.parent)$$(t,consts.id.UL,e).empty();else{data.nodeIsParent(e,t,!1),t.open=!1;var r=$$(t,consts.id.SWITCH,e),s=$$(t,consts.id.ICON,e);view.replaceSwitchClass(t,r,consts.folder.DOCU),view.replaceIcoClass(t,s,consts.folder.DOCU),$$(t,consts.id.UL,e).remove()}}}},scrollIntoView:function(e,t){if(t){if("undefined"==typeof Element){var n=e.treeObj.get(0).getBoundingClientRect(),i=t.getBoundingClientRect();return void((i.top<n.top||i.bottom>n.bottom||i.right>n.right||i.left<n.left)&&t.scrollIntoView())}Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){function t(t,n,i,a){return!1===e||t+a>=i&&n+a>=t?Math.min(i,Math.max(n,t)):(n+i)/2}function n(e,t,i,a){return{left:e,top:t,width:i,height:a,right:e+i,bottom:t+a,translate:function(r,s){return n(r+e,s+t,i,a)},relativeFromTo:function(s,o){var l=e,c=t;if(s=s.offsetParent,o=o.offsetParent,s===o)return r;for(;s;s=s.offsetParent)l+=s.offsetLeft+s.clientLeft,c+=s.offsetTop+s.clientTop;for(;o;o=o.offsetParent)l-=o.offsetLeft+o.clientLeft,c-=o.offsetTop+o.clientTop;return n(l,c,i,a)}}}for(var i,a=this,r=n(this.offsetLeft,this.offsetTop,this.offsetWidth,this.offsetHeight);tools.isElement(i=a.parentNode);){var s=i.offsetLeft+i.clientLeft,o=i.offsetTop+i.clientTop;r=r.relativeFromTo(a,i).translate(-s,-o),i.scrollLeft=t(i.scrollLeft,r.right-i.clientWidth,r.left,i.clientWidth),i.scrollTop=t(i.scrollTop,r.bottom-i.clientHeight,r.top,i.clientHeight),r=r.translate(s-i.scrollLeft,o-i.scrollTop),a=i}}),t.scrollIntoViewIfNeeded()}},setFirstNode:function(e,t){var n=data.nodeChildren(e,t);n.length>0&&(n[0].isFirstNode=!0)},setLastNode:function(e,t){var n=data.nodeChildren(e,t);n.length>0&&(n[n.length-1].isLastNode=!0)},removeNode:function(e,t){var n=data.getRoot(e),i=t.parentTId?t.getParentNode():n;if(t.isFirstNode=!1,t.isLastNode=!1,t.getPreNode=function(){return null},t.getNextNode=function(){return null},data.getNodeCache(e,t.tId)){$$(t,e).remove(),data.removeNodeCache(e,t),data.removeSelectedNode(e,t);for(var a=data.nodeChildren(e,i),r=0,s=a.length;s>r;r++)if(a[r].tId==t.tId){a.splice(r,1);break}view.setFirstNode(e,i),view.setLastNode(e,i);var o,l,c,d=a.length;if(e.data.keep.parent||0!=d){if(e.view.showLine&&d>0){var u=a[d-1];if(o=$$(u,consts.id.UL,e),l=$$(u,consts.id.SWITCH,e),c=$$(u,consts.id.ICON,e),i==n)if(1==a.length)view.replaceSwitchClass(u,l,consts.line.ROOT);else{var p=$$(a[0],consts.id.SWITCH,e);view.replaceSwitchClass(a[0],p,consts.line.ROOTS),view.replaceSwitchClass(u,l,consts.line.BOTTOM)}else view.replaceSwitchClass(u,l,consts.line.BOTTOM);o.removeClass(consts.line.LINE)}}else data.nodeIsParent(e,i,!1),i.open=!1,delete i[e.data.key.children],o=$$(i,consts.id.UL,e),l=$$(i,consts.id.SWITCH,e),c=$$(i,consts.id.ICON,e),view.replaceSwitchClass(i,l,consts.folder.DOCU),view.replaceIcoClass(i,c,consts.folder.DOCU),o.css("display","none")}},replaceIcoClass:function(e,t,n){if(t&&!e.isAjaxing){var i=t.attr("class");if(void 0!=i){var a=i.split("_");switch(n){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:a[a.length-1]=n}t.attr("class",a.join("_"))}}},replaceSwitchClass:function(e,t,n){if(t){var i=t.attr("class");if(void 0!=i){var a=i.split("_");switch(n){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:a[0]=view.makeNodeLineClassEx(e)+n;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:a[1]=n}t.attr("class",a.join("_")),n!==consts.folder.DOCU?t.removeAttr("disabled"):t.attr("disabled","disabled")}}},selectNode:function(e,t,n){n||view.cancelPreSelectedNode(e,null,t),$$(t,consts.id.A,e).addClass(consts.node.CURSELECTED),data.addSelectedNode(e,t),e.treeObj.trigger(consts.event.SELECTED,[e.treeId,t])},setNodeFontCss:function(e,t){var n=$$(t,consts.id.A,e),i=view.makeNodeFontCss(e,t);i&&n.css(i)},setNodeLineIcos:function(e,t){if(t){var n=$$(t,consts.id.SWITCH,e),i=$$(t,consts.id.UL,e),a=$$(t,consts.id.ICON,e),r=view.makeUlLineClass(e,t);0==r.length?i.removeClass(consts.line.LINE):i.addClass(r),n.attr("class",view.makeNodeLineClass(e,t)),data.nodeIsParent(e,t)?n.removeAttr("disabled"):n.attr("disabled","disabled"),a.removeAttr("style"),a.attr("style",view.makeNodeIcoStyle(e,t)),a.attr("class",view.makeNodeIcoClass(e,t))}},setNodeName:function(e,t){var n=data.nodeTitle(e,t),i=$$(t,consts.id.SPAN,e);if(i.empty(),e.view.nameIsHTML?i.html(data.nodeName(e,t)):i.text(data.nodeName(e,t)),tools.apply(e.view.showTitle,[e.treeId,t],e.view.showTitle)){var a=$$(t,consts.id.A,e);a.attr("title",n?n:"")}},setNodeTarget:function(e,t){var n=$$(t,consts.id.A,e);n.attr("target",view.makeNodeTarget(t))},setNodeUrl:function(e,t){var n=$$(t,consts.id.A,e),i=view.makeNodeUrl(e,t);null==i||0==i.length?n.removeAttr("href"):n.attr("href",i)},switchNode:function(e,t){if(t.open||!tools.canAsync(e,t))view.expandCollapseNode(e,t,!t.open);else if(e.async.enable){if(!view.asyncNode(e,t))return void view.expandCollapseNode(e,t,!t.open)}else t&&view.expandCollapseNode(e,t,!t.open)}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(e){var t=data.getZTreeTools(e);return t?t:null},destroy:function(e){if(e&&e.length>0)view.destroy(data.getSetting(e));else for(var t in settings)view.destroy(settings[t])},init:function(e,t,n){var i=tools.clone(_setting);$.extend(!0,i,t),i.treeId=e.attr("id"),i.treeObj=e,i.treeObj.empty(),settings[i.treeId]=i,"undefined"==typeof document.body.style.maxHeight&&(i.view.expandSpeed=""),data.initRoot(i);var a=data.getRoot(i);n=n?tools.clone(tools.isArray(n)?n:[n]):[],i.data.simpleData.enable?data.nodeChildren(i,a,data.transformTozTreeFormat(i,n)):data.nodeChildren(i,a,n),data.initCache(i),event.unbindTree(i),event.bindTree(i),event.unbindEvent(i),event.bindEvent(i);var r={setting:i,addNodes:function(e,t,n,a){function r(){view.addNodes(i,e,t,l,1==a)}e||(e=null);var s=data.nodeIsParent(i,e);if(e&&!s&&i.data.keep.leaf)return null;var o=parseInt(t,10);if(isNaN(o)?(a=!!n,n=t,t=-1):t=o,!n)return null;var l=tools.clone(tools.isArray(n)?n:[n]);return tools.canAsync(i,e)?view.asyncNode(i,e,a,r):r(),l},cancelSelectedNode:function(e){view.cancelPreSelectedNode(i,e)},destroy:function(){view.destroy(i)},expandAll:function(e){return e=!!e,view.expandCollapseSonNode(i,null,e,!0),e},expandNode:function(e,t,n,a,r){function s(){var t=$$(e,i).get(0);t&&a!==!1&&view.scrollIntoView(i,t)}return e&&data.nodeIsParent(i,e)?(t!==!0&&t!==!1&&(t=!e.open),r=!!r,r&&t&&0==tools.apply(i.callback.beforeExpand,[i.treeId,e],!0)?null:r&&!t&&0==tools.apply(i.callback.beforeCollapse,[i.treeId,e],!0)?null:(t&&e.parentTId&&view.expandCollapseParentNode(i,e.getParentNode(),t,!1),t!==e.open||n?(data.getRoot(i).expandTriggerFlag=r,!tools.canAsync(i,e)&&n?view.expandCollapseSonNode(i,e,t,!0,s):(e.open=!t,view.switchNode(this.setting,e),s()),t):null)):null},getNodes:function(){return data.getNodes(i)},getNodeByParam:function(e,t,n){return e?data.getNodeByParam(i,n?data.nodeChildren(i,n):data.getNodes(i),e,t):null},getNodeByTId:function(e){return data.getNodeCache(i,e)},getNodesByParam:function(e,t,n){return e?data.getNodesByParam(i,n?data.nodeChildren(i,n):data.getNodes(i),e,t):null},getNodesByParamFuzzy:function(e,t,n){return e?data.getNodesByParamFuzzy(i,n?data.nodeChildren(i,n):data.getNodes(i),e,t):null},getNodesByFilter:function(e,t,n,a){return t=!!t,e&&"function"==typeof e?data.getNodesByFilter(i,n?data.nodeChildren(i,n):data.getNodes(i),e,t,a):t?null:[]},getNodeIndex:function(e){if(!e)return null;for(var t=e.parentTId?e.getParentNode():data.getRoot(i),n=data.nodeChildren(i,t),a=0,r=n.length;r>a;a++)if(n[a]==e)return a;return-1},getSelectedNodes:function(){for(var e=[],t=data.getRoot(i).curSelectedList,n=0,a=t.length;a>n;n++)e.push(t[n]);return e},isSelectedNode:function(e){return data.isSelectedNode(i,e)},reAsyncChildNodesPromise:function(e,t,n){var i=new Promise(function(i,a){try{r.reAsyncChildNodes(e,t,n,function(){i(e)})}catch(s){a(s)}});return i},reAsyncChildNodes:function(e,t,n,a){if(this.setting.async.enable){var r=!e;if(r&&(e=data.getRoot(i)),"refresh"==t){for(var s=data.nodeChildren(i,e),o=0,l=s?s.length:0;l>o;o++)data.removeNodeCache(i,s[o]);if(data.removeSelectedNode(i),data.nodeChildren(i,e,[]),r)this.setting.treeObj.empty();else{var c=$$(e,consts.id.UL,i);c.empty()}}view.asyncNode(this.setting,r?null:e,!!n,a)}},refresh:function(){this.setting.treeObj.empty();var e=data.getRoot(i),t=data.nodeChildren(i,e);data.initRoot(i),data.nodeChildren(i,e,t),data.initCache(i),view.createNodes(i,0,data.nodeChildren(i,e),null,-1)},removeChildNodes:function(e){if(!e)return null;var t=data.nodeChildren(i,e);return view.removeChildNodes(i,e),t?t:null},removeNode:function(e,t){e&&(t=!!t,t&&0==tools.apply(i.callback.beforeRemove,[i.treeId,e],!0)||(view.removeNode(i,e),t&&this.setting.treeObj.trigger(consts.event.REMOVE,[i.treeId,e])))},selectNode:function(e,t,n){function a(){if(!n){var t=$$(e,i).get(0);view.scrollIntoView(i,t)}}if(e&&tools.uCanDo(i)){if(t=i.view.selectedMulti&&t,e.parentTId)view.expandCollapseParentNode(i,e.getParentNode(),!0,!1,a);else if(!n)try{$$(e,i).focus().blur()}catch(r){}view.selectNode(i,e,t)}},transformTozTreeNodes:function(e){return data.transformTozTreeFormat(i,e)},transformToArray:function(e){return data.transformToArrayFormat(i,e)},updateNode:function(e,t){if(e){var n=$$(e,i);n.get(0)&&tools.uCanDo(i)&&(view.setNodeName(i,e),view.setNodeTarget(i,e),view.setNodeUrl(i,e),view.setNodeLineIcos(i,e),view.setNodeFontCss(i,e))}}};a.treeTools=r,data.setZTreeTools(i,r);var s=data.nodeChildren(i,a);return s&&s.length>0?view.createNodes(i,0,s,null,-1):i.async.enable&&i.async.url&&""!==i.async.url&&view.asyncNode(i),r}};var zt=$.fn.zTree,$$=tools.$,consts=zt.consts}(jQuery),function(e){var t={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},n={check:{enable:!1,autoCheckTrigger:!1,chkStyle:t.checkbox.STYLE,nocheckInherit:!1,chkDisabledInherit:!1,radioType:t.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},i=function(e){var t=w.getRoot(e);t.radioCheckedList=[]},a=function(e){},r=function(e){var t=e.treeObj,n=y.event;t.bind(n.CHECK,function(t,n,i,a){t.srcEvent=n,_.apply(e.callback.onCheck,[t,i,a])})},s=function(e){var t=e.treeObj,n=y.event;t.unbind(n.CHECK)},o=function(e){var t=e.target,n=w.getSetting(e.data.treeId),i="",a=null,r="",s="",o=null,l=null;if(_.eqs(e.type,"mouseover")?n.check.enable&&_.eqs(t.tagName,"span")&&null!==t.getAttribute("treeNode"+y.id.CHECK)&&(i=_.getNodeMainDom(t).id,r="mouseoverCheck"):_.eqs(e.type,"mouseout")?n.check.enable&&_.eqs(t.tagName,"span")&&null!==t.getAttribute("treeNode"+y.id.CHECK)&&(i=_.getNodeMainDom(t).id,r="mouseoutCheck"):_.eqs(e.type,"click")&&n.check.enable&&_.eqs(t.tagName,"span")&&null!==t.getAttribute("treeNode"+y.id.CHECK)&&(i=_.getNodeMainDom(t).id,r="checkNode"),i.length>0)switch(a=w.getNodeCache(n,i),r){case"checkNode":o=h.onCheckNode;break;case"mouseoverCheck":o=h.onMouseoverCheck;break;case"mouseoutCheck":o=h.onMouseoutCheck}var c={stop:"checkNode"===r,node:a,nodeEventType:r,nodeEventCallback:o,treeEventType:s,treeEventCallback:l};return c},l=function(e,t,n,i,a,r,s){if(n){var o=w.nodeChecked(e,n);if(o=w.nodeChecked(e,n,o),n.checkedOld=o,"string"==typeof n.nocheck&&(n.nocheck=_.eqs(n.nocheck,"true")),n.nocheck=!!n.nocheck||e.check.nocheckInherit&&i&&!!i.nocheck,"string"==typeof n.chkDisabled&&(n.chkDisabled=_.eqs(n.chkDisabled,"true")),n.chkDisabled=!!n.chkDisabled||e.check.chkDisabledInherit&&i&&!!i.chkDisabled,"string"==typeof n.halfCheck&&(n.halfCheck=_.eqs(n.halfCheck,"true")),n.halfCheck=!!n.halfCheck,n.check_Child_State=-1,n.check_Focus=!1,n.getCheckStatus=function(){return w.getCheckStatus(e,n)},e.check.chkStyle==y.radio.STYLE&&e.check.radioType==y.radio.TYPE_ALL&&o){var l=w.getRoot(e);l.radioCheckedList.push(n)}}},c=function(e,t,n){e.check.enable&&(w.makeChkFlag(e,t),n.push("<span ID='",t.tId,y.id.CHECK,"' class='",b.makeChkClass(e,t),"' treeNode",y.id.CHECK,t.nocheck===!0?" style='display:none;'":"","></span>"))},d=function(e,t){t.checkNode=function(t,n,i,a){var r=w.nodeChecked(e,t);if(t.chkDisabled!==!0&&(n!==!0&&n!==!1&&(n=!r),a=!!a,(r!==n||i)&&(!a||0!=_.apply(this.setting.callback.beforeCheck,[this.setting.treeId,t],!0))&&_.uCanDo(this.setting)&&this.setting.check.enable&&t.nocheck!==!0)){w.nodeChecked(e,t,n);var s=M(t,y.id.CHECK,this.setting);(i||this.setting.check.chkStyle===y.radio.STYLE)&&b.checkNodeRelation(this.setting,t),b.setChkClass(this.setting,s,t),b.repairParentChkClassWithSelf(this.setting,t),a&&this.setting.treeObj.trigger(y.event.CHECK,[null,this.setting.treeId,t])}},t.checkAllNodes=function(e){b.repairAllChk(this.setting,!!e)},t.getCheckedNodes=function(t){var t=t!==!1,n=w.nodeChildren(e,w.getRoot(this.setting));return w.getTreeCheckedNodes(this.setting,n,t)},t.getChangeCheckedNodes=function(){var t=w.nodeChildren(e,w.getRoot(this.setting));return w.getTreeChangeCheckedNodes(this.setting,t)},t.setChkDisabled=function(e,t,n,i){t=!!t,n=!!n,i=!!i,b.repairSonChkDisabled(this.setting,e,t,i),b.repairParentChkDisabled(this.setting,e.getParentNode(),t,n)};var n=t.updateNode;t.updateNode=function(e,i){if(n&&n.apply(t,arguments),e&&this.setting.check.enable){var a=M(e,this.setting);if(a.get(0)&&_.uCanDo(this.setting)){var r=M(e,y.id.CHECK,this.setting);(1==i||this.setting.check.chkStyle===y.radio.STYLE)&&b.checkNodeRelation(this.setting,e),b.setChkClass(this.setting,r,e),b.repairParentChkClassWithSelf(this.setting,e)}}}},u={getRadioCheckedList:function(e){for(var t=w.getRoot(e).radioCheckedList,n=0,i=t.length;i>n;n++)w.getNodeCache(e,t[n].tId)||(t.splice(n,1),n--,i--);return t},getCheckStatus:function(e,t){if(!e.check.enable||t.nocheck||t.chkDisabled)return null;var n=w.nodeChecked(e,t),i={checked:n,half:t.halfCheck?t.halfCheck:e.check.chkStyle==y.radio.STYLE?2===t.check_Child_State:n?t.check_Child_State>-1&&t.check_Child_State<2:t.check_Child_State>0};return i},getTreeCheckedNodes:function(e,t,n,i){if(!t)return[];var a=n&&e.check.chkStyle==y.radio.STYLE&&e.check.radioType==y.radio.TYPE_ALL;i=i?i:[];for(var r=0,s=t.length;s>r;r++){var o=t[r],l=w.nodeChildren(e,o),c=w.nodeChecked(e,o);if(o.nocheck!==!0&&o.chkDisabled!==!0&&c==n&&(i.push(o),a))break;if(w.getTreeCheckedNodes(e,l,n,i),a&&i.length>0)break}return i},getTreeChangeCheckedNodes:function(e,t,n){if(!t)return[];n=n?n:[];for(var i=0,a=t.length;a>i;i++){var r=t[i],s=w.nodeChildren(e,r),o=w.nodeChecked(e,r);r.nocheck!==!0&&r.chkDisabled!==!0&&o!=r.checkedOld&&n.push(r),w.getTreeChangeCheckedNodes(e,s,n)}return n},makeChkFlag:function(e,t){if(t){var n=-1,i=w.nodeChildren(e,t);if(i)for(var a=0,r=i.length;r>a;a++){var s=i[a],o=w.nodeChecked(e,s),l=-1;if(e.check.chkStyle==y.radio.STYLE){if(l=s.nocheck===!0||s.chkDisabled===!0?s.check_Child_State:s.halfCheck===!0?2:o?2:s.check_Child_State>0?2:0,2==l){n=2;break}0==l&&(n=0)}else if(e.check.chkStyle==y.checkbox.STYLE){if(l=s.nocheck===!0||s.chkDisabled===!0?s.check_Child_State:s.halfCheck===!0?1:o?-1===s.check_Child_State||2===s.check_Child_State?2:1:s.check_Child_State>0?1:0,1===l){n=1;break}if(2===l&&n>-1&&a>0&&l!==n){n=1;break}if(2===n&&l>-1&&2>l){n=1;break}l>-1&&(n=l)}}t.check_Child_State=n}}},p={},h={onCheckNode:function(e,t){if(t.chkDisabled===!0)return!1;var n=w.getSetting(e.data.treeId);if(0==_.apply(n.callback.beforeCheck,[n.treeId,t],!0))return!0;var i=w.nodeChecked(n,t);w.nodeChecked(n,t,!i),b.checkNodeRelation(n,t);var a=M(t,y.id.CHECK,n);return b.setChkClass(n,a,t),b.repairParentChkClassWithSelf(n,t),n.treeObj.trigger(y.event.CHECK,[e,n.treeId,t]),!0},onMouseoverCheck:function(e,t){if(t.chkDisabled===!0)return!1;var n=w.getSetting(e.data.treeId),i=M(t,y.id.CHECK,n);return t.check_Focus=!0,b.setChkClass(n,i,t),!0},onMouseoutCheck:function(e,t){if(t.chkDisabled===!0)return!1;var n=w.getSetting(e.data.treeId),i=M(t,y.id.CHECK,n);return t.check_Focus=!1,b.setChkClass(n,i,t),!0}},f={},m={checkNodeRelation:function(e,t){var n,i,a,r=y.radio,s=w.nodeChecked(e,t);if(e.check.chkStyle==r.STYLE){var o=w.getRadioCheckedList(e);if(s)if(e.check.radioType==r.TYPE_ALL){
for(i=o.length-1;i>=0;i--){n=o[i];var l=w.nodeChecked(e,n);l&&n!=t&&(w.nodeChecked(e,n,!1),o.splice(i,1),b.setChkClass(e,M(n,y.id.CHECK,e),n),n.parentTId!=t.parentTId&&b.repairParentChkClassWithSelf(e,n))}o.push(t)}else{var c=t.parentTId?t.getParentNode():w.getRoot(e),d=w.nodeChildren(e,c);for(i=0,a=d.length;a>i;i++){n=d[i];var l=w.nodeChecked(e,n);l&&n!=t&&(w.nodeChecked(e,n,!1),b.setChkClass(e,M(n,y.id.CHECK,e),n))}}else if(e.check.radioType==r.TYPE_ALL)for(i=0,a=o.length;a>i;i++)if(t==o[i]){o.splice(i,1);break}}else{var d=w.nodeChildren(e,t);s&&(!d||0==d.length||e.check.chkboxType.Y.indexOf("s")>-1)&&b.setSonNodeCheckBox(e,t,!0),s||d&&0!=d.length&&!(e.check.chkboxType.N.indexOf("s")>-1)||b.setSonNodeCheckBox(e,t,!1),s&&e.check.chkboxType.Y.indexOf("p")>-1&&b.setParentNodeCheckBox(e,t,!0),!s&&e.check.chkboxType.N.indexOf("p")>-1&&b.setParentNodeCheckBox(e,t,!1)}},makeChkClass:function(e,t){var n=y.checkbox,i=y.radio,a="",r=w.nodeChecked(e,t);a=t.chkDisabled===!0?n.DISABLED:t.halfCheck?n.PART:e.check.chkStyle==i.STYLE?t.check_Child_State<1?n.FULL:n.PART:r?2===t.check_Child_State||-1===t.check_Child_State?n.FULL:n.PART:t.check_Child_State<1?n.FULL:n.PART;var s=e.check.chkStyle+"_"+(r?n.TRUE:n.FALSE)+"_"+a;return s=t.check_Focus&&t.chkDisabled!==!0?s+"_"+n.FOCUS:s,y.className.BUTTON+" "+n.DEFAULT+" "+s},repairAllChk:function(e,t){if(e.check.enable&&e.check.chkStyle===y.checkbox.STYLE)for(var n=w.getRoot(e),i=w.nodeChildren(e,n),a=0,r=i.length;r>a;a++){var s=i[a];s.nocheck!==!0&&s.chkDisabled!==!0&&w.nodeChecked(e,s,t),b.setSonNodeCheckBox(e,s,t)}},repairChkClass:function(e,t){if(t&&(w.makeChkFlag(e,t),t.nocheck!==!0)){var n=M(t,y.id.CHECK,e);b.setChkClass(e,n,t)}},repairParentChkClass:function(e,t){if(t&&t.parentTId){var n=t.getParentNode();b.repairChkClass(e,n),b.repairParentChkClass(e,n)}},repairParentChkClassWithSelf:function(e,t){if(t){var n=w.nodeChildren(e,t);n&&n.length>0?b.repairParentChkClass(e,n[0]):b.repairParentChkClass(e,t)}},repairSonChkDisabled:function(e,t,n,i){if(t){t.chkDisabled!=n&&(t.chkDisabled=n),b.repairChkClass(e,t);var a=w.nodeChildren(e,t);if(a&&i)for(var r=0,s=a.length;s>r;r++){var o=a[r];b.repairSonChkDisabled(e,o,n,i)}}},repairParentChkDisabled:function(e,t,n,i){t&&(t.chkDisabled!=n&&i&&(t.chkDisabled=n),b.repairChkClass(e,t),b.repairParentChkDisabled(e,t.getParentNode(),n,i))},setChkClass:function(e,t,n){t&&(n.nocheck===!0?t.hide():t.show(),t.attr("class",b.makeChkClass(e,n)))},setParentNodeCheckBox:function(e,t,n,i){var a=M(t,y.id.CHECK,e);if(i||(i=t),w.makeChkFlag(e,t),t.nocheck!==!0&&t.chkDisabled!==!0&&(w.nodeChecked(e,t,n),b.setChkClass(e,a,t),e.check.autoCheckTrigger&&t!=i&&e.treeObj.trigger(y.event.CHECK,[null,e.treeId,t])),t.parentTId){var r=!0;if(!n)for(var s=w.nodeChildren(e,t.getParentNode()),o=0,l=s.length;l>o;o++){var c=s[o],d=w.nodeChecked(e,c);if(c.nocheck!==!0&&c.chkDisabled!==!0&&d||(c.nocheck===!0||c.chkDisabled===!0)&&c.check_Child_State>0){r=!1;break}}r&&b.setParentNodeCheckBox(e,t.getParentNode(),n,i)}},setSonNodeCheckBox:function(e,t,n,i){if(t){var a=M(t,y.id.CHECK,e);i||(i=t);var r=!1,s=w.nodeChildren(e,t);if(s)for(var o=0,l=s.length;l>o;o++){var c=s[o];b.setSonNodeCheckBox(e,c,n,i),c.chkDisabled===!0&&(r=!0)}t!=w.getRoot(e)&&t.chkDisabled!==!0&&(r&&t.nocheck!==!0&&w.makeChkFlag(e,t),t.nocheck!==!0&&t.chkDisabled!==!0?(w.nodeChecked(e,t,n),r||(t.check_Child_State=s&&s.length>0?n?2:0:-1)):t.check_Child_State=-1,b.setChkClass(e,a,t),e.check.autoCheckTrigger&&t!=i&&t.nocheck!==!0&&t.chkDisabled!==!0&&e.treeObj.trigger(y.event.CHECK,[null,e.treeId,t]))}}},g={tools:f,view:m,event:p,data:u};e.extend(!0,e.fn.zTree.consts,t),e.extend(!0,e.fn.zTree._z,g);var v=e.fn.zTree,_=v._z.tools,y=v.consts,b=v._z.view,w=v._z.data,M=(v._z.event,_.$);w.nodeChecked=function(e,t,n){if(!t)return!1;var i=e.data.key.checked;return"undefined"!=typeof n&&("string"==typeof n&&(n=_.eqs(checked,"true")),n=!!n,t[i]=n),t[i]},w.exSetting(n),w.addInitBind(r),w.addInitUnBind(s),w.addInitCache(a),w.addInitNode(l),w.addInitProxy(o,!0),w.addInitRoot(i),w.addBeforeA(c),w.addZTreeTools(d);var T=b.createNodes;b.createNodes=function(e,t,n,i,a){T&&T.apply(b,arguments),n&&b.repairParentChkClassWithSelf(e,i)};var L=b.removeNode;b.removeNode=function(e,t){var n=t.getParentNode();L&&L.apply(b,arguments),t&&n&&(b.repairChkClass(e,n),b.repairParentChkClass(e,n))};var x=b.appendNodes;b.appendNodes=function(e,t,n,i,a,r,s){var o="";return x&&(o=x.apply(b,arguments)),i&&w.makeChkFlag(e,i),o}}(jQuery),function(e){var t={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},n={edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}},i=function(e){var t=b.getRoot(e),n=b.getRoots();t.curEditNode=null,t.curEditInput=null,t.curHoverNode=null,t.dragFlag=0,t.dragNodeShowBefore=[],t.dragMaskList=new Array,n.showHoverDom=!0},a=function(e){},r=function(e){var t=e.treeObj,n=_.event;t.bind(n.RENAME,function(t,n,i,a){v.apply(e.callback.onRename,[t,n,i,a])}),t.bind(n.DRAG,function(t,n,i,a){v.apply(e.callback.onDrag,[n,i,a])}),t.bind(n.DRAGMOVE,function(t,n,i,a){v.apply(e.callback.onDragMove,[n,i,a])}),t.bind(n.DROP,function(t,n,i,a,r,s,o){v.apply(e.callback.onDrop,[n,i,a,r,s,o])})},s=function(e){var t=e.treeObj,n=_.event;t.unbind(n.RENAME),t.unbind(n.DRAG),t.unbind(n.DRAGMOVE),t.unbind(n.DROP)},o=function(e){var t=e.target,n=b.getSetting(e.data.treeId),i=e.relatedTarget,a="",r=null,s="",o="",l=null,c=null,d=null;if(v.eqs(e.type,"mouseover")?(d=v.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+_.id.A}]),d&&(a=v.getNodeMainDom(d).id,s="hoverOverNode")):v.eqs(e.type,"mouseout")?(d=v.getMDom(n,i,[{tagName:"a",attrName:"treeNode"+_.id.A}]),d||(a="remove",s="hoverOutNode")):v.eqs(e.type,"mousedown")&&(d=v.getMDom(n,t,[{tagName:"a",attrName:"treeNode"+_.id.A}]),d&&(a=v.getNodeMainDom(d).id,s="mousedownNode")),a.length>0)switch(r=b.getNodeCache(n,a),s){case"mousedownNode":l=p.onMousedownNode;break;case"hoverOverNode":l=p.onHoverOverNode;break;case"hoverOutNode":l=p.onHoverOutNode}var u={stop:!1,node:r,nodeEventType:s,nodeEventCallback:l,treeEventType:o,treeEventCallback:c};return u},l=function(e,t,n,i,a,r,s){n&&(n.isHover=!1,n.editNameFlag=!1)},c=function(e,t){t.cancelEditName=function(e){var t=b.getRoot(this.setting);t.curEditNode&&y.cancelCurEditNode(this.setting,e?e:null,!0)},t.copyNode=function(t,n,i,a){function r(){y.addNodes(o.setting,t,-1,[l],a)}if(!n)return null;var s=b.nodeIsParent(e,t);if(t&&!s&&this.setting.data.keep.leaf&&i===_.move.TYPE_INNER)return null;var o=this,l=v.clone(n);return t||(t=null,i=_.move.TYPE_INNER),i==_.move.TYPE_INNER?v.canAsync(this.setting,t)?y.asyncNode(this.setting,t,a,r):r():(y.addNodes(this.setting,t.parentNode,-1,[l],a),y.moveNode(this.setting,t,l,i,!1,a)),l},t.editName=function(e){e&&e.tId&&e===b.getNodeCache(this.setting,e.tId)&&(e.parentTId&&y.expandCollapseParentNode(this.setting,e.getParentNode(),!0),y.editNode(this.setting,e))},t.moveNode=function(t,n,i,a){function r(){y.moveNode(o.setting,t,n,i,!1,a)}if(!n)return n;var s=b.nodeIsParent(e,t);if(t&&!s&&this.setting.data.keep.leaf&&i===_.move.TYPE_INNER)return null;if(t&&(n.parentTId==t.tId&&i==_.move.TYPE_INNER||w(n,this.setting).find("#"+t.tId).length>0))return null;t||(t=null);var o=this;return v.canAsync(this.setting,t)&&i===_.move.TYPE_INNER?y.asyncNode(this.setting,t,a,r):r(),n},t.setEditable=function(e){return this.setting.edit.enable=e,this.refresh()}},d={setSonNodeLevel:function(e,t,n){if(n){var i=b.nodeChildren(e,n);if(n.level=t?t.level+1:0,i)for(var a=0,r=i.length;r>a;a++)i[a]&&b.setSonNodeLevel(e,n,i[a])}}},u={},p={onHoverOverNode:function(e,t){var n=b.getSetting(e.data.treeId),i=b.getRoot(n);i.curHoverNode!=t&&p.onHoverOutNode(e),i.curHoverNode=t,y.addHoverDom(n,t)},onHoverOutNode:function(e,t){var n=b.getSetting(e.data.treeId),i=b.getRoot(n);i.curHoverNode&&!b.isSelectedNode(n,i.curHoverNode)&&(y.removeTreeDom(n,i.curHoverNode),i.curHoverNode=null)},onMousedownNode:function(n,i){function a(n){function i(){M=null,N="",P=_.move.TYPE_INNER,g.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)}if(0==d.dragFlag&&Math.abs(E-n.clientX)<c.edit.drag.minMoveSize&&Math.abs(A-n.clientY)<c.edit.drag.minMoveSize)return!0;var a,s,o,l,p;if(C.css("cursor","pointer"),0==d.dragFlag){if(0==v.apply(c.callback.beforeDrag,[c.treeId,f],!0))return r(n),!0;for(a=0,s=f.length;s>a;a++)0==a&&(d.dragNodeShowBefore=[]),o=f[a],b.nodeIsParent(c,o)&&o.open?(y.expandCollapseNode(c,o,!o.open),d.dragNodeShowBefore[o.tId]=!0):d.dragNodeShowBefore[o.tId]=!1;d.dragFlag=1,u.showHoverDom=!1,v.showIfameMask(c,!0);var h=!0,D=-1;if(f.length>1){var I=f[0].parentTId?b.nodeChildren(c,f[0].getParentNode()):b.getNodes(c);for(p=[],a=0,s=I.length;s>a;a++)if(void 0!==d.dragNodeShowBefore[I[a].tId]&&(h&&D>-1&&D+1!==a&&(h=!1),p.push(I[a]),D=a),f.length===p.length){f=p;break}}for(h&&(T=f[0].getPreNode(),L=f[f.length-1].getNextNode()),m=w("<ul class='zTreeDragUL'></ul>",c),a=0,s=f.length;s>a;a++)o=f[a],o.editNameFlag=!1,y.selectNode(c,o,a>0),y.removeTreeDom(c,o),a>c.edit.drag.maxShowNodeNum-1||(l=w("<li id='"+o.tId+"_tmp'></li>",c),l.append(w(o,_.id.A,c).clone()),l.css("padding","0"),l.children("#"+o.tId+_.id.A).removeClass(_.node.CURSELECTED),m.append(l),a==c.edit.drag.maxShowNodeNum-1&&(l=w("<li id='"+o.tId+"_moretmp'><a>  ...  </a></li>",c),m.append(l)));m.attr("id",f[0].tId+_.id.UL+"_tmp"),m.addClass(c.treeObj.attr("class")),m.appendTo(C),g=w("<span class='tmpzTreeMove_arrow'></span>",c),g.attr("id","zTreeMove_arrow_tmp"),g.appendTo(C),c.treeObj.trigger(_.event.DRAG,[n,c.treeId,f])}if(1==d.dragFlag){if(M&&g.attr("id")==n.target.id&&N&&n.clientX+x.scrollLeft()+2>e("#"+N+_.id.A,M).offset().left){var H=e("#"+N+_.id.A,M);n.target=H.length>0?H.get(0):n.target}else M&&(M.removeClass(_.node.TMPTARGET_TREE),N&&e("#"+N+_.id.A,M).removeClass(_.node.TMPTARGET_NODE+"_"+_.move.TYPE_PREV).removeClass(_.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(_.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER));M=null,N=null,S=!1,k=c;var Z=b.getSettings();for(var R in Z)Z[R].treeId&&Z[R].edit.enable&&Z[R].treeId!=c.treeId&&(n.target.id==Z[R].treeId||e(n.target).parents("#"+Z[R].treeId).length>0)&&(S=!0,k=Z[R]);var O=x.scrollTop(),X=x.scrollLeft(),J=k.treeObj.offset(),B=k.treeObj.get(0).scrollHeight,W=k.treeObj.get(0).scrollWidth,q=n.clientY+O-J.top,Q=k.treeObj.height()+J.top-n.clientY-O,$=n.clientX+X-J.left,z=k.treeObj.width()+J.left-n.clientX-X,U=q<c.edit.drag.borderMax&&q>c.edit.drag.borderMin,G=Q<c.edit.drag.borderMax&&Q>c.edit.drag.borderMin,K=$<c.edit.drag.borderMax&&$>c.edit.drag.borderMin,V=z<c.edit.drag.borderMax&&z>c.edit.drag.borderMin,ee=q>c.edit.drag.borderMin&&Q>c.edit.drag.borderMin&&$>c.edit.drag.borderMin&&z>c.edit.drag.borderMin,te=U&&k.treeObj.scrollTop()<=0,ne=G&&k.treeObj.scrollTop()+k.treeObj.height()+10>=B,ie=K&&k.treeObj.scrollLeft()<=0,ae=V&&k.treeObj.scrollLeft()+k.treeObj.width()+10>=W;if(n.target&&v.isChildOrSelf(n.target,k.treeId)){for(var re=n.target;re&&re.tagName&&!v.eqs(re.tagName,"li")&&re.id!=k.treeId;)re=re.parentNode;var se=!0;for(a=0,s=f.length;s>a;a++){if(o=f[a],re.id===o.tId){se=!1;break}if(w(o,c).find("#"+re.id).length>0){se=!1;break}}se&&n.target&&v.isChildOrSelf(n.target,re.id+_.id.A)&&(M=e(re),N=re.id)}o=f[0],ee&&v.isChildOrSelf(n.target,k.treeId)&&(!M&&(n.target.id==k.treeId||te||ne||ie||ae)&&(S||!S&&o.parentTId)&&(M=k.treeObj),U?k.treeObj.scrollTop(k.treeObj.scrollTop()-10):G&&k.treeObj.scrollTop(k.treeObj.scrollTop()+10),K?k.treeObj.scrollLeft(k.treeObj.scrollLeft()-10):V&&k.treeObj.scrollLeft(k.treeObj.scrollLeft()+10),M&&M!=k.treeObj&&M.offset().left<k.treeObj.offset().left&&k.treeObj.scrollLeft(k.treeObj.scrollLeft()+M.offset().left-k.treeObj.offset().left)),m.css({top:n.clientY+O+3+"px",left:n.clientX+X+3+"px"});var oe=0,le=0;if(M&&M.attr("id")!=k.treeId){var ce=null==N?null:b.getNodeCache(k,N),de=(n.ctrlKey||n.metaKey)&&c.edit.drag.isMove&&c.edit.drag.isCopy||!c.edit.drag.isMove&&c.edit.drag.isCopy,ue=!(!T||N!==T.tId),pe=!(!L||N!==L.tId),he=o.parentTId&&o.parentTId==N,fe=(de||!pe)&&v.apply(k.edit.drag.prev,[k.treeId,f,ce],!!k.edit.drag.prev),me=(de||!ue)&&v.apply(k.edit.drag.next,[k.treeId,f,ce],!!k.edit.drag.next),ge=(de||!he)&&!(k.data.keep.leaf&&!b.nodeIsParent(c,ce))&&v.apply(k.edit.drag.inner,[k.treeId,f,ce],!!k.edit.drag.inner);if(fe||me||ge){var ve=e("#"+N+_.id.A,M),_e=ce.isLastNode?null:e("#"+ce.getNextNode().tId+_.id.A,M.next()),ye=ve.offset().top,be=ve.offset().left,we=fe?ge?.25:me?.5:1:-1,Me=me?ge?.75:fe?.5:0:-1,Te=(n.clientY+O-ye)/ve.height();if((1==we||we>=Te&&Te>=-.2)&&fe?(oe=1-g.width(),le=ye-g.height()/2,P=_.move.TYPE_PREV):(0==Me||Te>=Me&&1.2>=Te)&&me?(oe=1-g.width(),le=null==_e||b.nodeIsParent(c,ce)&&ce.open?ye+ve.height()-g.height()/2:_e.offset().top-g.height()/2,P=_.move.TYPE_NEXT):ge?(oe=5-g.width(),le=ye,P=_.move.TYPE_INNER):i(),M&&(g.css({display:"block",top:le+"px",left:be+oe+"px"}),ve.addClass(_.node.TMPTARGET_NODE+"_"+P),(Y!=N||j!=P)&&(F=(new Date).getTime()),ce&&b.nodeIsParent(c,ce)&&P==_.move.TYPE_INNER)){var Le=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==ce.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===ce.tId&&(Le=!1),Le&&(window.zTreeMoveTimer=setTimeout(function(){P==_.move.TYPE_INNER&&ce&&b.nodeIsParent(c,ce)&&!ce.open&&(new Date).getTime()-F>k.edit.drag.autoOpenTime&&v.apply(k.callback.beforeDragOpen,[k.treeId,ce],!0)&&(y.switchNode(k,ce),k.edit.drag.autoExpandTrigger&&k.treeObj.trigger(_.event.EXPAND,[k.treeId,ce]))},k.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=ce.tId)}}else i()}else P=_.move.TYPE_INNER,M&&v.apply(k.edit.drag.inner,[k.treeId,f,null],!!k.edit.drag.inner)?M.addClass(_.node.TMPTARGET_TREE):M=null,g.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);Y=N,j=P,c.treeObj.trigger(_.event.DRAGMOVE,[n,c.treeId,f])}return!1}function r(n){function i(){if(S){if(!h)for(var e=0,t=f.length;t>e;e++)y.removeNode(c,f[e]);P==_.move.TYPE_INNER?y.addNodes(k,T,-1,L):y.addNodes(k,T.getParentNode(),P==_.move.TYPE_PREV?T.getIndex():T.getIndex()+1,L)}else if(h&&P==_.move.TYPE_INNER)y.addNodes(k,T,-1,L);else if(h)y.addNodes(k,T.getParentNode(),P==_.move.TYPE_PREV?T.getIndex():T.getIndex()+1,L);else if(P!=_.move.TYPE_NEXT)for(e=0,t=L.length;t>e;e++)y.moveNode(k,T,L[e],P,!1);else for(e=-1,t=L.length-1;t>e;t--)y.moveNode(k,T,L[t],P,!1);y.selectNodes(k,L);var i=w(L[0],c).get(0);y.scrollIntoView(c,i),c.treeObj.trigger(_.event.DROP,[n,k.treeId,L,T,P,h])}if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),Y=null,j=null,x.unbind("mousemove",a),x.unbind("mouseup",r),x.unbind("selectstart",s),C.css("cursor",""),M&&(M.removeClass(_.node.TMPTARGET_TREE),N&&e("#"+N+_.id.A,M).removeClass(_.node.TMPTARGET_NODE+"_"+_.move.TYPE_PREV).removeClass(_.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(_.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER)),v.showIfameMask(c,!1),u.showHoverDom=!0,0!=d.dragFlag){d.dragFlag=0;var o,l,p;for(o=0,l=f.length;l>o;o++)p=f[o],b.nodeIsParent(c,p)&&d.dragNodeShowBefore[p.tId]&&!p.open&&(y.expandCollapseNode(c,p,!p.open),delete d.dragNodeShowBefore[p.tId]);m&&m.remove(),g&&g.remove();var h=(n.ctrlKey||n.metaKey)&&c.edit.drag.isMove&&c.edit.drag.isCopy||!c.edit.drag.isMove&&c.edit.drag.isCopy;if(!h&&M&&N&&f[0].parentTId&&N==f[0].parentTId&&P==_.move.TYPE_INNER&&(M=null),M){var T=null==N?null:b.getNodeCache(k,N);if(0==v.apply(c.callback.beforeDrop,[k.treeId,f,T,P,h],!0))return void y.selectNodes(D,f);var L=h?v.clone(f):f;P==_.move.TYPE_INNER&&v.canAsync(k,T)?y.asyncNode(k,T,!1,i):i()}else y.selectNodes(D,f),c.treeObj.trigger(_.event.DROP,[n,c.treeId,f,null,null,null])}}function s(){return!1}var o,l,c=b.getSetting(n.data.treeId),d=b.getRoot(c),u=b.getRoots();if(2==n.button||!c.edit.enable||!c.edit.drag.isCopy&&!c.edit.drag.isMove)return!0;var p=n.target,h=b.getRoot(c).curSelectedList,f=[];if(b.isSelectedNode(c,i))for(o=0,l=h.length;l>o;o++){if(h[o].editNameFlag&&v.eqs(p.tagName,"input")&&null!==p.getAttribute("treeNode"+_.id.INPUT))return!0;if(f.push(h[o]),f[0].parentTId!==h[o].parentTId){f=[i];break}}else f=[i];y.editNodeBlur=!0,y.cancelCurEditNode(c);var m,g,M,T,L,x=e(c.treeObj.get(0).ownerDocument),C=e(c.treeObj.get(0).ownerDocument.body),S=!1,k=c,D=c,Y=null,j=null,N=null,P=_.move.TYPE_INNER,E=n.clientX,A=n.clientY,F=(new Date).getTime();return v.uCanDo(c)&&x.bind("mousemove",a),x.bind("mouseup",r),x.bind("selectstart",s),n.preventDefault&&n.preventDefault(),!0}},h={getAbs:function(e){var t=e.getBoundingClientRect(),n=document.body.scrollTop+document.documentElement.scrollTop,i=document.body.scrollLeft+document.documentElement.scrollLeft;return[t.left+i,t.top+n]},inputFocus:function(e){e.get(0)&&(e.focus(),v.setCursorPosition(e.get(0),e.val().length))},inputSelect:function(e){e.get(0)&&(e.focus(),e.select())},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}},showIfameMask:function(e,t){for(var n=b.getRoot(e);n.dragMaskList.length>0;)n.dragMaskList[0].remove(),n.dragMaskList.shift();if(t)for(var i=w("iframe",e),a=0,r=i.length;r>a;a++){var s=i.get(a),o=v.getAbs(s),l=w("<div id='zTreeMask_"+a+"' class='zTreeMask' style='top:"+o[1]+"px; left:"+o[0]+"px; width:"+s.offsetWidth+"px; height:"+s.offsetHeight+"px;'></div>",e);l.appendTo(w("body",e)),n.dragMaskList.push(l)}}},f={addEditBtn:function(e,t){if(!(t.editNameFlag||w(t,_.id.EDIT,e).length>0)&&v.apply(e.edit.showRenameBtn,[e.treeId,t],e.edit.showRenameBtn)){var n=w(t,_.id.A,e),i="<span class='"+_.className.BUTTON+" edit' id='"+t.tId+_.id.EDIT+"' title='"+v.apply(e.edit.renameTitle,[e.treeId,t],e.edit.renameTitle)+"' treeNode"+_.id.EDIT+" style='display:none;'></span>";n.append(i),w(t,_.id.EDIT,e).bind("click",function(){return v.uCanDo(e)&&0!=v.apply(e.callback.beforeEditName,[e.treeId,t],!0)?(y.editNode(e,t),!1):!1}).show()}},addRemoveBtn:function(e,t){if(!(t.editNameFlag||w(t,_.id.REMOVE,e).length>0)&&v.apply(e.edit.showRemoveBtn,[e.treeId,t],e.edit.showRemoveBtn)){var n=w(t,_.id.A,e),i="<span class='"+_.className.BUTTON+" remove' id='"+t.tId+_.id.REMOVE+"' title='"+v.apply(e.edit.removeTitle,[e.treeId,t],e.edit.removeTitle)+"' treeNode"+_.id.REMOVE+" style='display:none;'></span>";n.append(i),w(t,_.id.REMOVE,e).bind("click",function(){return v.uCanDo(e)&&0!=v.apply(e.callback.beforeRemove,[e.treeId,t],!0)?(y.removeNode(e,t),e.treeObj.trigger(_.event.REMOVE,[e.treeId,t]),!1):!1}).bind("mousedown",function(e){return!0}).show()}},addHoverDom:function(e,t){b.getRoots().showHoverDom&&(t.isHover=!0,e.edit.enable&&(y.addEditBtn(e,t),y.addRemoveBtn(e,t)),v.apply(e.view.addHoverDom,[e.treeId,t]))},cancelCurEditNode:function(e,t,n){var i=b.getRoot(e),a=i.curEditNode;if(a){var r=i.curEditInput,s=t?t:n?b.nodeName(e,a):r.val();if(v.apply(e.callback.beforeRename,[e.treeId,a,s,n],!0)===!1)return!1;b.nodeName(e,a,s);var o=w(a,_.id.A,e);o.removeClass(_.node.CURSELECTED_EDIT),r.unbind(),y.setNodeName(e,a),a.editNameFlag=!1,i.curEditNode=null,i.curEditInput=null,y.selectNode(e,a,!1),e.treeObj.trigger(_.event.RENAME,[e.treeId,a,n])}return i.noSelection=!0,!0},editNode:function(e,t){var n=b.getRoot(e);if(y.editNodeBlur=!1,b.isSelectedNode(e,t)&&n.curEditNode==t&&t.editNameFlag)return void setTimeout(function(){v.inputFocus(n.curEditInput)},0);t.editNameFlag=!0,y.removeTreeDom(e,t),y.cancelCurEditNode(e),y.selectNode(e,t,!1),w(t,_.id.SPAN,e).html("<input type=text class='rename' id='"+t.tId+_.id.INPUT+"' treeNode"+_.id.INPUT+" >");var i=w(t,_.id.INPUT,e);i.attr("value",b.nodeName(e,t)),e.edit.editNameSelectAll?v.inputSelect(i):v.inputFocus(i),i.bind("blur",function(t){y.editNodeBlur||y.cancelCurEditNode(e)}).bind("keydown",function(t){"13"==t.keyCode?(y.editNodeBlur=!0,y.cancelCurEditNode(e)):"27"==t.keyCode&&y.cancelCurEditNode(e,null,!0)}).bind("click",function(e){return!1}).bind("dblclick",function(e){return!1}),w(t,_.id.A,e).addClass(_.node.CURSELECTED_EDIT),n.curEditInput=i,n.noSelection=!1,n.curEditNode=t},moveNode:function(e,t,n,i,a,r){var s=b.getRoot(e);if(t!=n&&(!e.data.keep.leaf||!t||b.nodeIsParent(e,t)||i!=_.move.TYPE_INNER)){var o=n.parentTId?n.getParentNode():s,l=null===t||t==s;l&&null===t&&(t=s),l&&(i=_.move.TYPE_INNER);var c=t.parentTId?t.getParentNode():s;i!=_.move.TYPE_PREV&&i!=_.move.TYPE_NEXT&&(i=_.move.TYPE_INNER),i==_.move.TYPE_INNER&&(l?n.parentTId=null:(b.nodeIsParent(e,t)||(b.nodeIsParent(e,t,!0),t.open=!!t.open,y.setNodeLineIcos(e,t)),n.parentTId=t.tId));var d,u;if(l)d=e.treeObj,u=d;else{if(r||i!=_.move.TYPE_INNER?r||y.expandCollapseNode(e,t.getParentNode(),!0,!1):y.expandCollapseNode(e,t,!0,!1),d=w(t,e),u=w(t,_.id.UL,e),d.get(0)&&!u.get(0)){var p=[];y.makeUlHtml(e,t,p,""),d.append(p.join(""))}u=w(t,_.id.UL,e)}var h=w(n,e);h.get(0)?d.get(0)||h.remove():h=y.appendNodes(e,n.level,[n],null,-1,!1,!0).join(""),u.get(0)&&i==_.move.TYPE_INNER?u.append(h):d.get(0)&&i==_.move.TYPE_PREV?d.before(h):d.get(0)&&i==_.move.TYPE_NEXT&&d.after(h);var f,m,g=-1,v=0,M=null,T=null,L=n.level,x=b.nodeChildren(e,o),C=b.nodeChildren(e,c),S=b.nodeChildren(e,t);if(n.isFirstNode)g=0,x.length>1&&(M=x[1],M.isFirstNode=!0);else if(n.isLastNode)g=x.length-1,M=x[g-1],M.isLastNode=!0;else for(f=0,m=x.length;m>f;f++)if(x[f].tId==n.tId){g=f;break}if(g>=0&&x.splice(g,1),i!=_.move.TYPE_INNER)for(f=0,m=C.length;m>f;f++)C[f].tId==t.tId&&(v=f);if(i==_.move.TYPE_INNER?(S||(S=b.nodeChildren(e,t,[])),S.length>0&&(T=S[S.length-1],T.isLastNode=!1),S.splice(S.length,0,n),n.isLastNode=!0,n.isFirstNode=1==S.length):t.isFirstNode&&i==_.move.TYPE_PREV?(C.splice(v,0,n),T=t,T.isFirstNode=!1,n.parentTId=t.parentTId,n.isFirstNode=!0,n.isLastNode=!1):t.isLastNode&&i==_.move.TYPE_NEXT?(C.splice(v+1,0,n),T=t,T.isLastNode=!1,n.parentTId=t.parentTId,n.isFirstNode=!1,n.isLastNode=!0):(i==_.move.TYPE_PREV?C.splice(v,0,n):C.splice(v+1,0,n),n.parentTId=t.parentTId,n.isFirstNode=!1,n.isLastNode=!1),b.fixPIdKeyValue(e,n),b.setSonNodeLevel(e,n.getParentNode(),n),y.setNodeLineIcos(e,n),y.repairNodeLevelClass(e,n,L),!e.data.keep.parent&&x.length<1){b.nodeIsParent(e,o,!1),o.open=!1;var k=w(o,_.id.UL,e),D=w(o,_.id.SWITCH,e),Y=w(o,_.id.ICON,e);y.replaceSwitchClass(o,D,_.folder.DOCU),y.replaceIcoClass(o,Y,_.folder.DOCU),k.css("display","none")}else M&&y.setNodeLineIcos(e,M);T&&y.setNodeLineIcos(e,T),e.check&&e.check.enable&&y.repairChkClass&&(y.repairChkClass(e,o),y.repairParentChkClassWithSelf(e,o),o!=n.parent&&y.repairParentChkClassWithSelf(e,n)),r||y.expandCollapseParentNode(e,n.getParentNode(),!0,a)}},removeEditBtn:function(e,t){w(t,_.id.EDIT,e).unbind().remove()},removeRemoveBtn:function(e,t){w(t,_.id.REMOVE,e).unbind().remove()},removeTreeDom:function(e,t){t.isHover=!1,y.removeEditBtn(e,t),y.removeRemoveBtn(e,t),v.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(e,t,n){if(n!==t.level){var i=w(t,e),a=w(t,_.id.A,e),r=w(t,_.id.UL,e),s=_.className.LEVEL+n,o=_.className.LEVEL+t.level;i.removeClass(s),i.addClass(o),a.removeClass(s),a.addClass(o),r.removeClass(s),r.addClass(o)}},selectNodes:function(e,t){for(var n=0,i=t.length;i>n;n++)y.selectNode(e,t[n],n>0)}},m={tools:h,view:f,event:u,data:d};e.extend(!0,e.fn.zTree.consts,t),e.extend(!0,e.fn.zTree._z,m);var g=e.fn.zTree,v=g._z.tools,_=g.consts,y=g._z.view,b=g._z.data,w=(g._z.event,v.$);b.exSetting(n),b.addInitBind(r),b.addInitUnBind(s),b.addInitCache(a),b.addInitNode(l),b.addInitProxy(o),b.addInitRoot(i),b.addZTreeTools(c);var M=y.cancelPreSelectedNode;y.cancelPreSelectedNode=function(e,t){for(var n=b.getRoot(e).curSelectedList,i=0,a=n.length;a>i&&(t&&t!==n[i]||(y.removeTreeDom(e,n[i]),!t));i++);M&&M.apply(y,arguments)};var T=y.createNodes;y.createNodes=function(e,t,n,i,a){T&&T.apply(y,arguments),n&&y.repairParentChkClassWithSelf&&y.repairParentChkClassWithSelf(e,i)};var L=y.makeNodeUrl;y.makeNodeUrl=function(e,t){return e.edit.enable?null:L.apply(y,arguments)};var x=y.removeNode;y.removeNode=function(e,t){var n=b.getRoot(e);n.curEditNode===t&&(n.curEditNode=null),x&&x.apply(y,arguments)};var C=y.selectNode;y.selectNode=function(e,t,n){var i=b.getRoot(e);return b.isSelectedNode(e,t)&&i.curEditNode==t&&t.editNameFlag?!1:(C&&C.apply(y,arguments),y.addHoverDom(e,t),!0)};var S=v.uCanDo;v.uCanDo=function(e,t){var n=b.getRoot(e);return t&&(v.eqs(t.type,"mouseover")||v.eqs(t.type,"mouseout")||v.eqs(t.type,"mousedown")||v.eqs(t.type,"mouseup"))?!0:(n.curEditNode&&(y.editNodeBlur=!1,n.curEditInput.focus()),!n.curEditNode&&(S?S.apply(y,arguments):!0))}}(jQuery),define("components/zTree/js/jquery.ztree.all",function(){}),define("components/requirejs-text/text!template/module/mail/mail.tpl.html",[],function(){return'<section class="m-mail j-mail sidebar-expanded">\r\n    <aside class="mlsidebar j-mlsidebar">\r\n        <div class="mlsidebar-bg"></div>\r\n        <div class="u-btns">\r\n            <button class="u-btn u-btn-default u-btn-large btn-compose j-mlsb disabled" type="button" data-op="compose"><i class="iconfont iconcreate"></i> <span class="title">{{i18n "main/mbt_compose"}}</span></button>\r\n            <button class="u-btn u-btn-default u-btn-large btn-inbox j-mlsb" type="button" data-op="inbox"><i class="iconfont iconinbox"></i></button>\r\n        </div>\r\n        <button class="u-btn u-btn-default u-btn-large btn-toggle-sidebar j-btn-toggle-sidebar">\r\n            <i class="iconfont iconleftnew"></i>\r\n            <i class="iconfont iconrightnew"></i>\r\n        </button>\r\n\r\n        <div class="wrapper u-scroll j-folder-tree">\r\n            <ul class="ztree" id="mltree"></ul>\r\n        </div>\r\n    </aside>\r\n    <div class="mlsidebar-line j-mlsidebar-line">\r\n        <div class="line"></div>\r\n    </div>\r\n    <article class="mlmain mltabview j-mlmain">\r\n        <div class="u-tab u-tab-seamless u-tab-highlight j-mltab">\r\n            <ul class="mltabview-nav"></ul>\r\n        </div>\r\n        <div class="mltabview-content j-mlcnt"></div>\r\n    </article>\r\n    {{#raw}}\r\n    <script id="offSiteRemindTpl" type="text/x-handlebars-template">\r\n        <div class="u-box u-box-remind j-offSideRemind">\r\n            <div class="u-box-head">\r\n                <h3 class="u-box-head-title">{{i18n "main/offSiteRemind_title"}}</h3>\r\n            </div>\r\n            <div class="u-box-container">\r\n                <div class="u-info1">\r\n                    <div class=\'title\'>{{i18n "main/offSiteRemind_lastLogin"}}</div>\r\n                    <div>\r\n                        <div class=\'detail\'>[[lastDate]] &nbsp;&nbsp;&nbsp;<span title="[[lastArea]]&nbsp;[[lastIP]]">[[lastArea]]</span></div>\r\n                    </div>\r\n                    <div class=\'title\'>{{i18n "main/offSiteRemind_currentLogin"}}</div>\r\n                    <div>\r\n                        <div class=\'detail\'>[[currentDate]] &nbsp;&nbsp;&nbsp;<span title="[[currentArea]]&nbsp;[[currentIP]]">[[currentArea]]</span></div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'u-info2\'>\r\n                    {{i18n "main/offSiteRemind_content"}}<a href="javascript:void(0);">{{i18n "main/offSiteRemind_historyLink"}}</a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </script>\r\n    {{/raw}}\r\n</section>'}),define("module/mail/index",["require","i18n!compose,main,mail","./entrustmanager/index","jquery.ztree","jquery","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","cui/ui/tabview/tabview","cui/ui/overlay/overlay","../../component/userauth2","../../component/confirmbox","../../util/index","../common/globalService","../setting/service","./service","text!template/module/mail/mail.tpl.html"],function(e){function t(e,t,i){var a,r=-1!==(i.id+"").indexOf("@"),o=D.isExpandThreadMid(i.id)?"unreadThreadCount":"unreadMessageCount",l=e.$("#"+i.tId+"_a"),c=e.$("#"+i.tId+"_switch"),d=l.find("#"+i.tId+"_ico"),u=l.find("#"+i.tId+"_span"),p=_("<div />",{"class":"cnt"}),h=5;c.remove(),d.before(c),u.attr("fid",i.id).data("fid",i.id).empty(),i.name=C.html.encode(i.name),i.level>0&&(a="<span style='display: inline-block;width:"+h*i.level+"px'></span>",c.before(a)),p.append(s(i));var f=i.getParentNode();f&&g(e,f);var m=v(i);m&&m[o]>0?(p.append(i.name),u.append(_("<span/>",{"class":1==i.id?"unread unread-inbox skin-primary-bg ":"unread",text:m[o]}))):m&&m.unreadMessageCount>0&&(-6==i.id||r)?(p.append(i.name),u.append(_("<span/>",{"class":"unread",text:m.unreadMessageCount}))):p.append(i.name),u.append(p),n(e,t,i)}function n(e,t,n){var i=e.$("#"+t),a=e.$("#"+n.tId+"_a"),r=a.find("#"+n.tId+"_span"),s=i.width(),o=0;a.children("span:not(#"+n.tId+"_span)").each(function(){o+=_(this).outerWidth(!0)}),r.css("width",((s-o-10)/s*100).toFixed(2)+"%")}function i(e,t,n){var i,a,r,s,o,l=D.getFoldersMap(),c=e.$("#"+n.tId+"_span"),d=c.find(".unread"),u=n.id,p=n.isPOP,h=n.name,f=n.stats?n.stats.messageCount:0;if(p)return s=c.find(".j-checkPOP"),s.length>0?s.show():(s=_("<i />",{"class":"j-checkPOP iconfont icondownload"}).off("click").on("click",function(t){t.stopPropagation(),o={module:"setting.advance.pop",param:{id:n.POPId,action:"sync"}},S.setCurrentState(o),e.sendMessage("dispatcher","history:add",o)}),c.append(s)),void d.hide();switch(u){case l.vip:a=c.find(".j-setting"),a.length>0?a.show():(a=_("<i />",{"class":"j-setting iconfont iconset"}).off("click").on("click",function(t){t.stopPropagation(),o={module:"setting.filter.vip",param:{}},S.setCurrentState(o),e.sendMessage("dispatcher","history:add",o)}),c.append(a)),d.hide();break;case l.other:i=c.find(".j-add"),a=c.find(".j-setting"),i.length>0&&a.length>0&&(i.show(),a.show()),0===a.length&&(a=_("<i />",{"class":"j-setting iconfont iconset",title:C.i18n.t("main/tip_set")}).off("click").on("click",function(t){t.stopPropagation(),o={module:"setting.folder.folder",param:{}},S.setCurrentState(o),e.sendMessage("dispatcher","history:add",o)}),c.append(a)),0===i.length&&(i=_("<i />",{"class":"j-add iconfont iconadd",title:C.i18n.t("main/tip_add")}).off("click").on("click",function(t){t.stopPropagation(),o={module:"setting.folder.folder",param:{panel:"create"}},e.sendMessage("dispatcher","history:add",o)}),c.append(i)),d.hide();break;case l.mboxshare:a=c.find(".j-mbox-set"),a.length>0&&a.show(),0===a.length&&(a=_("<i />",{"class":"j-mbox-set iconfont iconset",title:C.i18n.t("main/tip_set")}).off("click").on("click",function(t){t.stopPropagation(),o={module:"setting.advance.mboxshare",param:{}},S.setCurrentState(o),e.sendMessage("dispatcher","history:add",o)}),c.append(a)),d.hide();break;case l.trash:if(r=c.find(".j-trash"),!f)return r.hide(),!1;r.length>0?r.show():(r=_("<i />",{"class":"j-trash iconfont iconrecover",title:C.i18n.t("main/act_empty")}).off("click").on("click",function(t){function i(){x.confirm(C.i18n.t("main/confirm_clean").replace("{0}",h),function(){k.doEmptyFolder(l.trash).then(function(){e.sendMessage("mail","folder:refresh",{ids:l.trash}),e.sendMessage("mail.list","view:refresh","")})})}t.stopPropagation(),n.auth2Locked&&!S.getFolderLockedStatus().isAuth?L.box({successCb:function(){i()}}):i()}),c.append(r)),d.hide()}}function a(e,t,n){e.$("#"+n.tId+"_span").children(".iconfont").hide().end().find(".unread").show();
}function r(e,t){var n,i,a=e.widgets.folderTree,r=D.isExpandThreadMid(t.id)?"unreadThreadCount":"unreadMessageCount",s=D.getFoldersMap();if(!a||!t)return!1;n=a.getNodeByParam("id",t.id);var o=n.getParentNode();if(o&&g(e,o),!n)return!1;_.extend(n.stats,t.stats),i=e.$('#mltree span[fid="'+t.id+'"]');var l=v(n);l[r]>0?i.find(".unread").length>0?i.find(".unread").html(l[r]):i.prepend(_("<span/>",{"class":1==n.id?"unread unread-inbox skin-primary-bg":"unread",text:l[r]})):i.find(".unread").length>0&&i.find(".unread").html(""),s.trash===t.id&&l.messageCount<1&&i.find(".j-trash").hide()}function s(e){var t=S.getFolderLockedStatus(),n=S.getUser(),i=(e.id+"").indexOf("@")>=0;if(t.lockedDefined&&!i){if(e.auth2Locked)return t.isAuth?'<i class="iconfont iconunlock"></i>':'<i class="iconfont iconlock"></i>';if(e.auth2Locked===!1||_.inArray(e.id+"",n.def_sec_folder)>-1)return'<i class="iconfont iconunlock"></i>'}return""}function o(e,t){var n,i=e.widgets.folderTree,a=i.getNodes(),r=null;return _.each(a,function(e,t){1==t.id&&(r=e+1)}),i&&t&&0!==t.length?void _.each(t,function(e,t){n=t.parent?i.getNodeByParam("id",t.parent):null,15==t.id&&"number"==typeof r?i.addNodes(n,r,t,!1):i.addNodes(n,t,!1)}):!1}function l(e,t){var n,i=e.widgets.folderTree;return i&&t&&0!==t.length?void _.each(t,function(e,t){n=i.getNodeByParam("id",t.id),i.removeNode(n)}):!1}function c(e,t){var n=e.getNodeByParam("id",t);return e.selectNode(n),n&&n.isParent&&e.expandNode(n,!0),n}function d(){return _("<div />",{"class":"iconfont iconcloseall closeall",title:C.i18n.t("compose/lbt_close_all")})}function u(e,t){var n,i=_("<li>",{"data-trigger":e.sid,"class":t,title:C.html.decode(e.stitle)});return i.append(_("<span>",{"class":"bar"})),n=_("<div>",{"class":"trigger-wrap"}).appendTo(i),0===e.sid.indexOf("compose")&&n.append(_("<a>",{"class":"iconfont iconcreate create"})),n.append(_("<a>",{href:"javascript:void(0)",html:e.stitle,"trigger-title":"","class":0===e.sid.indexOf("compose")?"compose":""})),e.isDefault||n.append(_("<span>",{"class":"iconfont icontabclose close",title:C.i18n.t("compose/lbt_close_single")})),i}function p(e,t){if(!e.widgets.tabview)return!1;var n,i,a,r,s=e.widgets.tabview.current();t=_.extend({module:"",param:{}},t),n=t.module.split("."),i=n[1]||"welcome","list"===i?(t.param.id=void 0!=t.param.fid?t.param.fid:t.param.id,t.param.fid=t.param.id,r=void 0!=t.param.id?t.param.id:void 0!=t.param.fid?t.param.fid:""):r="previewlayout"===i?void 0!=t.param.id?t.param.id:void 0!=t.param.fid?t.param.fid:"":"read"===i||"thread"===i?void 0!=t.param.id?t.param.id:t.param.mid:void 0!=t.param.id?t.param.id:"",a=i+(0===r||r?":"+r:""),"mail"===n[0]&&(e.activeView=i,S.setCurrentState(t),a!==s.sid?e.widgets.tabview.find(a)?(e.widgets.tabview.switchTo(a),e.sendMessage("mail."+i,"view:refresh",t)):e.widgets.tabview.addTab(h({view:i,id:r,title:t.param.tabTitle,replaceId:t.param.replaceId||""})):e.sendMessage("mail."+i,"view:refresh",t))}function h(e){var t={},n=S.getUser();switch(e=_.extend({view:"",id:"",title:""},e),e.view){case"welcome":t={id:"welcome",replaceId:"list*|previewlayout",title:e.title||C.i18n.t("main/Home"),module:b.module("mail.welcome")};break;case"list":t={id:"list:"+e.id,replaceId:"list*|previewlayout*|welcome",title:e.title||" ",module:b.module("mail.list")};break;case"previewlayout":t={id:"previewlayout:"+(e.id||n.preview_layout),replaceId:"previewlayout*|list*|welcome",title:e.title||" ",module:b.module("mail.previewlayout")};break;case"compose":t={id:e.id?"compose:"+e.id:"compose",isDefault:!1,title:e.title||C.i18n.t("compose/lb_compose"),module:b.module("mail.compose")};break;case"read":t={id:"read:"+(e.id||e.mid),isDefault:!1,title:e.title||C.i18n.t("mail/empty_subject"),module:b.module("mail.read")},e.replaceId&&(t.replaceId=e.replaceId);break;case"search":t={id:"search",isDefault:!1,title:C.i18n.t("main/mail_search"),module:b.module("mail.search")};break;case"thread":t={id:"thread:"+(e.id||e.mid),isDefault:!1,title:e.title,module:b.module("mail.thread")},e.replaceId&&(t.replaceId=e.replaceId);break;case"entrustmanager":t={id:"entrustmanager",isDefault:!1,title:C.i18n.t("main/Maillist"),module:b.module("mail.entrustmanager")}}return t}function f(e){var t,n,i={tabs:[],activeTabId:""};return i.tabs.push({id:"welcome",title:C.i18n.t("main/Home"),module:b.module("mail.welcome")}),"list"===e.activeView||"previewlayout"===e.activeView?(t=D.getCacheFolder(e.state.param.id),e.state.param.title=e.state.param.tabTitle||e.state.param.folderName||t.name,n=h(e.state.param),i.tabs.splice(0,1,n)):"welcome"!==e.activeView&&(n=h(e.state.param),i.tabs.push(n),i.activeTabId=n.id),i}function m(e){var t=e.widgets.tabview,n=t.getRenderedLength(),i=e.$("div.j-mltab"),a=e.$("div.j-mlcnt");1>=n&&!i.hasClass("f-ani-tab")?(i.addClass("f-ani-tab"),a.addClass("f-ani-cnt")):n>1&&i.is(":hidden")&&(i.removeClass("f-ani-tab"),a.removeClass("f-ani-cnt"))}function g(e,t){setTimeout(function(){r(e,t)})}function v(e){function t(e,n){var i=e.stats;n.unreadMessageCount+=i.unreadMessageCount||0,n.unreadThreadCount+=i.unreadThreadCount||0,_.each(e.children||[],function(e,i){t(i,n)})}var n=_.extend({},e.stats),i=!e.open,a={unreadMessageCount:0,unreadThreadCount:0};return i?(_.extend(n,a),t(e,n)):n=e.stats,n}e("i18n!compose,main,mail"),e("./entrustmanager/index"),e("jquery.ztree");var _=e("jquery"),y=e("cui/core/view/view"),b=e("cui/core/view/viewmanager"),w=e("cui/util/templatable/templatable"),M=e("cui/ui/tabview/tabview"),T=e("cui/ui/overlay/overlay"),L=e("../../component/userauth2"),x=e("../../component/confirmbox"),C=e("../../util/index"),S=e("../common/globalService"),k=e("../setting/service"),D=e("./service"),Y=0,j=0,N=y.extend({Implements:w,widgets:{folderTree:null,tabview:null},attrs:{sidebarExpanded:{getter:function(){return this.element.hasClass("sidebar-expanded")}}},state:null,activeView:"welcome",events:{"click button.j-btn-toggle-sidebar":function(){this.moveSidebarLine(0,!0,!1)},"click button.j-mlsb:not(.disabled)":"_handleComposeOrInbox"},setup:function(){var e,t;this.state=S.getCurrentState(),t=S.getUser(),0===t.firstpage?this.activeView="welcome":t.preview_layout?this.activeView="previewlayout":this.activeView="list",this.state.param.view?this.activeView=this.state.param.view||this.activeView:this.state.param.view=this.activeView,("list"===this.activeView||"previewlayout"===this.activeView)&&(e=this.state.param.fid,isNaN(parseInt(e,10))?this.state.param.fid=1:this.state.param.fid=parseInt(e,10)),this.state.module="mail."+this.activeView,S.setCurrentState(this.state),this._setHistory(this.state)},render:function(){var e=this;N.superclass.render.call(e),_.notify.loading(),S.getConfig("mail.enablewebmailcompose")&&e.$("button.btn-compose").removeClass("disabled"),D.getFolders(!0,!1,!1).then(function(t){e._initFolderTree(t),e._initTabView(),_.notify.loading("hide")}),D.getOffSiteInfo().then(function(t){e._initOffSiteRemind(t)}),this.initSidebar(),this._initModuleEvent()},destroy:function(){this.widgets.tabview&&this.widgets.tabview.destroy(),this.widgets.folderTree&&this.widgets.folderTree.destroy(),N.superclass.destroy.call(this)},_initFolderTree:function(e){var n,r=this,s=S.getConfig("mail.opennavothernod"),o={view:{showLine:!1,showIcon:!1,selectedMulti:!1,dblClickExpand:!1,addDiyDom:function(e,n){t(r,e,n)},addHoverDom:function(e,t){i(r,e,t)},removeHoverDom:function(e,t){a(r,e,t)}},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId",rootPId:""}},callback:{beforeClick:function(e,t){var n,i,a,s,o=_.fn.zTree.getZTreeObj("mltree"),l=D.getFoldersMap(),c=S.getUser(),d=S.getFolderLockedStatus();t.isParent&&o.expandNode(t,void 0,void 0,!1);var u=(t.getParentNode()||{}).id||t.id;return(u===l.mboxshare||u===l.extranet)&&g(r,t),t.id==l.other||t.id==l.mboxshare||t.id==l.extranet||0===(t.id+"").indexOf("@")?!0:(n=c.preview_layout?"mail.previewlayout":"mail.list",i=c.preview_layout?"previewlayout":"list",a={module:n,param:{id:t.id,fid:t.id,tabTitle:t.name,view:i}},-1!==t.id.toString().indexOf("@")&&(s=D.getCacheFolder(t.id)||{},s.send&&(a.param.send=s.send),s.rw&&(a.param.rw=s.rw)),t.auth2Locked&&!d.isAuth?(L.box({successCb:function(){r.trigger("tree:choose",t.id),p(r,a)}}),!1):(p(r,a),!0))},onNodeCreated:function(e,t,n){_("#"+n.tId+"_a").attr("title",n.name)},beforeExpand:function(e,t){g(r,t)},beforeCollapse:function(e,t){g(r,t)}}};if(r.widgets.folderTree=_.fn.zTree.init(r.$("#mltree"),o,e),C.cache.setItemWithLocal("ht_tree_folders",e),("list"===r.activeView||"previewlayout"===r.activeView)&&(n=c(r.widgets.folderTree,r.state.param.fid),r.state.param.folderName=n?n.name:" "),r.on("tree:choose",function(e){r.widgets.folderTree&&c(r.widgets.folderTree,e)}),r.on("tree:cancel",function(e){var t,n=r.widgets.folderTree;n&&(e?(t=n.getNodeByParam("id",e),n.cancelSelectedNode(t)):n.cancelSelectedNode())}),s){var l=D.getFoldersMap();r.trigger("tree:choose",l.other)}},_initTabView:function(){var e=this,t=f(e);e.widgets.tabview=new M({element:"article.mltabview",classPrefix:"mltabview",activeTriggerClass:"z-current",closeTriggerClass:"close",manageType:"close",generateTriggerMarkup:u,generateCloseAllMarkup:d,activeTabId:t.activeTabId,tabs:t.tabs}),e.widgets.tabview.on("render",function(t){var n,i=t.split(":");e.activeView=i[0],n=S.getCurrentState(),n.param.vid=t,e._setHistory(n)}),e.widgets.tabview.on("refresh",function(t){var n=t.split(":");e.activeView=n[0],"compose"===e.activeView||"read"===e.activeView||"thread"===e.activeView?e.sendMessage("mail."+t,"view:active",{vid:t}):e.sendMessage("mail."+e.activeView,"view:active",{}),e.sendMessage("dispatcher","view:refresh",{module:"mail."+n[0],param:{vid:t}})}),e.widgets.tabview.on("switched closed",function(){m(e)}),e.widgets.tabview.render(),m(e)},_initModuleEvent:function(){this._initHistoryModuleEvent(),this._initViewModuleEvent(),this._initTabModuleEvent(),this._initFolderModuleEvent(),this._initHotkeysModuleEvent(),this.initSidebarEvent()},_initHistoryModuleEvent:function(){var e=this;e.subscribe("dispatcher","url:changed",function(t){var n=t.message.newState;n=e._adjustViewState(n),"mail.list"===n.module||"mail.previewlayout"===n.module?e.trigger("tree:choose",n.param.fid):e.trigger("tree:cancel"),p(e,n)}),e.subscribe("dispatcher","view:changed",function(t){var n,i=t.message.newState;"mail.list"===i.module||"mail.previewlayout"===i.module?e.trigger("tree:choose",i.param.fid):e.trigger("tree:cancel"),n=e._adjustViewState(i),S.setCurrentState(n),JSON.stringify(n)!=JSON.stringify(i)&&p(e,n)})},_adjustViewState:function(e){var t=S.getUser(),n=_.extend(!0,{},e);return"mail.list"===n.module&&t.preview_layout?(n.module="mail.previewlayout",n.param.layout=t.preview_layout):"mail.previewlayout"===n.module&&(t.preview_layout?n.param.layout!=t.preview_layout&&(n.param.layout=t.preview_layout):n.module="mail.list"),n},_initViewModuleEvent:function(){var e=this;e.onMessage("view:change",function(t){var n=_.extend(!0,{module:"",param:{}},t.message);p(e,n)}),e.onMessage("view:close",function(t){var n,i=t.message||{},a=e.widgets.tabview.getRenderedTabs(),r=[];"read*"===i.id?_.each(a,function(e,t){new RegExp(i.id,"i").test(t.sid)&&r.push(t.sid)}):r.push(i.id),i.target?(_.each(a,function(e,t){return 0===t.sid.indexOf(i.target)?(n=t.sid,!0):void 0}),n?(_.each(r,function(t,n){e.widgets.tabview.close(n,!0)}),e.widgets.tabview.switchTo(n)):_.each(r,function(t,n){e.widgets.tabview.close(n)})):_.each(r,function(t,n){e.widgets.tabview.close(n)})}),e.onMessage("view:switchTo",function(t){var n,i=t.message||{},a=e.widgets.tabview.getRenderedTabs();i.target&&(_.each(a,function(e,t){0===t.sid.indexOf(i.target)&&(n=t.sid)}),n&&e.widgets.tabview.switchTo(n))})},_initTabModuleEvent:function(){var e=this;e.onMessage("tab:change",function(t){var n=t.message||{},i=e.widgets.tabview,a=i.current();n.id=n.id||a.sid,i&&i.refreshTab(n)})},_initFolderModuleEvent:function(){var e=this;e.onMessage("folder:reload",function(){D.getFolders(!0,!1,!1).then(function(t){e._initFolderTree(t)})}),e.onMessage("folder:refresh",function(t){var n,i,a=t.message,s=D.getFoldersMap(),c=a.mboxa||"";i=_.type(a.ids),"undefined"===i||"null"===i?n=[]:"number"===i||"string"===i?n=[parseInt(a.ids,10)]:"array"===i&&(n=a.ids),""!==c&&(n=n.map(function(e){return e+c})),D.getFolders(!1,!0,!1).then(function(t){D.getFolders(!0,!0,!1).then(function(i){var d,u,p,h=!1;switch(a.type){case"auth2Locked":d=e._parseLockedFolders(),n=e._extendIds(n,d);break;case"all":n=[],_.each(i,function(e,t){n.push(t.id)})}n.length>0?("all"===a.type&&(p=e._compareFolders(i,t),p.added&&o(e,p.added),p.removed&&l(e,p.removed)),n=e._extendIds(n,[s.vip,s.unread,s.flagged]),_.each(n,function(t,n){_.each(i,function(t,i){return i.id==n?(r(e,i),h=h||i.parent===s.other||-1!==(""+i.fullPath).indexOf(s.other)||0===(""+i.parent).indexOf("@")&&""!=c,!1):void(i.id==s.other?u=i:""!=c&&i.id===c&&(u=i))})}),h&&u&&r(e,u)):(p=e._compareFolders(i,t),o(e,p.added),l(e,p.removed)),e.publish("folder:refreshed")})})})},_initHotkeysModuleEvent:function(){var e=this;e.offMessage("checknewmsg").onMessage("checknewmsg",function(){var t=S.getCurrentState();0===t.module.indexOf("mail.")&&e._handleComposeOrInbox(null,"inbox")}),e.offMessage("compose").onMessage("compose",function(){var t=S.getCurrentState();0===t.module.indexOf("mail.")&&"mail.compose"!==t.module&&e._handleComposeOrInbox(null,"compose")})},initSidebarEvent:function(){var e=this,t=e.$(".j-mlsidebar-line"),n=!1,i=_(".j-sidebar-mask");t.on("mousedown",function(){n=!0,_(document).on("selectstart.sidebar",function(){return!1}),i.removeClass("f-dn")}),i.off("mouseup.sidebar").on("mouseup.sidebar",function(){n=!1,_(document).off("selectstart.sidebar"),i.addClass("f-dn")}),i.off("mousemove.sidebar").on("mousemove.sidebar",function(t){n&&e.moveSidebarLine(t.pageX-e.element.offset().left,!1,!1)})},initSidebar:function(){j=Y=this.$(".j-mlsidebar").outerWidth();var e=C.cache.getItemWithLocal("cm_user_action")||{};this.moveSidebarLine(e.sidebarLineLeft||0,e.isExpanded===!1,!0)},moveSidebarLine:function(e,t,i){function a(){var n=v?v+f:h.outerWidth(),a=t&&!i?"fast":0,u="mltree";c.animate({width:v},a,function(){t&&l.element.toggleClass("sidebar-expanded").toggleClass("sidebar-collapsed");var e=_.fn.zTree.getZTreeObj(u);e&&_.each(e.getNodes(),function(e,t){s(u,t)})}),d.animate({left:e},a),p.animate({left:n},a,function(){l.publish("sidebar:changed")}),o=!o,r(_.extend({sidebarLineLeft:e},t?{isExpanded:o}:{}))}function r(e){var t=C.cache.getItemWithLocal("cm_user_action")||{};C.cache.setItemWithLocal("cm_user_action",_.extend(t,e))}function s(e,t){n(l,e,t),_.each(t.children||[],function(t,n){s(e,n)})}var o=this.get("sidebarExpanded");if(t=t||!1,i=i||!1,t||o){var l=this,c=l.$(".j-mlsidebar"),d=l.$(".j-mlsidebar-line"),u=d.find(".line"),p=l.$(".j-mlmain"),h=l.$(".j-btn-toggle-sidebar"),f=+u.css("width").replace("px",""),m=+u.css("margin-left").replace("px",""),g=.24*l.element.outerWidth(),v=e+m;t?v=o?0:j:Y>v?v=Y:v>g&&(v=g),v=Math.floor(v),v&&(j=v),e=v?v-m:-(f+m),a()}},_setHistory:function(e){var t,n=_.extend(!0,{},e),i=S.getUser();if(t=n.module.split(".")[1]){switch(t){case"welcome":n.param={};break;case"compose":n.param={id:n.param.id};break;case"list":n.param={fid:n.param.fid||n.param.id};break;case"previewlayout":n.param={fid:n.param.fid||n.param.id,layout:i.preview_layout};break;case"read":n.param={fid:n.param.fid,mid:n.param.mid,mboxa:n.param.mboxa,start:n.param.start};break;case"thread":n.param={fid:n.param.fid,mid:n.param.mid,mboxa:n.param.mboxa,start:n.param.start};break;case"search":n.param=D.makeSearchCondition(e.param)}n.param.vid=e.param.vid,this.sendMessage("dispatcher","view:render",n)}},_handleComposeOrInbox:function(e,t){var n="string"==typeof t?t:_(t).attr("data-op"),i=this;switch(n){case"inbox":var a=D.getCacheFolder(1),r=S.getUser();k.syncAutoSyncPOPAccounts().then(function(){i.sendMessage("mail","folder:refresh",{type:"all"}),p(i,{module:r.preview_layout?"mail.previewlayout":"mail.list",param:{id:1,fid:1,title:a.name,tabTitle:a.name}})});break;case"compose":S.getConfig("mail.enablesendmail")?D.getComposeInfo({ctype:"normal"}).then(function(e){i.sendMessage("mail","view:change",{module:"mail.compose",param:{id:e.id}})}):x.alert(C.i18n.t("compose/fa_forbidden"))}},_parseLockedFolders:function(){var e=S.getUser(),t=e.def_sec_folder,n=[];return"array"===_.type(t)&&_.each(t,function(e,t){var i=parseInt(t,10);isNaN(i)||n.push(i)}),n},_extendIds:function(e,t){return t="array"===_.type(t)?t:[t],_.each(t,function(t,n){var i=!1;_.each(e,function(e,t){return n==t?(i=!0,!1):void 0}),i||e.push(n)}),e},_compareFolders:function(e,t){var n,i,a,r;for(e=_.extend(!0,[],e),t=_.extend(!0,[],t),n=e.length-1;n>=0;n--)for(a=e[n],i=t.length-1;i>=0;i--)r=t[i],r.id===a.id&&(e.splice(n,1),t.splice(i,1));return{added:e,removed:t}},_initOffSiteRemind:function(e){if(e&&e.isOffSite){var t=this.$("#offSiteRemindTpl").html(),n=_(window).height(),i=_(window).width(),a=this;new T({template:this.compile(t,e),width:360,height:235,align:{baseXY:[i-365,n]}}).show();var r=_(".j-offSideRemind");r.animate({top:n-240+"px"},1500),r.find("a").click(function(){a.sendMessage("dispatcher","history:add",{module:"logs",param:{}})}),setTimeout(function(){r.animate({top:n+"px"},1500,function(){_(this).fadeOut()})},1e4)}}});b.module({name:"mail",template:e("text!template/module/mail/mail.tpl.html")},N)}),define("components/requirejs-text/text!component/../../template/component/memobox.tpl.html",[],function(){return'\r\n<!---->\r\n{{#if memoTip}}<div class="mail-memo-tip">{{/if}}\r\n    {{#if memoTip}}<h3 class="memo-title">{{i18n "mbox/mail_memo"}}</h3>{{/if}}\r\n    <div class="memo-msg-content j-memo-msg {{#unless memo}}f-dn{{/unless}}">\r\n        <div id="memoMsg" class="memo-msg">{{memo}}</div>\r\n        <div class="memo-op">\r\n            <a class="memo-op-a memo-edit j-memo-op" data-action="edit" href="javascript:void(0)">{{i18n "common/edit"}}</a>\r\n            <a class="memo-op-a memo-delete j-memo-op" data-action="delete" href="javascript:void(0)">{{i18n "common/delete"}}</a>\r\n        </div>\r\n    </div>\r\n    <div class="memo-edit-content j-memo-edit {{#if memo}}f-dn{{/if}}">\r\n        <div class="textarea-box">\r\n            <textarea name="memo-edit" id="memoTextarea" rows="5" maxlength="{{maxMailMemo}}">{{memo}}</textarea>\r\n        </div>\r\n        <div class="memo-op edit-foot">\r\n            <span class="j-memo-count f-fl"></span>\r\n            <span class="u-btn u-btn-primary  j-memo-op" data-action="save">{{i18n "common/save"}}</span>\r\n            <span class="u-btn u-btn-default j-memo-op" data-action="cancel">{{i18n "common/cancel"}}</span>\r\n        </div>\r\n    </div>\r\n{{#if memoTip}}</div>{{/if}}\r\n\r\n\r\n\r\n\r\n\r\n'}),define("component/memobox",["require","text!../../template/component/memobox.tpl.html","jquery","../util/index","cui/core/widget/widget","cui/ui/tip/tip","cui/ui/dialog/confirmbox","cui/util/templatable/templatable","../module/common/globalService","../module/mail/service"],function(e){var t=e("text!../../template/component/memobox.tpl.html"),n=e("jquery"),i=e("../util/index"),a=e("cui/core/widget/widget"),r=e("cui/ui/tip/tip"),s=e("cui/ui/dialog/confirmbox"),o=e("cui/util/templatable/templatable"),l=e("../module/common/globalService"),c=e("../module/mail/service"),d=a.extend({Implements:o,attrs:{eventCallBack:function(){}},setup:function(){d.superclass.setup.call(this);var e=this,n=e.get("memo")||"",i=l.getConfig("mail.maxmailmemo")||50,a={memo:n,maxMailMemo:i};if(e.$trigger=e.get("trigger")||"",e.maxMailMemo=i,e.get("tip")){var s=new r({trigger:e.$trigger,arrowPosition:11,inViewport:!0,theme:"yellow",distance:0,effect:"slide",parentNode:e.get("parentNode")});s.before("show",function(){a.memoTip=!0,this.set("content",e.compile(t,a))}),s.after("show",function(){e._bindEvent(this.element)})}else e.$trigger.html(e.compile(t,a)),e._bindEvent()},render:function(){d.superclass.render.call(this)},_handleEventCallBack:function(e){var t=this;t.get("eventCallBack")&&n.isFunction(t.get("eventCallBack"))&&t.get("eventCallBack").call(this,e)},_bindEvent:function(e){function t(){var e=s.val().replace(/\s+/g,"").length,t=i.i18n.t("mail/mail_memo_word_count");r.find(".j-memo-count").html(i.messageFormat.format(t,[e,a.maxMailMemo-e]))}var a=this,r=e||a.$trigger,s=r.find("#memoTextarea");r.find(".j-memo-op").off("click").on("click",function(){var e=n(this).data("action");a._handleMailMemo(e,r)}),t(),s.off("keyup","keydown").on("keydown",function(e){var t=s.val().replace(/\s+/g,"").length;return t>=a.maxMailMemo&&8!=e.keyCode?!1:void 0}).on("keyup",function(){t()})},_updateCountMemo:function(){var e=this,t=i.i18n.t("mail/mail_memo_word_count");e.$trigger.find(".j-memo-count").html(i.messageFormat.format(t,[0,e.maxMailMemo]))},_handleMailMemo:function(e,t){function n(e){c.updateMailAttrs("mark",{mid:d,expandThreadMid:!1,flags:{memo:e}}).then(function(){o.text(e),r.set("memo",e),a(),r._handleEventCallBack()})}function a(){o.text()||(l.val(""),t.parents("#mailMemo").addClass("f-dn"),r.$trigger.addClass("f-dn")),t.find(".j-memo-msg").removeClass("f-dn"),t.find(".j-memo-edit").addClass("f-dn")}var r=this,o=t.find("#memoMsg"),l=t.find("#memoTextarea"),d=r.get("mid")||"";if(!d)return!1;switch(e){case"save":n(l.val());break;case"edit":l.val(o.text()),t.find("#mailMemo,.j-memo-edit").removeClass("f-dn"),t.find(".j-memo-msg").addClass("f-dn");break;case"cancel":a();break;case"delete":s.confirm(i.i18n.t("mail/confirm_delete_mail_memo"),function(){r._updateCountMemo(),n("")})}},destroy:function(){d.superclass.destroy.call(this)}}),u={init:function(e){return this.each(function(){var t=n(this),i=n.extend({trigger:t},e);t.data("memoBox.settings",i),t.memoBoxInstance||(t.memoBoxInstance=new d(i),t.data("memoBox",t.memoBoxInstance))})}};n.fn.memoBox=function(e){return u[e]?u[e].apply(this,Array.prototype.slice.call(arguments,1)):n.isPlainObject(e)?u.init.apply(this,arguments):void n.error("Method"+e+"does not exist on jQuery.memoBox")}}),define("components/requirejs-text/text!component/../../template/component/maildeferbox.tpl.html",[],function(){return'<!---->\r\n\r\n    <!--  -->\r\n    {{#if dialogTpl}}\r\n    <div id="deferDialogTpl" class="defer-dialog">\r\n        <div class="recent">\r\n            <div class="j-item item">\r\n                <label>\r\n                    <input type="radio" name="defer" value="0" {{#compare deferValue \'==\' 0}}checked{{/compare}}{{#unless deferValue}}checked{{/unless}} />\r\n                    {{i18n "mail/today"}}\r\n                </label>\r\n            </div>\r\n            <div class="j-item item">\r\n                <label>\r\n                    <input type="radio" name="defer" value="1" {{#compare deferValue \'==\' 1}}checked{{/compare}} />\r\n                    {{i18n "mail/tomorrow"}}\r\n                </label>\r\n            </div>\r\n            <div class="j-item item">\r\n                <label>\r\n                    <input type="radio" name="defer" value="2" {{#compare deferValue \'==\' 2}}checked{{/compare}}/>\r\n                    {{i18n "mail/theDayAfterTmr"}}\r\n                </label>\r\n            </div>\r\n        </div>\r\n        <div class="j-item other j-other-date">\r\n            <label for="oterDateRadio">\r\n                <input id="oterDateRadio"  type="radio" name="defer" value="3"\r\n                        {{#compare deferValue \'<\' 0}}checked{{/compare}}{{#compare deferValue \'>\' 2}}checked{{/compare}} />\r\n                <input id="datePicker" class="u-input" type="text" name="otherDeferDate"\r\n                       value="{{#compare deferValue \'<\' 0}}{{deferDate}}{{/compare}}{{#compare deferValue \'>\' 2}}{{deferDate}}{{/compare}}"\r\n                       placeholder=\'{{i18n "mail/defer_date_hint"}}\' />\r\n            </label>\r\n        </div>\r\n    </div>\r\n   {{/if}}\r\n\r\n    <!--tip-->\r\n    {{#if tipTpl}}\r\n    <div id="mailDeferTip" class="defer-memo-content">\r\n        <div>\r\n            {{{i18n "mail/defer_msg_1" date=displayDeferDate}}}{{#if overdue}}{{i18n \'mail/defer_msg_2\'}}{{/if}}\r\n            <a href="javascript:void(0)" class="j-defer-op" data-action="edit" deferDate="{{deferDate}}" mid="{{mid}}" deferValue="{{deferValue}}">\r\n                {{i18n \'mail/defer_mod_link\'}}\r\n            </a>\r\n        </div>\r\n        <div class="defer-memo-foot">\r\n            <span class="u-btn u-btn-primary j-defer-op" data-action="complete" mid="{{mid}}">{{i18n \'mail/deferCompleted\'}}</span>\r\n        </div>\r\n    </div>\r\n    {{/if}}'}),define("component/maildeferbox",["require","i18n!mail","jquery.datepicker","text!../../template/component/maildeferbox.tpl.html","jquery","moment","../util/index","cui/ui/tip/tip","cui/core/widget/widget","cui/ui/dialog/confirmbox","cui/util/templatable/templatable","../module/common/globalService","../module/mail/service"],function(e){e("i18n!mail"),e("jquery.datepicker");var t=e("text!../../template/component/maildeferbox.tpl.html"),n=e("jquery"),i=e("moment"),a=e("../util/index"),r=e("cui/ui/tip/tip"),s=e("cui/core/widget/widget"),o=e("cui/ui/dialog/confirmbox"),l=e("cui/util/templatable/templatable"),c=e("../module/common/globalService"),d=e("../module/mail/service"),u=s.extend({Implements:l,setup:function(){u.superclass.setup.call(this),this.get("tipTpl")?this._initTipView():this._initDialogView()},render:function(){u.superclass.render.call(this)},_initTipView:function(){var e=this;e.deferTip=new r({arrowPosition:1,inViewport:!0,triggerType:"click",trigger:e.get("trigger"),content:e.compile(t,e._formatTipData()),events:{"click .j-defer-op":function(t,i){var a=n(i).data("action");"edit"==a?(e.deferDialog=new u({mid:e.get("mid"),parentNode:e.get("parentNode"),parentView:e.get("parentView"),deferDate:e.get("deferDate"),deferValue:n(i).attr("deferValue"),mboxa:e.get("mboxa")}),this.hide()):"complete"==a&&(e._UpdateMailDefer(e._formatDeferData()),this.hide())}}})},_formatTipData:function(){var e=this,t=!1,n=e.get("deferDate")?e.get("deferDate").substring(0,10):"",r=n,s=i(n,"YYYY-MM-DD").diff(i(i().format("YYYY-MM-DD")),"days"),o={0:a.i18n.t("mail/today"),1:a.i18n.t("mail/tomorrow"),2:a.i18n.t("mail/theDayAfterTmr")};return s>=0?r=o[s]||r:t=!0,{tipTpl:!0,deferValue:s,overdue:t,mid:e.get("mid"),deferDate:n,displayDeferDate:r}},_initDialogView:function(){function e(e){var t={isDisabled:function(e){return e.valueOf()<(new Date).getTime()}};e.datepicker(t)}var i=this,r=c.getUser()||{},s={dialogTpl:!0,deferDate:i.get("deferDate"),deferValue:i.get("deferValue")||"0"};"2"==r.preview_layout&&n(".m-preview-layout-row").css("z-index","10"),i.deferDialog=new o({parentNode:i.get("parentNode"),title:a.i18n.t("mail/defer_dialog_title"),message:i.compile(t,s),events:{"click .j-other-date .radio":function(e,t){var i=n(t).siblings(['type="radio"']);i.prop("checked")||(i.trigger("click"),n(t).next("#datePicker").trigger("click"))},"click #datePicker":function(e,t){var i=n(t).siblings(['type="radio"']);i.prop("checked")||i.attr("checked","checked").trigger("change.crc")}},onConfirm:function(){var e=this.element,t=e.find('input[name="defer"]:checked').val(),a=e.find('input[name="otherDeferDate"]').val(),r=i._formatDeferData({deferValue:t,otherDeferValue:a});i._UpdateMailDefer(r),n(".m-preview-layout-row").css("z-index",""),this.hide()},onCancel:function(){n(".m-preview-layout-row").css("z-index",""),this.hide()}}),i.deferDialog.after("show",function(){var t=this.element;t.customRadioCheckbox(),e(t.find("#datePicker"))}).show()},_formatDeferData:function(e){var t,n=this,a=!0;switch(e=e||{},e.deferValue){case"0":t=i().format("YYYY-MM-DD");break;case"1":t=i().add(1,"days").format("YYYY-MM-DD");break;case"2":t=i().add(2,"days").format("YYYY-MM-DD");break;case"3":t=e.otherDeferValue||i().format("YYYY-MM-DD");break;default:t="1970-01-01",a=!1}return t=t.split("-"),{mid:n.get("mid"),flags:{deferHandle:a},defer:new Date(t[0],t[1]-1,t[2]),mboxa:n.get("mboxa")}},_UpdateMailDefer:function(e){var t=this,i=t.get("parentView"),r=t.get("successCb"),s=e.flags.deferHandle;d.updateMailAttrs("defer",e).then(function(){var t,o=c.getUser()||{},l=d.getFoldersMap()||{};i.sendMessage("mail","folder:refresh",{ids:l.defer}),i.sendMessage("mail.list","view:refresh",{start:i._params.listStart||i._params.start}),o.preview_layout?i.state.param.fid!==l.defer||s?"list"==i.state.param.view?(t=n("#previewLayoutRead").find(".j-mail-read").attr("mid"),t&&i._handleReadOrCompose&&i._handleReadOrCompose(null,i.$('tr[mid="'+t+'"]')[0])):i.render():(n("#previewLayoutRead").find(".j-mail-read").remove(),n("#previewLayoutRead").find(".j-email-unchecked").show()):i.render(),r?r(e):s?n.notify.success(a.i18n.t("mail/defer_update_success")):n.notify.success(a.i18n.t("mail/defer_complete_success"))})},destroy:function(){this.deferTip&&n.isFunction(this.deferTip.destroy)&&this.deferTip.destroy(),this.deferDialog&&n.isFunction(this.deferDialog.destroy)&&this.deferDialog.destroy(),u.superclass.destroy.call(this)}});return u}),define("components/requirejs-text/text!module/../../template/module/mail/toolbar.tpl.html",[],function(){return'<div>\r\n    <!--  -->\r\n    <div id="reportTemplate">\r\n        <div class="report-dialog j-report">\r\n            <div class="spamType">\r\n                {{i18n "mail/msg_report_as"}}:\r\n                <select name="spamType" id="spamType">\r\n                    <option value="0">{{i18n "mail/msg_report_as_spam"}}</option>\r\n                    <option value="1">{{i18n "mail/msg_report_as_illegal"}}</option>\r\n                    <option value="2">{{i18n "mail/msg_report_as_other"}}</option>\r\n                </select>\r\n            </div>\r\n            <div class="add">\r\n                <label>\r\n                    <input type="checkbox" name="addToRefuseList" id="addToRefuseList"/>\r\n                    {{i18n "mail/msg_report_add_refuselist"}}\r\n                </label>\r\n            </div>\r\n            <div class="add">{{i18n "mail/msg_add_to_refuselist_tips"}}</div>\r\n        </div>\r\n    </div>\r\n\r\n    <!--  -->\r\n    <div id="notJunkTemplate">\r\n        <div class="notJunk-dialog j-notJunk">\r\n            <div class="move">{{i18n "mail/msg_notjunk_move"}}</div>\r\n            <div class="add">\r\n                <label>\r\n                    <input type="checkbox" name="addToWhiteList" id="addToWhiteList"/>\r\n                    {{i18n "mail/msg_notjunk_add_whitelist"}}\r\n                </label>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!---->\r\n    <div id="filterTemplate">\r\n        <div class="filter-dialog j-filter  f-cf">\r\n            <div class="filter-item">{{i18n "common/mail_fast_filter_tip"}}</div>\r\n            <div class="filter-item">\r\n                <label class="filter-label">{{i18n "mbox/mail_from"}} :</label>\r\n                <span class="f-wwb ">{{from}}</span>\r\n            </div>\r\n            <div class="filter-item">\r\n                <label class="filter-label" for="folder">{{i18n "common/op_move"}} :</label>\r\n                <select id="folder" name="folder">\r\n                    {{#each folders}}\r\n                    <option value="{{id}}" data-indent="{{countIndent deepLevel}}">{{name}}</option>\r\n                    {{/each}}\r\n                    <optgroup>\r\n                        <option value="newFolder">{{i18n "common/new_folder"}}</option>\r\n                    </optgroup>\r\n                </select>\r\n            </div>\r\n            <div class="filter-item create-folder f-dn">\r\n                <label class="filter-label" for="folderName">{{i18n "common/folder_name"}} :</label>\r\n                <input type="text" class="u-input" id="folderName" name="folderName" />\r\n            </div>\r\n            <div class="filter-item create-folder f-dn">\r\n                <label class="filter-label" for="folderParent">{{i18n "common/position"}} :</label>\r\n                <select id="folderParent" name="folderParent" >\r\n                    <option value="0">{{i18n "main/fdr_root"}}</option>\r\n                    {{#each folders}}\r\n                    <option value="{{id}}">{{name}}</option>\r\n                    {{/each}}\r\n                </select>\r\n            </div>\r\n            <div class="filter-rules f-cf">\r\n                <input type="checkbox" name="toAllEmails" id="toAllEmails"/><label for="toAllEmails">{{i18n "common/to_all_emails"}}</label>\r\n            </div>\r\n            <div class="filter-item">\r\n                {{i18n "common/create_new_filter"}}<a class="hyperlinks j-filter-page" href="javascript:void(0)">{{i18n "common/create_new_filter_URL"}}</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <!---->\r\n    <div id="addToRefuselistDetails">\r\n\r\n        {{#if refuseList}}\r\n        <dl>\r\n            <dt>{{i18n "mail/add_to_refuselist_succ"}}</dt>\r\n            {{#each refuseList}}\r\n            <dd>{{this}}</dd>\r\n            {{/each}}\r\n        </dl>\r\n        {{/if}}\r\n\r\n        {{#if whiteList}}\r\n        <dl>\r\n            <dt>{{i18n "mail/add_to_whitelist_succ"}}</dt>\r\n            {{#each whiteList}}\r\n            <dd>{{this}}</dd>\r\n            {{/each}}\r\n        </dl>\r\n        {{/if}}\r\n\r\n        {{#if existRefuseList}}\r\n            <dl>\r\n                <dt>{{i18n "mail/add_to_list_fail_reason_0"}}</dt>\r\n                {{#each existRefuseList}}\r\n                    <dd>{{this}}</dd>\r\n                {{/each}}\r\n            </dl>\r\n        {{/if}}\r\n\r\n        {{#if existSafeList}}\r\n            <dl>\r\n                <dt>{{i18n "mail/add_to_list_fail_reason_1"}}</dt>\r\n                {{#each existSafeList}}\r\n                <dd>{{this}}</dd>\r\n                {{/each}}\r\n            </dl>\r\n        {{/if}}\r\n        {{#if existUserEmails}}\r\n            <dl>\r\n                <dt>{{i18n "mail/add_to_list_fail_reason_2"}}</dt>\r\n                {{#each existUserEmails}}\r\n                <dd>{{this}}</dd>\r\n                {{/each}}\r\n            </dl>\r\n        {{/if}}\r\n    </div>\r\n\r\n    <!---->\r\n    <script type="text/x-handlebars-template" id="settingTemplate">\r\n        <div class="setting-menu j-setting-menu">\r\n            {{#if previewLayout}}\r\n            <div class="setting-item f-cf">\r\n                <label>{{i18n "common/op_layout"}}</label>\r\n                <div class="u-btns layout-btns f-fr">\r\n                    <span class="u-btn u-btn-default{{#unless user.preview_layout}} u-btn-primary{{/unless}}" data-action="preview_layout:0">\r\n                        {{i18n "common/op_layout_default"}}\r\n                    </span>\r\n                    <span class="u-btn u-btn-default{{#compare user.preview_layout \'==\' 1}} u-btn-primary{{/compare}}" data-action="preview_layout:1">\r\n                        {{i18n "common/op_layout_ud"}}\r\n                    </span>\r\n                    <span class="u-btn u-btn-default{{#compare user.preview_layout \'==\' 2}} u-btn-primary{{/compare}}" data-action="preview_layout:2">\r\n                        {{i18n "common/op_layout_lr"}}\r\n                    </span>\r\n                </div>\r\n            </div>\r\n            {{/if}}\r\n\r\n            <div class="setting-item f-cf">\r\n                <label>{{i18n "common/op_lineheight"}}</label>\r\n                <div class="u-btns list-style-btns f-fr">\r\n                    <span class="u-btn u-btn-default{{#compare user.list_style \'==\' 0}} u-btn-primary{{/compare}}" data-action="list_style:0">\r\n                        {{i18n "common/op_lineheight_default"}}\r\n                    </span>\r\n                    <span class="u-btn u-btn-default{{#compare user.list_style \'==\' 1}} u-btn-primary{{/compare}}" data-action="list_style:1">\r\n                        {{i18n "common/op_lineheight_compact"}}\r\n                    </span>\r\n                </div>\r\n            </div>\r\n            <div class="setting-item group-bottom f-cf">\r\n                <label>{{i18n "common/op_maxlist"}}</label>\r\n                <div class="u-btns max-list-btns f-fr">\r\n                    <span class="u-btn u-btn-default{{#compare user.maxlist \'==\' 10}} u-btn-primary{{/compare}}" data-action="maxlist:10">10</span>\r\n                    <span class="u-btn u-btn-default{{#compare user.maxlist \'==\' 20}} u-btn-primary{{/compare}}" data-action="maxlist:20">20</span>\r\n                    <span class="u-btn u-btn-default{{#compare user.maxlist \'==\' 50}} u-btn-primary{{/compare}}" data-action="maxlist:50">50</span>\r\n                    <span class="u-btn u-btn-default{{#compare user.maxlist \'==\' 100}} u-btn-primary{{/compare}}" data-action="maxlist:100">100</span>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="setting-item group-top f-cf">\r\n                <label>{{i18n "common/op_size"}}</label>\r\n                <span class="f-fr">\r\n                    <input type="checkbox" name="display_size" role="switchBtn" class="checkbox j-switch-btn"\r\n                           {{#if user.display_size}}checked{{/if}} />\r\n                </span>\r\n            </div>\r\n            {{#if enableListBriefText}}\r\n            <div class="setting-item f-cf">\r\n                <label>{{i18n "common/op_summary"}}</label>\r\n                <span class="f-fr">\r\n                    <input type="checkbox" name="list_brief_text" role="switchBtn" class="checkbox j-switch-btn" {{#if user.list_brief_text}}checked{{/if}} />\r\n                </span>\r\n            </div>\r\n            {{/if}}\r\n            {{#if displayList}}\r\n            <div class="setting-item f-cf">\r\n                <label>{{i18n "common/op_session"}}</label>\r\n                 <span class="f-fr">\r\n                    <input type="checkbox" name="display_list" role="switchBtn" class="checkbox j-switch-btn" {{#if user.display_list}}checked{{/if}} />\r\n                </span>\r\n            </div>\r\n            {{/if}}\r\n            <div class="more-setting" data-action="moresetting">\r\n                <label class="setting-item">{{i18n "common/op_moresetting"}}</label>\r\n            </div>\r\n        </div>\r\n    </script>\r\n\r\n</div>';
}),define("module/mail/toolbar",["require","exports","module","../../widget/pagination/pagination","text!../../../template/module/mail/toolbar.tpl.html","jquery","cui/core/view/view","cui/ui/select/select","cui/ui/popup/popup","../../util/index","component/confirmbox","component/maildeferbox","../common/globalService","./service","../contact/service","../setting/service"],function(e,t,n){function i(e,t){var n=[];return e.$('.j-mail input[type="checkbox"]').each(function(){var e=c(this);e.prop("checked")&&("boolean"!=typeof t?n.push(e.val()):t?!!e.data("draft")&&n.push(e.val()):!e.data("draft")&&n.push(e.val()))}),n}function a(e,t){var n=e.state.param,a=[];return"read"===n.view||"thread"===n.view?a.push(n.mid):("list"===n.view||"search"===n.view)&&(a=i(e)),a.length>0?!0:(c.notify.warning(h.i18n.t("mail/msg_select",{action:h.i18n.t("common/"+t)})),!1)}function r(e,t,n){var a,o,l,d="checkbox-checked",u="selected",p=!1,h=!1,f=i(e.parent);if(f.length>0&&c.each(f,function(t){o=e._getMailInfo(f[t]),l=o?o.flags.signed||o.flags.encrypted||!1:"",p=p||l,o.ctrls&&o.ctrls["CM-SECURITY"]&&(h=!0)}),f.length>=0&&e.parent.sendMessage("mail.previewlayout","previewlayout:count",{count:f.length}),n)n="array"===c.type(n)?n:[n],c.each(n,function(t,n){a=e.parent.$('.j-mail[mid="'+n+'"]').find('input[type="checkbox"]'),a.prop("checked",!0),a.next(".checkbox").addClass(d)}),s(e,a&&a.length>0);else switch(t){case"all":e.set("selectedCurPage",!0),a=e.parent.$('.c-mail-list input[type="checkbox"]'),c.merge(a,e.$('.j-selectmail input[type="checkbox"]')),a.prop("checked",!0),a.next(".checkbox").addClass(d),a.closest(".j-mail").addClass(u),e._initSelectAllMail(!0),s(e,i(e.parent).length>0);break;case"curPage":e._initSelectAllMail(!1),e.set("selectedCurPage",!0),a=e.parent.$('.c-mail-list input[type="checkbox"]'),c.merge(a,e.$('.j-selectmail input[type="checkbox"]')),a.prop("checked",!0),a.next(".checkbox").addClass(d),a.closest(".j-mail").addClass(u);var m=e.parent.$('input[name="mid"]').length;e.parent.sendMessage("mail.previewlayout","curCheckShow:showCurNum",{showCurNum:m}),s(e,i(e.parent).length>0);break;case"none":e.set("selectedCurPage",!1),a=e.parent.$('.c-mail-list input[type="checkbox"]'),c.merge(a,e.$('.j-selectmail input[type="checkbox"]')),a.prop("checked",!1),a.next(".checkbox").removeClass(d),a.closest(".j-mail").removeClass(u),e._initSelectAllMail(!1),e.parent.sendMessage("mail.previewlayout","allCheckHide:hideSelectedNum",{hideSelectedNum:!1}),s(e,!1);break;case"unread":a=e.parent.$('.j-mail.unread input[type="checkbox"]'),r(e,"none"),a.prop("checked",!0),a.next(".checkbox").addClass(d),a.closest(".j-mail").addClass(u),r(e,"check");break;case"read":a=e.parent.$('.j-mail.read input[type="checkbox"]'),r(e,"none"),a.prop("checked",!0),a.next(".checkbox").addClass(d),a.closest(".j-mail").addClass(u),r(e,"check");break;case"inverse":e.parent.$(".j-mail").each(function(){var e=c(this),t=e.hasClass(u);t?(e.removeClass(u),e.find("input[type=checkbox]").prop("checked",!1).next(".checkbox").removeClass(d)):(e.addClass(u),e.find("input[type=checkbox]").prop("checked",!0).next(".checkbox").addClass(d))}),r(e,"check");break;case"inverse:curPage":e.get("selectedCurPage")?r(e,"none"):r(e,"curPage");break;case"check":var g=e.$("[data-dropdown=select]"),v=g.find("input[type=checkbox]");e.parent.$(".j-mail."+u).length===e.parent.$(".j-mail").length?(e.set("selectedCurPage",!0),v.prop("checked",!0).next(".checkbox").addClass(d)):(e.set("selectedCurPage",!1),v.prop("checked",!1).next(".checkbox").removeClass(d)),e._initSelectAllMail(!1),s(e,i(e.parent).length>0,p,h)}}function s(e,t,n,i){var a=e.parent.state.param.fid,r=e.$("div.j-tgbtns");t?r.removeClass("f-dn"):r.addClass("f-dn"),2==a||15==a?r.find(".u-btns .j-collect").hide():r.find(".u-btns .j-collect").show(),n?(r.find("[value='more:reply']").addClass("f-dn"),r.find("[value='more:replyall']").addClass("f-dn"),r.find("[value='more:replyall']").next(".divider").addClass("f-dn"),r.find("[value='more:forward']").addClass("f-dn"),r.find("[value='more:forwarda']").addClass("f-dn"),r.find("[value='more:sendagain']").addClass("f-dn")):(r.find("[value='more:reply']").removeClass("f-dn"),r.find("[value='more:replyall']").removeClass("f-dn"),r.find("[value='more:replyall']").next(".divider").removeClass("f-dn"),r.find("[value='more:forward']").removeClass("f-dn"),r.find("[value='more:forwarda']").removeClass("f-dn"),r.find("[value='more:sendagain']").removeClass("f-dn")),i?r.find("[value='more:forwardd']").addClass("f-dn"):r.find("[value='more:forwardd']").removeClass("f-dn")}function o(e,t){e.length<=0&&(e="operate"),"boolean"==typeof t?t?c.notify.error(h.i18n.t("mail/msg_select_draft",{action:h.i18n.t("common/"+e)})):c.notify.error(h.i18n.t("mail/msg_select_nodraft",{action:h.i18n.t("common/"+e)})):c.notify.error(h.i18n.t("mail/msg_select",{action:h.i18n.t("common/"+e)}))}e("../../widget/pagination/pagination");var l=e("text!../../../template/module/mail/toolbar.tpl.html"),c=e("jquery"),d=e("cui/core/view/view"),u=e("cui/ui/select/select"),p=e("cui/ui/popup/popup"),h=e("../../util/index"),f=e("component/confirmbox"),m=e("component/maildeferbox"),g=e("../common/globalService"),v=e("./service"),_=e("../contact/service"),y=e("../setting/service"),b=d.extend({attrs:{parent:null,refresh:null,total:0,limit:20,currentPage:0,selectedCurPage:!1},events:{"click span.j-maildelete":function(){this._handleToolbar(null,"delete")},"click span.j-collect":function(){this._handleToolbar(null,"collect")},"click span.j-mailrefresh":function(){this._handleToolbar(null,"refresh")},"click span[data-btn]":function(e,t){this._handleToolbar(null,c(t).data("btn"))},"click span.j-deferCompleted":function(){this._handleToolbar(null,"defer:setComp")},"change.crc .j-switch-btn":"_handleSwitchBtn","click .j-setting-menu [data-action]":function(e,t){this._handleSetting(c(t).data("action"),t)}},setup:function(){return this.parent=this.get("parent"),this.onRefresh=this.get("refresh"),this.parent?(this.view=this.parent.name.split(".").pop(),this.onRefresh=c.isFunction(this.onRefresh)?c.proxy(this.onRefresh,this.parent):c.noop,void(this._params={mboxa:this.parent.state.param.mboxa||"",fid:"list"===this.view||"read"===this.view||"thread"===this.view?this.parent.state.param.fid:void 0,mid:"read"===this.view||"thread"===this.view?this.parent.state.param.mid:void 0,action:""})):void c.error("MailToolbar: parent can not be empty")},render:function(){return b.superclass.render.call(this),this._initConfig(),this._initToolbar(),this._initSettingMenu(),this._initCheckbox(),this._initPagination(),this._initEvents(),this},_initConfig:function(){var e=this.parent||{};this.config={restrictDraftFunc:!0},c.extend(this.config,e.config)},_initToolbar:function(){var e=this,t=this._params.fid,n=v.getFoldersMap();t===n.defer?e.$("div.j-viewbtns").hide():e.$("span.j-deferCompleted").hide(),t===n.collect&&e.$('span.j-maildelete, [data-btn="delete"]').text(h.i18n.t("common/op_cancel_collect")).removeClass("j-maildelete").attr("data-btn","cancelCollect"),e.$("[data-dropdown]").not('[role="dropdown"]').each(function(){var i,a=c(this),r=c(this).attr("data-dropdown");if("move"===r){if(t&&t==n.draft)return a.remove(),!0;if(t&&t==n.collect)return a.remove(),!0;var s=h.cache.getItemWithLocal("ht_tree_folders"),o=[];c.each(s,function(e,t){return 15==t.id&&t.children?(o=t.children,!1):void 0}),o&&o.length>0&&c.each(o,function(e,n){return t==n.id?(a.remove(),!0):void 0}),v.getFolders(!1,!0).then(function(i){var r=t===n.trash,s=[],o=e.config.forbidMoveToFolders||[];c.each(i,function(e,t){var i=parseInt(t.id);return isNaN(i)?!0:i!==n.draft||r?-1!==c.inArray(""+i,o)?!0:15==i||15==t.parent||"[object String]"===Object.prototype.toString.call(t.fullPath)&&0==t.fullPath.indexOf("15")?!0:void s.push(t):!0}),a.dropdown({data:s,chooseHtml:"",callback:function(t){e._handleToolbar(t,"move")}})})}else i=e._formatMenu(r),a.dropdown({data:i,chooseHtml:"mark"===r||"more"===r?"":'<i class="iconfont iconchoose left"></i>',beforeShow:function(){var t=e._params.action,n=c(this).data("dropdown");0!==t.indexOf(n)&&0!==n.indexOf("setting")&&0!==n.indexOf("sort")&&c(this).dropdown("choose",!1,!0)},beforeClearChoose:function(e){},callback:function(t){e._handleToolbar(t)}})});var i=h.cookies.get("list_order","receivedDate"),a=h.cookies.get("list_order_desc",!0),r=a?":desc":":asc",s=this.$('li[value="sort:'+i+r+'"]');s&&s.addClass("u-menu-choose").append('<i class="iconfont iconchoose left u-menu-choose"></i>')},_initSettingMenu:function(){var e=this,t=g.getUser(),n={user:t,previewLayout:void 0!==t.preview_layout&&"search"!==e.view,displayList:void 0!==t.display_list&&"search"!==e.view,enableListBriefText:e.config.enableListBriefText&&("search"===e.view?e.parent.state.param.pattern:!0)};e.settingMenu&&(e.settingMenu.hide(),e.settingMenu.destroy()),e.settingMenu=new p({template:e.parent.compile(c(l).find("#settingTemplate").html(),n),trigger:e.$(".j-setting"),triggerType:"click",parentNode:e.element,align:{baseXY:["-265","100%"]}}),e.settingMenu.after("show",function(){this.element.customRadioCheckbox()})},_initCheckbox:function(){var e=this,t=e.parent;this.element.customRadioCheckbox(),this.$("span.j-selectmail .checkbox").on("click",function(e){e.stopPropagation();var n=c(this).parents('[data-dropdown="select"]'),i=c(this).hasClass("checkbox-checked");i?(n.find('li[value="select:curPage"]').trigger("click.dropdown").trigger("click.dropdown"),t.sendMessage("mail.previewlayout","allCheckShow:showSelectedNum",{showSelectedNum:i})):(n.find('li[value="select:none"]').trigger("click.dropdown"),t.sendMessage("mail.previewlayout","allCheckHide:hideSelectedNum",{hideSelectedNum:i}))})},_initPagination:function(){if(!this.parent)return!1;var e,t=this,n=t.parent._params.start,i=t.get("limit"),a=Boolean(t.parent._params.bookmark);0===t.get("total")&&(e=0),a&&(n=t.parent._params.bookmark.start||0),e=n?n/i:t.get("currentPage"),t.$("#pagination").pagination({total:t.get("total"),limit:t.get("limit"),currentPage:e,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',menu:!("read"===t.view||"thread"===t.view),callback:function(e,n){t.onRefresh({start:e*t.get("limit"),resetPagination:!1})}})},_initEvents:function(){var e=this;this.on("mail:select",function(t,n){r(e,t,n)}),this.on("mail:mark",function(t,n,i){t="string"===c.type(t)?[t]:t,e._handleMarkMail(n,i,t)}),this.on("mail:refresh",function(t){t=t||e._params.action,(0===t.indexOf("view")||"refresh"===t)&&e._handleToolbar(null,t)}),this.on("pagination:init",function(t,n){e.set("total",t),e.set("limit",n),e._initPagination()}),this.on("mail:defer",function(t,n){e._handleDeferMail(t,n)}),this.on("mail:remove",function(t){e._handleMoveMail("move",{id:t})}),this.on("mail:op",function(t){"prev"===t||"next"===t?this.$("#pagination [rel="+t+"]").trigger("click"):e._handleToolbarMoreOperate(t)})},_formatMenu:function(e){var t=this,n=v.getFoldersMap(),i=this._params.fid,a=v.getToolbarMenu("mail.menu."+e);switch(e){case"view":t._formatFlaggedColorMenu("view",a),t._params.fid&&t._params.fid==n.draft&&delete a.reply;break;case"mark":t._formatFlaggedColorMenu("view",a),t.config.enableVipMessage&&a.vip?t._params.fid===n.vip&&a.vip.splice(0,1):delete a.vip,(!t.config.enableTopMail||"undefined"!=typeof i&&0>i)&&delete a.top,t.config.enableDeferMail&&a.defer?"thread"===t.view&&a.defer.splice(0,1):delete a.defer,("read"===t.view||"thread"===t.view)&&t._formatReadMark(a);break;case"more":a.filter=t._formatMoreMenu(a.filter),a.other=t._formatMoreMenu(a.other),a.forward=t._formatMoreMenu(a.forward),a.reply=t._formatMoreMenu(a.reply),t.config.shareMailBoxFolder&&delete a.filter,v.isExpandThreadMid(i)&&(delete a.filter,delete a.reply),i==n.draft&&(delete a.filter,delete a.reply,delete a.forward);break;case"read-more":a.filter=t._formatMoreMenu(a.filter),a.other=t._formatMoreMenu(a.other),t.config.shareMailBoxFolder&&(delete a.filter,delete a["mail-memo"]);break;case"thread-more":a=t._formatMoreMenu(a)}return t.config.enableMailMemo||delete a["mail-memo"],a},_formatReadMark:function(e){var t=this,n=t.parent._params.mail,i=n.flags||{},a=0;e&&!c.isEmptyObject(e)&&(c.isArray(e.mail)&&e.mail.length>1&&e.mail.splice(0,1),c.isArray(e.priority)&&c.isArray(e.priority[0].children)&&(3==n.priority?a=1:n.priority>3&&(a=2),e.priority[0].children.splice(a,1)),c.isArray(e.top)&&e.top.splice(i.top?0:1,1),c.isArray(e.vip)&&e.vip.length>1&&e.vip.splice(i.vip?0:1,1))},_formatFlaggedColorMenu:function(e,t){var n=this,i=n.config||{},a=t.flag,r=i.mailFlaggedColorCount;i.enableMailFlagged&&i.enableUpdateMailStatus&&c.isArray(a)?1>=r?a.splice(1,1):a[1]&&c.isArray(a[1].children)&&a[1].children.splice("mark"===e?r:r+1):delete t.flag},_formatMoreMenu:function(e){var t=this,n=g.getUser(),i=v.getFoldersMap(),a=t._params.fid,r=[],s=t.parent._params.mail?t.parent._params.mail.sMimeServerEncrypted:!1,o=t.parent._params.mail?t.parent._params.mail.sMimeClientEncrypted:!1,l=t.parent._params.mail?t.parent._params.mail.isDecodeMail:"";return s||o||(l=!0),e=e||[],c.each(e,function(e,d){if("more:report"===d.value&&(a===i.junk||!t.config.enableSpamForwhand)||"more:notJunk"===d.value&&a!==i.junk||"more:delete"===d.value&&(!n.preview_layout||a===i.trash)||"more:sendagain"===d.value&&(!t.config.enableSendAgain||v.isExpandThreadMid(a)||a===i.draft||!l)||"more:forwardd"===d.value&&(!t.config.enableForwardd||v.isExpandThreadMid(a)||!l)||"more:forwarda"===d.value&&(!t.config.enableForward||s)||"more:delete"===d.value&&(!t.config.enableDelete||t.config.shareMailBoxFolder)||"more:realdelete"===d.value&&(!t.config.enableRealDelete||t.config.shareMailBoxFolder||a===i.collect)||"more:mail_event"===d.value&&!t.config.enableScheduleInvitation||"more:reply"===d.value&&(!t.config.enableReply||!l)||"more:replyall"===d.value&&(!t.config.enableReply||!l))return!0;if("more:forward"===d.value)if(c.isArray(d.children)&&d.children.length)c.each(d.children.splice(0,d.children.length),function(e,n){if(n.value)switch(n.value){case"forward:forwardd":t.config.enableForwardd&&!o&&d.children.push(n);break;case"forward:forwarda":t.config.enableForward&&!s&&!o&&d.children.push(n);break;default:t.config.enableForward&&d.children.push(n)}});else if(!t.config.enableForward||v.isExpandThreadMid(a)||!l)return!0;r.push(d)}),r},_handleToolbar:function(e,t){var n;switch(e=e||{},e.value=e.value||t,t=e.value.split(":"),n=t[2]?t[1]+":"+t[2]:t[1],t=t[0],this._params.action=e.value,t){case"select":r(this,n);break;case"sort":e.isSame||this._handleSortMail(n);break;case"delete":this._handleDeleteMail();break;case"collect":this._handleCollectMail();break;case"cancelCollect":this._handleCancelCollect();break;case"move":this._handleMoveMail(t,e);break;case"mark":this._handleMarkMail(n,e);break;case"label0":this._handleMarkMail(t+":"+n,e);break;case"view":this._handleViewMail(n);break;case"more":this._handleToolbarMoreOperate(n,e);break;case"refresh":this._handleRefresh();break;case"setting":this._handleSetting(n,e);break;case"reply":this._handleToolbarMoreOperate(n||t,e);break;case"replyall":this._handleToolbarMoreOperate(n||t,e);break;case"forward":this._handleToolbarMoreOperate(n||t);break;case"viewMail":this._handleViewMailPart(n);break;case"encoding":this._handleEncodingMail(n);break;case"defer":a(this.parent,"mark")&&this._handleDeferMail(n);break;case"decryptServerEncrypted":this.config.openSMIMEKeyPass?this._handleDecipherMail():(this.parent.state.param.supportSMIME=!0,this.parent.render());break;case"decryptClientEncrypted":this.parent._handleDecryptCAMail()}},_handleDeferMail:function(e){var t=this,n=this.parent,i=function(e){var t=g.getUser()||{},i=v.getFoldersMap()||{};n.sendMessage("mail","folder:refresh",{ids:i.defer}),t.preview_layout?n.sendMessage("mail.previewlayout","view:refresh"):n.render(),c.notify.success(0===e?h.i18n.t("mail/msg_recover_success"):h.i18n.t("mail/msg_recover_success_part",{failed:e}))};t._getSelectedMids().then(function(n){"set"===e?t._updateListDefer(n,i):"setComp"===e&&t._completedDefer(n,i)})},_handleDecipherMail:function(){var e=this,t='<div><div>{{i18n "mail/msg_signed_tip"}}</div><div><input type="password" size="40" value="" onkeypress="if(event.keyCode==13) {return false;}" id="smimeKeyPass" autocomplete="off" tabindex="1"></div></div>';f.confirm(e.parent.compile(t,{}),function(){v.authenticateSmimeKeyPass({smimeKeyPass:this.$("#smimeKeyPass").val()}).then(function(t){return"S_OK"===t.code&&(e.parent.state.param.supportSMIME=!0,e.parent.render()),!0},function(e){"FA_UNAUTHORIZED"===e.responseJSON.code&&f.alert(h.i18n.t("mail.safe_mail_pwd_error"))})})},_updateListDefer:function(e,t){var n=this,i=this.parent,a=function(){var e={action:"deferHandle",message:h.i18n.t("mail/defer_update_success"),options:{extendBtn:h.i18n.t("mail/op_recover"),callback:function(){v.recoverOpStack(e.action).then(function(e){!t&&(t=c.noop),t(e)},function(){c.notify.warning(h.i18n.t("mail/msg_recover_failed"))})}}};("list"==n.view||"search"==n.view)&&c.notify.success(e.message,e.options)};n.deferDialog=new m({parentNode:i.element,parentView:i,mid:e,mboxa:i.state.param.mboxa,successCb:a})},_completedDefer:function(e,t){var n=this.parent;v.updateMailAttrs("defer",{mid:e,flags:{deferHandle:!1},defer:new Date("1970","0","1")}).then(function(){var e=c("#previewLayoutRead"),i={action:"deferHandle",message:h.i18n.t("mail/defer_complete_success"),options:{extendBtn:h.i18n.t("mail/op_recover"),callback:function(){v.recoverOpStack(i.action).then(function(e){!t&&(t=c.noop),t(e)},function(){c.notify.warning(h.i18n.t("mail/msg_recover_failed"))})}}},a=g.getUser()||{},r=v.getFoldersMap()||{};n.sendMessage("mail","folder:refresh",{ids:r.defer}),a.preview_layout?(n.state.param.fid===r.defer&&(e.find(".j-mail-read").remove(),e.find(".j-email-unchecked").show()),n.sendMessage("mail.previewlayout","view:refresh")):n.render(),c.notify.success(i.message,i.options)})},_handleSortMail:function(e){var t,n;e&&(t=e.split(":"),n="desc"===t[1],t=t[0]),this.onRefresh({order:t,desc:n,topFirst:!1,group:!1,resetPagination:!0})},_handleDeleteMail:function(){switch(this.view){case"list":this._handleListDeleteMail();break;case"search":this._handleSearchDeleteMail();break;case"read":case"thread":this._handleReadDeleteMail()}},_handleCollectMail:function(){switch(this.view){case"list":case"read":case"thread":this._handleCollectMoveMail("collect",{id:15},{type:this.view})}},_handleCancelCollect:function(){"read"===this.view||"thread"===this.view?this._handleReadRealDeleteMail():this._handleListRealDeleteMail()},_handleListDeleteMail:function(){4===this._params.fid?this._handleListRealDeleteMail():this._handleListMoveMail("delete",{id:4})},_handleSearchDeleteMail:function(){var e=this;a(this.parent,"delete")&&e._getSelectedMids().then(function(t){var n=v.getFoldersMap(),i=[],a=[],r=[];c.each(t,function(t,s){var o=e.parent.$('.j-mail[mid="'+s+'"]'),l=o.attr("fid");-1===c.inArray(l,i)&&i.push(l),l==n.trash?a.push(s):r.push(s)}),r.length>0&&v.updateMailAttrs("move",{fid:n.trash,mid:r}).then(function(){c.notify.success(h.i18n.t("mail/msg_delete_mail",{count:r.length}),{extendBtn:h.i18n.t("mail/op_recover"),callback:function(){v.recoverOpStack("move").then(function(){e.onRefresh({resetPagination:!0,refreshMailFolder:!1,start:e.parent._params.start||0}),e.parent.sendMessage("mail","folder:refresh",{ids:i}),c.notify.success(h.i18n.t("mail/msg_recover_success"))},function(){c.notify.error(h.i18n.t("mail/msg_recover_failed"))})}}),e.onRefresh({resetPagination:!0,start:e.parent._params.start||0}),e.parent.sendMessage("mail","folder:refresh",{ids:i})},function(){c.notify.error(h.i18n.t("mail/msg_delete_mail_failed"))}),a.length>0&&v.realDeleteMails({mids:a}).then(function(){c.notify.success(h.i18n.t("mail/msg_realdelete_mail",{count:a.length})),e.onRefresh({resetPagination:!0,start:e.parent._params.start||0}),e.parent.sendMessage("mail","folder:refresh",{ids:i})},function(){c.notify.error(h.i18n.t("mail/msg_realdelete_mail_failed"))})})},_handleReadDeleteMail:function(){var e=this,t=v.getFoldersMap();this._params.fid==t.trash?this._handleReadRealDeleteMail():e._handleReadMoveMail("delete",{id:t.trash})},_handleRealDeleteMail:function(){"read"===this.view||"thread"===this.view?this._handleReadRealDeleteMail():this._handleListRealDeleteMail()},_handleListRealDeleteMail:function(){function e(){c.notify.success(h.i18n.t(s?"mbox/cancel_message_succ":"mbox/del_message_succ")),t.parent.sendMessage("mail","folder:refresh",{ids:r}),t.onRefresh({resetPagination:!0,start:t.parent._params.start||0})}var t=this,n=t.parent&&t.parent.state?t.parent.state.param:{},i=n.selectAll||!1,r=t._params.fid,s=r===v.getFoldersMap().collect,o=h.i18n.t(s?"mail/confirm_cancel_collect_mail":"mail/confirm_purge_mail");"list"===this.view&&i&&!n.mboxa?f.confirm(o,function(){y.doEmptyFolder(r,!0).then(function(){e()})}):a(t.parent,"realdelete")&&t._getSelectedMids().then(function(n){f.confirm(o,function(){var i={fromFid:r,mids:n};t._params.mboxa&&(i.mboxa=t._params.mboxa),v.realDeleteMails(i).then(function(){e()})})})},_handleReadRealDeleteMail:function(){var e=this,t=e._params.fid,n=t===v.getFoldersMap().collect,i=h.i18n.t(n?"mail/confirm_cancel_collect_mail":"mail/confirm_purge_mail");f.confirm(i,function(){var i={fromFid:t,mids:e._params.mid};e._params.mboxa&&(i.mboxa=e._params.mboxa),v.realDeleteMails(i).then(function(){c.notify.success(h.i18n.t(n?"mbox/cancel_message_succ":"mbox/del_message_succ")),e._handleReadAfterDel()})})},_handleFilterMail:function(){var e,t,n=this,a="filterBox",r=this.view,s=[];return"list"===r||"search"===r?(this.config.restrictDraftFunc&&(t=!1),s=i(this.parent,t),e=n._getMailInfo(s[0])):e=this.parent._params.mail||{},c.isEmptyObject(e)||s.length>1?(n.parent.sendMessage("dispatcher","history:add",{module:"setting.filter.letter",param:{}}),!1):(a+=e.id,void(n[a]?n[a].show():v.getFolders(!1,!0,!0).then(function(t){var i,r,s=[],o=[];i=c.isArray(e.from)?e.from:e.from?h.Email.parse(e.from):e.from,c.each(i,function(e,t){s.push(t.address?t.address:h.Email.parseAddress(t))}),c.each(t,function(e,t){15!=t.id&&o.push(t)}),r=n.parent.compile(c(l).find("#filterTemplate").html(),{from:s.join(","),folders:o}),n[a]=new f({id:encodeURIComponent(e.id),parentNode:n.parent.element,title:h.i18n.t("common/op_filter"),message:r,onConfirm:function(){var e=this.element,t=e.find("#folder").val(),i=e.find("#folderName").val(),a=parseInt(e.find("#folderParent").val());"newFolder"===t&&i?y.createFolders([{name:i,parent:a}]).then(function(t){"S_OK"===t.code&&(n.parent.sendMessage("mail","folder:refresh",{type:"all"}),n._handleFilterAndMoveToFolder(e.find("#toAllEmails").is(":checked"),t["var"][0],s.join(",")))}):n._handleFilterAndMoveToFolder(e.find("#toAllEmails").is(":checked"),parseInt(t),s.join(",")),this.hide()}}),n[a].after("show",function(){var e,t=this.element,i={parentNode:t.find(".j-filter"),trigger:t.find("#folder"),classPrefix:"u-select",width:"222"};n[a].hasInited||(t.customRadioCheckbox(),e=new u(i).render(),e.after("select",function(){"newFolder"===e.get("value")?t.find(".create-folder").removeClass("f-dn"):t.find(".create-folder").addClass("f-dn")}),new u(c.extend(i,{trigger:t.find("#folderParent")})).render(),t.find(".j-filter-page").on("click",function(){n[a].hide(),n.parent.sendMessage("dispatcher","history:add",{module:"setting.filter.letter",param:{type:"create",emailaddr:s.join(",")}})}),n[a].hasInited=!0)}).show()})))},_handleFilterAndMoveToFolder:function(e,t,n){var i=this,a=[{field:"from",disabled:!1,operator:"=",operand:n,ignoreCase:!0,forAddress:!0,forIAddress:!1,listOfValues:!0}],r=[{type:"move",disabled:!1,target:t},{disabled:!0,type:"flags",value:{flagged:!0}}],s=[{disabled:!1,"continue":!1,operator:"and",name:"rule_autoCreate_"+Math.ceil(100*Math.random()+100)+"_from_"+n,condictions:a,actions:r}];y.addMailRule({items:s}).then(function(n){e?v.updateMailAttrs("rule",{mid:[],rule:"@"+n}).then(function(){i.parent.sendMessage("mail.list","view:refresh")}):i._handleMoveMail("move",{id:t})},function(e,t,n){var i="";switch(n.code){case"FA_OVERFLOW":i=h.i18n.t("mail/msg_beyondMaxRuleLimit")}f.alert(i)})},_handleMailEvent:function(){var e=this;e.parent.sendMessage("dispatcher","history:add",{module:"calendar",param:{mid:e._params.mid,historyUrl:encodeURIComponent("calendar")}}),v.readMessage({mboxa:e._params.mboxa,mid:e._params.mid}).then(function(e){var t=setInterval(function(){var n=c(".j-calendar iframe");if(n.length>0){clearInterval(t);var i=[];c.each([e.from,e.to,e.cc,e.bcc],function(e,t){t&&c.each(t,function(e,t){var n=h.Email.parseAddress(t);-1===c.inArray(n,i)&&(i[i.length]=n)})}),n.attr("src",h.url.addUrlParams("cal/eventEdit.jsp",{sid:g.getSid(),func:"add",name:e.subject,attendees:i.join(",")}))}},100)})},_handleRejectMail:function(){var e,t=this,n=this.view;!this.config.restrictDraftFunc||"list"!==n&&"search"!==n||(e=!1),t._getSelectedMids(e).then(function(n){return n.length<=0?void o("operate",e):void(t.rejectBox?t.rejectBox.show():t.rejectBox=new f({parentNode:t.parent.element,title:h.i18n.t("main/sys_info"),message:h.i18n.t("mail/msg_confirm_reject_mail"),onConfirm:function(){t._handleSaveToListInfo("refuselist"),this.hide()}}).show())})},_handleReportMail:function(){var e,t=this,n=this.view;!this.config.restrictDraftFunc||"list"!==n&&"search"!==n||(e=!1),t._getSelectedMids(e).then(function(n){if(n.length<=0)return void o("operate",e);var i=v.getFoldersMap(),a="reportBox"+(c.isArray(n)?n.join(","):n);t[a]?t[a].show():(t[a]=new f({parentNode:t.parent.element,title:h.i18n.t("main/sys_info"),message:t.parent.compile(c(l).find("#reportTemplate").html()),onConfirm:function(){var e=this;v.updateMailAttrs("rule",{fromFid:t._params.fid,mid:n,attrs:{fid:i.junk},reportType:"spam"}).done(function(){t.parent.sendMessage("mail","folder:refresh",{ids:i.junk}),e.$("#addToRefuseList").is(":checked")?t._handleSaveToListInfo("refuselist","report"):(c.notify.success(h.i18n.t("mbox/reportJunk_succeed")),"read"===t.view||"thread"===t.view?t._handleReadAfterDel(i.junk):t.onRefresh({start:t.get("currentPage")}))}).always(function(){e.hide()})}}),t[a].after("show",function(){t[a].hasInited||(this.element.customRadioCheckbox(),new u({parentNode:this.element.find(".j-report"),trigger:this.element.find("#spamType"),classPrefix:"u-select"}).render(),t[a].hasInited=!0)}),t[a].show())})},_handleNotJunkMail:function(){"list"===this.view?this._handleListNotJunkMail():("read"===this.view||"thread"===this.view)&&this._handleReadNotJunkMail()},_handleListNotJunkMail:function(){var e,t=this,n=t.parent&&t.parent.state?t.parent.state.param:{};this.config.restrictDraftFunc&&(e=!1),t._getSelectedMids(e).then(function(i){if(i.length<=0)return void o("operate",e);var a=[];n.selectAll?v.getMessageInfos({mboxa:n.mboxa,ids:i}).then(function(e){c.each(e,function(e,t){a.push(t.from)}),t._doNotJunkMail(i,a)}):(c.each(i,function(e,n){var i=t._getMailInfo(n)||{};a.push(i.from)}),t._doNotJunkMail(i,a))})},_handleReadNotJunkMail:function(){var e=this,t=this._params.mid,n=this.parent._params.mail||{},i="array"===c.type(n.from)?n.from:[n.from];e._doNotJunkMail(t,i)},_doNotJunkMail:function(e,t){var n=this,i=v.getFoldersMap(),a=g.getUser(),r=a.refuselist?a.refuselist.replace(/, /g,",").split(","):[],s="notJunkBox"+(c.isArray(e)?e.join(","):e);n[s]?n[s].show():(n[s]=new f({parentNode:n.parent.element,title:h.i18n.t("main/sys_info"),message:n.parent.compile(c(l).find("#notJunkTemplate").html()),onConfirm:function(){var a=this;v.updateMailAttrs("rule",{mid:e,attrs:{fid:i.inbox},reportType:"notspam"}).done(function(){function e(){n.parent.sendMessage("mail","folder:refresh",{ids:i.inbox}),a.$("#addToWhiteList").is(":checked")?n._handleSaveToListInfo("safelist","notJunk"):(c.notify.success(h.i18n.t("mbox/reportNotJunk_succeed")),"read"===n.view||"thread"===n.view?n._handleReadAfterDel():n.onRefresh({start:n.get("currentPage")}))}var s,o,l=!1;for(s=t.length-1;s>=0;s--)o=h.Email.parseAddress(t[s]),c.each(r,function(e,t){return o===t?(r.splice(e,1),l=!0,!1):void 0});l?g.updateUser({refuselist:r.join(",")}).then(function(){e()}):e()}).always(function(){a.hide()})}}),n[s].after("show",function(){n[s].hasInited||(this.element.customRadioCheckbox(),n[s].hasInited=!0)}),n[s].show())},_handleAddToAddressbook:function(){var e,t,n=this.parent._params.mail||{},i=n.rcpts||[];return i.length?void _.createOrUpdatePabContacts(i).then(function(n){n.added&&n.added.length>0?(e=n.added.length>=3?n.added.splice(0,2).join(",")+",...":n.added.join(","),c.notify.success(h.messageFormat.format(h.i18n.t("common/added_user_address"),e))):n.existed&&n.existed.length>0&&(t=n.existed.length>=3?n.existed.splice(0,2).join(",")+",...":n.existed.join(","),c.notify.warning(h.messageFormat.format(h.i18n.t("common/aready_exists_address"),t)))},function(){c.notify.error(h.i18n.t("common/add_user_address_fail"))}):!1},_handleDownloadMail:function(){var e=this;return e._checkWebReadOnly(e.parent,this._params.mid)?void f.alert(h.i18n.t("mail/msg_select_webreadonly")):void(location.href="mbox/readdata.jsp?mid="+this._params.mid+"&mboxa="+this._params.mboxa+"&mode=download&part=0&mboxa=")},_handlePrintMail:function(){window.open("../public/mailprint.jsp?sid="+g.getSid()+"&fid="+this._params.fid+"&nav_type=system&inbox=true&webReadOnly=0&offset=0&mid="+this._params.mid+"&mboxa="+this._params.mboxa+"&scheduledate=&sender=")},_handleMailMemo:function(){this.parent.trigger("mail:memo:edit")},_handleMoveMail:function(e,t){"read"===this.view||"thread"===this.view?this._handleReadMoveMail(e,t):this._handleListMoveMail(e,t)},_handleListMoveMail:function(e,t){function n(e){e||(e=h.i18n.t("mail/msg_list_move_select")),c.notify.error(e),r(s,"none")}function i(n,i){var o,l="",d=(t.name||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");d=['<a style="cursor: pointer;" class="j-mail-list-move-success">',d,"</a>"].join(""),l="boolean"==typeof a&&i>0?a?h.i18n.t("mail/msg_list_move_draft_success",{moves:n,unmoves:i,dist:d}):h.i18n.t("mail/msg_list_move_nodraft_success",{moves:n,unmoves:i,dist:d}):h.i18n.t("delete"===e?"mail/msg_delete_mail":"mail/msg_move_mail",{count:n,dist:d}),s.onRefresh({resetPagination:!0,refreshMailFolder:!1,start:s.parent._params.start||0}),o=c.notify.success(l,{extendBtn:h.i18n.t("mail/op_recover"),bodyIsHTML:!0,callback:function(){v.recoverOpStack("move","list"===s.view?s._params.fid||v.getFoldersMap().trash:"").then(function(){s.onRefresh({resetPagination:!0,refreshMailFolder:!1,start:s.parent._params.start||0,initialize:!0}),c.notify.success(h.i18n.t("mail/msg_recover_success")),s.parent.sendMessage("mail","folder:refresh",{ids:[t.id,s._params.fid]})},function(){c.notify.error(h.i18n.t("mail/msg_recover_failed"))})}}),o.opt.beforeClose=function(){this.item.off("click",".j-mail-list-move-success")},o.item.on("click",".j-mail-list-move-success",function(e){return function(t){var n;t.preventDefault(),n={module:"mail.list",param:{fid:p}},e.sendMessage("dispatcher","history:add",n)}}(s.parent.pubsub)),r(s,"none"),g.getUser().preview_layout&&s.parent.sendMessage("mail.previewlayout","previewlayout:read"),s.parent.sendMessage("mail","folder:refresh",{ids:[t.id,s._params.fid]})}var a,s=this,o=s.parent&&s.parent.state?s.parent.state.param:{},l=o.selectAll||!1,d=v.isExpandThreadMid(s._params.fid),u=!1,p=t.id,m=v.getFoldersMap();this.config.restrictDraftFunc&&(p===m.draft?a=!0:p!==m.trash&&(a=!1));var _=function(e){v.updateMailAttrs("move",{expandThreadMid:d,fid:p,mid:e,mboxa:o.mboxa}).then(function(){var t,n=0;!l&&d?c.each(e,function(e,t){var i=s._getMailInfo(t);n+=i.threadMessageCount||1}):n=e.length,"boolean"==typeof a?s._getSelectedMids().then(function(a){t=a.length-e.length,0>t&&(t=0),i(n,t)}):i(n)})};s._getSelectedMids(a).then(function(e){return e.length<=0?void("boolean"==typeof a?n(h.i18n.t(a?"mail/msg_list_move_select_draft":"mail/msg_list_move_select_nodraft")):n()):(o.id===m.sent&&c.each(e,function(e,t){var n=s._getMailInfo(t);return u=!(!n.composeExtra||!n.composeExtra.autoDel),u?!1:void 0;
}),void(u?f.confirm(h.i18n.t("mail/msg_list_move_autodel_notify"),function(){_(e)},c.noop()):_(e)))})},_handleCollectMoveMail:function(e,t,n){function i(e){v.collectMailAttrs("collect",{fid:u,mid:e,mboxa:d}).then(r,function(e){switch((e||{}).code){case"FA_FORBIDDEN":f.alert(h.i18n.t("error/FA_FORBIDDEN"));break;case"S_PARTIAL_OK":r(e["var"]);break;default:a()}})}function a(){c.notify.error(h.i18n.t("mail/msg_collect_fail"))}function r(e){var t=s.parent.pubsub,n=c.grep(e.clones,function(e){return e}),i=(e.failedlist||[]).length;if(!n.length)return a();"list"===o&&s._handleReadAfterDel(u);var r=h.i18n.t("mail/msg_list_collect_success",{success:n.length,failed:i});i||(r=h.i18n.t("mail/msg_collect_success")),t.sendMessage("mail.list","view:refresh",{fid:u}),setTimeout(function(){c.notify.success(r,{extendBtn:h.i18n.t("mail/op_recover"),bodyIsHTML:!0,callback:function(){v.realDeleteMails({mids:n,expandThreadMid:l,mboxa:d}).then(function(){c.notify.success(h.i18n.t("mail/msg_recover_success")),t.sendMessage("mail.list","view:refresh",{fid:u})},function(){c.notify.error(h.i18n.t("mail/msg_recover_failed"))})}})},10)}var s=this,o=n.type,l=v.isExpandThreadMid(s._params.fid),d=s._params.mboxa,u=t.id;s._getSelectedMids().then(function(e){i(e)})},_handleReadMoveMail:function(e,t){var n=this,i=n.parent&&n.parent.state?n.parent.state.param:{},a=v.getFoldersMap(),r=n._params.fid,s=t.id,o=n.parent._params.mail.flags,l=function(e){e||(e=h.i18n.t("mail/msg_move_mail_failed")),c.notify.error(e)},d=function(){v.updateMailAttrs("move",{fromFid:r,fid:s,mid:n._params.mid,mboxa:i.mboxa}).then(function(){var i="",a=n.parent.pubsub,r=(t.name||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");i=h.i18n.t("delete"===e?"mail/msg_delete_mail":"mail/msg_move_mail",{count:1,dist:r}),n._handleReadAfterDel(s),setTimeout(function(){c.notify.success(i,{extendBtn:h.i18n.t("mail/op_recover"),bodyIsHTML:!0,callback:function(){v.recoverOpStack("move","").then(function(){c.notify.success(h.i18n.t("mail/msg_recover_success")),a.sendMessage("mail.list","view:refresh","")},function(){c.notify.error(h.i18n.t("mail/msg_recover_failed"))})}})},10)},function(t){var n="";switch((t||{}).code){case"FA_FORBIDDEN":f.alert(h.i18n.t("error/FA_FORBIDDEN"));break;default:n="delete"===e?"mail/msg_delete_mail_failed":"mail/msg_move_mail_failed",l(h.i18n.t(n))}})};if(this.config.restrictDraftFunc)if(s==a.draft){if(!o.draft)return void l(h.i18n.t("mail/msg_read_move_nodraft_failed"))}else if(s!=a.trash&&o.draft)return void l(h.i18n.t("mail/msg_read_move_draft_failed"));if(i.fid==a.sent){var u=n._getMailInfo(i.mid);if(u.composeExtra&&u.composeExtra.autoDel)return void f.confirm(h.i18n.t("mail/msg_list_move_autodel_notify"),function(){d()},c.noop())}d()},_handleReadAfterDel:function(e){var t=this,n=g.getUser(),i=t.parent&&t.parent.state?t.parent.state.param:{},a=[t._params.fid];e&&a.push(e),t.parent.sendMessage(t.parent._params.fromView,"view:refresh",{start:t.parent._params.listStart}),t.parent.sendMessage("mail","folder:refresh",{ids:a}),h.detector.isDetachMode()||n.preview_layout||0!==n.afterdel?t.onRefresh({start:t.parent._params.start||t.get("currentPage")}):t.parent.sendMessage("mail","view:close",{id:t.view+":"+t._params.mid,target:i.pView})},_handleMarkMail:function(e,t,n){"read"===this.view||"thread"===this.view?this._handleReadMarkMail(e,t):this._handleListMarkMail(e,t,n)},_handleReadMarkMail:function(e,t){var n=this,i=this._params.fid,a={flag:e};n.parent.state.param.mboxa&&(a.mboxa=n.parent.state.param.mboxa),v.isExpandThreadMid(i)&&("noflagged"===e?a.expandThreadMid=!0:("flagged"===e||-1!==e.indexOf("label0"))&&(a.expandThreadMid=!1)),v.markMails(this.view,this._params.mid,a).then(function(){var i={type:e};v.showMarkNotify(!0,!0,e,t.name),-1!==e.indexOf("label0:")&&(i.label0=e.split(":")[1],i.type="flagged"),("unread"===e||"read"===e)&&n.parent.sendMessage("mail","folder:refresh",{ids:n._params.fid}),n.parent.trigger("mail:mark",i)},function(){v.showMarkNotify(!0,!1,e,t.name)})},_handleListMarkMail:function(e,t,n){function i(n){var i={mboxa:l.mboxa,fromFid:l.fid,flag:e};v.isExpandThreadMid(i.fromFid)&&("noflagged"===e?i.expandThreadMid=!0:("flagged"===e||-1!==e.indexOf("label0"))&&(i.expandThreadMid=!1)),v.markMails(o.view,n,i).then(function(i){i?(v.showMarkNotify(!0,!0,e,t.name,function(){v.recoverOpStack(e).then(function(t){("unread"===e||"read"===e)&&o.parent.sendMessage("mail","folder:refresh",{ids:o._params.fid}),o.onRefresh({resetPagination:!0,start:0}),c.notify.success(0===t?h.i18n.t("mail/msg_recover_success"):h.i18n.t("mail/msg_recover_success_part",{failed:t}))},function(){c.notify.warning(h.i18n.t("mail/msg_recover_failed"))})}),s(e,n),("unread"===e||"read"===e)&&o.parent.sendMessage("mail","folder:refresh",{ids:o._params.fid})):v.showMarkNotify(!1),r(o,"none")},function(){v.showMarkNotify(!0,!1,e,t.name)})}function s(e,t){var n,i=!0,a=v.getFlagsMap(e),r=a[2]&&a[2].label0?a[2].label0:0;switch(-1!==e.indexOf("label0")&&(e="flagged"),n=o._getMailList(),e){case"unread":c.each(t,function(t,n){var i=o.parent.$('.j-mail[mid="'+n+'"]'),a=i.find(".j-normalIcon");i.removeClass("read").addClass("unread"),a.hasClass("iconschedule")?a.attr("title",h.i18n.t("mail/alt_m_UNREAD_CALENDAR_MAIL")):a.hasClass("state-icon")||a.hasClass("iconback")||a.addClass("state-icon icon-mUNREAD").attr("title",h.i18n.t("main/alt_m_UNREAD")),o.parent.sendMessage((i.attr("readthread")?"mail.thread:":"mail.read:")+n,"read:mark",{type:e})});break;case"read":c.each(t,function(e,t){var n=o.parent.$('.j-mail[mid="'+t+'"]'),i=n.find(".j-normalIcon");n.removeClass("unread").addClass("read"),i.hasClass("icon-mUNREAD")&&(i.removeClass("icon-mUNREAD").attr("title",""),i.removeClass("state-icon")),i.hasClass("iconschedule")&&i.attr("title",h.i18n.t("mail/alt_m_READED_CALENDAR_MAIL"))});break;case"flagged":c.each(t,function(t,n){var i=o.parent.$('.j-mail[mid="'+n+'"]');i.removeClass(function(e,t){return(t.match(/label0-[0-9]/g)||[]).join("")}).addClass("flagged label0-"+r),i.find(".j-flag").removeClass("unflag").find(".iconfont").addClass("iconflatcolor").removeClass("iconflat").attr("title",h.i18n.t("mail/list_cancel_flag")),o.parent.sendMessage((i.attr("readthread")?"mail.thread:":"mail.read:")+n,"read:mark",{type:e,label0:r})});break;case"noflagged":c.each(t,function(t,n){var i=o.parent.$('.j-mail[mid="'+n+'"]');i.removeClass("flagged label0-0"),i.find(".j-flag").addClass("unflag").find(".iconfont").removeClass("iconflatcolor").addClass("iconflat").attr("title",h.i18n.t("mail/list_set_flag")),o.parent.sendMessage((i.attr("readthread")?"mail.thread:":"mail.read:")+n,"read:mark",{type:e})});break;case"urgent":c.each(t,function(t,n){var i=o.parent.$('.j-mail[mid="'+n+'"]');i.find(".j-priorityIcon").removeClass("state-icon icon-pLOW").addClass("state-icon icon-pHIGH").attr("title",h.i18n.t("mail/list_title_urgent")),o.parent.sendMessage((i.attr("readthread")?"mail.thread:":"mail.read:")+n,"read:mark",{type:e})});break;case"general":c.each(t,function(t,n){var i=o.parent.$('.j-mail[mid="'+n+'"]');i.find(".j-priorityIcon").removeClass("state-icon icon-pHIGH icon-pLOW"),o.parent.sendMessage((i.attr("readthread")?"mail.thread:":"mail.read:")+n,"read:mark",{type:e})});break;case"slow":c.each(t,function(t,n){var i=o.parent.$('.j-mail[mid="'+n+'"]');i.find(".j-priorityIcon").removeClass("state-icon icon-pHIGH").addClass("state-icon icon-pLOW").attr("title",h.i18n.t("mail/list_title_slow")),o.parent.sendMessage((i.attr("readthread")?"mail.thread:":"mail.read:")+n,"read:mark",{type:e})});break;case"top":case"notop":case"vip":case"novip":i=!1,c.each(t,function(t,n){var i=o.parent.$('.j-mail[mid="'+n+'"]');o.parent.sendMessage((i.attr("readthread")?"mail.thread:":"mail.read:")+n,"read:mark",{type:e})})}i?c.each(t,function(e,t){c.each(n,function(e,n){return n.id===t?(c.extend(!0,n,a[2]),!1):void 0})}):o.onRefresh({resetPagination:!0,start:0})}var o=this,l=o.parent&&o.parent.state?o.parent.state.param:{};n?i(n):a(this.parent,"mark")&&o._getSelectedMids().then(function(e){i(e)})},_handleViewMail:function(e){var t=v.getFlagsMap(e),n=c.extend({},t[2].flags||t[2]);t[2].hasOwnProperty("label0")&&(n.label0=t[2].label0,e=e.replace(":","_")),("replied"===e||"forwarded"===e)&&(n.draft=!1),this.onRefresh({filterFlags:n,resetPagination:!0,action:e})},_handleToolbarMoreOperate:function(e,t){var n=this;switch(e){case"replyall":case"replyall-attach":case"reply":case"reply-attach":case"forward":case"forwardd":case"sendagain":n._handleMenuComposeMail(e,t);break;case"forwarda":n._handleForwardA(e,t);break;case"pack":n._handlePackMail();break;case"reject":n._handleRejectMail();break;case"delete":this._handleDeleteMail();break;case"realdelete":n._handleRealDeleteMail();break;case"filter":n._handleFilterMail();break;case"mail_event":n._handleMailEvent();break;case"report":n._handleReportMail();break;case"notJunk":n._handleNotJunkMail();break;case"addToAddressbook":n._handleAddToAddressbook();break;case"mailDownload":this._handleDownloadMail();break;case"print":this._handlePrintMail();break;case"mailMemo":this._handleMailMemo()}},_handleViewMailPart:function(e){var t=g.getSid(),n=this._params.mid,i=this._params.mboxa;switch(e){case"header":window.open("mbox/viewheader.jsp?sid="+t+"&mid="+n+"&partId=0&mboxa="+i);break;case"source":window.open("mbox/readdata.jsp?sid="+t+"&mid="+n+"&mode=text&part=0&mboxa="+i)}},_handleEncodingMail:function(e){var t,n,i;"read"===this.view?t=this.parent._params.mail:"thread"===this.view,t&&(n=this.parent.$("#mail-"+t.iframeId),i=n.attr("src").split("&encoding=")[0],n.attr("src",i+"&encoding="+e))},_handleRefresh:function(){this.$('[data-dropdown="select"]').data("action","none"),r(this,"none"),this._handleViewAndSort("all","receivedDate:desc")},_handleViewAndSort:function(e,t){var n=v.getFlagsMap(e),i=c.extend({},n[2].flags||n[2]);n[2].hasOwnProperty("label0")&&(i.label0=n[2].label0,e=e.replace(":","_")),("replied"===e||"forwarded"===e)&&(i.draft=!1);var a=t.split(":"),r="desc"===a[1];a=a[0],this.onRefresh({filterFlags:i,action:e,order:a,desc:r,topFirst:this.config.enableTopMail||!1,group:!1,resetPagination:!0})},_handleSwitchBtn:function(e,t){var n=c(t),i=n.prop("name")+":"+(n.prop("checked")?"1":"0");this._handleSetting(i,t)},_handleSetting:function(e){var t,n,i=this,a=g.getUser();switch(e=e.split(":"),t=e[0],n=e[1],t){case"preview_layout":g.updateUser({preview_layout:parseInt(n)}).then(function(){var e={module:0===parseInt(n)?"mail.list":"mail.previewlayout",param:{fid:i._params.fid}};(1===parseInt(n)||2===parseInt(n))&&(e.param.layout=parseInt(n),i.parent.sendMessage("mail","view:close",{id:"read*"})),i.parent.sendMessage("dispatcher","history:add",e),i.parent.sendMessage("setting.display.list","view:refresh",null)}).always(function(){i._initSettingMenu()});break;case"list_style":if(n=parseInt(n,10),n!==a.list_style){switch(n){case 0:i.parent.$(".j-mail-list").removeClass("user-fs12"),i.parent.$(".j-mail-totals").removeClass("user-fs12"),i.parent.$(".j-listtt").removeClass("user-fs12");break;case 1:i.parent.$(".j-mail-list").addClass("user-fs12"),i.parent.$(".j-mail-totals").addClass("user-fs12"),i.parent.$(".j-listtt").addClass("user-fs12")}g.updateUser({list_style:n}).always(function(){i._initSettingMenu(),i.parent.sendMessage("setting.display.list","view:refresh",null)})}else i.settingMenu&&i.settingMenu.hide();break;case"maxlist":n=parseInt(n,10),n!==a.maxlist?g.updateUser({maxlist:n}).then(function(){i.onRefresh({start:0,resetPagination:!0}),i._initSettingMenu(),i.parent.sendMessage("setting.display.list","view:refresh",null)}):i.settingMenu&&i.settingMenu.hide();break;case"display_size":n=1===a.display_size?0:1,g.updateUser({display_size:n}).then(function(){i.onRefresh({resetPagination:!0,start:0}),i.parent.sendMessage("setting.display.list","view:refresh",null)}).always(function(){i._initSettingMenu()});break;case"list_brief_text":n=1===a.list_brief_text?0:1,g.updateUser({list_brief_text:n}).then(function(){i.onRefresh({start:0,resetPagination:!0}),i.parent.sendMessage("setting.display.list","view:refresh",null)}).always(function(){i._initSettingMenu()});break;case"display_list":n=1===a.display_list?0:1,g.updateUser({display_list:n}).then(function(){i.parent.sendMessage("setting.display.list","view:refresh",null),i.onRefresh({start:0,resetPagination:!0,resetToolbar:!0})});break;case"moresetting":var r={module:"setting.display.list",param:{}};g.setCurrentState(r),i.parent.sendMessage("dispatcher","history:add",r)}},_handleForwardA:function(e){var t,n=this,i=this.view;!this.config.restrictDraftFunc||"list"!==i&&"search"!==i||(t=!1),n._getSelectedMids(t).then(function(i){if(i.length<=0)return void o(e,t);var a={mid:i,ctype:"forwarda"};n._params.mboxa&&(a.mboxa=n._params.mboxa),v.isExpandThreadMid(n._params.fid)&&(a.expandThreadMid=!0),n._switchToCompose(a)})},_handleMenuComposeMail:function(e,t){var n,a,r,s=this;if("read"===this.view||"thread"===this.view?n=[this._params.mid]:(!!this.config.restrictDraftFunc&&(r=!1),n=i(this.parent,r)),n.length<=0)return void o(e,r);if(n.length>1)return void f.alert(h.i18n.t("mail/msg_select_one",{action:t?t.name:h.i18n.t("common/op_"+e)}));if(a={mid:n[0]},s._params.mboxa&&(a.mboxa=s._params.mboxa),s.parent._params.defaultAccount&&(a.defaultAccount=s.parent._params.defaultAccount),s._checkWebReadOnly(s.parent,n[0]))return f.alert(h.i18n.t("mail/msg_select_webreadonly")),!1;switch(e){case"reply":case"replyall":case"reply-attach":case"replyall-attach":case"forward":case"forwardd":a.ctype=e;break;case"sendagain":a.ctype="edit";break;default:return!1}"replyall"==e||"replyall-attach"==e?f.confirm(h.i18n.t("mail/confirm_reply_all"),function(){s._switchToCompose(a)}):s._switchToCompose(a)},_switchToCompose:function(e){var t=this,n=t.parent._params.mail||{},i=n.config&&n.config.supportSMIME,a=i&&n.sMimeServerEncrypted,r=i&&n.sMimeClientEncrypted,s=e.ctype;return a&&(e.isDecodeMail=t.parent._params.mail.isDecodeMail||!1),r?void v.getComposeInfo(e).then(function(e){t.parent.sendMessage("mail","view:change",{module:"mail.compose",param:{id:e.id,sMimeClientEncrypted:!0,attachId:"caAttachments_"+t.parent.state.param.mid,content:t.parent._params.mail.content,isSigned:t.parent._params.mail.isSigned,isEncrypted:t.parent._params.mail.isEncrypted}})}):void(h.detector.isDetachMode()?(t.parent.sendMessage("dispatcher","history:add",{module:"mail.compose",param:e}),location.reload()):v.getComposeInfo("forwardd"===s?{ctype:"normal"}:e).then(function(n){t.parent.sendMessage("mail","view:change",{module:"mail.compose",param:"forwardd"===s?c.extend(e,{id:n.id}):{id:n.id}})}))},_checkWebReadOnly:function(e,t){var n=!1;switch(this.view){case"list":n=e.$('.j-mail[mid="'+t+'"]').hasClass("webReadOnly");break;case"read":n=e.$("div.j-main").hasClass("webReadOnly")}return n},_handlePackMail:function(){var e=this,t=this._params.mboxa||"",n=g.getSid();"list"===this.view||"search"===this.view?e._handleListPackMail():"thread"===this.view&&(location.href="mbox/packmessages.jsp?sid="+n+"&mboxa"+t+"&mid="+this._params.mid+"&expandThreadMid=true")},_handleListPackMail:function(){var e=this,t=this._params.mboxa||"";a(this.parent,"pack")&&e._getSelectedMids().then(function(n){var i=!1,a=[];c.each(n,function(t,n){e._checkWebReadOnly(e.parent,n)?i=!0:a.push(n)}),i?f.confirm(h.i18n.t("mail/msg_select_webreadonly_list"),function(){a.length>0&&v.packMessages({mboxa:t,fid:e._params.fid,mids:a})}):v.packMessages({mboxa:t,fid:e._params.fid,mids:n})})},_handleSaveToListInfo:function(e,t){"list"===this.view||"search"===this.view?this._handleListSaveToList(e,t):("read"===this.view||"thread"===this.view)&&this._handleReadSaveToList(e,t)},_handleListSaveToList:function(e,t){var n,i=this,a=i.parent&&i.parent.state?i.parent.state.param:{},r=[],s=this.view;!this.config.restrictDraftFunc||"list"!==s&&"search"!==s||(n=!1),i._getSelectedMids(n).then(function(s){return s.length<=0?void o("operate",n):void(a.selectAll?v.getMessageInfos({mboxa:a.mboxa,ids:s}).then(function(n){c.each(n,function(e,t){c.merge(r,h.Email.parse(t.from))}),i._prepareAddAddressToList(r,e,t)}):(c.each(s,function(e,t){var n=i._getMailInfo(t);c.merge(r,h.Email.parse(n.from))}),i._prepareAddAddressToList(r,e,t)))})},_handleReadSaveToList:function(e,t){var n,i=this,a=i.parent&&i.parent._params?i.parent._params:{},r=[];"read"===this.view?(n=a.mail?a.mail.from||"":"",r=h.Email.parse(c.isArray(n)?n[0]:n)):"thread"===this.view&&c.isArray(a.threadFrom)&&c.each(a.threadFrom,function(e,t){c.merge(r,h.Email.parse(t))}),i._prepareAddAddressToList(r,e,t)},_prepareAddAddressToList:function(e,t,n){var i=this,a=[],r=g.getUser(),s=r.refuselist?r.refuselist.replace(/, /g,",").split(","):[],o=r.safelist?r.safelist.replace(/, /g,",").split(","):[],l=[],d=[],u="";return!e||e.length<1?!1:(c.each(e,function(e,t){var n=t.address;-1!==c.inArray(n,s)&&-1===c.inArray(n,l)&&l.push(n),-1!==c.inArray(n,o)&&-1===c.inArray(n,d)&&d.push(n),-1===c.inArray(n,s)&&-1===c.inArray(n,o)&&a.push(n)}),void(a.length>0?"refuselist"===t?i._updateRefuseList(c.unique(a),l,d,n):"safelist"===t&&i._updateSafeList(c.unique(a),l,d,n):("refuselist"===t?u=h.i18n.t(d.length>0?"mail/contact_exist_whitelist":"mail/contact_exist_refuselist"):"safelist"===t&&(u=h.i18n.t(l.length>0?"mail/contact_exist_refuselist":"mail/contact_exist_whitelist")),u&&("report"===n&&(u=h.i18n.t("mbox/reportJunk_succeed")+" "+u),"notJunk"===n&&(u=h.i18n.t("mbox/reportNotJunk_succeed")+" "+u),c.notify.warning(u,{timeout:5e3,extendBtn:"["+h.i18n.t("mbox/show_detail")+"]",callback:function(){i._showAddToListDetails({existRefuseList:l,existSafeList:d})}})),("list"===i.view||"search"===i.view)&&i.onRefresh({start:i.get("currentPage")}))))},_showAddToListDetails:function(e){var t=this,n=t.parent.compile(c(l).find("#addToRefuselistDetails").html(),e);f.alert(n)},_updateRefuseList:function(e,t,n,i){var a=this,r=g.getUser(),s=r.refuselist?r.refuselist.replace(/, /g,",").split(","):[],o=g.getConfig("user.allemails")||[],l={},d=[],u=[],p="report"===i?h.i18n.t("mbox/reportJunk_succeed")+" ":"",f={timeout:5e3,extendBtn:"["+h.i18n.t("mbox/show_detail")+"]",callback:function(){a._showAddToListDetails({refuseList:d,existRefuseList:t,existSafeList:n,existUserEmails:u})}};e=e||[],c.each(o,function(e,t){l[t.addr]=t}),c.each(e,function(e,t){l[t]?u.push(t):d.push(t)}),d.length>0?(c.unique(c.merge(s,d)),g.updateUser({refuselist:s.join(",")},!0).then(function(){c.notify.success(p+h.i18n.t("mbox/reject_by_mailfrom_succeed"),f),a.parent&&c.isFunction(a.parent.sendMessage)&&a.parent.sendMessage("setting.security.blacklist","list:reload"),("list"===a.view||"search"===a.view)&&a.onRefresh({start:a.get("currentPage")})})):(("list"===a.view||"search"===a.view)&&a.onRefresh({start:a.get("currentPage")}),c.notify.warning(p+h.i18n.t("mbox/reject_by_mailfrom_fail"),f))},_updateSafeList:function(e,t,n,i){var a=this,r=g.getUser(),s="notJunk"===i?h.i18n.t("mbox/reportNotJunk_succeed")+" ":"",o=r.safelist?r.safelist.replace(/, /g,",").split(","):[];c.unique(c.merge(o,e)),g.updateUser({safelist:o.join(",")},!0).then(function(){c.notify.success(s+h.i18n.t("mbox/addToSafeList_succeed"),{timeout:5e3,extendBtn:"["+h.i18n.t("mbox/show_detail")+"]",callback:function(){a._showAddToListDetails({whiteList:e,existRefuseList:t,existSafeList:n})}}),a.parent&&c.isFunction(a.parent.sendMessage)&&a.parent.sendMessage("setting.security.blacklist","list:reload"),("list"===a.view||"search"===a.view)&&a.onRefresh({start:a.get("currentPage")})})},_getSelectedMids:function(e){var t=this,n=c.Deferred(),a=t.parent,r=t.parent&&t.parent.state?c.extend(!0,{},t.parent.state.param):{},s=[];if("boolean"==typeof e?r.draftFlagFilter=e:delete r.draftFlagFilter,"read"===t.view||"thread"===t.view)n.resolve(t._params.mid);else if("list"===t.view||"search"===t.view){if(!a.state.param.selectAll)return s=i(a,e),n.resolve(s);r.limit=t.get("total"),v.getAllListMid(t.view,r).then(function(e){n.resolve(e)},function(){n.reject()})}return n.promise()},_getMailList:function(){var e=[];switch(this.view){case"read":case"thread":case"list":e=v.getCacheMailList().list;break;case"search":e=v.getCacheSearchMailList()["var"]}return e},_getMailInfo:function(e){var t={},n=this._getMailList();return c.each(n,function(n,i){return e===i.id?(t=i,!1):void 0}),t},_initSelectAllMail:function(e){var t,n,i,a=this,r=a.parent&&a.parent.state?a.parent.state.param:{},s=a.get("total"),o=g.getUser();o.preview_layout&&2===o.preview_layout?(t=a.element.parent(".j-previewlayout-top"),n=a.parent.element.closest(".j-previewlayout-content"),i=t.find(".j-select-all-msg")):(t=a.parent.$(".j-module-top"),n=a.parent.$(".j-module-content"),i=t.find(".j-select-all-msg")),e&&!r.selectAll&&s!==n.find(".j-mail").length?(r.selectAll=!0,i.show().html(h.i18n.t("mail/deselect_all_mail").replace("{1}",r.folderName).replace("{2}",s)).undelegate("a[data-btn]","click").delegate("a[data-btn]","click",function(){a.$('[data-dropdown="select"]').find('li[value="select:none"]').trigger("click.dropdown").trigger("click.dropdown")}),a.parent.sendMessage("mail.previewlayout","selectAllMail:showNum",{showNum:s})):!e&&i.is(":visible")&&(r.selectAll=!1,i.hide())}});n.exports=b}),+function(){define("configurable/file",["require","exports","module","jquery","module/common/globalService"],function(e,t,n){var i=e("jquery"),a=e("module/common/globalService"),r={enableAtt:a.getConfig("file.ispermitattmgr"),enablePNF:a.getConfig("file.ispermitnf"),enableENF:a.getConfig("file.ispermitenf"),enableTrs:a.getConfig("file.ispermittrs"),enablesecuritylevel:a.getConfig("user.enablesecuritylevel")},s=function(){var e={enableAtt:r.enableAtt,download:a.getConfig("user.allowdownloadattachment"),preview:a.getPreviewStatus().isAvailable,saveToNF:a.getConfig("user.supportnf")&&a.getConfig("file.savetonf"),downloadPackage:a.getConfig("file.ispermitpacagedownload"),saveToXNF:a.getConfig("file.xnfengines").length>0,sendMail:a.getConfig("mail.enablewebmailcompose"),securityLevel:a.getConfig("user.enablesecuritylevel")};this.config=e},o=function(){this.config={enableENF:r.enableENF,enablesecuritylevel:r.enablesecuritylevel}},l=function(){this.config={enablePNF:r.enablePNF,enablesecuritylevel:r.enablesecuritylevel}},c=function(){this.config={enableTrs:r.enableTrs,enablesecuritylevel:r.enablesecuritylevel}},d=function(){this.config=i.extend({},r),this.children={accessory:s,enterprisenf:o,personalnf:l,transitcenter:c}};n.exports=d})}(),+function(){define("configurable/mail",["require","exports","module","jquery","util/index","module/common/globalService","module/mail/service"],function(e,t,n){function i(e){e=e||"";var t={delMail:{enable:!0},moveMail:{enable:!0,excludeFolders:[]}};return e&&a.each(e.split(","),function(e,n){if(n=a.trim(n),0==n.indexOf("-delmail"))t.delMail.enable=!1;else if(0==n.indexOf("-movemail")){var i=n.indexOf(":");if(-1!=i){var r=n.substr(i+1,n.length);t.moveMail.excludeFolders=r.split(";")}else t.moveMail.enable=!1}}),t}var a=e("jquery"),r=e("util/index"),s=e("module/common/globalService"),o=e("module/mail/service"),l=s.getConfig("mail.enablewebmailcompose"),c=s.getConfig("mail.enablewebmailreplycompose"),d=s.getConfig("mail.enablewebmailforwardcompose"),u=s.getConfig("setting.enabledirectforward"),p={locale:s.getConfig("context.locale"),supportPab:s.getConfig("user.supportpab"),supportOab:s.getConfig("user.supportoab"),enableSendMail:s.getConfig("mail.enablesendmail"),enableScheduleInvitation:s.getConfig("mail.enablescheduleinvitation"),permWebmailMailSearch:s.getConfig("user.permwebmailmailsearch"),enableSecurityLevel:s.getConfig("user.enablesecuritylevel"),supportSMIME:s.getConfig("user.supportsmime"),openSMIMEKeyPass:s.getConfig("mail.opensmimekeypass"),checkCookie:s.getConfig("user.checkcookie"),supportRecallMail:s.getConfig("mail.supportrecallmail")&&!s.getConfig("user.supportsmime")},h=function(){this.children={compose:f,common:m}},f=function(){this.config=a.extend(p,{enableForward:d,enableForwardd:p.enableSendMail&&u,enableReply:c,enableCompose:l,enableModifySendTo:s.getConfig("mail.enablemodifysendto"),trsMaxFileSize:s.getConfig("file.ispermittrs")?s.getConfig("user.trsmaxfilesize"):0,maxAttachmentSize:s.getConfig("user.maxattachmentsize"),smtpMaxSendMailSize:s.getConfig("user.smtpmaxsendmailsize"),forbidDownload:s.getConfig("user.forbiddownload"),enableDeliverWithSms:s.getConfig("user.enabledeliverwithsms"),enableMailCipher:s.getConfig("user.enablemailcipher"),enableAutoDel:s.getConfig("user.enableautodel"),mailCipherPassLen:s.getConfig("user.mailcipherpasslen"),enableShowOneRcpt:s.getConfig("mail.enableshowonercpt"),supportSMIMEClient:p.supportSMIME&&!s.getConfig("user.syssupportsmime")&&r.detector.isIE(),supportSMIMEServer:p.supportSMIME&&s.getConfig("user.syssupportsmime"),enableSaveDraft:s.getConfig("mail.enablesavedraft"),enableDnDUpload:s.getConfig("mail.enabledndupload"),autoSaveDraftInterval:s.getConfig("mail.autosavedraftinterval"),encryptedCheckedDefault:s.getConfig("mail.encryptedcheckeddefault"),smimeUploadAttachSizeLimit:Math.min(s.getConfig("mail.smimeuploadattachsizelimit"),s.getConfig("user.smtpmaxsendmailsize")),domainName:s.getConfig("user.uid").replace(/.*@/,""),enableMailTemplate:s.getConfig("mail.enablemailtemplate"),enableMultiRcptsAlert:s.getConfig("mail.enablemultircptsalert")})},m=function(){var e=i(s.getConfig("mail.mailactioncontrol")),t=e.moveMail.excludeFolders,n=e.moveMail.enable,r=n&&-1==a.inArray(o.getFoldersMap().trash+"",t),h={forceSendReadReceipt:s.getConfig("mail.forcesendreadreceipt"),enableVipMessage:s.getConfig("mail.enablevipmessage"),enableSpamForwhand:s.getConfig("setting.enablespamforwhand"),enableListBriefText:s.getConfig("user.enablelistbrieftext"),enableDeferMail:s.getConfig("mail.enabledefermail"),enableTopMail:s.getConfig("mail.enabletopmail"),enableMailMemo:s.getConfig("mail.enablemailmemo"),maxMailMemo:s.getConfig("mail.maxmailmemo")||50,enableMailFlagged:s.getConfig("mail.enablemailflagged"),enableMailDealings:s.getConfig("mail.enablemaildealings"),enableDeliveryStatus:s.getConfig("mail.enabledeliverystatus"),mailFlaggedColorCount:s.getConfig("mail.mailflaggedcolorcount"),disableAuditInDeliveryStatus:s.getConfig("mail.notdisplayaudit"),deliveryStatusKeepDays:s.getConfig("mail.deliverystatuskeepdays"),deliveryStatusBeginTime:s.getConfig("mail.deliverystatusbegintime"),enableForward:d,enableCompose:l,enableForwardd:p.enableSendMail&&u,enableReply:c,enableQuickReply:p.enableSendMail&&s.getConfig("mail.enablequickreply"),enableDelete:r,enableMoveTo:n,enableRealDelete:e.delMail.enable,forbidMoveToFolders:t,enableReplyWithAttachments:s.getConfig("mail.enablereplywithattachments")&&!p.supportSMIME,enableAllowOpenAttachment:s.getConfig("mail.enableallowopenattachment"),enableOpenFileType:s.getConfig("mail.enableopenfiletype"),enablePreview:s.getConfig("user.enablepreview"),trashLifeTime:s.getConfig("mail.trashlifetime"),spamLifeTime:s.getConfig("mail.spamlifetime")};this.config=a.extend(!0,p,h),this.execContext=function(e){var t=e.state.param,n=t.mboxa||"",i=t.fid,a={},r=s.getConfig("mail.enablemailboxview"),c=s.getConfig("user.supportarchivelite");return a.shareMailBoxFolder=r&&"shareFolder"===o.getFolderCategory(n),a.archiveLiteFolder=c&&"archiveFolder"===o.getFolderCategory(n),a.enableSendAgain=l&&4!=i&&5!=i&&6!=i&&7!=i,a.enableUpdateMailStatus=!0,a.mboxaOverwrite=function(){""!==n&&o.getMailBoxShareInfoById(n).then(function(t){e.config.enableCompose=t.send,e.config.enableSendMail=t.send,e.config.enableForwardd=t.send,e.config.enableForward=t.send,e.config.enableReply=t.send,e.config.enableSendAgain=t.send,e.config.enableDelete=t.rw,e.config.enableUpdateMailStatus=t.rw,e.config.supportRecallMail=t.send})},a}};n.exports=h})}(),+function(){define("configurable/setting/advance",["require","exports","module","jquery","module/common/globalService"],function(e,t,n){var i=e("jquery"),a=e("module/common/globalService"),r=a.getConfig("user.enablecellphonebinding"),s={supportMsgNotify:a.getConfig("setting.supportmsgnotify"),supportMsgNotifyFolder:a.getConfig("setting.supportmsgnotifyfolder"),supportSMSLoginNotify:a.getConfig("setting.supportsmsloginnotify")&&r,supportAppLoginNotify:a.getConfig("setting.supportapploginnotify")},o=function(){this.children={loginnotification:l,pop:c,mboxshare:d},this.config=i.extend(s,{allEmails:a.getConfig("user.allEmails"),mboxshare:a.getConfig("setting.enablemboxshare"),isSupportSync:a.getConfig("user.supportactivesync"),enableSMSNotifySetting:a.getConfig("user.enablesmsnotifysetting"),supportShortcut:a.getConfig("user.supportshortcut"),enableCellphoneBinding:r,enablePopWebmailAgent:a.getConfig("setting.popwebmailagent")})},l=function(){this.config=i.extend(s,{sendLoginNoticeTerminals:a.getConfig("setting.sendloginnoticeterminals")})},c=function(){this.config={locale:a.getConfig("context.locale"),allEmails:a.getConfig("user.allEmails"),popMaxCount:a.getConfig("setting.popmaxcount"),enableImportMailType:a.getConfig("setting.enableimportmailtype"),userDomainName:a.getUser().email.replace(/.*@/,"")}},d=function(){this.config={allEmails:a.getConfig("user.allEmails"),enableSecurityLevel:a.getConfig("user.enablesecuritylevel")}};n.exports=o})}(),+function(){define("configurable/setting/account",["require","exports","module","jquery","module/common/globalService"],function(e,t,n){var i=e("jquery"),a=e("module/common/globalService"),r={locale:a.getConfig("context.locale"),allEmails:a.getConfig("user.allEmails")},s=function(){this.children={personal:o,password:c,signature:l},this.config={signature:a.getConfig("user.supportsignagure"),question:a.getConfig("setting.enablepasswordprotect"),profile:a.getConfig("setting.enableopprofile"),externalauth:a.getConfig("setting.enableexternalauth"),externalauthurl:a.getConfig("setting.externalauthurl"),enableExternalAuth:a.getConfig("setting.enableexternalauth")&&!!a.getConfig("setting.externalauthurl"),enableDefaultAuth:!a.getConfig("setting.enableexternalauth")}},o=function(){this.config=i.extend(r,{enableSecurityLevel:a.getConfig("user.enablesecuritylevel"),enableForceSenderName:a.getConfig("setting.enableforcesendername")})},l=function(){this.config=i.extend(r,{maxSignLimit:a.getConfig("setting.maxsignaturecount"),editMode:a.getUser().edit_mode})},c=function(){this.config=i.extend(r,{isEnablePasswordAge:a.getConfig("setting.isenablepasswordage"),useStaticPwdAuth:a.getConfig("setting.usestaticpwdauth"),isRejectConsistentPwd:a.getConfig("setting.isrejectconsistentpwd")})};n.exports=s})}(),+function(){define("configurable/setting/delivery",["require","exports","module","module/common/globalService"],function(e,t,n){var i=e("module/common/globalService"),a=function(){this.config={enableForward:i.getConfig("user.enableforward"),enableAutoReply:i.getConfig("user.enableautoreply"),allEmails:i.getConfig("user.allemails"),editMode:i.getUser().edit_mode,enableMailTemplate:i.getConfig("mail.enablemailtemplate")}};n.exports=a})}(),+function(){define("configurable/setting/display",["require","exports","module","module/common/globalService"],function(e,t,n){var i=e("module/common/globalService"),a=function(){this.config={face:i.getConfig("context.face"),locale:i.getConfig("context.locale"),skin:i.getConfig("context.skin"),enableFastPreviewLayout:i.getConfig("mail.enableFastPreviewLayout"),timezoneId:i.getConfig("setting.timezoneid"),enableListBriefText:i.getConfig("user.enablelistbrieftext"),allEmails:i.getConfig("user.allemails"),timezoneValues:i.getConfig("setting.timezonevalues")}};n.exports=a})}(),+function(){define("configurable/setting",["require","exports","module","module/common/globalService","./setting/advance","./setting/account","./setting/delivery","./setting/display"],function(e,t,n){var i=e("module/common/globalService"),a=e("./setting/advance"),r=e("./setting/account"),s=e("./setting/delivery"),o=e("./setting/display"),l=function(){this.children={account:r,display:o,delivery:s,security:c,advance:a,folder:u,filter:d}},c=function(){this.config={allEmails:i.getConfig("user.allEmails"),opensmimekeypass:i.getConfig("mail.opensmimekeypass"),
enableJunkNotify:i.getConfig("setting.enablejunknotify"),supportOffSiteRemindStatus:i.getConfig("setting.supportoffsiteremindstatus"),supportAntivirus:i.getConfig("user.supportantivirus"),supportSMIMEServer:i.getConfig("user.supportsmime")&&i.getConfig("user.syssupportsmime"),enableAuth2lock:i.getConfig("setting.enableauth2lock"),supportTwoFactorAuth:!0,supportAuthorizedDevice:i.getConfig("setting.supportauthorizeddevice"),supportAlternativePassword:i.getConfig("setting.supportalternativepassword")}},d=function(){this.config={enablevipmessage:i.getConfig("mail.enablevipmessage"),filterFolder:i.getConfig("setting.filterfolder")||!1,isEnableForward:i.getConfig("user.enableforward")||!1,isEnableAutoReply:i.getConfig("setting.enableautoreply")||!1,supportSmsNotify:i.getConfig("setting.supportsmsnotify")||!1,mailFlaggedColorCount:i.getConfig("setting.mailflaggedcolorcount"),limitPerPage:i.getConfig("contact.itemperpage")||20,maxRuleCount:i.getConfig("setting.maxrulecount"),supportmailflagged:i.getConfig("setting.supportmailflagged")||!1}},u=function(){this.config={enablePopWebmailAgent:i.getConfig("setting.popwebmailagent"),limitMessageSize:i.getConfig("setting.limitmessagesize"),messageSize:i.getConfig("setting.messageSize"),enableImportMessage:i.getConfig("setting.enableimportmessage"),limitFolderNestLevel:i.getConfig("setting.limitfoldernestlevel"),folderCount:i.getConfig("setting.foldercount"),limitFolderCount:i.getConfig("setting.limitfoldercount"),secretFolder:i.getUser().def_sec_folder,previewLayout:i.getUser().preview_layout,enableFolderModify:i.getConfig("setting.enablefoldermodify")}};n.exports=l})}(),+function(){define("configurable/index",["require","exports","module","jquery","./file","./mail","./setting"],function(e,t,n){var i=e("jquery"),a=e("./file"),r=e("./mail"),s=e("./setting"),o={children:{file:a,mail:r,setting:s}},l=function(e,t){var n,a,r=null;if(e="string"==typeof e?e:"",e=e.split("."),!e.length)return{};for(;n=e.shift();){if(!n.length){r=r||{};break}if(r=r||o,a=i.type(r.children[n]),"object"===a)r=r.children[n];else{if("function"!==a){r={};break}r=r.children[n]=new r.children[n]}}return r=i.extend(!0,{},r),r.config=r.config||{},null!=t&&"function"===i.type(r.execContext)&&i.extend(!0,r.config,r.execContext(t)),r.config};n.exports=l})}(),define("module/mail/list/service",["require","jquery","../../common/globalService","../service"],function(e){function t(e){var t=i.Deferred(),n=a.getUser();return e=i.extend({fid:1,start:0,limit:n.maxlist||20,topFirst:a.getConfig("mail.enabletopmail")&&e.group},e),r.getMailList(e).then(function(n){var a;e.group?a=r.groupMailList(n.list,e.fid):(a=n.list,i.each(a,function(e,t){r.formatMail(t)})),t.resolve({list:a,total:n.total,limit:e.limit})},function(e){t.reject(e)}),t.promise()}function n(){var e=i.Deferred();return r.getFolders(!0,!0,!1).then(function(t){i.each(t,function(t,n){return-5===n.id?(e.resolve({TdyDeferMailCount:n.stats.messageCount}),!1):void 0})},function(t){e.reject(t)}),e.promise()}var i=e("jquery"),a=e("../../common/globalService"),r=e("../service");return{getMailList:t,getTdyDeferMailCount:n}}),define("components/requirejs-text/text!template/module/mail/list.tpl.html",[],function(){return'<div class="m-mllist">\r\n    <div class="list-bg"></div>\r\n    <div class="m-mllist-row">\r\n        <div class="j-module-top">\r\n            <div class="j-folder-hint message-tip u-alert-warning f-dn"></div>\r\n            <div class="j-autoforward message-tip u-alert-warning u-alert-dismissible f-ellipsis f-dn"></div>\r\n            <div class="j-autoreply message-tip u-alert-warning u-alert-dismissible f-ellipsis f-dn"></div>\r\n            <div class="j-defer-tip message-tip u-alert-warning u-alert-dismissible f-ellipsis f-dn"></div>\r\n            <div class="j-select-all-msg message-tip u-alert-warning f-dn"></div>\r\n            <div class="toolbar j-toolbar f-dn"></div>\r\n            <div class="mail-totals j-mail-totals f-dn"></div>\r\n        </div>\r\n    </div>\r\n    <div class="m-mllist-row mllist-list-row">\r\n        <div class="j-module-content j-maillist mllist-list u-scroll"></div>\r\n        <div class="j-nlist nlist-wrap"></div>\r\n    </div>\r\n    {{#raw}}\r\n    <script id="toolbartpl" type="text/x-handlebars-template">\r\n        <span class="u-btn u-btn-default u-btn-round f-fr j-setting" ><i class="iconfont iconset"></i></span>\r\n        <div id="pagination" class="f-fr"></div>\r\n\r\n        <div class="u-btns" data-dropdown="select">\r\n            <span class="u-btn u-btn-default j-selectmail">\r\n                <input type="checkbox" name="checkAll" />\r\n                <span class="iconfont icondown"></span>\r\n            </span>\r\n        </div>\r\n\r\n        <div class="u-btns j-viewbtns">\r\n            <span class="u-btn u-btn-default" data-dropdown="sort">{{i18n "common/op_sort"}}<span class="iconfont icondown"></span></span>\r\n            <span class="u-btn u-btn-default" data-dropdown="view">{{i18n "common/op_view"}}<span class="iconfont icondown"></span></span>\r\n        </div>\r\n\r\n        <div class="f-ib f-dn j-tgbtns">\r\n            <span class="u-btn u-btn-default j-deferCompleted">{{i18n "mail/deferCompleted"}}</span>\r\n            [[#if config.enableDelete]]\r\n            <span class="u-btn u-btn-default j-maildelete">{{i18n "common/op_delete"}}</span>\r\n            [[/if]]\r\n\r\n            <div class="u-btns">\r\n                [[#if config.enableUpdateMailStatus]]\r\n                [[#if config.enableMoveTo]]\r\n                    <span class="u-btn u-btn-default" data-dropdown="move">{{i18n "common/op_move"}}<span class="iconfont icondown"></span></span>\r\n                [[/if]]\r\n                <span class="u-btn u-btn-default" data-dropdown="mark">{{i18n "common/op_mark"}}<span class="iconfont icondown"></span></span>\r\n                [[/if]]\r\n                <span class="u-btn u-btn-default j-collect">[[i18n "common/op_collect"]]</span>\r\n\r\n                [[#if config.enableSendMail]]\r\n                <span class="u-btn u-btn-default" data-dropdown="more">{{i18n "common/op_more"}}<span class="iconfont icondown"></span></span>\r\n                [[/if]]\r\n            </div>\r\n        </div>\r\n\r\n        <span class="u-btn u-btn-default j-mailrefresh">{{i18n "common/op_refresh"}}</span>\r\n\r\n    </script>\r\n    {{/raw}}\r\n\r\n    {{#raw}}\r\n    <script id="mailtotaltpl" type="text/x-handlebars-template">\r\n        <div class="totals-info">\r\n          [[folderName]](\r\n          <span class="all-mail">[[i18n \'mail/message_totals\']]<span class="number">[[messageCount]]</span>[[i18n \'mail/message_letters\']]</span>\r\n          [[#if unreadMessageCount]]\r\n          <span class="unread-mail"><span class="number">[[unreadMessageCount]]</span>[[i18n \'mail/message_letters\']]</span>\r\n          <a href="javascript:void(0)" data-action="view:unread">[[i18n \'mail/unread_message_count\']]</a>\r\n          [[#unless config.shareMailBoxFolder]],<a href="javascript:void(0)" data-action="mark:allread">[[i18n \'mail/marked_allread\']]</a>[[/unless]]\r\n          [[/if]]\r\n          )\r\n        </div>\r\n    </script>\r\n    {{/raw}}\r\n\r\n    {{#raw}}\r\n    <script id="autoforwardtpl" type="text/x-handlebars-template">\r\n        <span class="close iconfont icondelword j-close"></span>\r\n        [[[i18n "mail/hint_message_forward" email=forwardEmail]]]\r\n    </script>\r\n    {{/raw}}\r\n\r\n    {{#raw}}\r\n    <script id="autoreplytpl" type="text/x-handlebars-template">\r\n        <span class="close iconfont icondelword j-close"></span>\r\n        [[[i18n "mail/hint_message_autoreply"]]]\r\n    </script>\r\n    {{/raw}}\r\n\r\n    {{#raw}}\r\n    <script id="listtpl" type="text/x-handlebars-template">\r\n        [[#if group]]\r\n        <div class="list-title f-csp j-listtt [[#if list_style]] user-fs12[[/if]] [[#if displaySize]]display-size[[/if]] [[#unless displaySummary]]not-display-summary[[/unless]]" toggle-title="[[id]]">\r\n            <i class="iconfont iconcollapse f-fr"></i>\r\n\r\n            <span class="j-select-group">[[name]] ([[list.length]])</span>\r\n            [[#if visibleDeferDate]]\r\n            <span class="received-time-header f-fr">[[i18n \'mail/lbl_received_time\']]</span>\r\n            <span class="defer-time-header f-fr">[[i18n \'mail/lbl_defer_time\']]</span>\r\n            [[/if]]\r\n        </div>\r\n        [[/if]]\r\n\r\n        [[#if displaySummary]]\r\n        <!-- -->\r\n        <div toggle-list="[[id]]" class="list-body [[#if visibleDeferDate]]list-body-defer[[/if]]">\r\n            <ul class="list-wrap c-mail-list j-mail-list [[#if list_style]] user-fs12[[/if]]">\r\n                [[#each list]]\r\n\r\n                <li class="list-item j-mail[[#if flags.read]] read[[else]] unread[[/if]][[#if flags.webReadOnly]] webReadOnly[[/if]][[#if flags.flagged]] flagged label0-[[#if ../../label0Filter]][[ ../../../label0Filter ]][[else]][[ label0 ]][[/if]][[/if]]\r\n                    [[#if summary]] display-summary[[/if]]"\r\n                    mid="[[id]]" index="[[index]]" fid="[[fid]]" [[#compare threadMessageCount \'>\' 1]]readThread="true"[[/compare]]  [[#if flags.deferHandle]]deferDate="[[defer]]"[[/if]]>\r\n                <div class="item-content mail-info">\r\n                    <div class="info-desc">\r\n                        <div class="info-desc-left">\r\n                            <div class="desc-flag">\r\n                                [[#if ../config.enableMailFlagged]]\r\n                                    [[#if ../../config.enableUpdateMailStatus]]\r\n                                        <span class="flag-flagged j-flag [[#unless flags.flagged]]unflag[[/unless]]">\r\n                                        [[#if flags.flagged]]\r\n                                            <i title="[[i18n \'mail/list_cancel_flag\']]" class="iconfont iconflatcolor"></i>\r\n                                        [[else]]\r\n                                            <i title="[[i18n \'mail/list_set_flag\']]" class="iconfont iconflat"></i>\r\n                                        [[/if]]\r\n                                        </span>\r\n                                    [[else]]\r\n                                        <span class="flag-flagged [[#unless flags.flagged]]unflag[[/unless]]">\r\n                                        [[#if flags.flagged]]\r\n                                            <i title="[[i18n \'mail/list_cancel_flag\']]" class="iconfont iconflatcolor"></i>\r\n                                        [[/if]]\r\n                                        </span>\r\n                                    [[/if]]\r\n                                [[/if]]\r\n                                [[#if ../config.enableDeferMail]]\r\n                                    <span class="flag-defer [[#unless flags.deferHandle]]unflag[[/unless]]">\r\n                                        [[#if ../../config.enableUpdateMailStatus]]\r\n                                            [[#if flags.deferHandle]]\r\n                                                <i [[defer]] title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="j-defer state-icon icon-mDEFER"></i>\r\n                                            [[else]]\r\n                                                <i title="[[i18n \'mail/list_set_defer\']]" class="j-undefer iconfont iconclock"></i>\r\n                                            [[/if]]\r\n                                        [[else]]\r\n                                            [[#if flags.deferHandle]]\r\n                                                <i [[defer]] title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="state-icon icon-mDEFER"></i>\r\n                                            [[/if]]\r\n                                        [[/if]]\r\n                                    </span>\r\n                                [[/if]]\r\n                            </div>\r\n                            <div class="desc-text">\r\n                                <span class="icon"><i class="j-priorityIcon iconfont [[priorityIcon]]" title="[[priorityMsg]]"></i></span>\r\n                                [[#if composeExtra.showOneRcpt]]\r\n                                <span class="doc-icon doc-one-rcpt">[[i18n "mail/mail_onercpt"]]</span>\r\n                                [[/if]]\r\n                                <span class="subject" title="[[subject]]">[[[ tplObj.subject ]]]</span>\r\n                            </div>\r\n                        </div>\r\n                        [[#if ../visibleDeferDate]]\r\n                        <div class="info-desc-center">\r\n                            <span class="desc-time">[[formatDeferDate]]</span>\r\n                        </div>\r\n                        [[/if]]\r\n                        <div class="info-desc-right">\r\n                            <span class="desc-time">[[formatReceivedDate]]</span>\r\n                            [[#if display_size]]<span class="desc-size">[[display_size]]</span>[[/if]]\r\n                        </div>\r\n                    </div>\r\n                    <div class="info-summary">\r\n                        <p class="summary-text">\r\n                            [[#if delegatedSender]]\r\n                            <span class="delegate-mail" title="[[i18n \'prop:mail/read_delegate_send\' 0=delegatedSender]]">[[i18n "mail/read_delegate_mail"]]</span>\r\n                            [[/if]]\r\n                            <span class="fromto [[#if displayTo]]to[[else]]from[[/if]]" data-email="[[#if displayTo]][[hemail to \'addr\']][[else]][[hemail from \'addr\']][[/if]]">\r\n                               [[#if displayTo]][[[ RenderTo this.to this.formatTo ]]][[else]][[formatfrom]][[/if]]\r\n                            </span>\r\n                            [[#if summary]]\r\n                            <span class="fromto"></span>\r\n                            <span class="summary">[[summary]]</span>\r\n                            [[/if]]\r\n                        </p>\r\n                        <div class="summary-stat">\r\n                            <div class="summary-stat-bg"></div>\r\n                            [[#or flags.attached flags.linkAttached]]<span class="stat-attach" title="[[i18n \'mail/list_have_attach\']]"><i class="iconfont iconacc"></i></span>[[/or]]\r\n                            [[#if memo]]<span class="j-memo-tip stat-memo" data-memo="[[memo]]"><i class="iconfont iconremarks"></i></span>[[/if]]\r\n                            [[#compare threadMessageCount \'>\' 1]]<span class="stat-thread">[[threadMessageCount]]</span>[[/compare]]\r\n                        </div>\r\n                    </div>\r\n                    <div class="info-icon">\r\n                        <span><i class="j-normalIcon iconfont [[icon]]" title="[[iconMsg]]"></i></span>\r\n                    </div>\r\n                </div>\r\n                <div class="item-chk check-col" title="[[iconMsg]]">\r\n                    [[#if backgroundColor]]<span class="pop-marker pop-marker-sum pop-marker-bg[[backgroundColor]]"></span>[[/if]]\r\n                    <input type="checkbox" name="mid" data-draft="[[flags.draft]]" data-fid="[[fid]]" value="[[id]]" from="[[from]]"/>\r\n                </div>\r\n                <div class="item-active-border"></div>\r\n                <div class="item-divider"></div>\r\n                </li>\r\n                [[/each]]\r\n            </ul>\r\n        </div>\r\n        [[else]]\r\n        <div toggle-list="[[id]]" class="list-body">\r\n            <table class="u-table c-mail-list j-mail-list [[#if list_style]] user-fs12[[/if]]">\r\n                <tbody>\r\n                [[#unless layoutType2]]\r\n                    <!--/-->\r\n                    [[#each list]]\r\n                    <tr class="j-mail[[#if flags.read]] read[[else]] unread[[/if]][[#if flags.webReadOnly]] webReadOnly[[/if]][[#if flags.flagged]] flagged label0-[[#if ../../label0Filter]][[ ../../../label0Filter ]][[else]][[ label0 ]][[/if]][[/if]]"\r\n                        mid="[[id]]" fid="[[fid]]" index="[[index]]" [[#compare threadMessageCount \'>\' 1]]readThread="true"[[/compare]]  [[#if flags.deferHandle]]deferDate="[[defer]]"[[/if]]>\r\n                        <td class="active-border"></td>\r\n                        <td class="check-col">\r\n                            [[#if backgroundColor]]<span class="pop-marker pop-marker-bg[[backgroundColor]]"></span>[[/if]]\r\n                            <input type="checkbox" name="mid" data-draft="[[flags.draft]]" data-fid="[[fid]]" value="[[id]]" from="[[from]]"/>\r\n                        </td>\r\n                        <td class="ico"><i class="iconfont [[icon]] j-normalIcon" title="[[iconMsg]]"></i><i class="j-priorityIcon iconfont [[priorityIcon]]" title="[[priorityMsg]]"></i></td>\r\n                        [[#if displayTo]]\r\n                        <td class="to">[[[ RenderTo this.to this.formatTo ]]]</td>\r\n                        [[else]]\r\n                        <td class="from" data-email="[[hemail from \'addr\']]">\r\n                            [[#if delegatedSender]]\r\n                            <span class="delegate-mail" title="[[i18n \'prop:mail/read_delegate_send\' 0=delegatedSender]]">[[i18n "mail/read_delegate_mail"]]</span>\r\n                            [[/if]]\r\n                            [[formatfrom]]\r\n                        </td>\r\n                        [[/if]]\r\n                        <td class="flag">\r\n                            [[#if ../../config.enableMailFlagged]]\r\n                                [[#if ../../config.enableUpdateMailStatus]]\r\n                                <span class="u-flag j-flag">\r\n                                    [[#if flags.flagged]]\r\n                                        <i title="[[i18n \'mail/list_cancel_flag\']]" class="iconfont iconflatcolor"></i>\r\n                                    [[else]]\r\n                                        <i title="[[i18n \'mail/list_set_flag\']]" class="iconfont iconflat"></i>\r\n                                    [[/if]]\r\n                                </span>\r\n                                [[else]]\r\n                                <span class="u-flag">\r\n                                    [[#if flags.flagged]]\r\n                                        <i title="[[i18n \'mail/list_cancel_flag\']]" class="iconfont iconflatcolor"></i>\r\n                                    [[/if]]\r\n                                </span>\r\n                                [[/if]]\r\n                            [[/if]]\r\n                        </td>\r\n                        <td class="subject-item">\r\n                            [[#if memo]]<span class="j-memo-tip"  data-memo="[[memo]]"><i class="iconfont iconremarks"></i></span>[[/if]]\r\n                            [[#if composeExtra.showOneRcpt]]\r\n                            <span class="doc-icon doc-one-rcpt">[[i18n "mail/mail_onercpt"]]</span>\r\n                            [[/if]]\r\n                            <span class="subject f-ib f-ellipsis" title="[[subject]]">[[[ tplObj.subject ]]]</span>\r\n                            [[#compare threadMessageCount \'>\' 1]]<strong class="thread-num icon">[[threadMessageCount]]</strong>[[/compare]]\r\n                        </td>\r\n                        <td class="defer">\r\n                            [[#if ../../config.enableDeferMail]]\r\n                                [[#if ../../config.enableUpdateMailStatus]]\r\n                                    [[#if flags.deferHandle]]\r\n                                        <i [[defer]] title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="j-defer state-icon icon-mDEFER"></i>\r\n                                    [[else]]\r\n                                        <i title="[[i18n \'mail/list_set_defer\']]" class="j-undefer iconfont iconclock"></i>\r\n                                    [[/if]]\r\n                                [[else]]\r\n                                    [[#if flags.deferHandle]]\r\n                                        <i [[defer]] title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="state-icon icon-mDEFER"></i>\r\n                                    [[/if]]\r\n                                [[/if]]\r\n                            [[/if]]\r\n                        </td>\r\n                        <td class="attach"><i [[#or flags.attached flags.linkAttached]] class="iconfont iconacc" title="[[i18n \'mail/list_have_attach\']]"[[/or]]></i></td>\r\n                        [[#if ../visibleDeferDate]]<td class="time">[[formatDeferDate]]</td>[[/if]]\r\n                        <td class="time">[[formatReceivedDate]]</td>\r\n                        [[#if display_size]]<td class="size">[[display_size]]</td>[[/if]]\r\n                    </tr>\r\n                    [[/each]]\r\n                [[else]]\r\n                     <!---->\r\n                    [[#each list]]\r\n                    <tr class="left-layout j-mail[[#if flags.read]] read[[else]] unread[[/if]][[#if flags.flagged]] flagged label0-[[#if ../../label0Filter]][[ ../../../label0Filter ]][[else]][[ label0 ]][[/if]] [[/if]]"\r\n                        mid="[[id]]" fid="[[fid]]" index="[[index]]" [[#compare threadMessageCount \'>\' 1]]readThread="true"[[/compare]]  [[#if flags.deferHandle]]deferDate="[[defer]]"[[/if]]>\r\n                    <td class="[[#if list_style]] user-fs12[[/if]] f-pr">\r\n                        <div class="active-border"></div>\r\n                        <div class="check-col" title="[[iconMsg]]">\r\n                            [[#if backgroundColor]]<span class="pop-marker pop-marker-bg[[backgroundColor]]"></span>[[/if]]\r\n                            <span class="mail-check f-ib"><input type="checkbox" name="mid" data-draft="[[flags.draft]]" data-fid="[[fid]]" value="[[id]]" from="[[from]]"/></span>\r\n                        </div>\r\n                        <div class="tr-item f-pr">\r\n                            <span class="item-"></span>\r\n                        </div>\r\n                        <div class="tr-item f-pr" style="height: 22px">\r\n                             <span class="item-from f-ib">\r\n                                 <span class="from f-ellipsis" data-email="[[#if displayTo]][[hemail to \'addr\']][[else]][[hemail from \'addr\']][[/if]]">\r\n                                    [[#if displayTo]]\r\n                                     [[formatTo]]\r\n                                    [[else]]\r\n                                     [[#if delegatedSender]]\r\n                                     <span class="delegate-mail" title="[[i18n \'prop:mail/read_delegate_send\' 0=delegatedSender]]">[[i18n "mail/read_delegate_mail"]]</span>\r\n                                     [[/if]]\r\n                                     [[formatfrom]]\r\n                                    [[/if]]\r\n                                 </span>\r\n                                 <span class="item-from-icon">\r\n                                     [[#or flags.attached flags.linkAttached]]<span class="attach f-ib" title="[[i18n \'mail/list_have_attach\']]"><i class="iconfont iconacc"></i></span>[[/or]]\r\n                                     [[#if memo]]<span class="j-memo-tip f-ib"  data-memo="[[memo]]"><i class="iconfont iconremarks"></i></span>[[/if]]\r\n                                     [[#compare threadMessageCount \'>\' 1]]<strong class="thread-num icon">[[threadMessageCount]]</strong>[[/compare]]\r\n                                </span>\r\n                             </span>\r\n                            [[#if ../visibleDeferDate]]\r\n                            <span class="defer-time f-ib">\r\n                                 <span class="time f-ib">[[formatDeferDate]]</span>\r\n                             </span>\r\n                            [[/if]]\r\n                             <span class="time-size f-ib">\r\n                                 <span class="time f-ib">[[formatReceivedDate]]</span>\r\n                                  [[#if display_size]]<span class="size f-ib">[[display_size]]</span>[[/if]]\r\n                             </span>\r\n                        </div>\r\n                        <div class="tr-item f-pr">\r\n                            <span class="ico mail-state f-ib"><i class="iconfont [[icon]] j-normalIcon" title="[[iconMsg]]"></i><i class="j-priorityIcon iconfont [[priorityIcon]]" title="[[priorityMsg]]"></i></span>\r\n                                 <span class="subject f-ib f-ellipsis">\r\n                                     [[#if composeExtra.showOneRcpt]]\r\n                                     <span class="doc-icon doc-one-rcpt">[[i18n "mail/mail_onercpt"]]</span>\r\n                                     [[/if]]\r\n                                     <span title="[[subject]]">[[[ tplObj.subject ]]]</span>\r\n                                 </span>\r\n                                 <span class="attach-flag f-ib">\r\n                                     <span class="defer f-ib">\r\n                                         [[#if ../../config.enableDeferMail]]\r\n                                             [[#if ../../config.enableUpdateMailStatus]]\r\n                                                 [[#if flags.deferHandle]]\r\n                                                     <i [[defer]] title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="j-defer state-icon icon-mDEFER"></i>\r\n                                                 [[else]]\r\n                                                     <i title="[[i18n \'mail/list_set_defer\']]" class="j-undefer iconfont iconclock"></i>\r\n                                                 [[/if]]\r\n                                             [[else]]\r\n                                                 [[#if flags.deferHandle]]\r\n                                                     <i [[defer]] title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="state-icon icon-mDEFER"></i>\r\n                                                 [[/if]]\r\n                                             [[/if]]\r\n                                         [[/if]]\r\n                                     </span>\r\n                                     <span class="flag f-ib">\r\n                                         [[#if ../../config.enableMailFlagged]]\r\n                                            [[#if ../../config.enableUpdateMailStatus]]\r\n                                                <span class="u-flag j-flag">\r\n                                                [[#if flags.flagged]]\r\n                                                    <i title="[[i18n \'mail/list_cancel_flag\']]" class="iconfont iconflatcolor"></i>\r\n                                                [[else]]\r\n                                                    <i title="[[i18n \'mail/list_set_flag\']]" class="iconfont iconflat"></i>\r\n                                                [[/if]]\r\n                                                </span>\r\n                                            [[else]]\r\n                                                <span class="u-flag">\r\n                                                [[#if flags.flagged]]\r\n                                                    <i title="[[i18n \'mail/list_cancel_flag\']]" class="iconfont iconflatcolor"></i>\r\n                                                [[/if]]\r\n                                                </span>\r\n                                            [[/if]]\r\n                                         [[/if]]\r\n                                     </span>\r\n                                 </span>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    [[/each]]\r\n                [[/unless]]\r\n                </tbody>\r\n            </table>\r\n\r\n        </div>\r\n        [[/if]]\r\n\r\n\r\n    </script>\r\n    {{/raw}}\r\n\r\n    {{#raw}}\r\n    <script id="nlisttpl" type="text/x-handlebars-template">\r\n        <div class="nlist">\r\n            [[#if action]]\r\n            <div class="h4">"[[name]]" </div>\r\n            [[/if]]\r\n            <div class="h3">"[[name]]" [[i18n "mbox/no_message"]]</div>\r\n            [[#if message]]\r\n            <div>\r\n                [[[message]]]\r\n                [[#if link]]\r\n                <a href="javascript:void(0)" class="link">([[link]])</a>\r\n                [[/if]]\r\n            </div>\r\n            [[/if]]\r\n        </div>\r\n    </script>\r\n    {{/raw}}\r\n\r\n    {{#raw}}\r\n    <script id="nslisttpl" type="text/x-handlebars-template">\r\n        <div class="nlist">\r\n            <div class="h4">[[[desc]]]</div>\r\n            <a href="javascript:void(0);" class="link"><i class="iconfont iconrevocation"></i> [[i18n \'mail/list_refresh\']]</a>\r\n        </div>\r\n    </script>\r\n    {{/raw}}\r\n\r\n\r\n    {{#raw}}\r\n    <script id="deferTipTpl" type="text/x-handlebars-template">\r\n        <span class="close iconfont icondelword j-close"></span>\r\n        [[[i18n "mail/hint_message_defer" count=tdyDeferCount]]]\r\n    </script>\r\n    {{/raw}}\r\n</div>'}),define("module/mail/list/index",["require","i18n!mail,mbox,common,error","component/memobox","jquery.ztree","jquery","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","../../../util/index","component/userauth2","component/maildeferbox","component/contactcard","../toolbar","../../../configurable/index","../../common/globalService","../../setting/service","../service","./service","moment","text!template/module/mail/list.tpl.html"],function(e){function t(e,t){var i,a,r=[];if(!n.isArray(e)||e.length<=0)return r;for(!n.isArray(t)&&(t=[t]),i=e.length-1;i>=0;i--)a=e[i],t.indexOf(a.id)<0&&r.push(a.id);return r}e("i18n!mail,mbox,common,error"),e("component/memobox"),e("jquery.ztree");var n=e("jquery"),i=e("cui/core/view/view"),a=e("cui/core/view/viewmanager"),r=e("cui/util/templatable/templatable"),s=e("../../../util/index"),o=e("component/userauth2"),l=e("component/maildeferbox"),c=e("component/contactcard"),d=e("../toolbar"),u=e("../../../configurable/index"),p=e("../../common/globalService"),h=e("../../setting/service"),f=e("../service"),m=e("./service"),g=e("moment"),v=i.extend({Implements:r,state:null,toolbar:null,widgets:{memoTip:null,deferMemo:null,contactCards:[]},attrs:{order:{value:"receivedDate",setter:function(e){return s.cookies.set("list_order",e),e},getter:function(){return s.cookies.get("list_order","receivedDate")}},orderDesc:{value:!0,setter:function(e){var t=e?1:0;return s.cookies.set("list_order_desc",t),t},getter:function(){return 1==s.cookies.get("list_order_desc",1)}}},events:{"click .j-mail-totals a[data-action]":"_handleListTotal","mousedown .j-mail":"_handleMailMouseDown","click .j-flag":"_handleFlagMail","click .j-undefer":"_initDeferDialog","click .j-subtract-prefix-subject":"_handleFullSubject","click div.j-listtt":"_handleToggleMailList","click span.j-select-group":"_handleSelectMailGroup"},setup:function(){var e,t,i,a=this;a.state=p.getCurrentState(),t=parseInt(a.state.param.id),i=s.mboxa.disassembly(a.state.param.fid),e=isNaN(i.fid)?t:i.fid,isNaN(e)?n.error("fid is not valid"):(a.state.param.fid=e,a.state.param.mboxa=i.mboxa,a.state.param.id=e+i.mboxa,a.state.isMailMouseDown=!1,a.state.isMailMouseMove=!1,a.$movingTip=null),a._params={},this.config=u("mail.common",this),"function"===n.type(this.config.mboxaOverwrite)&&this.config.mboxaOverwrite()},render:function(){var e=this,t=p.getUser();return v.superclass.render.call(e),t.preview_layout&&"mail.list"===e.state.module?(e.sendMessage("mail","view:change",{
module:"mail.previewlayout",param:{fid:e.state.param.fid,layout:t.preview_layout}}),!1):(e._initFolderHint(),e._initNotifyBar(),e._initSubject(),e._updateMailList({initialize:!0}),e._initModuleEvent(),void(1===e.state.param.fid&&2!==t.preview_layout?m.getTdyDeferMailCount().then(function(t){e._initDeferMailTip(t.TdyDeferMailCount)}):e._initDeferMailTip(!1)))},destroy:function(){this.toolbar&&this.toolbar.destroy(),n.each(this.widgets.contactCards,function(e,t){t.destroy()}),this.widgets.contactCards=[]},_initNotifyBar:function(){var e=this,t=p.getUser();e.config.enableSendMail&&2!==t.preview_layout&&n.when(f.isPopOrShareFolder(e.state.param.fid,e.state.param.id),f.getAutoReplyInfo()).then(function(t,n){"string"==typeof t&&(e._params.defaultAccount=t,t=!1),t?e._initAutoForwardTip():e.$("div.j-autoforward").hide(),n.enableAutoReply&&!s.cookies.get("autoreply_notify",0)?e._initAutoReplyTip():e.$("div.j-autoreply").hide()})},_initSubject:function(){var e,t=this,n=p.getUser(),i=this.state.param.id;return n.preview_layout?!1:(e=f.getCacheFolder(i)||{},t.state.param.folderName=e.name,void t.sendMessage("mail","tab:change",{id:"list:"+i,title:e.name||" "}))},_initMailListTotals:function(){var e,t,i=this,a=i.state.param.id,r=f.getFoldersMap(),s=p.getUser(),o=this.$(".j-mail-totals"),l={};e=f.getCacheFolder(a)||{},t=e.stats||{},n.isEmptyObject(e)||a==r.defer?o.is(":visible")?i.$(".j-maillist").removeClass("z-no-total"):i.$(".j-maillist").addClass("z-no-total"):(l={folderName:e.name,config:i.config,messageCount:f.isExpandThreadMid(a)&&!i.config.shareMailBoxFolder?t.threadCount:t.messageCount,unreadMessageCount:f.isExpandThreadMid(a)&&!i.config.shareMailBoxFolder?t.unreadThreadCount:t.unreadMessageCount},l.messageCount>0&&(o.html(i.compile(i.$("#mailtotaltpl").html(),l)).removeClass("f-dn"),s.list_style?o.addClass("user-fs12"):o.removeClass("user-fs12")))},_initModuleEvent:function(){var e=this;this.offMessage("view:refresh").onMessage("view:refresh",function(t){var i,a,r=t.message||{},s=r.flags||{};r.mid?(i=e.$('.j-mail[mid="'+t.message.mid+'"]'),a=i.find(".j-flag"),f.updateCacheMailList(r.mid,r),s&&s.hasOwnProperty("read")&&(s.read?i.removeClass("unread").addClass("read"):i.removeClass("read").addClass("unread")),s&&s.hasOwnProperty("flagged")&&(s.flagged&&r.hasOwnProperty("label0")?(i.removeClass(function(e,t){return(t.match(/label0-[0-9]/g)||[]).join("")}).addClass("flagged label0-"+r.label0),a.removeClass("unflag").find(".iconfont").removeClass("iconflat").addClass("iconflatcolor")):(i.removeClass("flagged"),a.addClass("unflag").find(".iconfont").removeClass("iconflatcolor flagged").addClass("iconflat"))),"reactive"===(r.action||"")&&(e.$(".j-mail").removeClass("active"),i.addClass("active"))):r.fid?e.state.param.fid==r.fid&&e._updateMailList(n.extend(!0,{resetPagination:!!r.resetPagination,keepScrollPosition:!!r.keepScrollPosition,start:r.start},e._params.bookmark)):r.resetToolbar?e._updateMailList({resetPagination:!0,start:0,resetToolbar:!0}):e._updateMailList({resetPagination:!0,start:r.start})}),this.offMessage("view:active").onMessage("view:active",function(){e.sendMessage("mail","folder:refresh",{ids:e.state.param.fid,mboxa:e.state.param.mboxa||""})}),this.unsubscribe("mail").subscribe("mail","folder:refreshed",function(){e._initMailListTotals()}),this.offMessage("notify:refresh").onMessage("notify:refresh",function(){e._initNotifyBar()}),this.offMessage("mail:op").onMessage("mail:op",function(t){t.message&&e.toolbar&&e.toolbar.trigger("mail:op",t.message.action)}),this.offMessage("mail:select").onMessage("mail:select",function(t){t.message&&e.toolbar&&e.toolbar.trigger("mail:select",t.message.action)})},_initCheckbox:function(){var e,t=this,i=t.$("div.j-maillist");return i.customRadioCheckbox(),i.off("click.check-col").on("click.check-col",".check-col",function(i){var a,r,s,o,l,c=n(this),d=i.shiftKey,u="checkbox-checked";if(d&&e&&(a=e.closest(".j-mail").attr("index")),/checkbox/g.test(i.target.className)||c.find(".checkbox").trigger("click.crc"),c.hasClass(u)||c.find("."+u).length>0){if(r=c.closest(".j-mail").attr("index"),a=a||-1,a>=0)if(s=r,o=c.closest(".j-mail"),r>a)for(;s>a;)o.addClass("selected"),l=o.find('input[type="checkbox"]'),l.prop("checked",!0),l.next(".checkbox").addClass(u),o=o.prev(),s--;else for(;a>s;)o.addClass("selected"),l=o.find('input[type="checkbox"]'),l.prop("checked",!0),l.next(".checkbox").addClass(u),o=o.next(),s++;else c.closest(".j-mail").addClass("selected");e=c}else c.closest(".j-mail").removeClass("selected"),e=null;t.toolbar&&t.toolbar.trigger("mail:select","check")}),t.state.param.selectAll?void t.toolbar.trigger("mail:select","all"):void(t.toolbar&&t.toolbar.trigger("mail:select","check"))},_initToolbar:function(e,t){this.toolbar&&this.toolbar.destroy(),this.$(".j-toolbar").removeClass("f-dn").html(this.compile(this.$("#toolbartpl").html(),{config:this.config})),this.toolbar=new d({element:this.$(".j-toolbar"),parent:this,total:e,limit:t,refresh:function(e){this._updateMailList(e)}}).render()},_initMemoTip:function(){var e=this;return e.$(".j-memo-tip").length<1?!1:void e.$(".j-memo-tip").each(function(){var t=n(this).data("memo"),i=n(this).closest(".j-mail").attr("mid"),a=n(this).closest(".j-mail").attr("readthread");n(this).memoBox({mid:i,memo:t,tip:!0,parentNode:e.element,eventCallBack:function(){var t=this.get("memo");e.sendMessage((a?"mail.thread:":"mail.read:")+i,"read:mark",{type:"memo",memo:t})}})})},_initContactCard:function(){var e=this;e.$(".j-mail .from,.j-mail .to span").each(function(){e._updateContactCard({parent:e,trigger:n(this),emailAddress:n(this).data("email"),pointPos:"20%",delay:800})})},_initFolderHint:function(){var e=f.getFoldersMap(),t=this.$(".j-folder-hint"),n=this.state.param.fid,i=parseInt(this.config.trashLifeTime,10),a=parseInt(this.config.spamLifeTime,10),r="f-dn";if(n===e.junk){if(isNaN(a))return;return void t.removeClass(r).html(s.i18n.t("mail/list_folder_hint_spam",{days:a}))}if(n===e.trash){if(isNaN(i))return;return void t.removeClass(r).html(s.i18n.t("mail/list_folder_hint_trash",{days:i}))}},_initAutoForwardTip:function(){var e,t=this,i=t.$("#autoforwardtpl").html(),a=t.$("div.j-autoforward");f.getAutoForwardInfo().then(function(r){!n.isEmptyObject(r)&&r.forwardList.length&&(a.show().html(t.compile(i,{forwardEmail:s.html.encode(r.forwardList.join(","))})),a.on("click","a",function(){2===n(this).index()?h.setPrefOpHistoryRecord(r.recordItems).then(function(){a.hide()}):(e={module:0===n(this).index()?"setting.filter.letter":"setting.delivery.forward",param:{}},t.sendMessage("dispatcher","history:add",e))}),a.find(".j-close").on("click",function(){a.hide()}))})},_initAutoReplyTip:function(){var e,t=this,i=t.$("#autoreplytpl").html(),a=t.$("div.j-autoreply");a.show().html(t.compile(i)),a.on("click","a",function(){1===n(this).index()&&(e={module:"setting.delivery.autoreply",param:{}},t.sendMessage("dispatcher","history:add",e))}),a.find(".j-close").on("click",function(){s.cookies.set("autoreply_notify",0),a.hide()})},_renderMailList:function(e){var t=this,i=t.$("div.j-maillist"),a=t.$("#listtpl").html(),r="",s=parseInt(t.state.param.id,10),o=0,l=p.getUser(),c=this._params.bookmark.filterFlags,d=!1;t._params.initialize&&delete t._params.initialize,f.isExpandThreadMid(s)&&c&&c.hasOwnProperty("flagged")&&c.flagged&&c.hasOwnProperty("label0")&&(d=c.label0+"");var u=s===f.getFoldersMap().defer,h=l.display_size;if(t._params.group)n.each(e,function(e,n){if(n.list&&n.list.length>0){for(var i=0;i<n.list.length;++i)n.list[i].index=o+i,n.list[i].tplObj=t._compileMailItemTpl(n.list[i]);2===l.preview_layout&&(n.layoutType2=l.preview_layout),n.list_style=l.list_style,n.group=!0,n.config=t.config,n.displaySummary=t.config.enableListBriefText&&l.list_brief_text,n.label0Filter=d,n.visibleDeferDate=u,n.displaySize=h,r+=t.compile(a,n),o++}});else{for(var m=0;m<e.length;++m)e[m].index=o+m,e[m].tplObj=t._compileMailItemTpl(e[m]);r=t.compile(a,{visibleDeferDate:u,displaySize:h,list:e,group:!1,layoutType2:l.preview_layout,list_style:l.list_style,config:t.config,displaySummary:t.config.enableListBriefText&&l.list_brief_text,label0Filter:d}),o++}t.$("div.j-nlist").html(""),i.html(r),t._initListPagination(),(t.config.supportPab||t.config.supportOab)&&t._initContactCard()},_compileMailItemTpl:function(e){function t(){var t=e.subject,i=e.subjectPrefixFormatted,r=e.ctrls,o=[];return r&&"1"===r.timedsend&&o.push(s.i18n.t("mail/list_schedule")),a.enableSecurityLevel&&r&&o.push(n.templateHelpers.translateSL(r["CM-SECURITY"])),t?i&&i.isSubtract?(o.push(n.escapeExpression(i.prefixes)),o.push(['<b class="j-subtract-prefix-subject subtract-prefix-subject" data-subject="',n.escapeExpression(t),'">... </b>'].join("")),o.push(n.escapeExpression(i.right))):o.push(n.escapeExpression(t)):o.push(s.i18n.t("mail/empty_subject")),o.join("")}var n=this,i={},a=this.config;return i.subject=t(),i},_renderNMailList:function(e){var t,i=this,a=f.getFoldersMap(),r=i.state.param.fid,o=i.$("#nlisttpl").html(),l=p.getUser();f.getFolders(!1,!0,!1).then(function(c){var d=!1;n.each(c,function(e,l){if(r===Number((""+l.id).split("@")[0])){switch(r){case a.vip:t=i.compile(o,{name:l.name,message:s.i18n.t("mail/msg_vip"),link:s.i18n.t("mail/msg_vip_link")}),t=n(t),t.find(".link").on("click",function(){var e={module:"setting.filter.vip",param:{}};i.sendMessage("dispatcher","history:add",e)}),d=!0;break;default:t=i.compile(o,{name:l.name}),d=!0}return!1}}),d&&(i.$("div.j-mail-totals").html(""),i.$("div.j-module-content").html(""),i.$("div.j-nlist").html(t),e&&2!==l.preview_layout&&i._initToolbar(0,0))})},_renderNSearchMailList:function(e){var t,i=this,a=this.$("#nslisttpl").html();delete this._params.resetPagination,this.toolbar&&this.toolbar.trigger("pagination:init",0,20),t=s.i18n.t("mail/list_nomail"),t=s.messageFormat.format(t,[this.state.param.folderName,'<span class="mark">'+s.i18n.t("mail/list_nomail_"+e)+"</span>"]),t=this.compile(a,{desc:t}),t=n(t).off("click").on("click ","a",function(e){e.preventDefault(),e.stopPropagation(),i.toolbar.trigger("mail:refresh")}),this.$("div.j-maillist").empty().append(t),this.$("div.j-nlist").html("")},_updateMailList:function(e){var i,a=this,r=f.getFoldersMap();e.order&&(a.set("order",e.order),"boolean"==typeof e.desc&&a.set("orderDesc",e.desc)),e=n.extend({fid:a.state.param.fid,group:!0,mboxa:a.state.param.mboxa,order:a.get("order"),desc:a.get("orderDesc")},e),e.action?a.state.param.action="":a.state.param.filterFlags?e.filterFlags=a.state.param.filterFlags:a._params.filterFlags&&(e.filterFlags=a._params.filterFlags),e.resetPagination||(e=n.extend(!0,{},this._params.bookmark,e)),e.group="receivedDate"===e.order&&e.desc,this._updateBookmark(e),n.extend(a._params,e),n.notify.loading(),e.keepScrollPosition||(a.$("div.j-nlist").html(""),a.$(".j-maillist").html("")),e.fid<0?(e.topFirst=!1,i=f.getCacheOriginalFolders(),i.length<=0?f.getFolders(!0,!0,!0).then(function(n){e.fids=t(n,r.trash),a._doGetMailList(e)}):(e.fids=t(i,r.trash),this._doGetMailList(e))):this._doGetMailList(e)},_doGetMailList:function(e){var t=this,i=p.getUser(),a=e.action;m.getMailList(e).then(function(n){return e.refreshMailFolder!==!1&&t.sendMessage("mail","folder:refresh",{ids:t.state.param.fid,mboxa:t.state.param.mboxa||""}),n.total<=0&&t.toolbar&&t.toolbar.trigger("mail:select","none"),n.total>0&&(t._params.start||0)>=n.total?(t._params.start=Math.max((n.total/n.limit-1)*n.limit,0),e.start=t._params.start,t._updateBookmark(e),void t._doGetMailList(e)):void(n.total>0?(t._params.total=n.total,t._params.limit=n.limit,t._renderMailList(n.list),t._initCheckbox(),e.initialize&&2!==i.preview_layout?(t._initMailListTotals(),t._initToolbar(n.total,n.limit)):t.toolbar&&e.resetPagination&&t.toolbar.trigger("pagination:init",n.total,n.limit),e.resetToolbar&&2!==i.preview_layout&&t._initToolbar(n.total,n.limit),t.config.enableMailMemo&&t._initMemoTip(),t.config.enableDeferMail&&t._initDeferTip()):a?(t._initMailListTotals(),t._renderNSearchMailList(a)):t._renderNMailList(e.initialize))},function(n){n&&"FA_NEED_AUTH2"===n.code&&o.box({successCb:function(){t._updateMailList(e)},cancelCb:function(){}})}).always(function(){n.notify.loading("hide")})},_updateBookmark:function(e){var t={};e.order?t={order:e.order,desc:e.desc||!1}:e.filterFlags?t.filterFlags=n.extend(!0,{},e.filterFlags):e.filter&&(t.filter=n.extend(!0,{},e.filter)),t.fid=e.fid,t.start=e.start||0,t.action=e.action,this._params.bookmark=t},_handleMailMouseDown:function(e){function t(e){var t=e.originalEvent?e.originalEvent.data:e.data||"",i=this;if(t=JSON.parse(t),"1"==t.mousemove){if(!i.state.isMailMouseDown)return!1;i.state.isMailMouseMove||(i.state.isMailMouseMove=!0)}else"1"==t.mouseup&&i.$movingTip&&(n(document).off("mousemove").off("mouseup"),n("#mltree li[treenode]").find("a[treenode_a]:first").removeClass("disabled"),i.state.isMailMouseDown=!1,i.state.isMailMouseMove=!1,i.$movingTip.remove(),i.$movingTip=null)}function i(e){e=e||window.event;var t=n(e.target||e.srcElement),i=this,a=m.offset().top,r=n(window).height(),o=m.offset().left,g=m.offset().left+m.width();if(e.preventDefault(),clearInterval(i.interval),!i.state.isMailMouseDown)return!1;if(o<e.clientX&&e.clientX<g&&a<e.clientY&&(e.clientY<a+18?i.interval=setInterval(function(){var e=m.scrollTop();m.scrollTop(e-36,200)},200):r-18<e.clientY&&(i.interval=setInterval(function(){var e=m.scrollTop();m.scrollTop(e+36,200)},200))),i.state.isMailMouseMove){e.data&&e.data.isIframe?i.$movingTip.css({left:e.clientX+2+h.offset().left,top:e.clientY+2+h.offset().top}):i.$movingTip.css({left:e.clientX+2,top:e.clientY+2});var v=t.closest("[treenode]"),_=!1;if(v.length>0){var y=v.find("span[id$=_span]").attr("fid");f.isMailMovable(i.state.param.fid,y)&&(_=!0),v.find("a[treenode_a]:first").toggleClass("disabled",!_);var b=d.getNodeByTId(v.attr("id"));_&&d.selectNode(b),c&&c.is(v)||(b.isParent&&!b.open&&d.expandNode(b,!0,!1,!1),c&&c.find("a[treenode_a]:first").removeClass("disabled"),c=v)}}else{var w=e.clientX-u,M=e.clientY-p;if(Math.pow(w*w+M*M,.5)<10)return!1;i.state.isMailMouseMove=!0,l=n(e.target||e.srcElement).closest(".j-mail"),l.find(".checkbox").hasClass("checkbox-checked")||l.find(".checkbox").click(),i.toolbar._getSelectedMids().then(function(e){var t=parseInt(i.state.param.id,10),a=f.isExpandThreadMid(t)?"mail/list_moving_thread":"mail/list_moving_mail";a+=e.length>1?"_multi":"",n(".j-mail-list").append('<div class="u-mf-mail"><div class="u-mouse-follow">'+s.i18n.t(a,{len:e.length})+"</div></div>"),i.$movingTip=n(".u-mf-mail"),i.$movingTip.width(l.width()).append(l.clone().removeClass("selected").toggleClass("multiple",e.length>1)),i.$movingTip.find('input[type="checkbox"]').prop("checked",!1),i.$movingTip.find("i.checkbox").removeClass("checkbox-checked"),i.$movingTip.find(".active-border").remove(),i.$movingTip.find(".f-pr").removeClass("f-pr")})}}function a(e){e=e||window.event;var t=n(e.target||e.srcElement),i=this;if(i.state.isMailMouseDown=!1,n(document).off("mousemove").off("mouseup"),clearInterval(i.interval),i.state.isMailMouseMove){var a=t.closest("[treenode]");if(a.length>0&&!a.find("a[treenode_a]:first").hasClass("disabled")){var r=a.find("span[id$=_span]"),s=r.attr("fid"),o=a.find("a[treenode_a]:first").attr("title");-4!==s&&i.toolbar._handleListMoveMail("move",{id:parseInt(s),name:o})}else i.toolbar._getSelectedMids().then(function(e){1===e.length&&i.toolbar.trigger("mail:select","none")});n("#mltree li[treenode]").find("a[treenode_a]:first").removeClass("disabled"),i.state.isMailMouseMove=!1,i.$movingTip.remove(),i.$movingTip=null}else{var l=t.closest(".j-mail");i._handleReadOrCompose(e,l[0])}}e=e||window.event;for(var r=e.button,o=this,l=null,c=null,d=n.fn.zTree.getZTreeObj("mltree"),u=e.clientX,p=e.clientY,h=n("iframe.j-mail-content"),m=n(".j-folder-tree"),g=["defer","j-flag","mail-check","check-col","flag-defer","j-subtract-prefix-subject"],v=0,_=g.length;_>v;v++)if(n(e.target).hasClass(g[v])||n(e.target).parent().hasClass(g[v]))return!1;e.preventDefault(),e.stopPropagation(),o.state.isMailMouseDown=!1,(0===r||1===r)&&(o.state.isMailMouseDown=!0,n(document).on("mousemove",n.proxy(i,this)),n(document).on("mouseup",n.proxy(a,this)),n(window).on("message",n.proxy(t,this)))},_handleFullSubject:function(e){e.preventDefault();var t=n(e.target),i=t.attr("data-subject"),a=t.closest(".subject");a.html(i)},_handleReadOrCompose:function(e,t){var i,a,r,o,l=this,c=p.getUser(),d=l.state.param.id,u=l.state.param.fid,h=l.state.param.mboxa,m=f.getFoldersMap(),v=f.getCacheMailList().list,_=n(t),y=_.attr("mid"),b={};if(n.each(v,function(e,t){return t.id===y?(b=t,a=e,!1):void 0}),void 0!=a&&(a+=this._params.bookmark.start),!b)return!1;if(l.$(".j-mail").removeClass("active"),_.addClass("active"),u==m.draft)this.config.enableCompose?(f.markMails("list",y,{flag:"read",mboxa:h}).then(function(e){e&&(_.removeClass("unread").addClass("read"),l.sendMessage("mail","folder:refresh",{ids:u}))}),r={mid:y,tabTitle:b.subject,ctype:"draft",mboxa:h},b.flags.scheduleDelivery&&(o=b.scheduledDate||b.sentDate,r.scheduledate=g(o).format("YYYY-MM-DD HH:mm")),f.getComposeInfo({ctype:"draft",mid:y,mboxa:h}).then(function(e){r.id=e.id,l.sendMessage("mail","view:change",{module:"mail.compose",param:r})})):n.notify.error(s.i18n.t("mail/FA_MBOX_TARGET_READ_ONLY"));else{if(i=f.isExpandThreadMid(d)&&b.threadMessageCount>=2?"mail.thread":"mail.read",c.newwindowtoreadletter)return window.open("detach.jsp?sid="+p.getSid()+"#"+i+"?mid="+y+"&fid="+u+"&mboxa="+h+"&start="+a),!1;r=n.extend(!0,{fid:u,id:y,mid:y,unread:_.hasClass("unread"),tabTitle:b.subject,pView:"list",mboxa:h,listStart:l._params.start},l._params.bookmark,{start:a}),"mail.read"===i&&l._params.defaultAccount&&n.extend(r,{defaultAccount:l._params.defaultAccount}),c.preview_layout?l.sendMessage("mail.previewlayout","previewlayout:read",{module:i,param:r}):l.sendMessage("mail","view:change",{module:i,param:r})}},_handleFlagMail:function(e,t){var i=n(t),a=i.closest(".j-mail"),r=a.hasClass("flagged");r?this.toolbar.trigger("mail:mark",a.attr("mid"),"noflagged",{}):this.toolbar.trigger("mail:mark",a.attr("mid"),"flagged",{name:s.i18n.t("common/op_flagged")})},_handleToggleMailList:function(e,t){var i=n(t),a=this.$('div[toggle-list="'+i.attr("toggle-title")+'"]');a.animate({height:"toggle"},{duration:200,complete:function(){a.is(":visible")?i.children(".iconfont").removeClass("iconunfold").addClass("iconcollapse"):i.children(".iconfont").removeClass("iconcollapse").addClass("iconunfold")}})},_handleListTotal:function(e,t){var i,a=n(t).data("action");switch(i=a.split(":")[1],a=a.split(":")[0]){case"view":this._handleViewMail(i);break;case"mark":this._handleMarkMail(i)}},_handleViewMail:function(e){this.toolbar.trigger("mail:refresh","view:"+e)},_handleMarkMail:function(e){var t=this;"allread"===e&&f.markUnreadMails({fid:t.state.param.fid}).then(function(){n.notify.success(s.i18n.t("mail/msg_mark_all_unread_success")),t._updateMailList({resetPagination:!0})},function(){n.notify.error(s.i18n.t("mail/msg_mark_all_unread_failed"))})},_handleSelectMailGroup:function(e,t){e.stopPropagation();var i,a=this,r=n(t),s=r.closest(".j-listtt").attr("toggle-title"),o="checkbox-checked",l="selected",c=!1;i=this.$('div[toggle-list="'+s+'"]').find(".j-mail"),i.each(function(){var e=n(this).find(".checkbox");return e.hasClass(o)?void 0:(c=!0,!1)}),c?(i.each(function(){var e=n(this).find(".checkbox");e.hasClass(o)||(e.closest(".j-mail").addClass(l),e.prev().prop("checked",!0),e.addClass(o))}),a.toolbar&&a.toolbar.trigger("mail:select","check")):(i.each(function(){var e=n(this).find(".checkbox");e.hasClass(o)&&(e.closest(".j-mail").removeClass(l),e.prev().prop("checked",!1),e.removeClass(o))}),a.toolbar&&a.toolbar.trigger("mail:select","check"))},_initDeferTip:function(){var e=this;e.$(".j-defer").each(function(){var t=n(this).closest(".j-mail");new l({parentView:e,tipTpl:!0,trigger:n(this),mid:t.attr("mid"),deferDate:t.attr("deferDate"),mboxa:e.state.param.mboxa})})},_initDeferDialog:function(e,t){var i=this,a=n(t).closest(".j-mail"),r=a.attr("mid");i.config.enableDeferMail&&new l({parentNode:i.element,parentView:i,mid:r,mboxa:i.state.param.mboxa})},_initDeferMailTip:function(e){var t,n=this,i=f.getFoldersMap(),a=n.$("#deferTipTpl").html(),r=n.$("div.j-defer-tip");return e?(r.show().html(n.compile(a,{tdyDeferCount:e})),r.on("click","a",function(){t={module:"mail.list",param:{fid:i.defer}},n.sendMessage("dispatcher","history:add",t)}),void r.find(".j-close").on("click",function(){r.hide()})):void(r.is(":visible")&&r.hide())},_initListPagination:function(){var e=this,t=this.$(".j-maillist"),i=n("<div>",{"class":"mllist-pagination"}),a=this._params.total||0,r=this._params.limit||10,s=this._params.bookmark.start||0,o=s?s/r:0;i.html('<div class="mllist-pagination-content"></div>'),t.append(i),i.find(".mllist-pagination-content").pagination({total:a,limit:r,currentPage:o,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',menu:!0,menuAlignCenter:!0,callback:function(t){e._updateMailList({start:t*r,resetPagination:!0})}})},_updateContactCard:function(e){var t=this,i=null;n.each(t.widgets.contactCards,function(t,n){return e.trigger.is(n.get("trigger"))?(i=n,!1):void 0}),i&&i.destroy(),i=new c(e),t.widgets.contactCards.push(i)},templateHelpers:{RenderTo:function(e,t){for(var n=t.split(","),i=e.split(","),a=0,r="";a<n.length;a++)a>0&&(r+=","),r+='<span data-email="'+s.html.encode(s.Email.parseAddress(i[a]))+'">'+s.html.encode(n[a])+"</span>";return r},replaceDefer:function(e,t){return s.i18n.t(t).replace("{0}",e)},translateSL:function(e){var t=s.securityLevel.i18n(e);return t?"["+t+"]":""}}});a.module({name:"mail.list",template:e("text!template/module/mail/list.tpl.html")},v)}),function(e){"function"==typeof define&&define.amd?define("jquery.ui/core",["jquery"],e):e(jQuery)}(function(e){function t(t,i){var a,r,s,o=t.nodeName.toLowerCase();return"area"===o?(a=t.parentNode,r=a.name,t.href&&r&&"map"===a.nodeName.toLowerCase()?(s=e("img[usemap='#"+r+"']")[0],!!s&&n(s)):!1):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||i:i)&&n(t)}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var n=this.css("position"),i="absolute"===n,a=t?/(auto|scroll|hidden)/:/(auto|scroll)/,r=this.parents().filter(function(){var t=e(this);return i&&"static"===t.css("position")?!1:a.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==n&&r.length?r:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,i){return!!e.data(t,i[3])},focusable:function(n){return t(n,!isNaN(e.attr(n,"tabindex")))},tabbable:function(n){var i=e.attr(n,"tabindex"),a=isNaN(i);return(a||i>=0)&&t(n,!a)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,n){function i(t,n,i,r){return e.each(a,function(){n-=parseFloat(e.css(t,"padding"+this))||0,i&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),r&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var a="Width"===n?["Left","Right"]:["Top","Bottom"],r=n.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(t){return void 0===t?s["inner"+n].call(this):this.each(function(){e(this).css(r,i(this,t)+"px")})},e.fn["outer"+n]=function(t,a){return"number"!=typeof t?s["outer"+n].call(this,t):this.each(function(){e(this).css(r,i(this,t,!0,a)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(n,i){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),i&&i.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var n,i,a=e(this[0]);a.length&&a[0]!==document;){if(n=a.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(i=parseInt(a.css("zIndex"),10),!isNaN(i)&&0!==i))return i;a=a.parent()}return 0}}),e.ui.plugin={add:function(t,n,i){var a,r=e.ui[t].prototype;for(a in i)r.plugins[a]=r.plugins[a]||[],r.plugins[a].push([n,i[a]])},call:function(e,t,n,i){var a,r=e.plugins[t];if(r&&(i||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(a=0;a<r.length;a++)e.options[r[a][0]]&&r[a][1].apply(e.element,n)}}}),function(e){"function"==typeof define&&define.amd?define("jquery.ui/mouse",["jquery","./widget"],e):e(jQuery)}(function(e){var t=!1;return e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.11.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var i=this,a=1===n.which,r="string"==typeof this.options.cancel&&n.target.nodeName?e(n.target).closest(this.options.cancel).length:!1;return a&&!r&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):t.which?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(n){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,n.target===this._mouseDownEvent.target&&e.data(n.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(n)),t=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}),function(e){"function"==typeof define&&define.amd?define("jquery.ui/resizable",["jquery","./core","./mouse","./widget"],e):e(jQuery)}(function(e){return e.widget("ui.resizable",e.ui.mouse,{version:"1.11.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",a=!1;return t[i]>0?!0:(t[i]=1,a=t[i]>0,t[i]=0,a)},_create:function(){var t,n,i,a,r,s=this,o=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!o.aspectRatio,aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=o.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},n=0;n<t.length;n++)i=e.trim(t[n]),r="ui-resizable-"+i,a=e("<div class='ui-resizable-handle "+r+"'></div>"),a.css({zIndex:o.zIndex}),"se"===i&&a.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[i]=".ui-resizable-"+i,this.element.append(a);this._renderAxis=function(t){var n,i,a,r;t=t||this.element;for(n in this.handles)this.handles[n].constructor===String&&(this.handles[n]=this.element.children(this.handles[n]).first().show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(i=e(this.handles[n],this.element),r=/sw|ne|nw|se|n|s/.test(n)?i.outerHeight():i.outerWidth(),a=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(a,r),this._proportionallyResize()),e(this.handles[n]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){s.resizing||(this.className&&(a=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=a&&a[1]?a[1]:"se")}),o.autoHide&&(this._handles.hide(),
e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){o.disabled||(e(this).removeClass("ui-resizable-autohide"),s._handles.show())}).mouseleave(function(){o.disabled||s.resizing||(e(this).addClass("ui-resizable-autohide"),s._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(t){var n,i,a=!1;for(n in this.handles)i=e(this.handles[n])[0],(i===t.target||e.contains(i,t.target))&&(a=!0);return!this.options.disabled&&a},_mouseStart:function(t){var n,i,a,r=this.options,s=this.element;return this.resizing=!0,this._renderProxy(),n=this._num(this.helper.css("left")),i=this._num(this.helper.css("top")),r.containment&&(n+=e(r.containment).scrollLeft()||0,i+=e(r.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:i},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalPosition={left:n,top:i},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof r.aspectRatio?r.aspectRatio:this.originalSize.width/this.originalSize.height||1,a=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===a?this.axis+"-resize":a),s.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var n,i,a=this.originalMousePosition,r=this.axis,s=t.pageX-a.left||0,o=t.pageY-a.top||0,l=this._change[r];return this._updatePrevProperties(),l?(n=l.apply(this,[t,s,o]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(n=this._updateRatio(n,t)),n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),i=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(i)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(t){this.resizing=!1;var n,i,a,r,s,o,l,c=this.options,d=this;return this._helper&&(n=this._proportionallyResizeElements,i=n.length&&/textarea/i.test(n[0].nodeName),a=i&&this._hasScroll(n[0],"left")?0:d.sizeDiff.height,r=i?0:d.sizeDiff.width,s={width:d.helper.width()-r,height:d.helper.height()-a},o=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,l=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null,c.animate||this.element.css(e.extend(s,{top:l,left:o})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!c.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,n,i,a,r,s=this.options;r={minWidth:this._isNumber(s.minWidth)?s.minWidth:0,maxWidth:this._isNumber(s.maxWidth)?s.maxWidth:1/0,minHeight:this._isNumber(s.minHeight)?s.minHeight:0,maxHeight:this._isNumber(s.maxHeight)?s.maxHeight:1/0},(this._aspectRatio||e)&&(t=r.minHeight*this.aspectRatio,i=r.minWidth/this.aspectRatio,n=r.maxHeight*this.aspectRatio,a=r.maxWidth/this.aspectRatio,t>r.minWidth&&(r.minWidth=t),i>r.minHeight&&(r.minHeight=i),n<r.maxWidth&&(r.maxWidth=n),a<r.maxHeight&&(r.maxHeight=a)),this._vBoundaries=r},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,n=this.size,i=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===i&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"===i&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,n=this.axis,i=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,a=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,r=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,s=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,o=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(n),d=/nw|ne|n/.test(n);return r&&(e.width=t.minWidth),s&&(e.height=t.minHeight),i&&(e.width=t.maxWidth),a&&(e.height=t.maxHeight),r&&c&&(e.left=o-t.minWidth),i&&c&&(e.left=o-t.maxWidth),s&&d&&(e.top=l-t.minHeight),a&&d&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,n=[],i=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],a=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)n[t]=parseInt(i[t],10)||0,n[t]+=parseInt(a[t],10)||0;return{height:n[0]+n[2],width:n[1]+n[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,n=this.helper||this.element;t<this._proportionallyResizeElements.length;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:n.height()-this.outerDimensions.height||0,width:n.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize,i=this.originalPosition;return{left:i.left+t,width:n.width-t}},n:function(e,t,n){var i=this.originalSize,a=this.originalPosition;return{top:a.top+n,height:i.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,i){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,i]))},sw:function(t,n,i){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,i]))},ne:function(t,n,i){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,i]))},nw:function(t,n,i){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,i]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),"resize"!==t&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).resizable("instance"),i=n.options,a=n._proportionallyResizeElements,r=a.length&&/textarea/i.test(a[0].nodeName),s=r&&n._hasScroll(a[0],"left")?0:n.sizeDiff.height,o=r?0:n.sizeDiff.width,l={width:n.size.width-o,height:n.size.height-s},c=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,d=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(l,d&&c?{top:d,left:c}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var i={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};a&&a.length&&e(a[0]).css({width:i.width,height:i.height}),n._updateCache(i),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,n,i,a,r,s,o,l=e(this).resizable("instance"),c=l.options,d=l.element,u=c.containment,p=u instanceof e?u.get(0):/parent/.test(u)?d.parent().get(0):u;p&&(l.containerElement=e(p),/document/.test(u)||u===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(p),n=[],e(["Top","Right","Left","Bottom"]).each(function(e,i){n[e]=l._num(t.css("padding"+i))}),l.containerOffset=t.offset(),l.containerPosition=t.position(),l.containerSize={height:t.innerHeight()-n[3],width:t.innerWidth()-n[1]},i=l.containerOffset,a=l.containerSize.height,r=l.containerSize.width,s=l._hasScroll(p,"left")?p.scrollWidth:r,o=l._hasScroll(p)?p.scrollHeight:a,l.parentData={element:p,left:i.left,top:i.top,width:s,height:o}))},resize:function(t){var n,i,a,r,s=e(this).resizable("instance"),o=s.options,l=s.containerOffset,c=s.position,d=s._aspectRatio||t.shiftKey,u={top:0,left:0},p=s.containerElement,h=!0;p[0]!==document&&/static/.test(p.css("position"))&&(u=l),c.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-u.left),d&&(s.size.height=s.size.width/s.aspectRatio,h=!1),s.position.left=o.helper?l.left:0),c.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),d&&(s.size.width=s.size.height*s.aspectRatio,h=!1),s.position.top=s._helper?l.top:0),a=s.containerElement.get(0)===s.element.parent().get(0),r=/relative|absolute/.test(s.containerElement.css("position")),a&&r?(s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top):(s.offset.left=s.element.offset().left,s.offset.top=s.element.offset().top),n=Math.abs(s.sizeDiff.width+(s._helper?s.offset.left-u.left:s.offset.left-l.left)),i=Math.abs(s.sizeDiff.height+(s._helper?s.offset.top-u.top:s.offset.top-l.top)),n+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-n,d&&(s.size.height=s.size.width/s.aspectRatio,h=!1)),i+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-i,d&&(s.size.width=s.size.height*s.aspectRatio,h=!1)),h||(s.position.left=s.prevPosition.left,s.position.top=s.prevPosition.top,s.size.width=s.prevSize.width,s.size.height=s.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),n=t.options,i=t.containerOffset,a=t.containerPosition,r=t.containerElement,s=e(t.helper),o=s.offset(),l=s.outerWidth()-t.sizeDiff.width,c=s.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(r.css("position"))&&e(this).css({left:o.left-a.left-i.left,width:l,height:c}),t._helper&&!n.animate&&/static/.test(r.css("position"))&&e(this).css({left:o.left-a.left-i.left,width:l,height:c})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),n=t.options,i=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof n.alsoResize||n.alsoResize.parentNode?i(n.alsoResize):n.alsoResize.length?(n.alsoResize=n.alsoResize[0],i(n.alsoResize)):e.each(n.alsoResize,function(e){i(e)})},resize:function(t,n){var i=e(this).resizable("instance"),a=i.options,r=i.originalSize,s=i.originalPosition,o={height:i.size.height-r.height||0,width:i.size.width-r.width||0,top:i.position.top-s.top||0,left:i.position.left-s.left||0},l=function(t,i){e(t).each(function(){var t=e(this),a=e(this).data("ui-resizable-alsoresize"),r={},s=i&&i.length?i:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,function(e,t){var n=(a[t]||0)+(o[t]||0);n&&n>=0&&(r[t]=n||null)}),t.css(r)})};"object"!=typeof a.alsoResize||a.alsoResize.nodeType?l(a.alsoResize):e.each(a.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),n=t.options,i=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof n.ghost?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,n=e(this).resizable("instance"),i=n.options,a=n.size,r=n.originalSize,s=n.originalPosition,o=n.axis,l="number"==typeof i.grid?[i.grid,i.grid]:i.grid,c=l[0]||1,d=l[1]||1,u=Math.round((a.width-r.width)/c)*c,p=Math.round((a.height-r.height)/d)*d,h=r.width+u,f=r.height+p,m=i.maxWidth&&i.maxWidth<h,g=i.maxHeight&&i.maxHeight<f,v=i.minWidth&&i.minWidth>h,_=i.minHeight&&i.minHeight>f;i.grid=l,v&&(h+=c),_&&(f+=d),m&&(h-=c),g&&(f-=d),/^(se|s|e)$/.test(o)?(n.size.width=h,n.size.height=f):/^(ne)$/.test(o)?(n.size.width=h,n.size.height=f,n.position.top=s.top-p):/^(sw)$/.test(o)?(n.size.width=h,n.size.height=f,n.position.left=s.left-u):((0>=f-d||0>=h-c)&&(t=n._getPaddingPlusBorderDimensions(this)),f-d>0?(n.size.height=f,n.position.top=s.top-p):(f=d-t.height,n.size.height=f,n.position.top=s.top+r.height-f),h-c>0?(n.size.width=h,n.position.left=s.left-u):(h=d-t.height,n.size.width=h,n.position.left=s.left+r.width-h))}}),e.ui.resizable}),define("components/requirejs-text/text!template/module/mail/previewlayout.tpl.html",[],function(){return'\r\n<div id="previewLayout" class="m-preview-layout">\r\n    <div class="m-preview-layout-row">\r\n        <div class="preview-layout-top j-previewlayout-top">\r\n            <!---->\r\n            <div class="j-autoreply-content message-tip u-alert-warning f-ellipsis f-dn"></div>\r\n            <div class="j-message-content message-tip u-alert-warning f-ellipsis f-dn"></div>\r\n            <div class="j-defer-hint message-tip u-alert-warning f-ellipsis f-dn"></div>\r\n            <div class="j-select-all-msg message-tip u-alert-warning f-dn"></div>\r\n            <!--toolbar-->\r\n            <div class="j-preview-toolbar toolbar f-dn"></div>\r\n        </div>\r\n    </div>\r\n    <div class="m-preview-layout-row preview-layout-content-row">\r\n        <div class="preview-layout-content j-previewlayout-content">\r\n            <!---->\r\n            <div id="previewLayoutList" class="preview-layout-list preview-layout"></div>\r\n            <!---->\r\n            <div id="previewLayoutRead" class="j-resize-layout preview-layout-read preview-layout f-dn">\r\n                <div class="j-email-unchecked email-unchecked">\r\n                    <div class="unchecked-title">{{i18n "mbox/preview_mail_select_tip"}}</div>\r\n                    <span>{{i18n "mail/layout_select_message"}}</span>\r\n                </div>\r\n                <!---->\r\n                <div class="checked-title"></div>\r\n                {{#raw}}\r\n                <script id="chousetpl" type="text/x-handlebars-template">\r\n                    <div class="showChecked-title">[[[i18n "mail/preview_mail_selected_tip" count=Num]]]</div>\r\n                </script>\r\n                {{/raw}}\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    {{#raw}}\r\n    <script id="autoforwardtpl" type="text/x-handlebars-template">\r\n        <span class="close iconfont icondelword j-close"></span>\r\n        [[[i18n "mail/hint_message_forward" email=forwardEmail]]]\r\n    </script>\r\n\r\n    <script id="deferTipTpl" type="text/x-handlebars-template">\r\n        <span class="close iconfont icondelword j-close"></span>\r\n        [[[i18n "mail/hint_message_defer" count=tdyDeferCount]]]\r\n    </script>\r\n\r\n    <script id="autoreplytpl" type="text/x-handlebars-template">\r\n        <span class="close iconfont icondelword j-close"></span>\r\n        [[[i18n "mail/hint_message_autoreply"]]]\r\n    </script>\r\n    {{/raw}}\r\n</div>\r\n\r\n\r\n\r\n\r\n\r\n'}),define("module/mail/previewlayout/index",["require","i18n!common,mail,mbox","jquery.ui/resizable","jquery","cui/core/view/view","cui/core/view/viewmanager","../../../util/index","cui/util/templatable/templatable","../../../configurable/index","../toolbar","../../common/globalService","../service","../../setting/service","../list/service","text!template/module/mail/previewlayout.tpl.html"],function(e){e("i18n!common,mail,mbox"),e("jquery.ui/resizable");var t=e("jquery"),n=e("cui/core/view/view"),i=e("cui/core/view/viewmanager"),a=e("../../../util/index"),r=e("cui/util/templatable/templatable"),s=e("../../../configurable/index"),o=e("../toolbar"),l=e("../../common/globalService"),c=e("../service"),d=e("../../setting/service"),u=e("../list/service"),p=n.extend({Implements:r,state:null,setup:function(){var e,n,i;this.state=l.getCurrentState(),n=parseInt(this.state.param.id),i=a.mboxa.disassembly(this.state.param.fid),e=isNaN(i.fid)?n:i.fid,isNaN(e)?t.error("fid is not valid"):(this.state.param.fid=e,this.state.param.mboxa=i.mboxa,this.state.param.id=e+i.mboxa),this.config=s("mail.common",this),"function"===t.type(this.config.mboxaOverwrite)&&this.config.mboxaOverwrite()},render:function(){var e=this,t=l.getUser();return p.superclass.render.call(e),t.preview_layout?(e._resetModuleTop(),2!==t.preview_layout?e.$(".j-previewlayout-top").hide():e.$(".j-previewlayout-top").show(),e._initNotifyBar(),1===e.state.param.fid&&2===t.preview_layout?u.getTdyDeferMailCount().then(function(t){e._initDeferMailTip(t.TdyDeferMailCount)}):e._initDeferMailTip(!1),e._initSubject(),e._initPreviewLayout(),void e._initModuleEvent()):(e.sendMessage("mail","view:change",{module:"mail.list",param:{fid:e.state.param.fid}}),!1)},_initNotifyBar:function(){var e=this,n=l.getUser();this.config.enableSendMail&&2===n.preview_layout&&t.when(c.isPopOrShareFolder(e.state.param.fid,e.state.param.id),c.getAutoReplyInfo()).then(function(t,n){"string"==typeof t&&(e._params.defaultAccount=t,t=!1),t?e._initAutoForwardTip():e.$("div.j-message-content").hide(),n.enableAutoReply&&a.cookies.get("autoreply_notify",1)?e._initAutoReplyTip():e.$("div.j-autoreply-content").hide()})},_initSubject:function(){var e=this.state.param.id,t=c.getCacheFolder(e)||{};this.state.param.folderName=t.name,this.sendMessage("mail","tab:change",{id:"previewlayout:"+e,title:t.name||" "})},_initPreviewLayout:function(){this.$("#previewLayoutRead").addClass("f-dn"),this._initMailList(),this._initResizeLayout()},_initModuleEvent:function(){var e=this;this.unsubscribe("dispatcher","view:changed").subscribe("dispatcher","view:changed",function(){!!e.resizeCache&&e._handleResizeLayout()}),this.unsubscribe("mail","sidebar:changed").subscribe("mail","sidebar:changed",function(){e._resetResizable()}),this.offMessage("view:refresh").onMessage("view:refresh",function(n){var i=n?n.message:"";e.$("#previewLayoutList").html(""),e.$(".j-resize-layout").find(".ui-resizable-handle").length>0&&e.$(".j-resize-layout").resizable("destroy"),e._handleLayoutNum({count:0}),i&&(t.extend(!0,e.state,i),e.state.param.id=parseInt(i.param.fid),e.state.param.mboxa=i.param.mboxa||""),e.render()}),this.offMessage("view:change").onMessage("view:change",function(){e._initPreviewLayout()}),this.offMessage("previewlayout:read").onMessage("previewlayout:read",function(t){e._handleLayoutRead(t.message)}),this.offMessage("notify:refresh").onMessage("notify:refresh",function(){e._initNotifyBar()}),this.offMessage("selectAllMail:showNum").onMessage("selectAllMail:showNum",function(t){e._handleAllSelectedMail(t)}),this.offMessage("allCheckShow:showSelectedNum").onMessage("allCheckShow:showSelectedNum",function(t){e._handleAllSelectedNum(t)}),this.offMessage("allCheckHide:hideSelectedNum").onMessage("allCheckHide:hideSelectedNum",function(t){e._handleAllSelectedNumHide(t)}),this.offMessage("curCheckShow:showCurNum").onMessage("curCheckShow:showCurNum",function(t){e._handleCurShowNum(t)}),this.offMessage("previewlayout:count").onMessage("previewlayout:count",function(t){e._handleLayoutNum(t.message)}),this.offMessage("previewlayout:readShow").onMessage("previewlayout:readShow",function(t){e._handleLayoutHide(t)})},_offModuleEvent:function(){this.unsubscribe("dispatcher","view:changed").offMessage("view:refresh").offMessage("view:change").offMessage("previewlayout:read")},_initMailList:function(){var e=this,n=l.getUser(),a=new i.module("mail.list");t.extend(e.state.param,{view:"list"}),!!this.listView&&this.listView.destroy(),this.listView=a,e.state.param.mboxa&&(e.state.param.fid=e.state.param.id),l.setCurrentState(e.state),a.render(e.$("#previewLayoutList")).then(function(t){e.$("#previewLayoutRead").removeClass("f-dn"),2===n.preview_layout?e._initToolbar(t):e.$(".j-preview-toolbar").addClass("f-dn")})},_initToolbar:function(e){function n(t){var n=l.getUser();e.toolbar&&e.toolbar.destroy(),e.toolbar=new o({element:r.$(".j-preview-toolbar"),parent:e,total:t.total,limit:t.limit||n.maxlist||20,refresh:function(t){t.resetToolbar&&2===n.preview_layout&&r._initToolbar(e),e._updateMailList(t)}}).render()}var i,r=this,s=r.$("#toolbartpl").html(),d=a.mboxa.disassembly(r.state.param.fid),u=c.getCacheFolder(d.fid)||{},p=c.isExpandThreadMid(d.fid)&&!r.config.shareMailBoxFolder;r.$(".j-preview-toolbar").removeClass("f-dn").html(r.compile(s,{config:r.config})),t.isEmptyObject(u)?c.getAllFolderStats({ids:d.fid,mboxa:r.state.param.mboxa}).then(function(e){e&&e[1]?(i=e[1],n({total:p?i.threadCount:i.messageCount})):console.log("previewlayout: ",e)},function(e){console.log("previewlayout: ",e)}):(i=u.stats||{},n({total:p?i.threadCount:i.messageCount}))},_handleLayoutRead:function(e){var n,a=this.$("#previewLayoutRead");return!e||t.isEmptyObject(e)?(a.find("section.j-mail-read").remove(),void a.find(".j-email-unchecked").show()):(n=e&&new i.module(e.module),this.readView&&this.readView.destroy(),a.find("section.j-mail-read").remove(),a.find(".j-email-unchecked").hide(),l.setCurrentState(e),n.render(a),void(this.readView=n))},_handleLayoutNum:function(e){var t=this.$("#previewLayoutRead"),n=this.$("#chousetpl").html();if(t.find(".j-mail-read").is(":visible"))return!1;if(e.count>0){t.find(".email-unchecked").hide();var i=this.compile(n,{Num:e.count});t.find(".checked-title").show().html(i)}else t.find(".email-unchecked").show(),t.find(".checked-title").hide()},_handleAllSelectedNum:function(e){if(e.message.showSelectedNum){var t=this.$("#previewLayoutRead");t.find(".email-unchecked").hide(),t.find(".checked-title").show()}},_handleAllSelectedNumHide:function(e){if(!e.message.showSelectedNum){var t=this.$("#previewLayoutRead");t.find(".email-unchecked").show(),t.find(".checked-title").hide()}},_handleCurShowNum:function(e){var t=this.$("#previewLayoutRead"),n=this.$("#chousetpl").html();if(e.message.showCurNum>0){t.find(".email-unchecked").hide();var i=this.compile(n,{Num:e.message.showCurNum});t.find(".checked-title").show().html(i)}},_handleLayoutHide:function(e){if(e){var t=this.$("#previewLayoutRead");t.find(".email-unchecked").remove(),t.find(".checked-title").remove()}},_handleAllSelectedMail:function(e){var t=e.message.showNum,n=this.$("#previewLayoutRead"),i=this.$("#chousetpl").html();if(t){n.find(".email-unchecked").hide();var a=this.compile(i,{Num:t});n.find(".checked-title").show().html(a)}},_initAutoForwardTip:function(){var e,n=this,i=n.$("#autoforwardtpl").html(),a=n.$("div.j-message-content");c.getAutoForwardInfo().then(function(r){t.isEmptyObject(r)||0===r.forwardList.length||(a.show().html(n.compile(i,{forwardEmail:r.forwardList.join(",")})),a.on("click","a",function(){2===t(this).index()?d.setPrefOpHistoryRecord(r.recordItems).then(function(){a.hide()}):(e={module:0===t(this).index()?"setting.filter.letter":"setting.advance.forward",param:{}},n.sendMessage("dispatcher","history:add",e))}),a.find(".j-close").on("click",function(){a.hide()}))})},_initAutoReplyTip:function(){var e=this,n=e.$("#autoreplytpl").html(),i=e.$("div.j-autoreply-content");i.show().html(e.compile(n)),i.on("click","a",function(){1===t(this).index()&&e.sendMessage("dispatcher","history:add",{module:"setting.delivery.autoreply",param:{}})}),i.find(".j-close").on("click",function(){a.cookies.set("autoreply_notify",0),i.hide()})},_initDeferMailTip:function(e){var t=this,n=c.getFoldersMap(),i=t.$("#deferTipTpl").html(),a=t.$("div.j-defer-hint");return e?(a.show().html(t.compile(i,{tdyDeferCount:e})),a.on("click","a",function(){t.sendMessage("dispatcher","history:add",{module:"mail.list",param:{fid:n.defer}})}),void a.find(".j-close").on("click",function(){a.hide()})):void(a.is(":visible")&&a.hide())},_initResizeLayout:function(){var e=this,n=l.getUser(),i=1===n.preview_layout?"n":"w",r=e.$("#previewLayoutList"),s=e._getResizeMaxSize();e.$("#previewLayoutList,#previewLayoutRead").attr("style",""),e.element.removeClass("up-down-layout left-right-layout").addClass(1===n.preview_layout?"up-down-layout":"left-right-layout"),e.$(".j-resize-layout").resizable({handles:i,maxHeight:s.maxHeight,maxWidth:s.maxWidth,minWidth:400,minHeight:120,start:function(){e.$("#previewLayoutRead").find(".mail-content").each(function(){t(this).append('<div class="iframeCover" style="zindex:199;position:absolute;width:100%;top:0px;left:0px;height:'+t(this).height()+'px"></div>')})},stop:function(t,i){a.cookies.set("layout_ratio"+n.preview_layout,1===n.preview_layout?i.position.top/e.element.outerHeight():i.position.left/e.element.outerWidth()),e.$(".iframeCover").remove()},resize:function(e,t){1===n.preview_layout?r.css({height:t.position.top}):r.css({width:t.position.left})}}),e.$(".j-resize-layout").find(".ui-resizable-handle").html('<i class="iconfont '+("w"===i?"iconsliderv":"iconsliderh")+'"></i>'),e._resetResizable()},_getResizeMaxSize:function(){return this.element?{maxWidth:.7*this.element.outerWidth(),maxHeight:this.element.outerHeight()-this.$(".j-toolbar").outerHeight()-120}:void 0},_resizeLayoutByCookie:function(){var e=this,t=l.getUser(),n=a.cookies.get("layout_ratio"+t.preview_layout,0);if((0>n||n>1)&&(n=.5),1===t.preview_layout&&0!==n){var i=parseFloat(n)*e.element.outerHeight(),r=e.element.outerHeight()-i;e.$("#previewLayoutRead").css({top:i,height:r}),e.$("#previewLayoutList").css({height:i})}if(2===t.preview_layout&&0!==n){var s=parseFloat(n)*e.element.outerWidth(),o=e.element.outerWidth()-s-10;e.$("#previewLayoutRead").css({left:s,width:o}),e.$("#previewLayoutList").css({width:s})}},_resetResizable:function(){var e=this,n=l.getUser(),i=t(window),a=e._getResizeMaxSize(),r=-1;2===n.preview_layout?e.$(".j-resize-layout").resizable({maxWidth:a.maxWidth}):1===n.preview_layout&&e.$(".j-resize-layout").resizable({maxHeight:a.maxHeight}),e._resizeLayoutByCookie(),i.off("resize.previewLayout").on("resize.previewLayout",function(t){clearTimeout(r),r=setTimeout(function(){e.resizeCache=!0,e._handleResizeLayout()},100),t.stopPropagation()})},_handleResizeLayout:function(){var e=l.getUser(),n=t(window),i=n.width(),a=n.height();return function(){var n,r,s,o,l=this,c=l.element.is(":visible");c&&(n=t(window),r=n.width(),s=n.height(),o=l._getResizeMaxSize(),l.resizeCache=!1,i!==r&&2===e.preview_layout?(l.$(".j-resize-layout").resizable({maxWidth:o.maxWidth}),i=r,l._resizeLayoutByCookie()):a!==s&&1===e.preview_layout&&(l.$(".j-resize-layout").resizable({maxHeight:o.maxHeight}),a=s,l._resizeLayoutByCookie()))}}(),_resetModuleTop:function(){var e=this.$(".j-previewlayout-top");e.find(".message-tip").empty().html("").end().find(".j-preview-toolbar").empty().html("")},destroy:function(){this._offModuleEvent(),t(window).off("resize.previewLayout"),p.superclass.destroy.call(this)}});i.module({name:"mail.previewlayout",template:e("text!template/module/mail/previewlayout.tpl.html")},p)}),function(e){"use strict";e("components/jquery.scrollTo/jquery.scrollTo",["jquery"],function(e){function t(t){return e.isFunction(t)||e.isPlainObject(t)?t:{top:t,left:t}}var n=e.scrollTo=function(t,n,i){return e(window).scrollTo(t,n,i)};return n.defaults={axis:"xy",duration:0,limit:!0},n.window=function(t){return e(window)._scrollable()},e.fn._scrollable=function(){return this.map(function(){var t=this,n=!t.nodeName||-1!=e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!n)return t;var i=(t.contentWindow||t).document||t.ownerDocument||t;return/webkit/i.test(navigator.userAgent)||"BackCompat"==i.compatMode?i.body:i.documentElement})},e.fn.scrollTo=function(i,a,r){return"object"==typeof a&&(r=a,a=0),"function"==typeof r&&(r={onAfter:r}),"max"==i&&(i=9e9),r=e.extend({},n.defaults,r),a=a||r.duration,r.queue=r.queue&&r.axis.length>1,r.queue&&(a/=2),r.offset=t(r.offset),r.over=t(r.over),this._scrollable().each(function(){function s(e){c.animate(u,a,r.easing,e&&function(){e.call(this,d,r)})}if(null!=i){var o,l=this,c=e(l),d=i,u={},p=c.is("html,body");switch(typeof d){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(d)){d=t(d);break}if(d=p?e(d):e(d,this),!d.length)return;case"object":(d.is||d.style)&&(o=(d=e(d)).offset())}var h=e.isFunction(r.offset)&&r.offset(l,d)||r.offset;e.each(r.axis.split(""),function(e,t){var i="x"==t?"Left":"Top",a=i.toLowerCase(),f="scroll"+i,m=l[f],g=n.max(l,t);if(o)u[f]=o[a]+(p?0:m-c.offset()[a]),r.margin&&(u[f]-=parseInt(d.css("margin"+i))||0,u[f]-=parseInt(d.css("border"+i+"Width"))||0),u[f]+=h[a]||0,r.over[a]&&(u[f]+=d["x"==t?"width":"height"]()*r.over[a]);else{var v=d[a];u[f]=v.slice&&"%"==v.slice(-1)?parseFloat(v)/100*g:v}r.limit&&/^\d+$/.test(u[f])&&(u[f]=u[f]<=0?0:Math.min(u[f],g)),!e&&r.queue&&(m!=u[f]&&s(r.onAfterFirst),delete u[f])}),s(r.onAfter)}}).end()},n.max=function(t,n){var i="x"==n?"Width":"Height",a="scroll"+i;if(!e(t).is("html,body"))return t[a]-e(t)[i.toLowerCase()]();var r="client"+i,s=t.ownerDocument.documentElement,o=t.ownerDocument.body;return Math.max(s[a],o[a])-Math.min(s[r],o[r])},n})}("function"==typeof define&&define.amd?define:function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}),define("components/requirejs-text/text!component/../../template/component/mailRecall.tpl.html",[],function(){return'<!---->\n<div class="recall-wrap j-recall-wrap">\n  {{#if isConfirm }}\n  <p class="j-recall-confirm">\n    {{i18n "mail/recall_todo"}}<br/>\n    {{i18n "mail/recall_detail"}}\n  </p>\n  {{/if}}\n  {{#if isFail}}\n  <p class="j-recall-fail">\n    {{ meta.recallFailReason }}\n  </p>\n  {{/if}}\n  {{#if isSuccess}}\n  <div class="j-recall-success u-scroll" style="max-height:350px;">\n    <p>{{i18n "mail/recall_succ_message"}}</p>\n    <table class="u-table">\n      <tbody>\n      {{#each meta.recallData}}\n      <tr>\n        <td>{{emailAddress}}</td>\n        <td>{{recallMessage}}</td>\n      </tr>\n      {{/each}}\n      </tbody>\n    </table>\n  </div>\n  {{/if}}\n</div>\n';
}),define("component/mailRecallBox",["require","jquery","../util/index","cui/ui/dialog/confirmbox","text!../../template/component/mailRecall.tpl.html","../module/mail/service"],function(e){var t=e("jquery"),n=e("../util/index"),i=n.i18n,a=e("cui/ui/dialog/confirmbox"),r=e("text!../../template/component/mailRecall.tpl.html"),s=e("../module/mail/service"),o=a.extend({attrs:{isRecallConfirm:!1,title:i.t("mail/recall_mail"),message:"",confirmTpl:i.t("common/confirm"),cancelTpl:i.t("common/cancel"),onConfirm:function(){var e=this;e.get("isRecallConfirm")?this.hide():(e.set("isRecallConfirm",!0),e.element.mask(),s.recallMessage({mid:e.get("mid"),mboxa:e.get("mboxa")||""}).then(function(t){e.renderRecallSuccess(t),e.element.mask("hide")},function(t){e.renderRecallFail(t),e.element.mask("hide")}),e.set("cancelTpl",""))},onCancel:function(){this.hide()}},Statics:{recallStatus:{CONFIRM:"needConfirm",FAIL:"fail",SUCCESS:"success"}},render:function(){o.superclass.render.call(this),this._renderBox()},destroy:function(){o.superclass.destroy.call(this)},_renderBox:function(){this.set("message",this._compileRecallBoxContent(o.recallStatus.CONFIRM,void 0))},_compileRecallBoxContent:function(e,n){var i={isConfirm:!1,isFail:!1,isSuccess:!1,meta:{}};if(e)switch(e){case o.recallStatus.CONFIRM:i.isConfirm=!0;break;case o.recallStatus.FAIL:i.isFail=!0;break;case o.recallStatus.SUCCESS:i.isSuccess=!0;break;default:i.isConfirm=!0}else i.isConfirm=!0;return t.isPlainObject(n)&&(i.meta=n),this.compile(r,i)},renderRecallFail:function(e){var t;if(e&&e.code)switch(e.code){case"FA_MAIL_NOT_FOUND":t=n.i18n.t("mail/recall_fail_mail_not_found");break;case"FA_UNSUPPORT_RECALL":t=n.i18n.t("mail/recall_fail_unsupport");break;case"FA_MAIL_EXPIRED":t=n.i18n.t("mail/recall_fail_expired");break;default:t=n.i18n.t("mail/recall_fail")}else t=n.i18n.t("mail/recall_fail");this.set("message",this._compileRecallBoxContent(o.recallStatus.FAIL,{recallFailReason:t}))},renderRecallSuccess:function(e){this.set("message",this._compileRecallBoxContent(o.recallStatus.SUCCESS,{recallData:e}))}});return o}),define("components/requirejs-text/text!component/../../template/component/filetonfbox.tpl.html",[],function(){return'<div class="c-filetonfbox ">\r\n\r\n  <div class="c-filebox-content j-filebox-content u-scroll">\r\n\r\n  </div>\r\n\r\n  {{#raw}}\r\n\r\n  <script type=\'x-handlebars-template\' id=\'forbiddenTpl\'>\r\n    [[ i18n "file/msg_filebox_forbidden" ]]\r\n  </script>\r\n\r\n  <script type=\'x-handlebars-template\' id="auth2Tpl">\r\n    <div class="c-filebox-auth2lock">\r\n      <div class="c-filebox-auth2lock-wrap"></div>\r\n    </div>\r\n  </script>\r\n\r\n  <script type=\'x-handlebars-template\' id=\'folderTreeTpl\'>\r\n    <ul class="c-filebox-crumb u-crumb">\r\n      <li>[[ i18n "nf/bf_path" ]]&nbsp;</li>\r\n\r\n      <li class="j-hiddenPath f-dn">\r\n        <a href="javascript:void(0);" class="j-trigger-path" title="">..</a>\r\n      </li>\r\n\r\n\r\n      [[#each parentFolders]]\r\n      <li class="j-parentPath" data-fid="[[this.fid]]">\r\n          [[#if this.isRoot]]\r\n            <a href="javascript:void(0);" class="j-trigger-path" data-fid="[[this.fid]]">[[ i18n "main/pfdr_root" ]]</a>\r\n          [[else]]\r\n            <i>&gt;</i>\r\n            <a href="javascript:void(0);" class="j-trigger-path" data-fid="[[this.fid]]">[[this.name]]</a>\r\n          [[/if]]\r\n      </li>\r\n      [[/each]]\r\n\r\n      <li>\r\n        [[#if folderInfo.isRoot ]]\r\n          [[ i18n "main/pfdr_root" ]]\r\n        [[else]]\r\n          <i>&gt;</i>\r\n          [[folderInfo.name]]\r\n        [[/if]]\r\n      </li>\r\n    </ul>\r\n  </script>\r\n\r\n  <script type=\'x-handlebars-template\' id=\'folderListTpl\'>\r\n    <div class="c-filebox-list-wrap j-filelist-wrap">\r\n      [[#if isBlank]]\r\n        [[[ blankMsg ]]]\r\n      [[else]]\r\n        <div class="c-filebox-list onlyFolder">\r\n          <table class="u-table u-table-row">\r\n            <tbody>\r\n            [[#each subFolders]]\r\n            <tr class="folder-item">\r\n              <td class="col-name">\r\n                <i class="file-small-icon icon-small-folder"></i>\r\n                <a href="javascript:void(0);" class="j-trigger-path" data-fid="[[ this.id ]]">[[this.name]]</a>\r\n              </td>\r\n            </tr>\r\n            [[/each]]\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      [[/if]]\r\n    </div>\r\n  </script>\r\n\r\n  <script type=\'x-handlebars-template\' id=\'newFolderTpl\'>\r\n    <div class="c-filebox-newfolder j-filebox-newfolder">\r\n      <i class="file-small-icon icon-small-folder"></i>\r\n      <input type="text" class="u-input j-folderName" role="name" placeholder="[[i18n \'main/fdr_name\']]" data-placeholder="[[i18n \'main/fdr_name\']]" />\r\n      <span>\r\n        <a href="javascript:void(0);" class="c-filebox-newfolder-cancel j-cancel" title="[[i18n \'main/bt_cancel\']]"><i class="iconfont iconmistake"></i></a>\r\n        <a href="javascript:void(0);" class="c-filebox-newfolder-confirm j-confirm" title="[[i18n \'main/bt_ok\']]"><i class="iconfont iconpass"></i></a>\r\n      </span>\r\n      <p class="explain j-explain"></p>\r\n    </div>\r\n  </script>\r\n\r\n  {{/raw}}\r\n\r\n</div>'}),define("component/filetonfbox",["require","i18n!main,common,nf,file","text!../../template/component/filetonfbox.tpl.html","jquery","handlebars","xss","cui/ui/dialog/confirmbox","cui/util/templatable/templatable","../util/i18n","../module/common/globalService","../module/file/fileService","./userauth2"],function(e){e("i18n!main,common,nf,file");var t=e("text!../../template/component/filetonfbox.tpl.html"),n=e("jquery"),i=e("handlebars"),a=e("xss"),r=e("cui/ui/dialog/confirmbox"),s=e("cui/util/templatable/templatable"),o=e("../util/i18n"),l=e("../module/common/globalService"),c=e("../module/file/fileService"),d=e("./userauth2"),u=r.extend({Implements:s,$message:null,$content:null,$newFolder:null,$newFolderBtn:null,newFolderErrorTimeoutId:-1,attrs:{title:o.t("common/op_to_netfolder"),message:i.compile(t)({}),height:464,width:526,fid:l.getConfig("file.nfrootid"),subFolders:[],isPermitNF:!!l.getConfig("file.ispermitnf"),files:null,confirmCb:null,cancelCb:null},events:{"click a.j-trigger-path":"_handlerPathChange"},setup:function(){var e=this;this.after("render",function(){e.element.addClass("c-filebox-dialog"),e.$message=e.$(".c-filetonfbox").eq(0),e.$content=e.$message.find(".j-filebox-content").eq(0),e.get("isPermitNF")?e._checkAuth2Lock():e._renderForbid()}),this.after("hide",function(){this.destroy()}),u.superclass.setup.call(this)},render:function(){u.superclass.render.call(this),this._initEvent()},destroy:function(){u.superclass.destroy.call(this)},_initEvent:function(){this.on("confirm",this._handleConfirm,this),this.on("cancel",this._handleCancel,this)},_renderForbid:function(){var e=this.$message.find("#forbiddenTpl"),t=this.compile(e.html());this.$content.empty().html(t)},_renderContent:function(){var e,t=this,i=this.get("fid"),a=o.t("file/msg_filebox_loading"),r=o.t("file/msg_list_pnf_fail"),s=this.$("."+this.get("classPrefix")+"-operation").eq(0),l="j-newFolder";this.$content.empty().html(a),s.find("."+l).length<=0&&(e=n('<button class="u-btn u-btn-primary">'+o.t("main/bt_createfolder")+"</button>"),e.addClass(l).click(function(e){e.preventDefault(),t._handlerNewFolderDo()}),s.append(e),this.$newFolderBtn=e),this._toggleNewFolderBtnStatus(!1),n.when(c.getPNfFolderStructure(i,!0,!0,!1)).then(function(e){var n=e.folderTree.length>0?e.folderTree.reverse():[],i=e.folders.length>0?e.folders:[],a=e.folderInfo;t.set("subFolders",i),t.$content.empty().html(""),t._renderTree(n,a),t._renderFolders(i)},function(){t.$content.empty().html(r)})},_renderTree:function(e,t){var i=this.$message.find("#folderTreeTpl"),a=n(this.compile(i.html(),{parentFolders:e,folderInfo:t})),r=a.find(".j-hiddenPath").eq(0),s="f-dn",o=".j-parentPath",l=function(){var e,t,n=a[0].scrollHeight,i=a.outerHeight();n>i+3&&(e=a.find(o).eq(0),t=e.data("fid"),e.remove(),r.removeClass(s),r.data("fid",t),r.find("a").data("fid",t),l())};this.$content.append(a),l()},_renderFolders:function(e){var t=o.t("file/msg_list_pnf_folder_blank"),n=e.length<=0,i=this.$message.find("#folderListTpl"),a=this.compile(i.html(),{isBlank:n,blankMsg:t,subFolders:e});this.$content.append(a)},_renderNewFolder:function(){var e=this,t=this.$message.find("#newFolderTpl"),i=this.compile(t.html(),{});this.$newFolder=n(i),this.$newFolder.on("click",".j-cancel",function(t){t.preventDefault(),e._handlerNewFolderCancel()}).on("click",".j-confirm",function(t){t.preventDefault(),e._handlerNewFolderConfirm()}).on("keydown",".j-folderName",function(t){13==t.which&&(t.preventDefault(),e._handlerNewFolderConfirm())}),this.$content.append(this.$newFolder),this.$newFolder.find(".j-folderName").focus()},_renderNewFolderError:function(e){var t=this,n="error",i=this.$newFolder.find(".j-folderName").eq(0),a=this.$newFolder.find(".j-explain").eq(0),r=function(){clearTimeout(this.newFolderErrorTimeoutId),i.removeClass(n),a.html("")};if(!("undefined"==typeof e||e.length<=0)){if("clear"==e)return void r();i.addClass(n),a.html(e),this.newFolderErrorTimeoutId=setTimeout(function(){r.call(t)},2e3),this._scrollContentToBottom()}},_handlerPathChange:function(e){e.preventDefault();var t=n(e.target);this.set("fid",t.data("fid"))},_handlerNewFolderDo:function(){0==this.$content.find(".j-filebox-newfolder").length&&this._renderNewFolder(),this._scrollContentToBottom(),this._toggleNewFolderBtnStatus(!0)},_handlerNewFolderCancel:function(){this._closeNewFolder(),this._toggleNewFolderBtnStatus(!1)},_handlerNewFolderConfirm:function(){var e,t=this,i=this.get("subFolders"),r=this.$newFolder.find(".j-folderName").eq(0),s=a(r.val()),l=c.validateName(s,!1);l.isValid?p(i,s)?this._renderNewFolderError(o.t("file/msg_tips_foldername_repeat")):(e=[{parent:this.get("fid"),name:s}],n.when(c.createNFFolder(e)).then(function(e){var n=e[0],a={id:n,name:s};i.push(a),t._closeNewFolder(),t._insertNewFolder(a),t._toggleNewFolderBtnStatus(!1)},function(){t._renderNewFolderError(o.t("file/msg_tips_foldername_common"))})):this._renderNewFolderError(l.msg)},_handleConfirm:function(){var e=this,t=this.get("confirmCb"),i=this.get("files"),a=this.get("fid"),r=l.getFolderLockedStatus(!0);return t&&"function"==n.type(t)||(t=n.noop),n.isArray(i)||(i=[i]),r.isAuth?(this.element.mask(),void n.when(c.saveToNF({parts:i,fid:a})).done(function(){t(!0),n.notify.success(o.t("file/msg_saveto_nf_succ"))}).fail(function(e){var i=e.responseJSON;switch(i.code){case"FA_OVERFLOW":n.notify.error(o.t("file/msg_saveto_nf_fail_overflow"));break;default:n.notify.error(o.t("file/msg_saveto_nf_fail"))}t(!1)}).always(function(){e.element.mask("destroy"),e.hide()})):void n.notify.error(o.t("file/msg_saveto_nf_fail_auth2"))},_handleCancel:function(){var e=this.get("cancelCb");!!e&&"function"===n.type(e)&&e(),this.hide()},_onChangeFid:function(){this._checkAuth2Lock()},_checkAuth2Lock:function(){var e,t,i=this,a=l.getFolderLockedStatus(!0);a.isAuth?i._renderContent():(e=n(this.$message.find("#auth2Tpl").html()),this.$content.empty().html(e),t=new d({root:e.find(".c-filebox-auth2lock-wrap"),successCb:function(){t.close(),i._renderContent()}}))},_insertNewFolder:function(e){var t,i=this.get("subFolders"),a='<tr class="folder-item"><td class="col-name"><i class="file-small-icon icon-small-folder"></i><a href="javascript:void(0);" class="j-trigger-path" data-fid="{{ id }}">{{ name }}</a> </td></tr>';n.isPlainObject(e)&&(1==i.length?(t=n(this.compile(this.$message.find("#folderListTpl").html(),{isBlank:!1,subFolders:i})),this.$content.find(".j-filelist-wrap").empty().html(t.html())):this.$content.find(".j-filelist-wrap table tbody").append(n(this.compile(a,{id:e.id,name:e.name}))),this._scrollContentToBottom())},_closeNewFolder:function(){this.$newFolder&&(this.$newFolder.remove(),this.$newFolder=null)},_toggleNewFolderBtnStatus:function(e){var t=this.$newFolderBtn;t&&(e="boolean"==typeof e?e:!1,t.prop("disabled",e),e?t.addClass("disabled"):t.removeClass("disabled"))},_scrollContentToBottom:function(){var e=this.$content.height(),t=this.$content[0].scrollHeight;t>e&&this.$content.stop().animate({scrollTop:t},500)}}),p=function(e,t){var i=!1;return n.each(e,function(e,n){return n.name==t?(i=!0,!1):void 0}),i};return u}),define("components/requirejs-text/text!component/../../template/component/xnffilebox.tpl.html",[],function(){return'<div class="c-xnffilebox">\r\n\r\n  <div class="u-input-control c-xnf-search">\r\n    <input disabledhotkey="true" type="text" class="u-input u-input-round j-search">\r\n    <span class="iconfont iconsreachm"></span>\r\n    <span class="iconfont iconenter" data-action="search"></span>\r\n  </div>\r\n  <div class="j-crumb"></div>\r\n  <div class="c-filebox-content u-scroll">\r\n  </div>\r\n  <div class="j-pagination"></div>\r\n\r\n\r\n  {{#raw}}\r\n\r\n  <script type=\'x-handlebars-template\' id="unAuthTpl">\r\n  [[[ i18n "file/msg_xnfbox_unauth" ]]]\r\n  </script>\r\n\r\n  <script type=\'x-handlebars-template\' id="initFailTpl">\r\n    [[[ i18n "file/msg_xnfbox_fail" ]]]\r\n  </script>\r\n\r\n  <script type=\'x-handlebars-template\' id="saveToFootTpl">\r\n    <button type="button" class="u-btn u-btn-primary btn-createFolder" data-action="createFolder">[[i18n "main/bt_createfolder"]]</button>\r\n  </script>\r\n\r\n  <script type=\'x-handlebars-template\' id="selectFromFootTpl">\r\n    <a class="c-checkAll" data-selectType="all" href="javascript:void(0);" data-action="checkAll">\r\n      [[i18n "mail/clipboard_select_all"]]</a>\r\n    &nbsp;&nbsp;&nbsp;<a class="fileCount">[[i18n "file/msg_tips_choose_file_count"]]</a>\r\n  </script>\r\n\r\n  <script type=\'x-handlebars-template\' id=\'newFolderTpl\'>\r\n    <div class="c-filebox-newfolder j-filebox-newfolder">\r\n      <i class="file-small-icon icon-small-folder"></i>\r\n      <input disabledhotkey="true" type="text" class="u-input j-folderName" role="name"\r\n             placeholder="[[i18n \'main/fdr_name\']]" data-placeholder="[[i18n \'main/fdr_name\']]" />\r\n      <span>\r\n        <a href="javascript:void(0);" class="c-filebox-newfolder-cancel j-cancel" title="[[i18n \'main/bt_cancel\']]">\r\n          <i class="iconfont iconmistake"></i></a>\r\n        <a href="javascript:void(0);" class="c-filebox-newfolder-confirm j-confirm" title="[[i18n \'main/bt_ok\']]">\r\n          <i class="iconfont iconpass"></i></a>\r\n      </span>\r\n      <p class="explain j-explain"></p>\r\n    </div>\r\n  </script>\r\n\r\n  <script type=\'x-handlebars-template\' id=\'renameFolderTpl\'>\r\n    <div class="c-filebox-renamefolder j-filebox-renamefolder">\r\n      <input disabledhotkey="true" value="[[val]]" type="text" class="u-input j-folderName"\r\n             role="name" data-placeholder="[[i18n \'main/fdr_name\']]" />\r\n      <span>\r\n        <a href="javascript:void(0);" class="c-filebox-renamefolder-cancel j-cancel" title="[[i18n \'main/bt_cancel\']]">\r\n          <i class="iconfont iconmistake"></i></a>\r\n        <a href="javascript:void(0);" class="c-filebox-renamefolder-confirm j-confirm" title="[[i18n \'main/bt_ok\']]">\r\n          <i class="iconfont iconpass"></i></a>\r\n      </span>\r\n      <p class="explain j-explain"></p>\r\n    </div>\r\n  </script>\r\n\r\n  <script type=\'x-handlebars-template\' id=\'attachmentInfoTpl\'>\r\n    <div class="c-filebox-attachment">\r\n      <div class="c-attachment-info">\r\n        <span>[[i18n "file/msg_xnfbox_name"]]</span>\r\n        <input disabledhotkey="true" type="text" class="u-input c-newname" value="[[filename]]" />\r\n        <span class="c-newname-error f-dn"></span>\r\n      </div>\r\n    </div>\r\n  </script>\r\n\r\n\r\n  <script type="x-handlebars-template" id="folderTreeTpl">\r\n    <ul class="c-filebox-crumb u-crumb">\r\n      <li>[[ i18n "nf/bf_path" ]]&nbsp;</li>\r\n\r\n      <li class="j-hiddenPath f-dn">\r\n        <a href="javascript:void(0);" class="j-trigger-path" title="">..</a>\r\n      </li>\r\n\r\n\r\n      [[#each parentFolders]]\r\n      <li class="j-parentPath c-path" data-path="[[this.path]]"  data-fid="[[this.id]]">\r\n        [[#if this.isRoot]]\r\n        <a href="javascript:void(0);" class="j-trigger-path" data-fid="[[this.id]]" data-path="[[this.path]]">[[ i18n "main/fdr_root" ]]</a>\r\n        [[else]]\r\n        <i>&gt;</i>\r\n        <a href="javascript:void(0);" class="j-trigger-path" data-fid="[[this.id]]" data-path="[[this.path]]">[[this.name]]</a>\r\n        [[/if]]\r\n      </li>\r\n      [[/each]]\r\n\r\n      <li class="c-path">\r\n        [[#if folderInfo.isRoot ]]\r\n        [[ i18n "main/fdr_root" ]]\r\n        [[else]]\r\n        <i>&gt;</i>\r\n        [[folderInfo.name]]\r\n        [[/if]]\r\n      </li>\r\n    </ul>\r\n  </script>\r\n\r\n  <!--  -->\r\n  <script type=\'x-handlebars-template\' id=\'folderListTpl\'>\r\n    <div class="c-filebox-list-wrap j-filelist-wrap c-filebox-list">\r\n      [[#if isBlank]]\r\n      [[[ blankMsg ]]]\r\n      [[else]]\r\n      <div class="c-filebox-list j-filelist onlyFolder">\r\n        <table class="u-table u-table-row">\r\n          <tbody>\r\n          [[#each subFolders]]\r\n          <tr class="file-item">\r\n            <td class="col-name">\r\n              <i class="file-small-icon icon-small-folder"></i>\r\n              <a href="javascript:void(0);" class="j-trigger-path" data-fid="[[this.id]]" data-path="[[ this.path ]]">[[this.name]]</a>\r\n            </td>\r\n            <td class="col-size"></td>\r\n            <td class="col-rename"><span data-action="rename">{{i18n "main/bt_rename"}}</span></td>\r\n          </tr>\r\n          [[/each]]\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      [[/if]]\r\n    </div>\r\n  </script>\r\n\r\n  <!-- + -->\r\n  <script type="x-handlebars-template" id="allListTpl">\r\n    <div class="c-filebox-list-wrap j-filelist-wrap">\r\n      [[#if isBlank]]\r\n        [[[ blankMsg ]]]\r\n      [[else]]\r\n        <div class="c-filebox-list j-filelist">\r\n          <table class="u-table u-table-row">\r\n            <tbody>\r\n            [[#each listResult]]\r\n              [[#if this.size]]\r\n              <tr class="file-item j-file-item"\r\n                  data-isFile="true"\r\n                  data-id="[[ this.id ]]"\r\n                  data-size="[[ this.size ]]"\r\n                  data-name="[[ this.name ]]"\r\n                  data-date="[[ this.date ]]">\r\n                <td class="col-chk">\r\n                      <span>\r\n                        <input type="checkbox" class="u-input j-item-chk" />\r\n                      </span>\r\n                </td>\r\n                <td class="col-name" title="[[this.name]]">\r\n                  <i class="file-small-icon [[ GetFileIco this.name \'icon-small-\' ]]"></i>\r\n                  <span>[[this.name]]</span>\r\n                </td>\r\n                <td class="col-size">[[ GetSize this.size ]]</td>\r\n                <td class="col-rename"><span data-action="rename">[[i18n "main/bt_rename"]]</span></td>\r\n              </tr>\r\n              [[else]]\r\n              <tr class="file-item">\r\n                <td class="col-chk">\r\n                </td>\r\n                <td class="col-name" title="[[this.name]]">\r\n                  <i class="file-small-icon icon-small-folder"></i>\r\n                  <a href="javascript:void(0);" title="[[this.name]]" class="j-trigger-path"\r\n                     data-fid="[[this.id]]" data-path="[[ this.path ]]">[[this.name]]</a>\r\n                </td>\r\n                <td class="col-size"></td>\r\n                <td class="col-rename"><span data-action="rename">[[i18n "main/bt_rename"]]</span></td>\r\n              </tr>\r\n              [[/if]]\r\n            [[/each]]\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      [[/if]]\r\n    </div>\r\n  </script>\r\n\r\n  <!--  -->\r\n  <script type="x-handlebars-template" id="engineListTpl">\r\n    <div class="c-filebox-xnfEngines j-xnfEngines">\r\n      <p class="c-filebox-xnfEngines-title">[[ i18n \'file/msg_xnfbox_engine_select\' ]]</p>\r\n      <ul>\r\n        [[#each xnfLists]]\r\n        <li class="j-engineItem" data-token="[[ this.token ]]">\r\n          <span class="engineIcon file-big-icon icon-big-folder"></span>\r\n          <span class="engineName">[[ this.engineName ]]</span>\r\n        </li>\r\n        [[/each]]\r\n      </ul>\r\n    </div>\r\n  </script>\r\n\r\n  {{/raw}}\r\n\r\n</div>'}),define("component/xnffilebox",["require","i18n!main,common,nf,file,mail","widget/pagination/pagination","text!../../template/component/xnffilebox.tpl.html","jquery","xss","handlebars","moment","cui/ui/dialog/confirmbox","cui/util/templatable/templatable","../util/i18n","../util/file","../util/size","../module/common/globalService","../module/file/fileService"],function(e){e("i18n!main,common,nf,file,mail"),e("widget/pagination/pagination");var t=e("text!../../template/component/xnffilebox.tpl.html"),n=e("jquery"),i=e("xss"),a=e("handlebars"),r=e("moment"),s=e("cui/ui/dialog/confirmbox"),o=e("cui/util/templatable/templatable"),l=e("../util/i18n"),c=e("../util/file"),d=e("../util/size"),u=e("../module/common/globalService"),p=e("../module/file/fileService"),h=s.extend({Implements:o,$message:null,$content:null,$createFolder:null,$renameFolder:null,composeId:null,attrs:{token:null,fid:null,path:null,xnfConfig:[],subFolders:[],message:a.compile(t)({}),type:"",height:600,width:650,parts:null,filename:null,confirmCb:null,cancelCb:null,checked:0,pageEntity:{limit:20,start:0,total:0}},events:{"click [data-action]":"_dispatchAction","click a.j-trigger-path":"_handlePathChange","click .j-filelist .col-chk":"_handleItemChk","keydown .j-search":"_handleMousedownSearch"},setup:function(){var e=this;this.after("render",function(){var t=u.getConfig("file.xnfengines"),n=t.length,i=e.element.find("."+e.get("classPrefix")+"-title").eq(0);if(e.element.addClass("c-filebox-dialog"),e.$message=e.$(".c-xnffilebox").eq(0),e.$content=e.$message.find(".c-filebox-content").eq(0),e.set("xnfConfig",t),0>=n)e._renderUnAuth();else if(1===n){switch(e.get("type")){case"saveTo":e.element.addClass("c-saveTo"),i.html(l.t("common/op_to_xnffolder").replace("{0}",t[0].engineName));break;case"selectFrom":e.element.addClass("c-selectFrom"),i.html(l.t("mail/compose_attach_add_from_external_nf").replace("{0}",t[0].engineName));break;default:return e._renderInitFail()}e.set("token",t[0].token)}else n>1&&e._renderEngines()}),this.after("hide",function(){this.destroy()}),h.superclass.setup.call(this)},render:function(){h.superclass.render.call(this),this._initEvent()},destroy:function(){h.superclass.destroy.call(this)},_initEvent:function(){this.on("confirm",this._handleConfirm,this),this.on("cancel",this._handleCancel,this)},_renderUnAuth:function(){var e=this.$message.find("#unAuthTpl"),t=this.compile(e.html());this.$content.empty().append(t)},_renderInitFail:function(){var e=this.$message.find("#initFailTpl"),t=this.compile(e.html());this.$content.empty().append(t)},_renderEngines:function(){var e=this,t=this.$message.find("#engineListTpl"),i=this.get("xnfConfig"),a=n.map(i,function(e){return e.linked?e:null}),r=this.compile(t.html(),{xnfLists:a}),s=n(r);this.$content.empty().append(s),s.on("click",".j-engineItem",function(t){e._handleEngineSelected(t)})},_renderContent:function(){var e=this.get("type");switch(this.set("pageEntity",{start:0}),this.set("checked",0),0===this.get("fid").indexOf(this.get("token"))&&(e="search"),e){case"saveTo":case"selectFrom":this._renderAllList(!0);break;case"search":this._renderAllList(!0,e);break;default:this._renderInitFail()}},_renderAllList:function(e,t){var n=this,i=n.get("fid"),a=n.get("token"),r=n.get("pageEntity").start,s=n.get("pageEntity").limit,o=n.$(".j-search").val(),c=l.t("file/msg_filebox_loading");e="boolean"==typeof e?e:!1,n.$content.empty().html(c),"search"===t?n._renderSearchList(e,o):p.getXNfFolderStructure(a,i,!0,!0,!0,r,s).then(function(t){n.set("pageEntity",{total:t.totalLen},{silent:!1}),e&&n._initPagination(),n._toggleNewFolderBtnStatus(!1),n._updateList(t)},function(e){console.log(e),n._renderInitFail()}),n._initFoot()},_initFoot:function(){var e=this,t=n('<div class="choose-info f-fl"></div>'),i=this.compile(e.element.find("#saveToFootTpl").html()),a=this.compile(e.element.find("#selectFromFootTpl").html()).replace("{0}",0);switch(e.$(".choose-info").length>0&&(t=e.$(".choose-info")),e.get("type")){case"saveTo":0===e.element.find("[data-action=createFolder]").length&&e.element.find("[data-role=foot] .u-dialog-btns").prepend(i);break;case"selectFrom":e.element.find("[data-role=foot]").prepend(t.html(a));break;default:return e._renderInitFail()}},_updateList:function(e){var t=this,n=t.get("type"),i=e.folderTree?e.folderTree:[],a=e.listResult?e.listResult:[],r=e.folders?e.folders:[],s=e.files?e.files:[],o=r.concat(s),c=e.folderInfo,d=0===a.length,u=l.t("file/msg_list_pnf_folder_blank");t.set("subFolders",o);var p=t.$message.find("#allListTpl"),h=t.compile(p.html(),{isBlank:d,blankMsg:u,listResult:a});t.$content.empty().html(""),t._renderTree(i,c),t.$content.append(h).customRadioCheckbox(),t.isAnyShareRoot()&&"saveTo"===n?(t.$(".col-rename").hide(),t.element.find('[data-role="confirm"]').addClass("disabled")):t.element.find('[data-role="confirm"]').removeClass("disabled"),"saveTo"===t.get("type")&&t._renderAttachmentInfo(c)},_updateSearchList:function(e){var t,n,i=this,a=i.get("path"),r=l.t("file/msg_list_pnf_search_blank").replace("{0}",""==a?l.t("main/fdr_root"):a),s=i.$message.find("#allListTpl"),o=l.t("file/msg_xnfbox_search_result"),c=[{id:"",isRoot:!0,path:""}],d={id:"/"+o,isRoot:!1,path:"/"+o,name:o};t=0==e.totalLen,n=i.compile(s.html(),{isBlank:t,blankMsg:r,listResult:e.listResult}),i.$content.empty().html(""),i._renderTree(c,d),i.$content.append(n).customRadioCheckbox()},_initPagination:function(e){var t=this,n=this.get("pageEntity"),i=n.limit,a=n.total;t.$(".j-pagination").pagination({total:a,limit:i,currentPage:0,menu:!1,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',callback:function(n){t.set("checked",0),t.set("pageEntity",{start:n*i}),"search"===e?t._renderAllList(!1,"search"):t._renderAllList()}})},_renderTree:function(e,t){var i=this.$message.find("#folderTreeTpl"),a=n(this.compile(i.html(),{parentFolders:e,folderInfo:t})),r=a.find(".j-hiddenPath").eq(0),s="f-dn",o=".j-parentPath",l=function(){var e,t,i,c=(a.width()-n(".c-filebox-crumb").find("li").eq(0).width())/80,d=a.find(".c-path").length;d>c&&(e=a.find(o).eq(0),t=e.data("fid"),i=e.data("path"),e.remove(),r.removeClass(s),r.data("fid",t).data("path",t),r.find("a").data("fid",t).data("path",i),l())};this.element.find(".j-crumb").html(a),l()},_renderAttachmentInfo:function(e){var t=this,n=this.get("filename"),i=this.$("#attachmentInfoTpl").html();t.$content.append(t.compile(i,{filename:n}))},_handleEngineSelected:function(e){e.preventDefault(),this.set("token",n(e.currentTarget).data("token"))},_handlePathChange:function(e){e.preventDefault(),this.set("fid",n(e.target).data("fid")),this.set("path",n(e.target).data("path"))},_handlerRename:function(e){0!==this.$content.find(".j-filebox-renamefolder").length&&this._handlerRenameFolderCancel(),"true"==e.parents(".file-item").attr("data-isFile")?this._renderRenameFolder(e,!0):this._renderRenameFolder(e,!1)},_handleCheckAll:function(e){var t=this,n=e.attr("data-selectType");"all"===n?(t.$(".j-file-item .checkbox:not(.rc-disabled)").attr("class","checkbox checkbox-checked"),e.attr("data-selectType","no"),e.html(l.t("common/op_none")),t.set("checked",t.$(".j-file-item .checkbox-checked").length)):(t.$(".j-file-item .checkbox:not(.rc-disabled)").attr("class","checkbox"),e.html(l.t("mail/clipboard_select_all")),e.attr("data-selectType","all"),t.set("checked",0))},_handlerCreateFolderDo:function(){0==this.$content.find(".j-filebox-newfolder").length&&this._renderNewFolder(),this._scrollContentToBottom(),this._toggleNewFolderBtnStatus(!0)},_handlerNewFolderCancel:function(){this._closeCreateFolder(),this._toggleNewFolderBtnStatus(!1)},_handlerNewFolderConfirm:function(){var e,t=this,a=this.get("subFolders"),r=this.$createFolder.find(".j-folderName").eq(0),s=r.val(),o=i(r.val()),c=p.validateName(s,!1);c.isValid?f(a,s)?this._renderError("newFolder",l.t("file/msg_tips_foldername_repeat")):(e={path:this.get("fid")+"/"+o,token:this.get("token"),hintWithParents:!0},n.when(p.createXNFFolder(e)).then(function(e){a.push(e),t._closeCreateFolder(),t._insertNewFolder(e),t._toggleNewFolderBtnStatus(!1)},function(){t._renderError("newFolder",l.t("file/msg_tips_foldername_common"))})):this._renderError("newFolder",c.msg)},_handlerRenameFolderConfirm:function(e){var t,a=this,r=this.get("subFolders"),s=this.$renameFolder.find(".j-folderName").eq(0),o=this.$renameFolder.prev().html(),c=i(s.val()),d=p.validateName(c,e);return s.val()===o?(a._handlerRenameFolderCancel(),!1):void(d.isValid?f(r,c)?this._renderError("renameFolder",l.t("file/msg_tips_foldername_repeat")):(t={path:this.get("fid")+"/"+o,destPath:this.get("fid")+"/"+c,token:this.get("token")},p.renameXNFFolder(t).then(function(e){a.$renameFolder.prev().html(e.name),a.$renameFolder.prev().attr("data-fid",e.id),a.$renameFolder.prev().attr("data-path",e.path),a.$renameFolder.prev().parent().attr("title",e.name),a._handlerRenameFolderCancel();var t=a.get("subFolders");n.each(t,function(e,n){return n&&n.path===a.get("fid")+"/"+o?void t.splice(e,1):void 0})},function(){a._renderError("renameFolder",l.t("file/msg_tips_foldername_common"))})):this._renderError("renameFolder",d.msg))},_handlerRenameFolderCancel:function(){this.$renameFolder&&(this.$renameFolder.parents(".file-item").removeClass("c-rename-tr"),this.$renameFolder.remove(),this.$renameFolder=null)},_renderNewFolder:function(){var e=this,t=e.$("#newFolderTpl"),i=e.compile(t.html(),{});this.$createFolder=n(i),this.$createFolder.on("click",".j-cancel",function(t){t.preventDefault(),e._handlerNewFolderCancel()}).on("click",".j-confirm",function(t){t.preventDefault(),e._handlerNewFolderConfirm()}).on("keydown",".j-folderName",function(t){13===t.which&&(t.preventDefault(),e._handlerNewFolderConfirm())}),this.$(".j-filelist-wrap").append(this.$createFolder),this.$createFolder.find(".j-folderName").focus()},_renderRenameFolder:function(e,t){var i=this,a=i.$("#renameFolderTpl"),r=e.parents(".file-item"),s=r.find(".col-name").attr("title"),o=i.compile(a.html(),{val:s});this.$renameFolder=n(o),this.$renameFolder.on("click",".j-cancel",function(e){e.preventDefault(),i._handlerRenameFolderCancel()}).on("click",".j-confirm",function(e){e.preventDefault(),i._handlerRenameFolderConfirm(t)}).on("keydown",".j-folderName",function(e){13===e.which&&(e.preventDefault(),i._handlerNewFolderConfirm())}),r.find(".col-name").append(this.$renameFolder),this.$renameFolder.find(".j-folderName").focus(),r.addClass("c-rename-tr")},_renderError:function(e,t){var n,i,a=this,r="error";if("newFolder"===e)n=this.$createFolder.find(".j-folderName").eq(0),i=this.$createFolder.find(".j-explain").eq(0);else if("renameFolder"===e){n=this.$renameFolder.find(".j-folderName").eq(0),i=this.$renameFolder.find(".j-explain").eq(0);var s=this.$renameFolder.parents(".file-item").eq(0)}var o=function(){clearTimeout(a.newFolderErrorTimeoutId),n.removeClass(r),i.html(""),s&&s.height(36),navigator.userAgent.indexOf("MSIE 8.0")>0&&n.parent().css("top",-2)};if(!("undefined"==typeof t||t.length<=0)){if("clear"==t)return void o();n.addClass(r),navigator.userAgent.indexOf("MSIE 8.0")>0&&n.parent().css("top",-12),i.html(t),s&&s.height(63),this.newFolderErrorTimeoutId=setTimeout(function(){o.call(a)},2e3),"newFolder"===e?this._scrollContentToBottom():this.$(".j-filelist-wrap").scrollTop(this.$(".j-filelist-wrap").scrollTop()+30)}},_handleItemChk:function(e,t){var i=this,a=n(t),r=i.get("checked");
/checkbox/g.test(e.target.className)||a.find(".checkbox:not(.rc-disabled)").trigger("click.crc"),0===a.find(".rc-disabled").length&&(a.find(".checkbox-checked").length>0?i.set("checked",r+1):i.set("checked",r-1))},_handleConfirm:function(){var e=this.get("type");if(this.element.find("[data-role=confirm]").hasClass("disabled"))return!1;switch(e){case"saveTo":this._handleSaveToXNF();break;case"selectFrom":this._handleSelectFromXNF();break;default:this._renderInitFail()}},_handleCancel:function(){var e=this.get("cancelCb");!!e&&"function"===n.type(e)&&e(),this.hide()},_renderSearchList:function(e,t){var n=this,i=n.get("pageEntity").start,a=n.get("pageEntity").limit,r={token:n.get("token"),fid:n.get("path"),query:t,start:i,limit:a};p.SearchXNFList(r).then(function(t){n._updateSearchList(t),n.set("pageEntity",{total:t.totalLen},{silent:!1}),e&&n._initPagination("search")})},_handleSaveToXNF:function(){this.element.mask();var e=this,t=this.get("confirmCb"),a=this.get("parts"),r=this.get("token"),s=this.get("fid"),o=this.get("filename"),c=this.$(".c-newname").val(),d=i(this.$(".c-newname").val()),u=p.validateName(c,!0);t&&"function"==n.type(t)||(t=n.noop),o===c||u.isValid?n.when(p.saveToXNF({token:r,parts:a,fid:s})).done(function(i){if(o!==c){var a={path:e.formateStr(i[0],o),destPath:e.formateStr(i[0],d),token:e.get("token")};p.renameXNFFolder(a).then(function(){t(!0),n.notify.success(l.t("file/msg_saveto_xnf_succ"))},function(){n.notify.success(l.t("file/msg_saveto_xnf_succ"))})}else t(!0),n.notify.success(l.t("file/msg_saveto_xnf_succ"))}).fail(function(){t(!1),n.notify.error(l.t("file/msg_saveto_xnf_fail"))}).always(function(){e.element.mask("destroy"),e.hide()}):(this.$(".c-newname-error").html(u.msg).show(),t(!1),e.element.mask("destroy"))},_handleSelectFromXNF:function(){var e=this,t=this._getCheckedCheckboxDom(),i=this.get("token"),a=this.get("confirmCb"),r=[],s=[],o=[],c=!0,d=u.getConfig("user.smtpmaxsendmailsize");return 0===t.length?void e.hide():(t.each(function(){var e=n(this).parents(".j-file-item").eq(0);c?e.data("size")>=d?s.push(e.data("id")):r.push(encodeURI(e.data("id"))):s.push(e.data("id")),o.push(e.data("name"))}),a&&"function"==n.type(a)||(a=n.noop),e.$content.find(".j-filelist .checkbox").addClass("rc-disabled"),void((r.length>0||s.length>0)&&n.when(p.attachToCompose({token:i,ids:r,composeId:e.get("composeId")}),p.getXNFShareableUrl({token:i,id:s})).done(function(t,i){var r=[];i.length>0&&n.each(i,function(e,t){var n=t.split("/");r.push({url:t,name:n[n.length-1]})}),t.urlArray&&t.urlArray.length>0&&n.each(t.urlArray,function(e,t){var n=t.url[0].split("/");r.push({url:t.url[0],name:n[n.length-1]})}),r.length>0&&n.notify.warning(l.t("mail/FA_OVERFLOW.attchment_limit")),a(r,t.attachments),e.hide()}).fail(function(){a(!1),e.hide()})))},_dispatchAction:function(e,t){var i=this,a=n(t),r=new Date,s=i.$(".j-search").val(),o=a.attr("data-action");switch(o){case"search":if(!s)return;this.set("pageEntity",{start:0}),i.set("fid",i.get("token")+r.getTime());break;case"createFolder":i._handlerCreateFolderDo();break;case"rename":i._handlerRename(a);break;case"checkAll":i._handleCheckAll(a)}},_handleMousedownSearch:function(e){var t=this,n=new Date,i=t.$(".j-search").val();i&&13===e.keyCode&&(t.set("pageEntity",{start:0}),t.set("fid",t.get("token")+n.getTime()))},_insertNewFolder:function(e){var t,i=this.get("subFolders"),a='<tr class="file-item"><td class="col-chk"></td><td class="col-name" title="{{ newFolder.name }}"><i class="file-small-icon icon-small-folder"></i><a href="javascript:void(0);" class="j-trigger-path" data-fid="{{ newFolder.id }}" data-path="{{ newFolder.path }}">{{ newFolder.name }}</a> </td><td class="col-size"></td><td class="col-rename"><span data-action="rename">{{i18n "main/bt_rename"}}</span></td></tr>';n.isPlainObject(e)&&(0===this.$content.find(".file-item").length?(t=n(this.compile(this.$message.find("#folderListTpl").html(),{isBlank:!1,subFolders:i})),this.$content.find(".j-filelist-wrap").empty().html(t.html())):this.$content.find(".j-filelist-wrap table tbody").append(n(this.compile(a,{newFolder:e}))),this._scrollContentToBottom())},_closeCreateFolder:function(){this.$createFolder&&(this.$createFolder.remove(),this.$createFolder=null)},_toggleNewFolderBtnStatus:function(e){var t=this.$("[data-action=createFolder]");t&&(this.isAnyShareRoot()&&(e=!0),e="boolean"==typeof e?e:!1,t.prop("disabled",e),e?t.addClass("disabled"):t.removeClass("disabled"))},isAnyShareRoot:function(){var e=this.get("fid"),t=this.get("xnfConfig")[0].engineKey;return"AnyShare"===t&&""===e?!0:!1},_scrollContentToBottom:function(){var e=this.$(".j-filelist").height()+this.$(".j-filebox-newfolder").height()-this.$(".j-filelist-wrap").height()+10;this.$(".j-filelist-wrap").stop().animate({scrollTop:e},500)},_onChangeToken:function(){this.set("fid","",{silent:!0}),this.set("path",""),this._renderContent()},_onChangeFid:function(){this._renderContent()},_onChangeChecked:function(){var e=l.t("file/msg_tips_choose_file_count");this.$("[data-role=foot] .fileCount").html(e.replace("{0}",this.get("checked")))},_getCheckedCheckboxDom:function(){return this.$content.find(".j-filelist .j-file-item i.checkbox-checked").prev('input.j-item-chk[type="checkbox"]')},templateHelpers:{GetDateMD:function(e){return e?new a.SafeString(r(e).format("MM-DD")):void 0},GetFileIco:function(e,t){return e&&t?t+c.formatFileType(e):""},GetSize:function(e){return!e||0>e?"0K":d.bytesToSize(e,0)}},formateStr:function(e,t){var n=e.lastIndexOf("/");return e.substring(0,n+1)+t}}),f=function(e,t){var i=!1;return n.each(e,function(e,n){return n.name===t?(i=!0,!1):void 0}),i},m=function(e,t,n,i){return new h({parts:e,filename:t,confirmCb:n,cancelCb:i,type:"saveTo"})},g=function(e,t,n){return new h({confirmCb:e,cancelCb:t,type:"selectFrom",composeId:n})};return{saveFilesToXNF:m,selectFilesFromXNF:g}}),define("module/calendar/service",["require","jquery","../../util/index","../common/globalService"],function(e){function t(e){var t=c.Deferred();return d.xhr.simpleCall({query:{func:"cal:replyMeetingRequest",sid:u.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function n(e){var t=c.Deferred();return d.xhr.simpleCall({query:{func:"cal:addToMyCal",sid:u.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function i(e){var t=c.Deferred();return d.xhr.simpleCall({query:{func:"cal:delFromMyCal",sid:u.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function a(e){var t=c.Deferred();return d.xhr.simpleCall({query:{func:"cal:listCalFolder",sid:u.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function r(e){var t=c.Deferred();return d.xhr.simpleCall({query:{func:"cal:listAccessedCalFolder",sid:u.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function s(e){var t=c.Deferred();return d.xhr.simpleCall({query:{func:"cal:searchEventsNew",sid:u.getSid()},data:e},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function o(){var e=c.Deferred();return d.xhr.simpleCall({query:{func:"oab:searchEx",sid:u.getSid()},data:{dn:u.getConfig("user.orgid"),windowSize:500,conditions:[{field:"@type",operator:"=",operand:"R"}],returnAttrs:["true_name","email"]}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function l(e,t,n){var i=c.Deferred();return d.xhr.simpleCall({query:{func:"cal:getUserFreeBusyStatus",sid:u.getSid()},data:{user_id:e,m:!0,toweb:!0,fromdate:t,todate:n}},function(e){i.resolve(e)},function(){i.reject()}),i.promise()}var c=e("jquery"),d=e("../../util/index"),u=e("../common/globalService");return{replyMeetingRequest:t,addToMyCal:n,delFromMyCal:i,listCalFolder:a,listAccessedCalFolder:r,getMRList:o,getMRBookings:l,searchCalEvents:s}}),define("module/mail/read/service",["require","i18n!mail,mbox,main,error","jquery","../../../util/index","moment","../../common/globalService","../service","../../../util/common-controls","../../common/previewCtrl"],function(e){function t(e){var t=m.Deferred();return y.readMessage(e).then(function(e){t.resolve(s(e))},function(e){"FA_MAIL_NOT_FOUND"===e.code&&(e.message=g.i18n.t("error/FA_MAIL_NOT_FOUND")),t.reject(e)}),t.promise()}function n(e){var t=m.Deferred();return g.xhr.simpleCall({query:m.extend({func:"mbox:getMessageData",sid:_.getSid()},e)},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function i(e){var t=m.Deferred();return g.xhr.simpleCall({query:{func:"mbox:getThreadMessageInfos",sid:_.getSid()},data:{id:e.id,order:"date",detailLevel:3,summaryWindowSize:2147483647},onlyVar:!0},function(e){if(m.isArray(e)&&0===e.length)t.reject({code:"FA_MAIL_NOT_FOUND",message:g.i18n.t("error/FA_MAIL_NOT_FOUND")});else{var n=p(e);t.resolve(n)}},function(e,n,i){t.reject(i)}),t.promise()}function a(e){var t=m.Deferred();return g.xhr.simpleCall({query:{func:"mbox:decryptMessage",sid:_.getSid()},data:e},function(e){t.resolve(e)},function(e,n,i){switch(i=i||{},i.code){case"FA_MAIL_NOT_FOUND":i.message=g.i18n.t("error/FA_MAIL_NOT_FOUND");break;case"FA_EMPTY_PASSWORD":i.message=g.i18n.t("mbox/read_mail_err_password_empty");break;case"FA_INVALID_PASSWORD":i.message=g.i18n.t("mbox/read_mail_err_password_invalid")}t.reject(i)}),t.promise()}function r(e,t,n,i){e.trsAttachments=e.trsAttachments||[],i!==!0&&(e.attachments=l(t)||[],e.trsAttachments=l(n,!0)||[]),e.totalAttachs=e.attachments.length+e.trsAttachments.length,e.totalAttachs&&(e.firstAttach=e.attachments.concat(e.trsAttachments)[0]),e.bothTypeAttach=e.attachments.length>0&&e.trsAttachments.length>0}function s(e){var t=m.extend({},e);t.from=t.from||[],t.to=t.to||[],t.cc=t.cc||[],t.bcc=t.bcc||[],t.sender=e.headers&&m.isArray(e.headers.Sender)?e.headers.Sender[0]:"",t.isSenderMode=!e.delegatedSender&&""!==t.sender&&t.sender!==t.from&&null==t.sender.match(/@$/),t.isSenderMode&&(t.senderMessage=(y.isStranger(t.sender)?'<span class="icon-stranger"></span>':"")+g.i18n.t("mbox/mail_forwardBy").replace("{0}",t.sender)),e.encpwd&&(t.showEncpwd=g.i18n.t("mbox/read_mail_encpwd_tip").replace("{0}",e.encpwd)),r(t,e.attachments,e.trsAttachments),t.to.length>5&&(t.partto=u(t.to,5)),t.cc.length>5&&(t.partcc=u(t.cc,5)),t.bcc.length>5&&(t.partbcc=u(t.bcc,5)),t.rcpts=t.from.concat(t.to,t.cc),t.calendar&&(t.calendar=h(t.calendar)),o(t);var n=String.fromCharCode(24453)+String.fromCharCode(23457)+String.fromCharCode(26680);return 0===t.subject.indexOf(n)&&0===t.from[0].indexOf("postmaster@")&&(t.isAuditMail=!0),t}function o(e){var t,n,i=e.from[0];t="<p>"+e.sentDate+'<a href="mailto:"'+i+">"+i+"</a>"+g.i18n.t("mbox/reply_info_wrote")+'</p><blockquote name="replyContent" style="padding-left: 1ex; font-size:16px; font-family:\'SimSun,arial,Verdana,sans-serif\'; margin: 0 0 0 0.8ex;border-left: 1px solid #ccc;"><div>',n="\n\n"+i+g.i18n.t("mbox/reply_info_wrote")+"\n",e.quoteHTMLStart=t,e.quoteHTMLEnd="</div></blockquote>",e.quoteTextStart=n,e.quoteTextEnd="\n"}function l(e,t){var n,i,a,r,s,o=_.getSid();return e=e||[],t=t||!1,0===e.length?!1:(n=t?!0:_.getConfig("user.allowdownloadattachment"),i=t?!1:n,a=!t,r=t?!1:_.getConfig("user.supportnf"),s=t?!1:_.getConfig("file.xnfengines").length>0,m.each(e,function(e,l){l=m.extend(l,g.file.formatFile(l),{allowDownload:n,allowOpen:i,allowPreview:a&&c(l.filename,l.estimateSize||l.contentLength),allowSaveToNetFolder:r,allowSaveToExtFolder:s}),l.expiryTime&&(l.attachExpiryTime=d(l.expiryTime)),t?l.trsDownloadUrl=l.trsDownloadUrl||"../viewDownloadFile.jsp?sid="+o+"&key="+l.key+"&code="+l.code+"&locale="+b.locale():l.url="mbox/readdata.jsp?sid="+o+"&part="+l.id}),e)}function c(e,t){return w.checkFilePermit(e,t)}function d(e){var t,n,i;return e?(e=v(e),t=v(),n=e.diff(t,"days"),i=t.isAfter(e)?g.i18n.t("mbox/mail_expiry_a_2").replace("{0}",e.format("YYYY-MM-DD hh:mm")):0===n?g.i18n.t("mbox/mail_expiry_a_1").replace("{0}",e.format("hh:mm")):g.i18n.t("mbox/mail_expiry_a_0").replace("{0}",e.format("YYYY-MM-DD hh:mm"))):""}function u(e,t){var n,i;return e=e||[],t=t||5,n=e.length-t,n=n>0?n:0,i=n?g.i18n.t("mail/still_contacts").replace("{0}",n):"",{remain:n,stillContacts:i,contacts:e.slice(0,t)}}function p(e){for(var t,n,i,a=_.getUser(),r=0;r<e.length;r++)i=e[r],r==e.length-1&&(i.lastMessage=!0),t=g.Email.parseTrueName(i.from),n=g.Email.parseAddress(i.from),e[r].isFromCurUser=n==a.email,e[r].formatFrom={true_name:t,emailAddress:n};return e}function h(e){var t=e.meetingRequestStatus,n=e.meetingRequestMethod,i=e.meetingRequest,a=i?i.attendees:[],r={2:g.i18n.t("mail/op_tentative"),3:g.i18n.t("mail/op_accept"),4:g.i18n.t("mail/op_decline")};if(e.isExpired=!1,e.isMembers=e.isAttendee||e.isOrganizer,e.isMeetingRequest="request"===n,e.enableMeetingAction=e.isMeetingRequest&&e.isMembers&&!e.isOrganizer,"reply"===n&&(e.replyStatusDisplay=g.i18n.t("cal/event_status_"+t).replace("{0}",g.html.encode(e.meetingRequestAttendee))),e.isMeetingRequest&&e.isMembers&&!e.isOrganizer&&r[t]&&(e.participationDisplay=g.i18n.t("cal/event_participation_display").replace("{0}",r[t])),m.isArray(a)&&a.length>=6){i.partAttendees=[],i.stillAttendees=g.i18n.t("cal/msg_stillattendees").replace("{0}",a.length-5);for(var s=0,o=a.length;o>s;s++)5>s&&i.partAttendees.push(a[s])}return f(e),e}function f(e){v.locale("zh-cn",{meridiem:function(e,t){var n=100*e+t;return 1200>n?"":2400>n?"":void 0}}),v.locale(b.localeMM());var t,n=_.getConfig("setting.timezonevalues"),i=_.getConfig("setting.timezoneid"),a=e.meetingRequest||{},r=v(a.start),s=a.duration||0,o=a.allDayEvent||!1,l=a.recurrence||{},c=v(r.valueOf()+1e3*s),d=0===c.diff(r,"days"),u=[],p="";if(o&&s>0&&s%86400===0&&(c=v(r.valueOf()+1e3*s-1)),e.startDateYMD=r.format("YYYY-MM-DD"),o&&m.isEmptyObject(l)&&(e.allDayEventDate=s>86400?r.format("LL")+"-"+c.format("LL"):r.format("LL")+" "+r.format("dddd")),m.isEmptyObject(l))o?e.eventTime=g.i18n.t("cal/info_event_isallday"):d?e.eventTime=r.format("LLLL")+" - "+c.format("LT"):e.eventTime=r.format("LLLL")+" - "+c.format("LLLL");else{if(l.dayOfWeek)for(var h=0;7>h;h++)0!=(l.dayOfWeek&1<<h)&&u.push(g.i18n.t("cal/lb_day"+(h+1)+"_medium"));l.monthOfYear&&(p=p+" "+v.months(l.monthOfYear)),l.dayOfMonth&&(p=p+" "+l.dayOfMonth),l.weekOfMonth&&(p=l.weekOfMonth),p+=u.join(","),e.eventTime=r.format("LL ")+(l.until?" - "+v(l.until).format("LL "):"")+","+(g.i18n.t("mail/recurrence_type"+l.type)?g.i18n.t("mail/recurrence_type"+l.type):"")+(p||"")+(o?" "+g.i18n.t("cal/lb_all_day"):r.format("LT")+" - "+c.format("LT"))+(l.until||l.occurrences?"":" "+g.i18n.t("cal/info_event_recurrence_forever"))}e.timeZone=n[i],e.timeZone&&(t=e.timeZone.substring(0,e.timeZone.indexOf(")")+1),e.timeZone=""!=t?t.replace(":",""):"("+e.timeZone+")")}e("i18n!mail,mbox,main,error");var m=e("jquery"),g=e("../../../util/index"),v=e("moment"),_=e("../../common/globalService"),y=e("../service"),b=e("../../../util/common-controls"),w=e("../../common/previewCtrl");return{readMessage:t,getMessageData:n,getThreadMessageInfos:i,decryptMessage:a,formatMailAttachments:r}}),define("widget/datetime/datetime",["require","exports","module"],function(e,t,n){function i(e,t){var n,i,a,r="",s="";if(r=e,r=r.replace(/\s{2,}|^\s|\s$/g," "),r=r.replace(/[ \r\n]/g,""),"now"==r)return(new Date).getTime()/1e3;if(!isNaN(s=Date.parse(r)))return s/1e3;t=t?new Date(1e3*t):new Date,r=r.toLowerCase();var o={day:{sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},mon:{jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}},l=function(e){var n=e[2]&&"ago"==e[2],i=(i="last"==e[0]?-1:1)*(n?-1:1);switch(e[0]){case"last":case"next":switch(e[1].substring(0,3)){case"yea":t.setFullYear(t.getFullYear()+i);break;case"mon":t.setMonth(t.getMonth()+i);break;case"wee":t.setDate(t.getDate()+7*i);break;case"day":t.setDate(t.getDate()+i);break;case"hou":t.setHours(t.getHours()+i);break;case"min":t.setMinutes(t.getMinutes()+i);break;case"sec":t.setSeconds(t.getSeconds()+i);break;default:var a;if("undefined"!=typeof(a=o.day[e[1].substring(0,3)])){var r=a-t.getDay();0===r?r=7*i:r>0?"last"==e[0]&&(r-=7):"next"==e[0]&&(r+=7),t.setDate(t.getDate()+r)}}break;default:if(!/\d+/.test(e[0]))return!1;switch(i*=parseInt(e[0],10),e[1].substring(0,3)){case"yea":t.setFullYear(t.getFullYear()+i);break;case"mon":t.setMonth(t.getMonth()+i);break;case"wee":t.setDate(t.getDate()+7*i);break;case"day":t.setDate(t.getDate()+i);break;case"hou":t.setHours(t.getHours()+i);break;case"min":t.setMinutes(t.getMinutes()+i);break;case"sec":t.setSeconds(t.getSeconds()+i)}}return!0};if(i=r.match(/^(\d{2,4}-\d{2}-\d{2})(?:\s(\d{1,2}:\d{2}(:\d{2})?)?(?:\.(\d+))?)?$/)){i[2]?i[3]||(i[2]+=":00"):i[2]="00:00:00",a=i[1].split(/-/g);for(n in o.mon)o.mon[n]==a[1]-1&&(a[1]=n);return a[0]=parseInt(a[0],10),a[0]=a[0]>=0&&a[0]<=69?"20"+(a[0]<10?"0"+a[0]:a[0]+""):a[0]>=70&&a[0]<=99?"19"+a[0]:a[0]+"",parseInt(this.strtotime(a[2]+" "+a[1]+" "+a[0]+" "+i[2])+(i[4]?i[4]/1e3:""),10)}var c="([+-]?\\d+\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday)|(last|next)\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday))(\\sago)?";if(i=r.match(new RegExp(c,"gi")),!i)return!1;for(n=0;n<i.length;n++)if(!l(i[n].split(" ")))return!1;return t.getTime()/1e3}t.strtotime=i}),define("util/mimeparser",["require","cui/core/class/class","cui/core/events/events","datetime"],function(e){var t=e("cui/core/class/class"),n=e("cui/core/events/events"),i=e("datetime"),a={header:1,body:2,finished:3},r=t.create({Implements:n,initialize:function(e,t){this.options=t||{},this.plugin=e||null,this.mimeTree=this._createMimeNode(),this.mailData={},this._multipartTree=[],this._state=a.header,this._headersSent=!1,this._currentNode=this.mimeTree,this._currentNode.priority="normal",(!!this.plugin==!1||this.plugin.valid===!1)&&this.emit("end","Plugin load failed")},end:function(e){var t,n,i,r=e.split(/\r?\n|\r/);for(n=0,i=r.length;i>n;n++)t=r[n],!(this._state==a.header&&this._processStateHeader(t)===!0||this._state==a.body&&this._processStateBody(t)===!0);this._currentNode.content&&this._finalizeContents(),this._state=a.finished,this._processMimeTree()},_processMimeTree:function(){var e,t,n={};if(this.mailData={html:[],text:[],calendar:[],attachments:[]},this.mimeTree.meta.mimeMultipart?this._walkMimeTree(this.mimeTree):this._processMimeNode(this.mimeTree,0),this.mailData.html.length)for(e=0,t=this.mailData.html.length;t>e;e++)!n.html&&this.mailData.html[e].content?n.html=this.mailData.html[e].content:this.mailData.html[e].content&&(n.html=this._concatHTML(n.html,this.mailData.html[e].content));if(this.mailData.text.length)for(e=0,t=this.mailData.text.length;t>e;e++)!n.text&&this.mailData.text[e].content?n.text=this.mailData.text[e].content:this.mailData.text[e].content&&(n.text+=this.mailData.text[e].content);if(this.mailData.calendar.length)for(n.alternatives=[],e=0,t=this.mailData.calendar.length;t>e;e++)n.alternatives.push(this.mailData.calendar[e].content);if(n.headers=this.mimeTree.parsedHeaders,this.mimeTree.subject&&(n.subject=this.mimeTree.subject),this.mimeTree.references&&(n.references=this.mimeTree.references),this.mimeTree.messageId&&(n.messageId=this.mimeTree.messageId),this.mimeTree.inReplyTo&&(n.inReplyTo=this.mimeTree.inReplyTo),this.mimeTree.priority&&(n.priority=this.mimeTree.priority),this.mimeTree.from&&(n.from=this.mimeTree.from),this.mimeTree.replyTo&&(n.replyTo=this.mimeTree.replyTo),this.mimeTree.to&&(n.to=this.mimeTree.to),this.mimeTree.cc&&(n.cc=this.mimeTree.cc),this.mimeTree.bcc&&(n.bcc=this.mimeTree.bcc),this.mimeTree.meta.date&&(n.date=this.mimeTree.meta.date),this.mimeTree.meta.receivedDate&&(n.receivedDate=this.mimeTree.meta.receivedDate),this.mailData.attachments.length)for(n.attachments=[],e=0,t=this.mailData.attachments.length;t>e;e++)n.attachments.push(this.mailData.attachments[e].content);this.emit("end",n)},_processMimeNode:function(e,t,n){var i,a;if(t=t||0,e.attachment)e.meta=e.meta||{},e.content&&(e.meta.content=e.content),e.originalContent&&(e.meta.originalContent=e.originalContent),this.mailData.attachments.push({content:e.meta||{},level:t});else switch(e.meta.contentType){case"text/html":if("mixed"==n&&this.mailData.html.length)for(i=0,a=this.mailData.html.length;a>i;i++)if(this.mailData.html[i].level==t)return void this._joinHTMLNodes(this.mailData.html[i],e.content);return void this.mailData.html.push({content:this._updateHTMLCharset(e.content||""),level:t});case"text/plain":return void this.mailData.text.push({content:e.content||"",level:t});case"text/calendar":return e.content&&(e.meta.content=e.content),void this.mailData.calendar.push({content:e.meta||{},level:t})}},_createMimeNode:function(e){var t={parentNode:e||this._currentNode||null,headers:[],parsedHeaders:{},meta:{},childNodes:[]};return t},_processStateHeader:function(e){var t,n=this._currentNode.headers.length-1,i=!1;return e.length?void(e.match(/^\s+/)&&n>=0?this._currentNode.headers[n]+=" "+e.trim():(this._currentNode.headers.push(e.trim()),n>=0&&this._processHeaderLine(n))):(n>=0&&this._processHeaderLine(n),this._headersSent||(this.emit("headers",this._currentNode.parsedHeaders),this._headersSent=!0),this._state=a.body,n>=0&&this._processHeaderLine(n),this._currentNode.parentNode||this._currentNode.meta.contentType||(this._currentNode.meta.contentType="text/plain"),i=["text/plain","text/html","text/calendar"].indexOf(this._currentNode.meta.contentType||"")>=0,!i||this._currentNode.meta.contentDisposition&&"inline"!=this._currentNode.meta.contentDisposition?i&&!(["attachment","inline"].indexOf(this._currentNode.meta.contentDisposition)>=0)||this._currentNode.meta.mimeMultipart||(this._currentNode.attachment=!0):this._currentNode.attachment=!1,this._currentNode.attachment&&(t=this._currentNode.meta,this._currentNode.content=void 0),!0)},_processStateBody:function(e){var t,n,i,r=!1;if("--"==e.substr(0,2))for(t=0,n=this._multipartTree.length;n>t;t++){if(e=="--"+this._multipartTree[t].boundary){this._currentNode.content&&this._finalizeContents(),i=this._createMimeNode(this._multipartTree[t].node),this._multipartTree[t].node.childNodes.push(i),this._currentNode=i,this._state=a.header,r=!0;break}if(e=="--"+this._multipartTree[t].boundary+"--"){this._currentNode.content&&this._finalizeContents(),this._isEmptyObject(this._multipartTree[t].node.parentNode)?this._currentNode=this._multipartTree[t].node:this._currentNode=this._multipartTree[t].node.parentNode,this._state=a.body,r=!0;break}}return r?!0:(["text/plain","text/html","text/calendar"].indexOf(this._currentNode.meta.contentType||"")>=0&&!this._currentNode.attachment?this._handleTextLine(e):this._currentNode.attachment&&this._handleAttachmentLine(e),!1)},_processHeaderLine:function(e){var t,n,i,a;if(e=e||0,(a=this._currentNode.headers[e])&&"string"==typeof a){switch(i=a.split(":"),t=i.shift().toLowerCase().trim(),n=i.join(":").trim(),t){case"content-type":this._parseContentType(n);break;case"mime-version":this._currentNode.useMIME=!0;break;case"date":this._currentNode.meta.date=this._parseDateString(n);break;case"received":case"x-received":this._parseReceived(n);break;case"to":this._currentNode.to&&this._currentNode.to.length>0?this._currentNode.to=this._currentNode.to.concat(this.plugin.encode().decodeMailbox(n)):this._currentNode.to=this.plugin.encode().decodeMailbox(n);break;case"from":this._currentNode.from&&this._currentNode.from.length>0?this._currentNode.from=this._currentNode.from.concat(n):this._currentNode.from=this.plugin.encode().decodeMailbox(n);break;case"reply-to":this._currentNode.replyTo&&this._currentNode.replyTo.length>0?this._currentNode.replyTo=this._currentNode.replyTo.concat(this.plugin.encode().decodeMailbox(n)):this._currentNode.replyTo=this.plugin.encode().decodeMailbox(n);break;case"cc":this._currentNode.cc&&this._currentNode.cc.length>0?this._currentNode.cc=this._currentNode.cc.concat(this.plugin.encode().decodeMailbox(n)):this._currentNode.cc=this.plugin.encode().decodeMailbox(n);break;case"bcc":this._currentNode.bcc&&this._currentNode.bcc.length>0?this._currentNode.bcc=this._currentNode.bcc.concat(this.plugin.encode().decodeMailbox(n)):this._currentNode.bcc=this.plugin.encode().decodeMailbox(n);break;case"x-priority":case"x-msmail-priority":case"importance":n=this._parsePriority(n),this._currentNode.priority=n;break;case"message-id":this._currentNode.meta.messageId=this._trimQuotes(n),this._currentNode.messageId=this._currentNode.meta.messageId;break;case"references":this._parseReferences(n);break;case"in-reply-to":this._parseInReplyTo(n);break;case"thread-index":this._currentNode.meta.threadIndex=n;break;case"content-transfer-encoding":this._currentNode.meta.transferEncoding=n.toLowerCase();break;case"content-location":this._currentNode.meta.location=n.toLowerCase();break;case"subject":this._currentNode.subject=this._encodeString(n);break;case"content-disposition":this._parseContentDisposition(n);break;case"content-id":this._currentNode.meta.contentId=this._trimQuotes(n)}this._currentNode.parsedHeaders[t]?(Array.isArray(this._currentNode.parsedHeaders[t])||(this._currentNode.parsedHeaders[t]=[this._currentNode.parsedHeaders[t]]),this._currentNode.parsedHeaders[t].push(this._replaceMimeWords(n))):this._currentNode.parsedHeaders[t]=this._replaceMimeWords(n),this._currentNode.headers[e]={key:t,value:n}}},_parseContentType:function(e){var t;return e=this._parseHeaderLineWithParams(e),e&&(e.defaultValue?(e.defaultValue=e.defaultValue.toLowerCase(),this._currentNode.meta.contentType=e.defaultValue,"multipart/"==e.defaultValue.substr(0,"multipart/".length)&&(this._currentNode.meta.mimeMultipart=e.defaultValue.substr("multipart/".length))):this._currentNode.meta.contentType="application/octet-stream",e.charset&&(e.charset=e.charset.toLowerCase(),"win-"==e.charset.substr(0,4)?e.charset="windows-"+e.charset.substr(4):"ks_c_5601-1987"==e.charset?e.charset="cp949":e.charset.match(/^utf\d/)?e.charset="utf-"+e.charset.substr(3):e.charset.match(/^latin[\-_]?\d/)?e.charset="iso-8859-"+e.charset.replace(/\D/g,""):e.charset.match(/^(us\-)?ascii$/)?e.charset="utf-8":e.charset.match(/^ansi_x3\.4\-19/)&&(e.charset="utf-8"),this._currentNode.meta.charset=e.charset),e.format&&(this._currentNode.meta.textFormat=e.format.toLowerCase()),e.delsp&&(this._currentNode.meta.textDelSp=e.delsp.toLowerCase()),e.boundary&&(this._currentNode.meta.mimeBoundary=e.boundary),e.method&&(this._currentNode.meta.method=e.method),!this._currentNode.meta.fileName&&(t=this._detectFilename(e))&&(this._currentNode.meta.fileName=t),e.boundary&&(this._currentNode.meta.mimeBoundary=e.boundary,this._multipartTree.push({boundary:e.boundary,node:this._currentNode}))),e},_parseHeaderLineWithParams:function(e){var t,n,i={};n=e.match(/(?:[^;"]+|"[^"]*")+/g)||[e],i.defaultValue=n.shift().toLowerCase();for(var a=0,r=n.length;r>a;a++)e=n[a].split("="),t=e.shift().trim().toLowerCase(),e=e.join("=").trim(),e=this._trimQuotes(e),i[t]=e;return i},_trimQuotes:function(e){return e=(e||"").trim(),('"'==e.charAt(0)&&'"'==e.charAt(e.length-1)||"'"==e.charAt(0)&&"'"==e.charAt(e.length-1)||"<"==e.charAt(0)&&">"==e.charAt(e.length-1))&&(e=e.substr(1,e.length-2)),e},_replaceMimeWords:function(e){return e.replace(/(=\?[^?]+\?[QqBb]\?[^?]*\?=)\s+(?==\?[^?]+\?[QqBb]\?[^?]*\?=)/g,"$1").replace(/\=\?[^?]+\?[QqBb]\?[^?]*\?=/g,function(e){return this.plugin.encode().decodeSubject(e.replace(/\s/g,""))}.bind(this))},_parseDateString:function(e){var t;if(t=new Date(e),"[object Date]"!=Object.prototype.toString.call(t)||"Invalid Date"==t.toString()){try{t=i.strtotime(e)}catch(n){return!1}if(!t)return!1;t=new Date(1e3*t)}return t},_parseReceived:function(e){var t,n,i;return e?(i=e.split(";"),e=i[i.length-1],n=this._parseDateString(e),t=this._currentNode.meta.receivedDate,n?(t?n>t&&(this._currentNode.meta.receivedDate=n):this._currentNode.meta.receivedDate=n,n):(t||(this._currentNode.meta.receivedDate=n),n)):!1},_parsePriority:function(e){if(e=e.toLowerCase().trim(),!isNaN(parseInt(e,10)))return e=parseInt(e,10)||0,3==e?"normal":e>3?"low":"high";switch(e){case"non-urgent":case"low":return"low";case"urgent":case"hight":return"high"}return"normal"},_parseReferences:function(e){this._currentNode.references=(this._currentNode.references||[]).concat((e||"").toString().trim().split(/\s+/).map(this._trimQuotes.bind(this)))},_encodeString:function(e){return e=this._replaceMimeWords(this._convertStringToUTF8(e))},_convertStringToUTF8:function(e){return e=this._convertString(e,this._currentNode.meta.charset||this.options.defaultCharset||"iso-8859-1").toString("utf-8")},_parseContentDisposition:function(e){e=this._parseHeaderLineWithParams(e);var t="";if(e)if(e.defaultValue&&(this._currentNode.meta.contentDisposition=e.defaultValue.trim().toLowerCase()),e.filename)this._currentNode.meta.fileName=e.filename;else if(e["filename*0*"]){for(var n in e)-1!=n.indexOf("filename*")&&(t+=e[n]);this._currentNode.meta.fileName=decodeURIComponent(t.substring(7))}},_parseInReplyTo:function(e){this._currentNode.inReplyTo=(this._currentNode.inReplyTo||[]).concat((e||"").toString().trim().split(/\s+/).map(this._trimQuotes.bind(this)))},_handleTextLine:function(e){["quoted-printable","base64"].indexOf(this._currentNode.meta.transferEncoding)>=0||"flowed"!=this._currentNode.meta.textFormat?"string"!=typeof this._currentNode.content?this._currentNode.content=e:this._currentNode.content+="\n"+e:"string"!=typeof this._currentNode.content?this._currentNode.content=e:this._currentNode.content.match(/[ ]$/)?"flowed"==this._currentNode.meta.textFormat&&this._currentNode.content.match(/(^|\n)-- $/)?this._currentNode.content+="\n"+e:("yes"==this._currentNode.meta.textDelSp&&(this._currentNode.content=this._currentNode.content.replace(/[ ]+$/,"")),this._currentNode.content+=e):this._currentNode.content+="\n"+e},_handleAttachmentLine:function(e){this._currentNode.attachment&&"content"in this._currentNode&&("string"!=typeof this._currentNode.content?this._currentNode.content=e:this._currentNode.content+="\r\n"+e)},_finalizeContents:function(){if(this._currentNode.content)if(this._currentNode.attachment){if(this._currentNode.originalContent=this._currentNode.content,"quoted-printable"==this._currentNode.meta.transferEncoding){var e=this.plugin.encode().decodeQPToBin(this._currentNode.content);this._currentNode.content=this.plugin.encode().encodeCharsetFromBin(e,this._currentNode.meta.charset)}else"base64"==this._currentNode.meta.transferEncoding||"uuencode"==this._currentNode.meta.transferEncoding;this._currentNode.meta.length=this.plugin.encode().decodeBase64Length(this._currentNode.content)}else if(this._currentNode.meta.charset||("text/html"==this._currentNode.meta.contentType?this._currentNode.meta.charset=this._detectHTMLCharset(this._currentNode.content)||this.options.defaultCharset||"iso-8859-1":this._currentNode.meta.charset="iso-8859-1"),"quoted-printable"==this._currentNode.meta.transferEncoding){var e=this.plugin.encode().decodeQPToBin(this._currentNode.content);this._currentNode.content=this.plugin.encode().encodeCharsetFromBin(e,this._currentNode.meta.charset),"flowed"==this._currentNode.meta.textFormat&&("yes"==this._currentNode.meta.textDelSp?this._currentNode.content=this._currentNode.content.replace(/(^|\n)-- \n/g,"$1-- \x00").replace(/ \n/g,"").replace(/(^|\n)-- \u0000/g,"$1-- \n"):this._currentNode.content=this._currentNode.content.replace(/(^|\n)-- \n/g,"$1-- \x00").replace(/ \n/g," ").replace(/(^|\n)-- \u0000/g,"$1-- \n"))}else if("base64"==this._currentNode.meta.transferEncoding){var e=this.plugin.encode().decodeBase64ToBin(this._currentNode.content);this._currentNode.content=this.plugin.encode().encodeCharsetFromBin(e,this._currentNode.meta.charset)}else this._currentNode.content=this.plugin.encode().encodeCharsetFromBin(this._currentNode.content,this._currentNode.meta.charset)},_detectFilename:function(e){var t,n,i,a,r="",s=0;if(e.name)return this._replaceMimeWords(e.name);
if(e.filename)return this._replaceMimeWords(e.filename);if(e["name*"])r=e["name*"];else if(e["filename*"])r=e["filename*"];else if(e["name*0*"]||e["name*0"])for(;a=e["name*"+s+"*"]||e["name*"+s];)r+=a,s++;else if(e["filename*0*"]||e["filename*0"])for(;a=e["filename*"+s+"*"]||e["filename*"+s];)r+=a,s++;return r&&(t=r.split("'"),n=t.shift(),i=t.pop())?this._replaceMimeWords(this._replaceMimeWords("=?"+(n||"us-ascii")+"?Q?"+i.replace(/%/g,"=")+"?=")):""},_detectHTMLCharset:function(e){var t,n,i;return"string"!=typeof e&&(e=e.toString("ascii")),(i=e.match(/<meta\s+http-equiv=["']content-type["'][^>]*?>/i))&&(n=i[0]),n&&(t=n.match(/charset\s?=\s?([a-zA-Z\-_:0-9]*);?/),t&&(t=(t[1]||"").trim().toLowerCase())),!t&&(i=e.match(/<meta\s+charset=["']([^'"<\/]*?)["']/i))&&(t=(i[1]||"").trim().toLowerCase()),t},_joinHTMLNodes:function(e,t){var n=!1;t=(t||"").toString("utf-8").trim(),t=t.replace(/^\s*<\!doctype( [^>]*)?>/gi,""),t=t.replace(/<head( [^>]*)?>(.*)<\/head( [^>]*)?>/gi,"").replace(/<\/?html( [^>]*)?>/gi,"").trim(),t.replace(/<body(?: [^>]*)?>(.*)<\/body( [^>]*)?>/gi,function(e,n){t=n.trim()}),e.content=(e.content||"").toString("utf-8").trim(),e.content=e.content.replace(/<\/body( [^>]*)?>/i,function(e){return n=!0,"<br/>\n"+t+e}),n||(e.content+="<br/>\n"+t)},_updateHTMLCharset:function(e){return e=e.replace(/\n/g,"\x00").replace(/<meta[^>]*>/gi,function(e){return e.match(/http\-equiv\s*=\s*"?content\-type/i)?'<meta http-equiv="content-type" content="text/html; charset=utf-8" />':e.match(/\scharset\s*=\s*['"]?[\w\-]+["'\s>\/]/i)?'<meta charset="utf-8"/>':e}).replace(/\u0000/g,"\n")},_walkMimeTree:function(e,t){t=t||1;for(var n=0,i=e.childNodes.length;i>n;n++)this._processMimeNode(e.childNodes[n],t,e.meta.mimeMultipart),this._walkMimeTree(e.childNodes[n],t+1)},_concatHTML:function(e,t){var n="",i="";return e=(e||"").toString("utf-8"),(t=(t||"").toString("utf-8"))?e?(e.substr(0,1024).replace(/\r?\n/g,"\x00").match(/^[\s\u0000]*(<\!doctype\b[^>]*?>)?[\s\u0000]*<(html|head)\b[^>]*?>/i)?n=e:t.substr(0,1024).replace(/\r?\n/g,"\x00").match(/^[\s\u0000]*(<\!doctype\b[^>]*?>)?[\s\u0000]*<(html|head)\b[^>]*?>/i)&&(n=t),n&&n.replace(/\r?\n/g,"\x00").replace(/^[\s\u0000]*(<\!doctype\b[^>]*?>)?[\s\u0000]*<(html|head)\b[^>]*>.*?<\/(head)\b[^>]*>(.*?<body\b[^>]*>)?/i,function(e){var t=e.match(/^[\s\u0000]*(<\!doctype\b[^>]*?>)/i),n=e.match(/<html\b[^>]*?>/i),a=e.match(/<head\b[^>]*?>/i),r=e.match(/<body\b[^>]*?>/i);t=t&&t[1]&&t[1]+"\n"||"",n=n&&n[0]||"<head>",a=a&&a[0]||"<head>",r=r&&r[0]||"<body>",e=e.replace(/<[\!\/]?(doctype|html|head|body)\b[^>]*?>/gi,"\x00").replace(/\u0000+/g,"\n").trim(),i=t+n+"\n"+a+(e?e+"\n":"")+"</head>\n"+r+"\n"}),e=e.replace(/\r?\n/g,"\x00").replace(/[\s\u0000]*<head\b[^>]*>.*?<\/(head|body)\b[^>]*>/gi,"").replace(/[\s\u0000]*<[\!\/]?(doctype|html|body)\b[^>]*>[\s\u0000]*/gi,"").replace(/\u0000/g,"\n"),t=t.replace(/\r?\n/g,"\x00").replace(/[\s\u0000]*<head\b[^>]*>.*?<\/(head|body)\b[^>]*>/gi,"").replace(/[\s\u0000]*<[\!\/]?(doctype|html|body)\b[^>]*>[\s\u0000]*/gi,"").replace(/\u0000/g,"\n"),i+e+t+(i?(e||t?"\n":"")+"</body>\n</html>":"")):t:e},_convertString:function(e,t,n){return n=(n||"utf-8").toUpperCase(),t=(t||"utf-8").toUpperCase(),n==t?e:e=this.plugin.encode().encodeCharset(e,n,t)},_isEmptyObject:function(e){var t;for(t in e)return!1;return!0}});return r}),define("util/mimebuilder",["require","./email"],function(e){function t(e,t,n){this.nodeCounter=0,t=t||{},this.cmPlugin=n||null,this.baseBoundary=t.baseBoundary||Date.now().toString()+Math.random(),this.date=new Date,this.rootNode=t.rootNode||this,t.filename&&(this.filename=t.filename,e||(e=this.cmPlugin.mime().getContentTypeByExt(this.filename.split(".").pop()))),this.parentNode=t.parentNode,this._nodeId=++this.rootNode.nodeCounter,this._childNodes=[],this._headers=[],e&&this.setHeader("content-type",e)}var n=e("./email");return t.prototype.createChild=function(e,n){n||"object"!=typeof e||(n=e,e=void 0);var i=new t(e,n,this.cmPlugin);return this.appendChild(i),i},t.prototype.appendChild=function(e){return e.rootNode!==this.rootNode&&(e.rootNode=this.rootNode,e._nodeId=++this.rootNode.nodeCounter),e.parentNode=this,this._childNodes.push(e),e},t.prototype.remove=function(){if(!this.parentNode)return this;for(var e=this.parentNode._childNodes.length-1;e>=0;e--)if(this.parentNode._childNodes[e]===this)return this.parentNode._childNodes.splice(e,1),this.parentNode=void 0,this.rootNode=this,this},t.prototype.setHeader=function(e,t){var n,i=!1;if(!t&&e&&"object"==typeof e)return e.key&&e.value?this.setHeader(e.key,e.value):Array.isArray(e)?e.forEach(function(e){this.setHeader(e.key,e.value)}.bind(this)):Object.keys(e).forEach(function(t){this.setHeader(t,e[t])}.bind(this)),this;e=this._normalizeHeaderKey(e),n={key:e,value:t};for(var a=0,r=this._headers.length;r>a;a++)this._headers[a].key===e&&(i?(this._headers.splice(a,1),a--,r--):(this._headers[a]=n,i=!0));return i||this._headers.push(n),this},t.prototype.addHeader=function(e,t){return!t&&e&&"object"==typeof e?(e.key&&e.value?this.addHeader(e.key,e.value):Array.isArray(e)?e.forEach(function(e){this.addHeader(e.key,e.value)}.bind(this)):Object.keys(e).forEach(function(t){this.addHeader(t,e[t])}.bind(this)),this):(this._headers.push({key:this._normalizeHeaderKey(e),value:t}),this)},t.prototype.getHeader=function(e){e=this._normalizeHeaderKey(e);for(var t=0,n=this._headers.length;n>t;t++)if(this._headers[t].key===e)return this._headers[t].value},t.prototype.setContent=function(e,t){switch(t){case"base64":this.base64Content=e;break;case"plain":this.content=e}return this},t.prototype.build=function(){var e,t=[];if(this.content&&(e=(this.getHeader("Content-Transfer-Encoding")||"").toString().toLowerCase().trim(),e&&this.setHeader("Content-Transfer-Encoding",e)),this.filename&&!this.getHeader("Content-Disposition")&&this.setHeader("Content-Disposition","attachment"),this._headers.forEach(function(e){var n,i=e.key,a=e.value;switch(e.key){case"Content-Disposition":n=this._parseHeaderValue(a),this.filename&&(n.params.filename=this.filename),a=this._buildHeaderValue(n);break;case"Content-Type":if(n=this._parseHeaderValue(a),this._handleContentType(n),n.value.match(/pkcs7-mime$/))break;n.value.match(/^text\//)&&"string"==typeof this.content&&/[\u0080-\uFFFF]/.test(this.content)&&(n.params.charset="utf-8"),a=this._buildHeaderValue(n)}a=this._encodeHeaderValue(i,a),(a||"").toString().trim()&&t.push(this._foldLines(i+": "+a,76))}.bind(this)),this.rootNode===this&&(this.getHeader("Date")||t.push("Date: "+this.date.toUTCString().replace(/GMT/,"+0000")),this.getHeader("Message-Id")||t.push("Message-Id: <"+[0,0,0].reduce(function(e){return e+"-"+Math.floor(4294967296*(1+Math.random())).toString(16).substring(1)},Date.now())+"@"+(this.getEnvelope().from||"localhost").split("@").pop()+">"),this.getHeader("MIME-Version")||t.push("MIME-Version: 1.0")),t.push(""),this.base64Content&&t.push(this.base64Content),this.content){switch(e){case"base64":t.push(this._addSoftLinebreaks(this.cmPlugin.encode().encodeBase64(this.content)));break;default:/(\r?\n)$/.test(this.content)||(this.content=this.content+"\r\n"),t.push(this.content.replace(/\r?\n/g,"\r\n"))}this.multipart&&t.push("")}return this.multipart&&(this._childNodes.forEach(function(e){t.push("--"+this.boundary),t.push(e.build())}.bind(this)),t.push("--"+this.boundary+"--"),t.push("")),t.join("\r\n")},t.prototype.getEnvelope=function(){var e={from:!1,to:[]};return this._headers.forEach(function(t){var n=[];"From"===t.key||!e.from&&["Reply-To","Sender"].indexOf(t.key)>=0?(this._convertAddresses(this._parseAddresses(t.value),n),n.length&&n[0]&&(e.from=n[0])):["To","Cc","Bcc"].indexOf(t.key)>=0&&this._convertAddresses(this._parseAddresses(t.value),e.to)}.bind(this)),e},t.prototype._parseAddresses=function(e){return[].concat.apply([],[].concat(e).map(function(e){return n.parse(e)}))},t.prototype._normalizeHeaderKey=function(e){return(e||"").toString().replace(/\r?\n|\r/g," ").trim().toLowerCase().replace(/^MIME\b|^[a-z]|\-[a-z]/gi,function(e){return e.toUpperCase()})},t.prototype._buildHeaderValue=function(e){var t=[];return Object.keys(e.params||{}).forEach(function(n){"filename"===n?this._continuationEncode(n,e.params[n],50).forEach(function(e){t.push(e.key+"="+e.value)}):t.push(n+"="+this._escapeHeaderArgument(e.params[n]))}.bind(this)),e.value+(t.length?"; "+t.join("; "):"")},t.prototype._continuationEncode=function(e,t,n){var i,a,r=[],s=0,o=!1;if(n=n||50,/^[\w.\- ]*$/.test(t)){if(t.length<=n)return[{key:e,value:/[\s";=]/.test(t)?'"'+t+'"':t}];t=t.replace(new RegExp(".{"+n+"}","g"),function(e){return r.push({line:e}),""}),t&&r.push({line:t})}else{a="utf-8''",o=!0,s=0;for(var l=0,c=t.length;c>l;l++){if(i=t[l],o)i=encodeURIComponent(i);else if(i=" "===i?i:encodeURIComponent(i),i!==t[l]){if(!((encodeURIComponent(a)+i).length>=n)){o=!0,l=s,a="";continue}r.push({line:a,encoded:o}),a="",s=l-1}(a+i).length>=n?(r.push({line:a,encoded:o}),a=i=" "===t[l]?" ":encodeURIComponent(t[l]),i===t[l]?(o=!1,s=l-1):o=!0):a+=i}a&&r.push({line:a,encoded:o})}return r.map(function(t,n){return{key:e+"*"+n+(t.encoded?"*":""),value:/[\s";=]/.test(t.line)?'"'+t.line+'"':t.line}})},t.prototype._escapeHeaderArgument=function(e){return e.match(/[\s'"\\;\/=]|^\-/g)?'"'+e.replace(/(["\\])/g,"\\$1")+'"':e},t.prototype._handleContentType=function(e){this.contentType=e.value.trim().toLowerCase(),this.multipart=this.contentType.split("/").reduce(function(e,t){return"multipart"===e?t:!1}),this.multipart?this.boundary=e.params.boundary=e.params.boundary||this.boundary||this._generateBoundary():this.boundary=!1},t.prototype._generateBoundary=function(){return"----Coremail_Part_Boundary-?=_"+this._nodeId+"-"+this.rootNode.baseBoundary},t.prototype._encodeHeaderValue=function(e,t){switch(e=this._normalizeHeaderKey(e)){case"From":case"Sender":case"To":case"Cc":case"Bcc":case"Reply-To":return this._convertAddresses(this._parseAddresses(t));case"Message-Id":case"In-Reply-To":case"Content-Id":return t=(t||"").toString().replace(/\r?\n|\r/g," "),"<"!==t.charAt(0)&&(t="<"+t),">"!==t.charAt(t.length-1)&&(t+=">"),t;case"References":return t=[].concat.apply([],[].concat(t||"").map(function(e){return e=(e||"").toString().replace(/\r?\n|\r/g," ").trim(),e.replace(/<[^>]*>/g,function(e){return e.replace(/\s/g,"")}).split(/\s+/)})).map(function(e){return"<"!==e.charAt(0)&&(e="<"+e),">"!==e.charAt(e.length-1)&&(e+=">"),e}),t.join(" ").trim();case"Subject":return this.cmPlugin.encode().encodeSubject(t);default:return t=(t||"").toString().replace(/\r?\n|\r/g," ")}},t.prototype._convertAddresses=function(e,t){var n=[];return t=t||[],[].concat(e||[]).forEach(function(e){e.address&&(e.trueName?n.push(this.cmPlugin.encode().encodeMailbox(e.trueName+" <"+e.address+">")):n.push(this.cmPlugin.encode().encodeMailbox(e.address))),t.indexOf(e.address)<0&&t.push(e.address)}.bind(this)),n.join(", ")},t.prototype._parseHeaderValue=function(e){for(var t,n={value:!1,params:{}},i=!1,a="",r="value",s=!1,o=!1,l=0,c=e.length;c>l;l++)if(t=e.charAt(l),"key"===r){if("="===t){i=a.trim().toLowerCase(),r="value",a="";continue}a+=t}else{if(o)a+=t;else{if("\\"===t){o=!0;continue}s&&t===s?s=!1:s||'"'!==t?s||";"!==t?a+=t:(i===!1?n.value=a.trim():n.params[i]=a.trim(),r="key",a=""):s=t}o=!1}return"value"===r?i===!1?n.value=a.trim():n.params[i]=a.trim():a.trim()&&(n.params[a.trim().toLowerCase()]=""),Object.keys(n.params).forEach(function(e){var t,i,a,r;(a=e.match(/(\*(\d+)|\*(\d+)\*|\*)$/))&&(t=e.substr(0,a.index),i=Number(a[2]||a[3])||0,n.params[t]&&"object"==typeof n.params[t]||(n.params[t]={charset:!1,values:[]}),r=n.params[e],0===i&&"*"===a[0].substr(-1)&&(a=r.match(/^([^']*)'[^']*'(.*)$/))&&(n.params[t].charset=a[1]||"iso-8859-1",r=a[2]),n.params[t].values[i]=r,delete n.params[e])}),Object.keys(n.params).forEach(function(e){var t;n.params[e]&&Array.isArray(n.params[e].values)&&(t=n.params[e].values.map(function(e){return e||""}).join(""),n.params[e].charset?n.params[e]="=?"+n.params[e].charset+"?Q?"+t.replace(/[=\?_\s]/g,function(e){var t=e.charCodeAt(0).toString(16);return" "===e?"_":"%"+(t.length<2?"0":"")+t}).replace(/%/g,"=")+"?=":n.params[e]=t)}.bind(this)),n},t.prototype._foldLines=function(e,t,n){e=(e||"").toString(),t=t||76;for(var i,a,r=0,s=e.length,o="";s>r;){if(i=e.substr(r,t),i.length<t){o+=i;break}(a=i.match(/^[^\n\r]*(\r?\n|\r)/))?(i=a[0],o+=i,r+=i.length):((a=i.match(/(\s+)[^\s]*$/))&&a[0].length-(n?(a[1]||"").length:0)<i.length?i=i.substr(0,i.length-(a[0].length-(n?(a[1]||"").length:0))):(a=e.substr(r+i.length).match(/^[^\s]+(\s*)/))&&(i+=a[0].substr(0,a[0].length-(n?0:(a[1]||"").length))),o+=i,r+=i.length,s>r&&(o+="\r\n"))}return o},t.prototype._addSoftLinebreaks=function(e){var t=76,n=(e||"").toString().trim();return n.replace(new RegExp(".{"+t+"}","g"),"$&\r\n").trim()},t}),define("module/mail/smime",["require","i18n!mail","../../component/confirmbox","../../util/mimeparser","../../util/mimebuilder","i18n","../../util/size","jquery"],function(e){function t(e,t){try{new ActiveXObject("CAPICOM.Certificates"),new ActiveXObject("CAPICOM.EnvelopedData"),new ActiveXObject("CAPICOM.Certificate"),new ActiveXObject("CAPICOM.SignedData"),new ActiveXObject("CAPICOM.Signer"),new ActiveXObject("CAPICOM.Attribute")}catch(a){this.invaild=!0,n(c.t("mail/plugin_loadfailed"))}e.version?i(e.version,"4.0.5.0")>=0?this.cmPlugin=e:(this.invaild=!0,n(c.t("mail/plugin_version_error"),"/cab/cmplugin_setup.exe")):(this.invaild=!0,n(c.t("mail/cmplugin_loadfail"),"/cab/cmplugin_setup.exe")),t&&this.parseMail(t)}function n(e,t){s.confirm(e,u.noop(),u.noop(),{onConfirm:function(){this.hide(),t=t?t:window.location.href.replace(/index.jsp(.+)/,"jsp/pluginInstall.jsp"),window.open(t)},onCancel:function(){this.hide()},title:c.t("main/tip_title")})}function i(e,t){function n(e){return/^\d+$/.test(e)}function i(e){for(var t=0;t<e.length;++t)if(!n(e[t]))return!1;return!0}var a=e.split("."),r=t.split(".");if(!i(a)||!i(r))return NaN;for(var s=0;s<a.length;++s){if(r.length===s)return 1;if(a[s]!==r[s])return a[s]>r[s]?1:-1}return a.length!=r.length?-1:0}function a(e){for(var t=0,n=e.length,i="";n>t;t+=2){var a=parseInt(e.substr(t,2),16);a&&(i+=String.fromCharCode(a))}return i}function r(e){var t,n,i,a,r=e.length,s="";for(t=0;r>t;t++)for(i=unescape(encodeURIComponent(e.substr(t,1))),n=0;n<i.length;n++)a=i.charCodeAt(n).toString(16),s+=a.length>1?a:"0"+a;return s}e("i18n!mail");var s=e("../../component/confirmbox"),o=e("../../util/mimeparser"),l=e("../../util/mimebuilder"),c=e("i18n"),d=e("../../util/size"),u=e("jquery"),p=0,h=2,f=1,m=6,g=9,v=0,_=0,y=0,b=2,w=0,M=-2138568446,T=6;return t.prototype.parseMail=function(e){var t=new o(this.cmPlugin),n=this;t.on("end",function(e){var t=e.headers["content-type"];if(n.signed=t.indexOf("signed-data")>-1,n.encrypted=t.indexOf("enveloped-data")>-1,n.attachments=[],!e.text&&e.attachments&&"smime.p7m"==e.attachments[0].fileName){var i=e.attachments[0];n.mailContent=i.originalContent,n.attachments.push({id:0,fileName:i.fileName,base64:i.content,fileType:i.fileName.split(".").pop()})}else n.mailContent=e.text||"",e.attachments&&u.each(e.attachments,function(e,t){n.attachments.push({id:e,fileName:t.fileName,base64:t.content,fileType:t.fileName.split(".").pop(),size:d.bytesToSize(t.length),length:t.length})})},null),t.end(e)},t.prototype.setBaseMailInfo=function(e,t){var n,i,a=new l(null,null,this.cmPlugin);if(this.rootNodeHeaders={from:e.account,to:e.to,cc:e.cc,bcc:e.bcc,subject:e.subject,"Content-Transfer-Encoding":"base64"},a.addHeader(this.rootNodeHeaders,null),t.length>0)for(a.setHeader("Content-Type","multipart/mixed"),n=new l("text/plain",null,this.cmPlugin),n.addHeader({"Content-Transfer-Encoding":"8bit"},null).setContent(e.content,"plain"),a.appendChild(n),i=0;i<t.length;i++)n=new l(null,{filename:t[i].fileName},this.cmPlugin),n.addHeader({"Content-Transfer-Encoding":"base64","Content-Disposition":"attachment"},null).setContent(t[i].base64,"base64"),a.appendChild(n);else a.setHeader({"Content-Transfer-Encoding":"8bit"},null),a.setContent(e.content,"plain").setHeader("Content-Type","text/plain");this.prevMimeNode=a},t.prototype.encryptMail=function(e,t,n){var i,a,o,d,u,p=new ActiveXObject("CAPICOM.EnvelopedData"),h=new ActiveXObject("CAPICOM.Utilities"),f="application/pkcs7-mime; smime-type='enveloped-data'; name='smime.p7m'";try{for(i in t)t.hasOwnProperty(i)&&(d=new ActiveXObject("CAPICOM.Certificate"),d.Import(t[i]),p.Recipients.Add(d));return d=new ActiveXObject("CAPICOM.Certificate"),d.Import(e.Export()),p.Recipients.Add(d),a=n?this.mimeNode.build():this.prevMimeNode.build(),u=r(a),p.Content=h.HexToBinary(u),o=p.Encrypt(w),this.mimeNode=new l(f,{filename:"smime.p7m"},this.cmPlugin),this.mimeNode.setContent(o,"base64").setHeader(this.rootNodeHeaders),!0}catch(m){return s.alert(c.t("mail/msg_get_receiver_cert_fail")),!1}},t.prototype.decryptMail=function(){if(this.encrypted)try{var e,t=this.mailContent,n=new ActiveXObject("CAPICOM.EnvelopedData"),i=new ActiveXObject("CAPICOM.utilities");return n.Decrypt(t),e=i.BinaryToHex(n.Content),t=a(e),this.parseMail(t),!0}catch(r){return s.alert(c.t("mail/ERRSTR_OPEN_CERT_STORE_ABORTING")+r.description),!1}return!1},t.prototype.signMail=function(e){var t,n,i,a=new ActiveXObject("CAPICOM.Signer"),s=new ActiveXObject("CAPICOM.SignedData"),o=new ActiveXObject("CAPICOM.Utilities"),c=new ActiveXObject("CAPICOM.Attribute"),d=new Date,u=!1,p="application/pkcs7-mime; smime-type='signed-data'; name='smime.p7m'";try{return a.Certificate=e,c.Name=_,c.Value=d.getVarDate(),a.AuthenticatedAttributes.Add(c),t=this.prevMimeNode.build(),i=r(t),s.Content=o.HexToBinary(i),n=s.Sign(a,u,w),this.mimeNode=new l(p,{filename:"smime.p7m"},this.cmPlugin),this.mimeNode.setContent(n,"base64").setHeader(this.rootNodeHeaders),!0}catch(h){return!1}},t.prototype.checkSign=function(){var e,t,n=new ActiveXObject("CAPICOM.SignedData"),i=new ActiveXObject("CAPICOM.Utilities"),r=this.mailContent;try{return n.Verify(r,!1,v),t=i.BinaryToHex(n.Content),r=a(t),this.parseMail(r),e=n.Signers.Item(1).Certificate,{name:e.GetInfo(y),email:e.GetInfo(b)}}catch(s){return!1}},t.prototype.initCertificate=function(e){var t=new ActiveXObject("CAPICOM.Store"),n=new ActiveXObject("CAPICOM.Certificates");try{if(t.Open(h,"My",p),n=t.Certificates.Find(g).Find(m,T),null!=e&&""!=e){var i,a,r,o=new ActiveXObject("CAPICOM.Certificates");for(i=e.split(","),a=0;a<i.length;++a){var l=n.Find(f,i[a]);for(r=1;r<=l.Count;++r)o.Add(l.Item(r))}n=o}if(n.Count>1&&(n=n.Select(void 0,void 0,!1)),0==n.Count)return s.alert(c.t("mail/msg_filter_cert_fail")),!1}catch(d){if(d.number!=M)return s.alert(c.t("mail/ERRSTR_OPEN_CERT_STORE_ABORTING")+d.description),!1}return n.item(1)},t.prototype.dealWithAddResult=function(e,t){for(var n,i=this.cmPlugin.upload(),a=i.browser({single:!1}),r=[].concat(e),s=function(e){var t=0;return u.each(e,function(e,n){t+=n.length}),t},o=0;o<a.length;o++){if(n=i.item(a[o]),s(r)+parseInt(n.size_str)>t)return alert(c.t("mail/FA_OVERFLOW.pref_smtp_max_send_mail_size")),e;r.push({id:r.length,fileName:n.name.replace(/^.*[\\\/]/,""),size:d.bytesToSize(n.size_str),length:parseInt(n.size_str),base64:n.base64ln(76),fileType:n.name.split(".").pop()})}return r},t}),function(e,t){"function"==typeof define&&define.amd?define("components/css-element-queries/src/ResizeSensor",t):"object"==typeof exports?module.exports=t():e.ResizeSensor=t()}("undefined"!=typeof window?window:this,function(){function e(e,t){var n=Object.prototype.toString.call(e),i="[object Array]"===n||"[object NodeList]"===n||"[object HTMLCollection]"===n||"[object Object]"===n||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements,a=0,r=e.length;if(i)for(;r>a;a++)t(e[a]);else t(e)}function t(e){if(!e.getBoundingClientRect)return{width:e.offsetWidth,height:e.offsetHeight};var t=e.getBoundingClientRect();return{width:Math.round(t.width),height:Math.round(t.height)}}if("undefined"==typeof window)return null;var n=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)},i=function(a,r){function s(){var e=[];this.add=function(t){e.push(t)};var t,n;this.call=function(){for(t=0,n=e.length;n>t;t++)e[t].call()},this.remove=function(i){var a=[];for(t=0,n=e.length;n>t;t++)e[t]!==i&&a.push(e[t]);e=a},this.length=function(){return e.length}}function o(e,i){if(e){if(e.resizedAttached)return void e.resizedAttached.add(i);e.resizedAttached=new s,e.resizedAttached.add(i),e.resizeSensor=document.createElement("div"),e.resizeSensor.dir="ltr",e.resizeSensor.className="resize-sensor";var a="position: absolute; left: -10px; top: -10px; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",r="position: absolute; left: 0; top: 0; transition: 0s;";e.resizeSensor.style.cssText=a,e.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+a+'"><div style="'+r+'"></div></div><div class="resize-sensor-shrink" style="'+a+'"><div style="'+r+' width: 200%; height: 200%"></div></div>',e.appendChild(e.resizeSensor),e.resizeSensor.offsetParent!==e&&(e.style.position="relative");var o,l,c,d,u=e.resizeSensor.childNodes[0],p=u.childNodes[0],h=e.resizeSensor.childNodes[1],f=t(e),m=f.width,g=f.height,v=function(){p.style.width="100000px",p.style.height="100000px",u.scrollLeft=1e5,u.scrollTop=1e5,h.scrollLeft=1e5,h.scrollTop=1e5},_=function(){l=0,o&&(m=c,g=d,e.resizedAttached&&e.resizedAttached.call())},y=function(){var i=t(e),a=i.width,r=i.height;o=a!=m||r!=g,o&&!l&&(l=n(_)),v()},b=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};b(u,"scroll",y),b(h,"scroll",y),n(v)}}e(a,function(e){o(e,r)}),this.detach=function(e){i.detach(a,e)}};return i.detach=function(t,n){e(t,function(e){e&&(e.resizedAttached&&"function"==typeof n&&(e.resizedAttached.remove(n),e.resizedAttached.length())||e.resizeSensor&&(e.contains(e.resizeSensor)&&e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached))})},i}),define("components/requirejs-text/text!module/../../template/module/mail/readbase.tpl.html",[],function(){return'<div>\n  <!--CA// -->\n  <!--TODO CA-->\n  <script id="attachListTpl" type="text/x-handlebars-template">\n    {{#unless smimeAttachs}}\n      <div class="attach-content">\n        <!---->\n        {{#if attachments}}\n          <div class="attach-content-header">\n            <span class="f-fwb">{{i18n "mbox/mail_normalatt"}}({{attachments.length}} {{i18n "mail/attachments_number"}})</span>\n            <span class="attachments-op">\n              {{#compare attachments.length \'>\' 1}}\n                {{#if attachments.0.allowDownload}}\n                  <a href="../common/mbox/packMessage.jsp?sid={{sid}}{{#each attachments}}&part={{id}}{{/each}}&mid={{mid}}&mboxa={{mboxa}}">{{i18n "mbox/pack_mail"}}</a>\n                {{/if}}\n                {{#if attachments.0.allowSaveToNetFolder}}\n                  <a class="j-saveToNetFolder" href="javascript:void(0)" data-mid="{{mid}}" data-id="{{#each attachments}}&{{id}}{{/each}}">{{i18n "mbox/add_to_netfolder"}}</a>\n                {{/if}}\n              {{/compare}}\n              {{#if readOnlyTip}}<span class="read_only_attach">{{readOnlyTip}}</span>{{/if}}\n            </span>\n          </div>\n          <div class="attachment-main">\n            {{#each attachments}}\n              <div class="attachment j-attachment" attach-type="attachments" attach-index="{{@index}}">\n                {{{formatAttachment this}}}\n              </div>\n            {{/each}}\n          </div>\n        {{/if}}\n\n        <!---->\n        {{#if trsAttachments}}\n          <div class="attach-content-header trs-attach-content-header">\n            <span class="f-fwb">{{i18n "mbox/mail_largeatt"}}({{trsAttachments.length}} {{i18n "mail/attachments_number"}})</span>\n          </div>\n          <div class="attachment-main">\n            {{#each trsAttachments}}\n              <div class="trs-attachment j-attachment" attach-type="trsAttachments" attach-index=\'{{@index}}\'>\n                {{{formatAttachment this}}}\n              </div>\n            {{/each}}\n          </div>\n        {{/if}}\n      </div>\n    {{/unless}}\n  </script>\n\n  <!---->\n  <script id="attachmentTpl" type="text/x-handlebars-template">\n    <div class="attach-type">\n      <span class="file-icon icon-{{fileType}}"></span>\n    </div>\n    <div class="attach-info not-actions j-attach-info">\n      <div class="attach-name" title="{{filename}}">{{filename}}</div>\n      {{#if formatSize}}\n        <div class="attach-size">({{formatSize}})</div>\n      {{/if}}\n      {{#if attachExpiryTime}}\n        <div class="attach-expiration-time">({{attachExpiryTime}})</div>\n      {{/if}}\n      <div class="attach-actions j-attach-actions"></div>\n    </div>\n  </script>\n\n  <!--CA// -->\n  <script id="attachActionTpl" type="text/x-handlebars-template">\n    <ul class="action-list">\n      {{#if allowDownload}}\n        <li class="action-item">\n          <a href="{{downloadUrl}}" target="_blank" {{#if caDecrypted}}data-action="decryptedDownload" data-id="{{id}}"{{/if}}>{{i18n "common/op_download"}}</a>\n        </li>\n      {{/if}}\n\n      {{#if allowOpen}}\n        <li class="action-item">\n          <a href="{{openUrl}}" target="_blank">{{i18n "common/op_open"}}</a>\n        </li>\n      {{/if}}\n\n      {{#if isImageType}}\n        <li class="j-preview-gallery action-item" data-mid="{{mid}}" data-id="{{id}}" data-filename="{{filename}}">\n          <a href="javascript:void(0)">{{i18n "common/op_preview"}}</a>\n        </li>\n      {{else}}\n        {{#if allowPreview}}\n          <li class="action-item" data-id="{{id}}" data-filename="{{filename}}">\n            <a href="{{previewUrl}}" class="{{#if exceedTypeSizeLimit}}j-over-limit{{/if}}" target="_blank"\n               data-limitsize="{{typeSizeLimit}}">{{i18n "common/op_preview"}}</a>\n          </li>\n        {{/if}}\n      {{/if}}\n\n      {{#if allowSaveToNetFolder}}\n        <li class="j-saveToNetFolder action-item" data-mid="{{mid}}" data-id="{{id}}">\n          <a href="javascript:void(0)">{{i18n "common/op_to_netfolder"}}</a>\n        </li>\n      {{/if}}\n\n      {{#if allowSaveToExtFolder}}\n        <li class="j-saveToExtFolder action-item" data-mid="{{mid}}" data-id="{{id}}" data-filename="{{filename}}">\n          <a href="javascript:void(0)">{{replaceDefer engineName "common/op_to_xnffolder"}}</a>\n        </li>\n      {{/if}}\n    </ul>\n  </script>\n\n  <script id="attachHeadTpl" type="text/x-handlebars-template">\n    <td class="info-item">{{i18n \'mbox/mail_attached\'}} :</td>\n    <td>\n      <b>{{totalAttachs}}</b> {{i18n \'mail/attachments_number\'}}(\n      <span class="file-small-icon icon-small-{{firstAttach.fileType}}"></span>\n      <span class="file-name f-ellipsis" title="{{firstAttach.filename}}">\n          {{firstAttach.filename}}\n          {{#compare totalAttachs \'>=\' 2}}{{i18n \'mbox/andsoon\'}}{{/compare}}\n        </span> )\n      <a class="view-attach-btn j-view-attach disabled" title="{{i18n \'mbox/mail_viewatta\'}}" href="javascript:void(0)">\n        {{i18n \'mbox/mail_viewatta\'}}\n      </a>\n    </td>\n  </script>\n\n  <script id="backTopTpl" type="text/x-handlebars-template">\n    <div class="j-back-top mail-back-top f-dn" data-isThread="{{isThread}}"><span class="iconfont iconcollapse"></span></div>\n  </script>\n</div>'}),define("module/mail/readbase",["require","./service","../../util/index","cui/core/view/view","cui/util/templatable/templatable","text!../../../template/module/mail/readbase.tpl.html","util/url","module/common/globalService"],function(e){var t=e("./service"),n=e("../../util/index"),i=e("cui/core/view/view"),a=e("cui/util/templatable/templatable"),r=$(e("text!../../../template/module/mail/readbase.tpl.html")),s=e("util/url").addUrlParams,o=e("module/common/globalService");return i.extend({Implements:a,state:{},initState:function(){},events:{"click .j-back-top":"_handleBackTop"},$readBaseTpl:r,_initAttach:function(e){function t(e){var t=e.attr("attach-type"),n=a[e.attr("attach-type")]||a.attachments,r=n[e.attr("attach-index")],l=a.mid;r.mid=l;var d={allowDownload:!1,allowOpen:!1,isImageType:!1,allowPreview:!1,allowSaveToNetFolder:!1,allowSaveToExtFolder:!1};if(r.allowOpen=function(){var e,t=r.filename?r.filename.lastIndexOf("."):-1;return 0>t?e=!1:(e=r.filename.substring(t+1,r.filename.length).toLowerCase(),-1!=e.indexOf("htm")&&(e="html")),e!==!1&&c?c.indexOf(e)>-1:i.config.enableAllowOpenAttachment}(),i.Smime)$.extend(r,d,{allowDownload:!0,downloadUrl:"javascript:void(0)",caDecrypted:!0});else if("attachments"===t){var u=r.url,p={mboxa:a.mboxa||"",mid:l};r.downloadUrl=s(u,$.extend({mode:"download"},p)),r.isMsg?r.openUrl=s(o.getDetachBaseURL()+"#mail.read",$.extend({fid:i.state.param.fid,part:r.id},p)):r.openUrl=s(u,p),r.previewUrl=s(u,$.extend({mode:"preview"},p));var h=a.mailCipherPassword;h&&["downloadUrl","openUrl","previewUrl"].forEach(function(e){r[e]=s(r[e],{mailCipherPassword:h})})}else"trsAttachments"===t&&(r.downloadUrl=r.trsDownloadUrl,r.isImageType=!1,r.allowOpen=!1);a.mailCipherEncrypted&&(r.allowPreview=!1),i.config.enablePreview||(r.allowPreview=!1,r.isImageType=!1),r.allowSaveToExtFolder&&(r.engineName=(o.getConfig("file.xnfengines")[0]||{}).engineName);var f=i.compile(i.$readBaseTpl.find("#attachActionTpl").html(),r),m=e.find(".j-attach-actions");m.html(f),$.each(d,function(t){return r[t]===!0?(e.find(".j-attach-info").removeClass("not-actions"),!1):void 0})}var i=this,a=e?this._getCurMailInfo(e):this._params.mail,r=e?this.$('.j-mail-info[data-mid="'+e+'"]'):this.element;r.find(".j-long-info").html(i.compile(i.$readBaseTpl.find("#attachHeadTpl").html(),a)),r.find(".j-attach-desc").html(a.totalAttachs),r.find(".j-attach-wrap")[a.totalAttachs?"show":"hide"]();var l=r.find(".j-mail-attachments-wrap");if(a.smimeAttachs||!a.totalAttachs)return l.empty(),!1;var c=i.config.enableOpenFileType,d=c?n.i18n.t("mail/attachments_open_type_limit_tip",{type:c}):"",u=i.compile(i.$readBaseTpl.find("#attachListTpl").html(),$.extend({readOnlyTip:d},a)),p=$("<div/>").html(u);p.find(".j-attachment").each(function(e,n){t($(n))}),l.html(p.html())},_initBackTop:function(e){var t=this,n=e?t.$(".thread-list"):t.$(".j-main"),i=t.compile(t.$readBaseTpl.find("#backTopTpl").html(),{isThread:e});n.append(i),e&&t._handleShowBackTop(n)},_handleShowBackTop:function(e){var t=this;e.scroll(function(e){t.$(".j-back-top").toggleClass("f-dn",$(e.target).scrollTop()<500)})},_handleBackTop:function(e){var t=$(e.target).attr("data-isThread")||$(e.target).parent(".j-back-top").attr("data-isThread"),n=t?this.$(".thread-list"):this.$(".j-mail-content").contents().find("html,body");n.animate({scrollTop:0},200)},templateHelpers:{formatAttachment:function(e){return a.compile(r.find("#attachmentTpl").html(),e)},strangerIconHtml:function(e){return t.isStranger(e)?'<span class="icon-stranger"></span>':""},encodeUriComponent:function(e){return encodeURIComponent(e)},replaceDefer:function(e,t){return n.i18n.t(t).replace("{0}",e)},translateSL:function(e){var t=n.securityLevel.i18n(e);return t?"["+t+"]":""}}})}),define("components/requirejs-text/text!template/module/mail/read.tpl.html",[],function(){return'<section class="m-read j-mail-read">\r\n    <div class="toolbar f-cf j-toolbar"></div>\r\n    <div class="j-module-content"></div>\r\n    {{#raw}}\r\n    <!--  -->\r\n    <script id="toolbartpl" type="text/x-handlebars-template">\r\n        <div id="pagination" class="f-fr"></div>\r\n        [[#if recallMail.enableRecallMail]]\r\n        <span class="u-btn u-btn-default [[#if recallMail.disabledRecall]]disabled[[/if]]" data-btn="recall">[[recallMail.message]]</span>\r\n        [[/if]]\r\n\r\n        [[#if autoDelMail]]\r\n            [[#if autoDelMailIsExpiry]]\r\n             <span class="u-btn u-btn-default disabled">[[i18n "mbox/bt_overdue"]]</span>\r\n            [[else]]\r\n            <span class="u-btn u-btn-default" data-btn="destroy">[[i18n "mbox/autoDel_sysDialog_title"]]</span>\r\n            [[/if]]\r\n        [[/if]]\r\n\r\n        <!---->\r\n        [[#if config.supportSMIME]]\r\n            [[#if sMimeServerEncrypted]]\r\n            <span class="u-btn u-btn-default" [[#if isDecodeMail]]disabled[[/if]] data-btn="decryptServerEncrypted">[[i18n "mbox/bt_decode_mail"]]</span>\r\n            [[/if]]\r\n\r\n            [[#if sMimeClientEncrypted]]\r\n            <span class="u-btn u-btn-default j-ca-decrypt" data-btn="decryptClientEncrypted" [[#unless isIE]]disabled[[/unless]] [[#if isDecodeMail]]disabled [[/if]]>[[i18n "mbox/bt_decode_mail"]]</span>\r\n            [[/if]]\r\n        [[/if]]\r\n\r\n        [[#if config.enableReply]]\r\n        <div class="u-btns">\r\n            [[#and config.enableReplyWithAttachments hasAttachment]]\r\n            <span class="u-btn u-btn-default" data-dropdown="reply">[[i18n "common/op_reply"]]<span class="iconfont icondown"></span></span>\r\n            <span class="u-btn u-btn-default" data-dropdown="reply-all">[[i18n "common/op_replyall"]] <span class="iconfont icondown"></span></span>\r\n            [[else]]\r\n            <span class="u-btn u-btn-default" [[#compare isDecodeMail \'==\' false]]disabled[[/compare]] data-btn="reply">[[i18n "common/op_reply"]]</span>\r\n            <span class="u-btn u-btn-default" [[#compare isDecodeMail \'==\' false]]disabled[[/compare]] data-btn="replyall">[[i18n "common/op_replyall"]]</span>\r\n            [[/and]]\r\n        </div>\r\n        [[/if]]\r\n        [[#if config.enableForward]]\r\n        <span class="u-btn u-btn-default" [[#compare isDecodeMail \'==\' false]]disabled[[/compare]] data-btn="forward">[[i18n "common/op_forward"]]</span>\r\n        [[/if]]\r\n        <div class="u-btns">\r\n            [[#if config.enableUpdateMailStatus]]\r\n            [[#if config.enableMoveTo]]\r\n                <span class="u-btn u-btn-default" data-dropdown="move">[[i18n "common/op_move"]] <span class="iconfont icondown"></span></span>\r\n            [[/if]]\r\n            <span class="u-btn u-btn-default" data-dropdown="mark">[[i18n "common/op_mark"]] <span class="iconfont icondown"></span></span>\r\n            [[/if]]\r\n            <span class="u-btn u-btn-default" data-dropdown="read-more">[[i18n "common/op_more"]] <span class="iconfont icondown"></span></span>\r\n        </div>\r\n        [[#if config.enableDelete]] <span class="u-btn u-btn-default" data-btn="delete">[[i18n "common/op_delete"]]</span>  [[/if]]\r\n        [[#unless config.isCollectFolder]]<span class="u-btn u-btn-default j-collect">[[i18n "common/op_collect"]]</span>  [[/unless]]\r\n    </script>\r\n\r\n    <!--  -->\r\n    <script id="directforwardtpl" type="text/x-handlebars-template">\r\n      <div class="u-alert u-alert-warning u-alert-dismissible j-forward">\r\n        <span class="close iconfont icondelword" data-action="close"></span>\r\n        <span>[[i18n "mail/msg_direct_forward" from=from time=time]]</span>\r\n      </div>\r\n    </script>\r\n\r\n    <!--  -->\r\n    <script id="schedulesendtpl" type="text/x-handlebars-template">\r\n        <div class="u-alert u-alert-warning u-alert-dismissible j-schedule">\r\n            <span class="close iconfont icondelword" data-action="closeSchedule"></span>\r\n            <span>[[i18n "mail/msg_schedule_send" from=from time=time]]</span>\r\n        </div>\r\n    </script>\r\n\r\n    <!--  -->\r\n    <script id="readreceipttpl" type="text/x-handlebars-template">\r\n        <div class="u-alert u-alert-warning u-alert-dismissible j-read-receipt">\r\n            <span class="close iconfont icondelword" data-action="close"></span>\r\n            <span>[[i18n "mbox/need_read_receipt"]]</span>\r\n            <label>[[i18n "mbox/need_read_receipt_auto"]] <input type="checkbox" id="receiptAlways" name="receiptAlways"></label>\r\n            <a class="j-receipt link" data-action="send" href="javascript:void(0);">[[i18n "mbox/need_read_receipt_yes"]]</a>\r\n            <a class="j-receipt link" data-action="cancel" href="javascript:void(0);">[[i18n "mbox/need_read_receipt_no"]]</a>\r\n        </div>\r\n    </script>\r\n\r\n    <script id="sspurltpl" type="text/x-handlebars-template">\r\n      <div class="u-alert u-alert-warning u-alert-dismissible j-sspurl">\r\n        <span class="close iconfont icondelword" data-action="close"></span>\r\n        <span>[[[i18n "mbox/sspurl_message_tips"]]]</span>\r\n        <a class="link" data-action="original" href="javascript:void(0)">[[i18n "mbox/sspurl_message_original"]]</a>\r\n        [[#unless isJunk]]\r\n          <a class="link" data-action="spam" href="javascript:void(0)">[[i18n "mbox/sspurl_message_spam"]]</a>\r\n        [[/unless]]\r\n        [[#unless isTrash]]\r\n          <a class="link" data-action="delete" href="javascript:void(0)"> [[i18n "common/op_delete"]]</a>\r\n        [[/unless]]\r\n      </div>\r\n    </script>\r\n\r\n    <!--  -->\r\n    <script id="maintpl" type="text/x-handlebars-template">\r\n        <div class="j-main mail [[#if flags.webReadOnly]]webReadOnly[[/if]]">\r\n            <div class="mail-frame">\r\n                <div class="j-read-alert f-pr"></div>\r\n\r\n                <div class="mail-top j-mail-top f-pr">\r\n                    <div class="top-bar">\r\n                        <div class="f-tar">\r\n                            [[#unless isNestedMsg]]\r\n                            [[#if config.enableMailFlagged]]\r\n                            [[#if config.enableUpdateMailStatus]]\r\n                            <span class="mail-flagged f-pr f-csp" data-dropdown="flag-color">\r\n                                    <i class="iconfont[[#if flags.flagged]] iconflatcolor flagged label0-[[label0]][[else]] iconflat[[/if]] j-mail-flagged"\r\n                                       title="[[i18n \'mbox/mail_flag_flagged_true\']]"></i>\r\n                                    <i class="iconfont icondown"></i>\r\n                                </span>\r\n                            [[else]]\r\n                            [[#if flags.flagged]]\r\n                            <span class="mail-flagged f-pr f-csp">\r\n                                        <i class="iconfont iconflatcolor flagged label0-[[label0]]"\r\n                                           title="[[i18n \'mbox/mail_flag_flagged_true\']]"></i>\r\n                                    </span>\r\n                            [[/if]]\r\n                            [[/if]]\r\n                            [[/if]]\r\n                            [[#if config.enableDeferMail]]\r\n                            [[#if config.enableUpdateMailStatus]]\r\n                            [[#if flags.deferHandle]]\r\n                            <span class="j-defer f-pr f-csp" deferDate="[[defer]]">\r\n                                        <i [[defer]] title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="state-icon icon-mDEFER"></i>\r\n                                    </span>\r\n                            [[else]]\r\n                            <span class="j-undefer f-pr f-csp" deferDate="[[defer]]">\r\n                                        <i title="[[i18n \'mail/list_set_defer\']]" class="j-undefer iconfont iconclock"></i>\r\n                                    </span>\r\n                            [[/if]]\r\n                            [[else]]\r\n                            [[#if flags.deferHandle]]\r\n                            <span class="f-pr f-csp" deferDate="[[defer]]">\r\n                                        <i [[defer]] title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="state-icon icon-mDEFER"></i>\r\n                                    </span>\r\n                            [[/if]]\r\n                            [[/if]]\r\n                            [[/if]]\r\n                            [[/unless]]\r\n\r\n                            [[#unless isNestedMsg]]\r\n                            [[#and config.enableMailDealings config.permWebmailMailSearch]]\r\n                            [[#unless config.shareMailBoxFolder]]\r\n                            <a class="iconfont iconemailcontacts" href="javascript:void(0)" title=\'[[i18n "mbox/mail_dealings"]]\' data-type="dealings"></a>\r\n                            [[/unless]]\r\n                            [[/and]]\r\n                            [[/unless]]\r\n\r\n                            <a class="iconfont iconnewtab" href="./detach.jsp?sid=[[sid]]#mail.read?mid=[[mid]]&fid=[[fid]]&mboxa=[[mboxa]]&start=[[start]]" target="_blank" title=\'[[i18n "mbox/mail_blank"]]\'></a>\r\n\r\n                            [[#unless isNestedMsg]]\r\n                            [[#if config.enableScheduleInvitation]]\r\n                            <a href="javascript:void(0)" title=\'[[i18n "mbox/mail_event"]]\' data-type="mail_event">[[i18n "mbox/mail_event"]]</a>\r\n                            [[/if]]\r\n                            [[/unless]]\r\n                        </div>\r\n                        <div class="f-tar">\r\n                            <span>[[sentDate]]</span>\r\n                        </div>\r\n                    </div>\r\n                    <div class="mail-top-info">\r\n                        <h3 class="mail-subject j-mail-subject [[#if flags.flagged]] flagged label0-[[label0]][[/if]]">\r\n                            [[#if composeExtra.showOneRcpt]]\r\n                            <span class="doc-icon doc-one-rcpt">[[i18n "mail/mail_onercpt"]]</span>\r\n                            [[/if]]\r\n                            <span class="icon"><i class="j-sourceIcon iconfont [[sourceIcon]]" title="[[sourceMsg]]"></i></span>\r\n                            [[#and config.enableSecurityLevel ctrls]] [[translateSL ctrls.CM-SECURITY]] [[/and]] [[subject]]\r\n                        </h3>\r\n                        <div class="short-info j-short-info">\r\n                            <div class="short-info-left">\r\n                                [[#if delegatedSender]]\r\n                                <span class="delegate-mail" title="[[i18n \'prop:mail/read_delegate_send\' 0=delegatedSender]]">[[i18n "mail/read_delegate_mail"]]</span>\r\n                                [[/if]]\r\n                                <a class="j-u-email" href="javascript:void(0);" addr="[[hemail from.[0] \'addr\']]">[[[strangerIconHtml from.[0] ]]][[hemail from.[0] "name"]]</a>\r\n                                <span>[[i18n "mbox/send_to"]]</span>\r\n                                [[#each to]]\r\n                                <a class="j-u-email" href="javascript:void(0)" addr="[[hemail this \'addr\']]">[[hemail this "name"]]</a>\r\n                                [[#unless @last]],[[/unless]]\r\n                                [[/each]]\r\n                            </div>\r\n                            <div class="j-attach-wrap short-info-right f-dn [[#compare isDecodeMail \'==\' false]]f-dni[[/compare]]">\r\n                                [[i18n \'mbox/op_contains\']]\r\n                                <a class="view-attach-btn attach-icon j-view-attach disabled" title="[[i18n \'mbox/mail_viewatta\']]" href="javascript:void(0)">\r\n                                    <i class="iconfont iconacc"></i>\r\n                                    <span class="attach-desc j-attach-desc">[[totalAttachs]]</span>\r\n                                    <span class="attach-desc">[[i18n \'mail/attachments_desc\']]</span>\r\n                                </a>\r\n                            </div>\r\n                        </div>\r\n                        <div class="full-info j-full-info f-dn">\r\n                            <table class="u-table u-table-row">\r\n                                <tr>\r\n                                    <td class="info-item">[[i18n "mbox/mail_from"]] :</td>\r\n                                    <td>\r\n                                        [[#if delegatedSender]]\r\n                                        <span class="delegate-mail" title="[[i18n \'prop:mail/read_delegate_send\' 0=delegatedSender]]">[[i18n "mail/read_delegate_mail"]]</span>\r\n                                        [[/if]]\r\n                                        [[#each from]]\r\n                                        <span class="u-email j-u-email" addr="[[hemail this \'addr\']]">\r\n                                            [[[strangerIconHtml this]]]\r\n                                            <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                            <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                         </span>\r\n                                        [[/each]]\r\n                                        [[#if delegatedSender]]\r\n                                        <span>([[i18n "prop:mail/read_delegate_send" 0=delegatedSender]])</span>\r\n                                        [[/if]]\r\n                                        [[#if isSenderMode]]([[[senderMessage]]])[[/if]]\r\n                                    </td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td class="info-item">[[i18n "mbox/mail_to"]] :</td>\r\n                                    <td>\r\n                                        [[#if partto]]\r\n                                        <div class="j-contacts">\r\n                                            [[#each partto.contacts]]\r\n                                            <span class="u-email j-u-email" addr="[[hemail this \'addr\']]">\r\n                                            <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                            <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                        </span>\r\n                                            [[#unless @last]]\r\n                                            <span class="divider">,</span>\r\n                                            [[/unless]]\r\n\r\n                                            [[/each]]\r\n                                            <span class="u-hide-info">.. <a href="javascript:void(0)" data-type="toggleContact">[[partto.stillContacts]]</a></span>\r\n                                        </div>\r\n                                        [[/if]]\r\n\r\n                                        <div class="j-contacts [[#if partto]]f-dn[[/if]]">\r\n                                            [[#each to]]\r\n                                            <span class="u-email j-u-email" addr="[[hemail this \'addr\']]">\r\n                                            <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                            <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                        </span>\r\n                                            [[#unless @last]]\r\n                                            <span class="divider">,</span>\r\n                                            [[/unless]]\r\n                                            [[/each]]\r\n                                            [[#if partto]]\r\n                                            <span class="u-hide-info"><a href="javascript:void(0)" data-type="toggleContact">[[i18n "mail/mail_hidemsg"]]</a></span>\r\n                                            [[/if]]\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                                [[#if cc]]\r\n                                <tr>\r\n                                    <td class="info-item">[[[i18n "mbox/mail_cc"]]] :</td>\r\n                                    <td>\r\n                                        [[#if partcc]]\r\n                                        <div class="j-contacts">\r\n                                            [[#each partcc.contacts]]\r\n                                            <span class="u-email j-u-email" addr="[[hemail this \'addr\']]">\r\n                                            <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                            <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                        </span>\r\n                                            [[#unless @last]]\r\n                                            <span class="divider">,</span>\r\n                                            [[/unless]]\r\n                                            [[/each]]\r\n                                            <span class="u-hide-info">.. <a href="javascript:void(0)" data-type="toggleContact">[[partcc.stillContacts]]</a></span>\r\n                                        </div>\r\n                                        [[/if]]\r\n\r\n                                        <div class="j-contacts [[#if partcc]]f-dn[[/if]]">\r\n                                            [[#each cc]]\r\n                                            <span class="u-email j-u-email" addr="[[hemail this \'addr\']]">\r\n                                            <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                            <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                        </span>\r\n                                            [[#unless @last]]\r\n                                            <span class="divider">,</span>\r\n                                            [[/unless]]\r\n                                            [[/each]]\r\n                                            [[#if partcc]]\r\n                                            <span class="u-hide-info"><a href="javascript:void(0)" data-type="toggleContact">[[i18n "mail/mail_hidemsg"]]</a></span>\r\n                                            [[/if]]\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                                [[/if]]\r\n\r\n                                [[#if bcc]]\r\n                                <tr>\r\n                                    <td class="info-item">[[[i18n "mbox/mail_bcc"]]] :</td>\r\n                                    <td>\r\n                                        [[#if partbcc]]\r\n                                        <div class="j-contacts">\r\n                                            [[#each partbcc.contacts]]\r\n                                            <span class="u-email j-u-email" addr="[[hemail this \'addr\']]">\r\n                                            <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                            <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                        </span>\r\n                                            [[#unless @last]]\r\n                                            <span class="divider">,</span>\r\n                                            [[/unless]]\r\n                                            [[/each]]\r\n                                            <span class="u-hide-info">.. <a href="javascript:void(0)" data-type="toggleContact">[[partbcc.stillContacts]]</a></span>\r\n                                        </div>\r\n                                        [[/if]]\r\n\r\n                                        <div class="j-contacts [[#if partbcc]]f-dn[[/if]]">\r\n                                            [[#each bcc]]\r\n                                            <span class="u-email j-u-email" addr="[[hemail this \'addr\']]">\r\n                                             <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                             <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                          </span>\r\n                                            [[#unless @last]]\r\n                                            <span class="divider">,</span>\r\n                                            [[/unless]]\r\n                                            [[/each]]\r\n                                            [[#if partbcc]]\r\n                                            <span class="u-hide-info"><a href="javascript:void(0)" data-type="toggleContact">[[i18n "mail/mail_hidemsg"]]</a></span>\r\n                                            [[/if]]\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                                [[/if]]\r\n\r\n                                <tr class="j-attach-wrap j-long-info f-dn [[#compare isDecodeMail \'==\' false]]f-dni[[/compare]]"></tr>\r\n\r\n                                [[#if config.enableMailMemo]]\r\n                                <tr id="mailMemo" class="[[#unless memo]]f-dn[[/unless]] j-mail-memo">\r\n                                    <td class="info-item">[[i18n "mail/memo"]] :</td>\r\n                                    <td class="j-memo-box"></td>\r\n                                </tr>\r\n                                [[/if]]\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                    <div class="mail-divider">\r\n                        <a href="javascript:void(0)" class="u-btn u-btn-default u-btn-round f-fr" data-type="toggleBrief">\r\n                            <i class="iconfont icondown"></i>\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n                <!--  -->\r\n                <div class="mail-sent-state j-sent-state f-dn"></div>\r\n\r\n                <!--  -->\r\n                [[#if isAuditMail]]\r\n                <div class="mail-audit-action j-audit-action">\r\n                    <span>[[i18n \'mail/lbl_auditTip\']]</span>\r\n                </div>\r\n                [[/if]]\r\n\r\n\r\n\r\n                <!---->\r\n                [[#if mailCipherEncrypted]]\r\n                <div class="mail-cipher-encrypted j-mailCipherEncrypted">\r\n                    [[#if mailCipherPassword]]\r\n                    <div class="decryption-success">\r\n                        <span class="iconfont iconunlock"></span>\r\n                        [[i18n "mbox/read_mail_cipher_decrypted_tip"]]\r\n                    </div>\r\n                    [[else]]\r\n                    <div class="no-decryption">\r\n                        <div class="lock-item"><span class="iconfont iconlock"></span></div>\r\n                        <div class="action-item">\r\n                            <input type="password" placeholder=\'[[i18n "mail/read_mail_password_prompt"]]\' class="u-input" name="password" id="password" maxlength="6" />\r\n                        </div>\r\n                        <div class="decryption-msg">\r\n                            [[#if showEncpwd]]<div class="encpwd">[[showEncpwd]]</div>[[/if]]\r\n                            <span class="j-decryption-error decryption-error f-dn"></span>\r\n                        </div>\r\n                        <div class="action-item">\r\n                            <span class="u-btn u-btn-primary j-decrypt-submit">[[i18n "main/bt_submit"]]</span>\r\n                        </div>\r\n                        <div class="label-item">[[[cipherEncryptedMsg]]]</div>\r\n                        <div class="label-item">[[i18n "mail/read_mail_cipher_encrypted_tip_1"]]</div>\r\n                    </div>\r\n                    [[/if]]\r\n                </div>\r\n                [[/if]]\r\n\r\n                <!---->\r\n                [[#if calendar]]<div class="j-meeting-request meeting-request"></div>[[/if]]\r\n            </div>\r\n\r\n            <!--  -->\r\n            <div class="mail-content">\r\n                [[#if sMimeClientEncrypted]]\r\n                <div class="j-ca-notify">\r\n                    [[#if isIE]]\r\n                    [[[i18n \'mail/encrypt_notify\']]]\r\n                    [[else]]\r\n                    [[[i18n \'mail/ca_not_support\']]]\r\n                    [[/if]]\r\n                </div>\r\n                [[/if]]\r\n                <iframe width="100%" height="100%" id="mail-[[iframeId]]" class="j-mail-content" style="position: absolute" frameborder="0" allowTransparency="true" [[#unless sMimeClientEncrypted]] sandbox="allow-scripts allow-popups allow-same-origin" [[/unless]]\r\n                src="jsp/viewMailHTML.jsp?mid=[[encodeUriComponent mid]]&mailCipherPassword=[[mailCipherPassword]]&partId=[[part]]&isSearch=&priority=&supportSMIME=[[supportSMIME]]&striptTrs=true&mboxa=[[mboxa]]&iframeId=[[iframeId]]&sspurl=[[sspurl]]">\r\n                </iframe>\r\n            </div>\r\n\r\n            <!--  -->\r\n            <div class="mail-attachments-wrap j-mail-attachments-wrap"></div>\r\n        </div>\r\n\r\n        <!--  -->\r\n        <footer class="quick-reply j-quick-reply [[#and config.supportSMIME sMimeServerEncrypted]]u-smime-server-encrypted[[/and]]" mid="[[mid]]" >\r\n            [[#unless isNestedMsg]]\r\n            [[#unless flags.webReadOnly]]\r\n            [[#if config.enableQuickReply]]\r\n            <div class="quick-reply-default quick-reply-item j-reply-default [[#if recallMail.enableRecallMail]] recall[[/if]] [[#compare isDecodeMail \'==\' false]]f-dn[[/compare]]"\r\n                 data-type="open-quick-reply" >[[i18n "mail/quick_reply_to"]]\r\n            </div>\r\n            <form class="quick-reply-form quick-reply-item j-reply-form f-dn" action="">\r\n                <textarea name="replyContent" class="reply-textarea" rows="6"></textarea>\r\n                <span class="u-btn u-btn-primary" data-type="send">[[i18n "common/send"]]</span>\r\n                <span class="u-btn u-btn-default" data-type="cancel">[[i18n "common/cancel"]]</span>\r\n                [[#if config.enableReply]]\r\n                <span class="f-fr"><a href="javascript:void(0)" data-type="compose">[[i18n "mbox/switch_to_full_mode"]]</a></span>\r\n                [[/if]]\r\n            </form>\r\n            <div class="quick-reply-item f-dn j-reply-sending">\r\n                <span class="reply-state reply-sending">[[i18n "mbox/reply_sending"]]</span>\r\n            </div>\r\n            <div class="quick-reply-item f-dn j-reply-result">\r\n                <span class="reply-state reply-success j-reply-success">[[i18n "mbox/reply_succ"]]</span>\r\n                <span class="reply-state reply-fail j-reply-fail">[[i18n "mbox/reply_fail"]]</span>\r\n                <a href="javascript:void(0)" data-type="open-quick-reply">[[i18n "mbox/reply_again"]]</a>\r\n            </div>\r\n            [[/if]]\r\n\r\n            <div class="j-footer-btn j-toolbar-footer u-btns [[#if config.enableQuickReply]][[#compare isDecodeMail \'!=\' false]]f-fr[[/compare]][[/if]]"></div>\r\n\r\n            [[/unless]]\r\n            [[/unless]]\r\n        </footer>\r\n    </script>\r\n\r\n    <!--  -->\r\n    <script id="sentstatetpl" type="text/x-handlebars-template">\r\n        <div class="f-cf">\r\n            <span><i class="iconfont iconmark"></i>[[rcptStatus.message]]</span>\r\n            <a href="javascript:void(0)" class="j-sent-detail-show" data-type="showSentDetail">[{{i18n "mbox/show_detail"}}]</a>\r\n            <span class="j-sent-detail f-dn">\r\n                <a href="javascript:void(0)" class="j-sent-detail-hide" data-type="hideSentDetail">[{{i18n "mbox/hide_detail"}}]</a>\r\n                <a href="javascript:void(0)" class="j-sent-detail-refresh" data-type="refreshSentDetail">[{{i18n "mbox/refresh"}}]</a>\r\n            </span>\r\n            <span class="j-sent-detail-short">[[[msgDetail]]]</span>\r\n            <span class="f-fr state-pagination f-dn j-sent-pagination"></span>\r\n        </div>\r\n        <div class="sent-detail f-dn">\r\n            [[#if sendingMsg]]\r\n            <div class="state-sending">[[sendingMsg]]</div>\r\n            [[/if]]\r\n        </div>\r\n    </script>\r\n\r\n    <!---->\r\n    <script id="meetingRequestTpl" type="text/x-handlebar-template">\r\n        <strong class="f-db meeting-item">[[replyStatusDisplay]]</strong>\r\n\r\n        <div class="meeting-box f-cf [[#if isExpired]]meeting-box-disabled[[/if]]">\r\n            <h4 class="meeting-box-decorate"></h4>\r\n            <div class="meeting-header">\r\n                <div class="subject f-ellipsis">[[meetingRequest.name]][[subjectFeatured]]</div>\r\n                <div class="details">[[eventDetails]]</div>\r\n            </div>\r\n            <div class="meeting-content">\r\n                <table>\r\n                    <tbody>\r\n                    [[#if allDayEventDate]]\r\n                    <tr class="date-info">\r\n                        <td><span class="item-icon"></span></td>\r\n                        <td class="meeting-item">[[i18n "cal/info_event_date"]]:</td>\r\n                        <td>\r\n                            [[#if isMembers]]\r\n                            <a href="javascript:void(0)" class="j-go-cal" data-action="goCal" data-caldate="[[startDateYMD]]">[[allDayEventDate]]</a>\r\n                            [[else]]\r\n                            [[allDayEventDate]]\r\n                            [[/if]]\r\n                        </td>\r\n                    </tr>\r\n                    [[/if]]\r\n                    <tr class="time-info">\r\n                        <td><span class="item-icon"></span></td>\r\n                        <td class="meeting-item">[[i18n "cal/info_event_time"]]:</td>\r\n                        <td>[[#if timeZone]][[timeZone]][[/if]]\r\n                            [[#if isMembers]]\r\n                            <a href="javascript:void(0)" class="j-go-cal" data-action="goCal" data-caldate="[[startDateYMD]]">[[eventTime]]</a>\r\n                            [[else]]\r\n                            [[eventTime]]\r\n                            [[/if]]\r\n                        </td>\r\n                    </tr>\r\n                    <tr class="place-info">\r\n                        <td><span class="item-icon"></span></td>\r\n                        <td class="meeting-item">[[i18n "cal/info_event_place"]]:</td>\r\n                        <td>[[meetingRequest.location]]</td>\r\n                    </tr>\r\n                    <tr class="description-info">\r\n                        <td><span class="item-icon"></span></td>\r\n                        <td class="meeting-item">[[i18n "cal/info_event_description"]]:</td>\r\n                        <td >[[meetingRequest.body]]</td>\r\n                    </tr>\r\n                    <tr class="attendees-info">\r\n                        <td><span class="item-icon"></span></td>\r\n                        <td class="meeting-item">[[i18n "cal/info_event_attendees"]]:</td>\r\n                        <td >\r\n                            <a href="mailto:[[hemail meetingRequest.organizer \'addr\']]" title="[[meetingRequest.organizer]]">\r\n                                [[hemail meetingRequest.organizer "name"]]\r\n                            </a>\r\n                            ([[i18n "cal/info_event_organizer"]])\r\n                            [[#if meetingRequest.partAttendees]]\r\n                            <div class="part-attendees j-attendees">\r\n                                [[#each meetingRequest.partAttendees]]\r\n                                <a href="mailto:[[hemail this.email \'addr\']]" title="[[this.email]]">[[hemail this.email "name"]]</a>,\r\n                                [[/each]]\r\n                                ...\r\n                                <a class="f-db" href="javascript:void(0)" data-action="toggleAttendees">[[meetingRequest.stillAttendees]]</a>\r\n                            </div>\r\n                            [[/if]]\r\n                            <div class="all-attendees [[#if meetingRequest.partAttendees]]f-dn[[/if]] j-attendees">\r\n                                [[#each meetingRequest.attendees]]\r\n                                <a href="mailto:[[hemail this.email \'addr\']]" title="[[this.email]]">[[hemail this.email "name"]]</a>,\r\n                                [[/each]]\r\n                                [[#if meetingRequest.partAttendees]]\r\n                                <a class="f-db"  href="javascript:void(0)" data-action="toggleAttendees">[[i18n "cal/msg_hidemsg"]]</a>\r\n                                [[/if]]\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n            <div class="meeting-footer f-cf">\r\n                [[#if enableMeetingAction]]\r\n                <!---->\r\n                <div class="f-fl participation-display">\r\n                    <i class="iconfont iconinformation"></i>\r\n                    <div class="details [[#unless participationDisplay]]f-dn[[/unless]]">\r\n                        <span class="j-participation-display">[[[participationDisplay]]]</span>\r\n                        <span class="j-modify-msg"></span>\r\n                        <a href="javascript:void(0)" data-action="modify">[[i18n "mail/op_modify"]]</a>\r\n                    </div>\r\n                    <span class="j-accept-state accept-state [[#if participationDisplay]]f-dn[[/if]]">[[i18n \'mail/accept_invitation\']]</span>\r\n                </div>\r\n\r\n                <div class="j-meeting-btn f-fr [[#if participationDisplay]]f-dn[[/if]] meeting-btns">\r\n                    <span class="u-btn u-btn-primary u-btn-accept" data-action="accept">[[i18n "mail/op_accept"]]</span>\r\n                    <span class="u-btn u-btn-primary u-btn-tentative" data-action="tentative">[[i18n "mail/op_tentative"]]</span>\r\n                    <span class="u-btn u-btn-default u-btn-decline" data-action="decline">[[i18n "mail/op_decline"]]</span>\r\n                </div>\r\n                [[/if]]\r\n                [[#unless isMembers]]\r\n                <div id="actionLinkTR">\r\n                    <div class="f-fl participation-display">\r\n                        <i class="iconfont iconinformation"></i>\r\n                        <a href="javascript:void(0)" class="j-view-cal [[#unless calUid]] f-dn[[/unless]]" data-action="viewCal" data-calUid="calUid">\r\n                            [[i18n \'cal/info_event_participation_toview\']]\r\n                        </a>\r\n                    </div>\r\n                    <div class="f-fr meeting-btns">\r\n                        <span class="j-add-cal u-btn u-btn-primary[[#if calUid]] f-dn[[/if]]" data-action="addCal">\r\n                            [[i18n \'cal/info_event_participation_toadd\']]\r\n                        </span>\r\n                            [[#if meetingRequest.organizer]]\r\n                        <span class="j-forward-cal u-btn u-btn-primary" data-action="forwardCal" data-organizer="[[meetingRequest.organizer]]">\r\n                            [[i18n \'cal/info_event_participation_introduct\']]\r\n                        </span>\r\n                            [[/if]]\r\n                        <span class="j-del-cal u-btn u-btn-default[[#unless calUid]] f-dn[[/unless]]" data-action="deleteCal">\r\n                            [[i18n \'cal/event_participation_del\']]\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n                [[/unless]]\r\n            </div>\r\n        </div>\r\n    </script>\r\n\r\n    <script id="sentstatetabletpl" type="text/x-handlebars-template">\r\n        <table class="u-table sent-state-table">\r\n            <thead>\r\n            <tr>\r\n                <th>[[i18n "mbox/true_name"]]</th>\r\n                <th>[[i18n "mbox/mail_to"]]</th>\r\n                <th>[[i18n "mbox/mail_sent_state"]]</th>\r\n                <th>[[[i18n "mbox/mail_time"]]]</th>\r\n            </tr>\r\n            </thead>\r\n            <tbody>\r\n            [[#each deliverys]]\r\n            <tr class="j-delivery-item" data-type="[[dsTextKey]]">\r\n                <td>[[to_name]]</td>\r\n                <td>[[to]]</td>\r\n                <td><i class="state-icon [[dsTextKey]]"></i> [[displayText]]</td>\r\n                <td>[[modtime]]</td>\r\n            </tr>\r\n            [[/each]]\r\n            </tbody>\r\n        </table>\r\n    </script>\r\n\r\n     <!--CA-->\r\n    <script id="decryptAttachTpl" type="text/x-handlebars-template">\r\n        <div class="attach-title">\r\n            <h3>[[i18n "mbox/mail_normalatt"]]([[attachments.length]] [[i18n "mail/attachments_number"]])</h3>\r\n        </div>\r\n        <div class="attach-content">\r\n            <!---->\r\n            [[#if attachments]]\r\n            <div class="j-tab-panels f-cf">\r\n                [[#each attachments]]\r\n                <div class="attachment f-fl" attach-type="decryptedattachment" attach-index=\'[[@index]]\' attach-id=\'[[id]]\'>\r\n                    <div class="attachment-item attach-type">\r\n                        <span class="file-big-icon icon-big-[[fileType]]"></span>\r\n                    </div>\r\n                    <div class="attachment-item attach-name f-ellipsis">[[fileName]]</div>\r\n                </div>\r\n                [[/each]]\r\n            </div>\r\n            [[/if]]\r\n        </div>\r\n    </script>\r\n\r\n    <!--CA -->\r\n    <script id="decryptAttachTipTpl" type="text/x-handlebars-template">\r\n        <div class="attach-action-tip">\r\n            <div class="file-name">[[filename]]</div>\r\n            <ul class="action-list">\r\n                [[#if allowDownload]]\r\n                <li class="action-item enable">\r\n                    <a href="javascript:void(0)" class="iconfont icondownload" data-action="download" ></a><div class="action-name">[[i18n "common/op_download"]]</div>\r\n                </li>\r\n                [[else]]\r\n                <li class="action-item"><a href="javascript:void(0)" class="iconfont icondownload"></a></li>\r\n                [[/if]]\r\n\r\n                [[#if allowOpen]]\r\n                <li class="action-item enable">\r\n                    <a href="javascript:void(0)" class="iconfont iconfiler" data-action="open"></a><div class="action-name">[[i18n "common/op_open"]]</div>\r\n                </li>\r\n                [[else]]\r\n                <li class="action-item"><a href="javascript:void(0)" class="iconfont iconfiler"></a></li>\r\n                [[/if]]\r\n\r\n                [[#if allowPreview]]\r\n                <li class="action-item enable">\r\n                    <a href="javascript:void(0)" class="iconfont iconeye" target="_blank"></a><div class="action-name">[[i18n "common/op_preview"]]</div>\r\n                </li>\r\n                [[else]]\r\n                <li class="action-item"><a href="javascript:void(0)" class="iconfont iconeye"></a></li>\r\n                [[/if]]\r\n\r\n                [[#if allowAddToNetfolder]]\r\n                <li class="j-addToNetFolder action-item enable" data-id="[[id]]">\r\n                    <a  href="javascript:void(0)" class="iconfont iconsave"></a><div class="action-name">[[i18n "common/op_to_netfolder"]]</div>\r\n                </li>\r\n                [[else]]\r\n                <li class="action-item"><a href="javascript:void(0)" class="iconfont iconsave"></a></li>\r\n                [[/if]]\r\n\r\n                [[#if allowAddToExternalfolder]]\r\n                <li class="j-addToExternalFolder action-item enable" data-id="[[id]]">\r\n                    <a  href="javascript:void(0)" class="iconfont iconyin"></a><div class="action-name">[[i18n "common/op_to_xnffolder"]]</div>\r\n                </li>\r\n                [[/if]]\r\n            </ul>\r\n        </div>\r\n    </script>\r\n\r\n    <!--CA -->\r\n    <script id="CApluginInjectTpl" type="text/x-handlebars-template">\r\n        <div role="CAcomposePlugin">\r\n            <object classid="clsid:A996E48C-D3DC-4244-89F7-AFA33EC60679" id="oCAPICOM"></object>\r\n            <object type="application/x-cmplugin">\r\n              <param name="onload" value="pluginLoaded">\r\n            </object>\r\n        </div>\r\n    </script>\r\n\r\n    <script id="footerToolbarTpl" type="text/x-handlebars-template">\r\n        [[#if config.supportSMIME]]\r\n        [[#if sMimeServerEncrypted]]\r\n        <span class="u-btn u-btn-default" [[#if isDecodeMail]]disabled[[/if]] data-btn="decryptServerEncrypted">[[i18n "mbox/bt_decode_mail"]]</span>\r\n        [[/if]]\r\n        [[#if sMimeClientEncrypted]]\r\n        <span class="u-btn u-btn-default j-ca-decrypt" data-btn="decryptClientEncrypted" [[#unless isIE]]disabled[[/unless]] [[#if isDecodeMail]]disabled [[/if]]>[[i18n "mbox/bt_decode_mail"]]</span>\r\n        [[/if]]\r\n        [[/if]]\r\n        [[#if recallMail.enableRecallMail]]\r\n        <span class="u-btn u-btn-default [[#if recallMail.disabledRecall]]disabled[[/if]]" data-btn="recall">[[recallMail.message]]</span>\r\n        [[/if]]\r\n        [[#if config.enableReply]]\r\n        [[#and config.enableReplyWithAttachments hasAttachment]]\r\n        <span class="u-btn u-btn-default" data-dropdown="reply">[[i18n "common/op_reply"]]<span class="iconfont icondown"></span></span>\r\n        <span class="u-btn u-btn-default" data-dropdown="reply-all">[[i18n "common/op_replyall"]]<span class="iconfont icondown"></span></span>\r\n        [[else]]\r\n        <span class="u-btn u-btn-default"  [[#compare isDecodeMail \'==\' false]]disabled[[/compare]] data-btn="reply">[[i18n "common/op_reply"]]</span>\r\n        <span class="u-btn u-btn-default"  [[#compare isDecodeMail \'==\' false]]disabled[[/compare]] data-btn="replyall">[[i18n "common/op_replyall"]]</span>\r\n        [[/and]]\r\n        [[/if]]\r\n        [[#if config.enableForward]]\r\n        <span class="u-btn u-btn-default" [[#compare isDecodeMail \'==\' false]]disabled[[/compare]] data-btn="forward">[[i18n "common/op_forward"]]</span>\r\n        [[/if]]\r\n        <span class="u-btn u-btn-default" data-dropdown="read-more">[[i18n "common/op_more"]]<span class="iconfont icondown"></span></span>\r\n    </script>\r\n    {{/raw}}\r\n\r\n</section>';
}),define("module/mail/read/index",["require","i18n!common,mail,mbox,main,faces,cal,error","jquery.scrollTo","../../../component/memobox","jquery","cui/core/view/viewmanager","../../../util/index","component/userauth2","cui/util/history/hash","component/maildeferbox","../../../component/confirmbox","../../../component/mailRecallBox","../../../component/filetonfbox","../../../component/xnffilebox","../../../component/contactcard","moment","../toolbar","../../common/globalService","../service","../../calendar/service","../../../configurable/index","./service","../smime","ResizeSensor","../readbase","text!template/module/mail/read.tpl.html"],function(e){function t(e,t){var i=this,a=n(t),r=a.data("action");switch(r){case"decryptedDownload":var s=i._params.mail.attachments[a.data("id")];i.Smime.cmPlugin.encode().decodeBase64AndSave(s.base64,s.fileName)}}e("i18n!common,mail,mbox,main,faces,cal,error"),e("jquery.scrollTo"),e("../../../component/memobox");var n=e("jquery"),i=e("cui/core/view/viewmanager"),a=e("../../../util/index"),r=e("component/userauth2"),s=e("cui/util/history/hash"),o=e("component/maildeferbox"),l=e("../../../component/confirmbox"),c=e("../../../component/mailRecallBox"),d=e("../../../component/filetonfbox"),u=e("../../../component/xnffilebox"),p=e("../../../component/contactcard"),h=e("moment"),f=e("../toolbar"),m=e("../../common/globalService"),g=e("../service"),v=e("../../calendar/service"),_=e("../../../configurable/index"),y=e("./service"),b=e("../smime"),w=e("ResizeSensor"),M=e("../readbase"),T=M.extend({toolbar:null,Smime:null,attrs:{className:null,briefMode:{value:!1,setter:function(e){var t=e?1:0;return a.cookies.set("brief_mode",t),t},getter:function(){var e=m.getConfig("mail.defaultreadbriefmode");return 1==a.cookies.get("brief_mode",e)}}},widgets:{contactCards:[]},events:{"click .j-read-receipt [data-action]":"_handleReadReceipt","click .j-sspurl [data-action]":"_handleSSPUrl","click [data-btn=recall]":"_handleRecallMail","click [data-btn=destroy]":"_handleDestroyAutoDelMail","click .j-mail-top a[data-type]":"_handleMailTop","click .j-view-attach":"_handleScrollTo","click .j-meeting-request [data-action]":"_handleMeetingModify","click .j-saveToNetFolder":"_handleSaveToNetFolder","click .j-saveToExtFolder":"_handleSaveToExternalFolder","click .j-quick-reply [data-type]":"_handleQuickReply","click .j-undefer":"_initDeferDialog","click .j-decrypt-submit":"_handleDecryptMessage","click .j-attach-actions [data-action]":t,"click .j-showRuleInfo":"_handleShowAuditDetails"},initProps:function(){var e=m.getCurrentState();this.set("name","mail.read:"+(e.param.id||e.param.mid)),this.set("className",e.param.embed?"m-read-embed":e.param.shared?"m-read-shared":"")},setup:function(){var e;this.state=m.getCurrentState(),h.locale(m.getConfig("context.locale")||""),this.state.param.fid=parseInt(this.state.param.fid,10),e=this.state.param.mid,this.state.param.id=this.state.param.id||e,this.state.param.pView=this.state.param.pView||"",this.state.param.mboxa=this.state.param.mboxa||"",(isNaN(this.state.param.fid)||!e)&&n.error("fid or mid is empty"),this.element.attr("mid",e),this._params={fromView:"mail."+this.state.param.pView,mailList:[],mail:{}},this.state.param.defaultAccount&&(this._params.defaultAccount=this.state.param.defaultAccount),this.config=_("mail.common",this),"function"===n.type(this.config.mboxaOverwrite)&&this.config.mboxaOverwrite()},render:function(){var e=this;T.superclass.render.call(this),n.notify.loading();var t=[this.config.checkCookie?n.noop():this._generateCookieSid(),this._initPrevAndNext()];n.when.apply(n,t).then(n.proxy(this._initMailInfo,this)).done(function(){e._initBeforeMainEvent(),e._initMain(),e._initReadReceipt(),e._initEvent(),e._initBackTop(),e.element.customRadioCheckbox()}).fail(function(t){t&&"FA_MAIL_NOT_FOUND"===t.code?e._handleMailNotFound(t.message):n.notify.error(a.i18n.t("mail/read_init_fail"))}).always(function(){n.notify.loading("hide")})},destroy:function(){n(window).off("message.read",this._receiveViewMailIframeMessage),n(window).off("resize",this._postMessageToFrame),this.toolbar&&this.toolbar.destroy(),this.element.remove(),this.Smime&&this.Smime.attachments&&a.cache.removeItem("caAttachments_"+this.state.param.mid),n.each(this.widgets.contactCards,function(e,t){t.destroy()}),this.widgets.contactCards=[]},_onRenderClassName:function(e){this.element.addClass(e)},rerender:function(e){var t,r,o,l,c=m.getUser();if(!this._params.mailList||0===this._params.mailList.length)return this.sendMessage("mail","view:close",{target:"list"});if(e.start-this._params.start>=0?(t=this._params.mlIndex+1,this._params.mailList[t]||(e.start=e.start-1,t=this._params.mlIndex-1)):t=this._params.mlIndex-1,r=this._params.mailList[t],!r)return this.sendMessage("mail","view:close",{target:"list"});if(l=1===c.display_list&&r.threadMessageCount>=2?"mail.thread":"mail.read",o={module:l,param:{fid:this.state.param.fid,mid:r.id||"",start:e.start}},o.param.historyUrl=s.stringifyHash(o),o.param=n.extend(o.param,{start:e.start,mboxa:this.state.param.mboxa,pView:this.state.param.pView,id:o.param.mid,tabTitle:" ",replaceId:"read:"+this.state.param.mid}),"search"===this.state.param.pView&&(o.param.condition=this.state.param.condition),a.detector.isDetachMode())return this.sendMessage("dispatcher","history:add",o),location.reload();if(c.preview_layout&&"search"!==this.state.param.pView){var d=this.element.parents("#previewLayoutRead"),u=new i.module(o.module);d.find("section.j-mail-read").remove(),d.find(".j-email-unchecked").hide(),m.setCurrentState(o),u.render(d)}else this.sendMessage("mail","view:change",o)},_generateCookieSid:function(){var e=n.Deferred();return m.generateSidCookie().then(function(){e.resolve()},function(){e.reject()}),e.promise()},_receiveViewMailIframeMessage:null,_postMessageToFrame:null,_initBeforeMainEvent:function(){this._receiveViewMailIframeMessage=n.proxy(function(e){var t=e.originalEvent?e.originalEvent.data:e.data||"";if(t&&(t=JSON.parse(t),n.isPlainObject(t)&&"attachmentsRefer"===t.type)){var i=t.attachments,a=t.mid,r=t.iframeId,s=this._params.mail;if(!s||s.mid!==a||s.iframeId!=r)return!1;y.formatMailAttachments(s,i,t.inLineTrsAttachments.concat(s.trsAttachments)),this._initAttach(),this._initToolbar(),this._postMessageToFrame()}},this),this._postMessageToFrame=n.proxy(function(e){e="boolean"==n.type(e)?e:!1;var t=this.$(".mail-frame").height(),i=this.$(".j-mail-attachments-wrap").height(),a={type:"resize",toBottom:e,topHeight:t,attachHeight:i,resize:!0,isThread:!1};a.resize=!e;var r=this.$(".j-mail-content")[0].contentWindow;r&&r.postMessage(JSON.stringify(a),"*")},this),n(window).on("message.read",this._receiveViewMailIframeMessage),n(window).on("resize",this._postMessageToFrame)},_initEvent:function(){function e(){var e=i.$(".mail-frame").height(),t=i.$(".j-mail-attachments-wrap").height();(r!==e||s!==t)&&(r=e,s=t,i._postMessageToFrame())}function t(e){var t=e.originalEvent,n=t.deltaX,r=t.deltaY;if("DOMMouseScroll"==t.type&&("1"==t.axis&&(n=10*t.detail),"2"==t.axis&&(r=10*t.detail)),a.detector.isIE()&&(r=-t.wheelDelta),n&&0!=n||r&&0!=r){var s=i.$(".j-mail-content")[0].contentWindow,o={type:"scroll",scrollX:n,scrollY:r};s&&s.postMessage(JSON.stringify(o),"*")}}var i=this;if(i.on("mail:mark",function(e){var t,n=i.$(".j-mail-subject"),a=i.$(".j-mail-flagged"),r={};switch(e=e||{},t=e.label0||0,e.type){case"unread":i.sendMessage("mail","view:close",{target:"list"}),r.read=!1;break;case"flagged":n.removeClass(function(e,t){return(t.match(/label0-[0-9]/g)||[]).join("")}).addClass("flagged label0-"+t),a.removeClass(function(e,t){return(t.match(/label0-[0-9]/g)||[]).join("")}).removeClass("iconflat").addClass("iconflatcolor flagged label0-"+t),r.flagged=!0;break;case"noflagged":n.removeClass("flagged"),a.removeClass("iconflatcolor flagged").addClass("iconflat"),r.flagged=!1;break;case"urgent":i._params.mail.priority=1,i._initToolbar();break;case"general":i._params.mail.priority=3,i._initToolbar();break;case"slow":i._params.mail.priority=5,i._initToolbar();break;case"vip":i._params.mail.flags.vip=!0,i._initToolbar();break;case"novip":i._params.mail.flags.vip=!1,i._initToolbar();break;case"top":i._params.mail.flags.top=!0,i._params.listStart=0,i._initToolbar();break;case"notop":i._params.mail.flags.top=!1,i._initToolbar();break;case"memo":i._params.mail.memo=e.memo,i._initMailMemo()}i.sendMessage(i._params.fromView,"view:refresh",{mid:e.mid,flags:r,start:i._params.listStart})}),i.on("mail:memo:edit",function(){i._handleMailMemo()}),i.offMessage("view:active").onMessage("view:active",function(){i.toolbar&&i.toolbar._initPagination(),i._initContactCard()}),i.offMessage("read:mark").onMessage("read:mark",function(e){i.trigger("mail:mark",e.message)}),i.offMessage("mail:op").onMessage("mail:op",function(e){var t=e.message.action;e.message&&("undefined"==typeof i._params.mail.isDecodeMail||i._params.mail.isDecodeMail)&&("quickReply"!==t?i.toolbar&&i.toolbar.trigger("mail:op",e.message.action):i._handleQuickReply(null,i.$(".j-quick-reply [data-type=send]")))}),a.detector.isIEByVersion("10-")){var r,s;setInterval(e,200)}else new w(i.$(".mail-frame"),function(){i._postMessageToFrame()});var o=(/Version\/*([0-9]+)*/.exec(navigator.userAgent)||{})[1]||"";navigator.userAgent.indexOf("Safari")>-1&&parseInt(o)<12?i.$(".j-main").off("mouseenter").on("mouseenter",function(){n(this).off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(e){t(e)})}):(i.$(".mail-frame").off("mouseenter").on("mouseenter",function(){n(this).off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(e){t(e)})}),i.$(".j-mail-attachments-wrap").off("mouseenter").on("mouseenter",function(){n(this).off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(e){t(e)})}))},_initPrevAndNext:function(){var e=n.Deferred(),t=this,i=t.state.param.pView,a=n.extend({},t.state.param);if(n.extend(t._params,a),void 0===a.start)return n.extend(t._params,{start:0,total:0}),e.resolve();if("list"===i)a.topFirst=t.config.enableTopMail;else{if("search"!==i)return;a=t.state.param.condition||a}return a.start=t._params.start>0?t._params.start-1:0,a.limit=3,g.getListData(i,a).then(function(i){t._params.mailList=i.list,t._params.total=i.total,n.each(i.list,function(e,n){return n.id===t.state.param.mid?(t._params.mail=n,t._params.mlIndex=e,!1):void 0}),n.isEmptyObject(t._params.mail)&&(t._params.total=0),e.resolve()},function(){e.reject()}),e.promise()},_initMailInfo:function(){var e=n.Deferred(),t=this,i=this._params.mail,s=this.state.param.fid,o=this.state.param.mboxa,l=i.flags&&!i.flags.read||this.state.param.unread,c={mid:this.state.param.mid,mboxa:o,part:this.state.param.part,mailCipherPassword:this.state.param.mailCipherPassword||""};return i.id=this.state.param.mid,i.config=this.config,this.state.param.supportSMIME&&(i.supportSMIME=!0,c.supportSMIME=!0),y.readMessage(c).then(function(r){var c=i.rclStatus||r.rclStatus,d=!(!i.recallable&&!r.recallable);i.iframeId=+new Date,i.isIE=a.detector.isIE(),n.extend(!0,i,r,{mid:i.id,fid:s,start:t.state.param.start,iframeId:i.iframeId,sid:m.getSid(),flags:i.flags,mboxa:o}),(l||"unread"===t.state.param.action)&&(t.sendMessage(t._params.fromView,"view:refresh",{mid:i.id,flags:{read:!0}}),t.sendMessage("mail","folder:refresh",{type:"all"})),i.config.supportSMIME&&i.sMimeServerEncrypted&&(i.isDecodeMail=i.smimeStatus>=200,i.smimeAttachs=i.smimeStatus<200),i.config.supportSMIME&&i.sMimeClientEncrypted&&(i.isDecodeMail=!1),t._isPreviewLayout()?t.sendMessage(t._params.fromView,"view:refresh",{mid:i.id,action:"reactive"}):t.sendMessage("mail","tab:change",{title:i.subject||a.i18n.t("mail/empty_subject"),id:"read:"+i.id}),s===g.getFoldersMap().sent&&(i.recallMail={enableRecallMail:!1},i.autoDelMail=!(!i.composeExtra||!i.composeExtra.autoDel),t.config.supportRecallMail&&d&&!i.autoDelMail&&(i.recallMail.enableRecallMail=!0,i.rclStatus>0&&(i.recallMail.disabledRecall=!0),1===c||2===c?i.recallMail.message=a.i18n.t("common/op_recalling"):3===c||4===c||5===c?i.recallMail.message=a.i18n.t("common/op_recalled"):i.recallMail.message=a.i18n.t("common/op_recall")),i.autoDelMail&&(i.autoDelMailIsExpiry=g.checkAutoDelMailExpired(i.composeExtra.autoDel))),i.mailCipherEncrypted&&(i.cipherEncryptedMsg=a.i18n.t("mbox/read_mail_cipher_encrypted_tip").replace("{0}",'<span class="highlight ">"'+(a.html.encode(a.Email.parseTrueName(n.isArray(i.from)?i.from[0]:i.from))||i.from)+'"</span>')),i.requestReadReceipt=i.requestReadReceipt&&l,i.previewLayout=t._isPreviewLayout(),t.sendMessage("mail.previewlayout","previewlayout:readShow",{readShow:i.previewLayout}),e.resolve()},function(n){n&&"FA_NEED_AUTH2"===n.code?r.box({successCb:function(){t.render()},cancelCb:function(){}}):e.reject(n)}),e.promise()},_isPreviewLayout:function(){var e=m.getUser(),t=this.state.param.pView;return!(!e.preview_layout||a.detector.isDetachMode()||"search"===t||!t)},_initToolbar:function(){this._updateToolbarContent(),this._updateToolbarView()},_initReadReceipt:function(){var e=this.$("#readreceipttpl").html(),t=this._params.mail,n=m.getUser(),i=n.op_readreceipt||0;if(this.config.forceSendReadReceipt)this._handleReadReceiptSend();else if(t.requestReadReceipt)switch(i){case 0:this.$(".j-read-alert").append(this.compile(e));break;case 2:this._handleReadReceiptSend()}},_initDetectSSPUrl:function(){var e,t,n=this,i=this._params.mail;i.sspurl&&(t=g.getFoldersMap(),e=this.$("#sspurltpl").html(),this.$(".j-read-alert").append(this.compile(e,{isJunk:n._params.fid===t.junk,isTrash:n._params.fid===t.trash})))},_initDirectForward:function(){var e,t,n=this.$("#directforwardtpl").html(),i=this._params.mail,a=i.headers,r=this.$(".j-read-alert");e=a["Resent-From"]&&a["Resent-From"][0]||"",e.length>0&&(t=h(a["Resent-Date"]),r.append(this.compile(n,{from:e,time:t.format("ll")+" "+t.format("HH:mm:ss")})),r.on("click","span[data-action=close]",function(){r.slideUp()}))},_initScheduleSend:function(){var e=this,t=e.$("#schedulesendtpl").html(),i=e._params.mail,a=i.ctrls||{},r="1"===a.timedsend,s=h(a.ts_creattime),o=e.$(".j-read-alert");r&&s.isValid()&&o.append(e.compile(t,{from:"array"===n.type(i.from)?i.from[0]:i.from,time:s.format("ll")+" "+s.format("HH:mm:ss")})).on("click","span[data-action=closeSchedule]",function(){e.$(".j-schedule").slideUp()})},_initMain:function(){var e=this.$("#maintpl").html(),t=this._params.mail,n=t.flags;n&&n.system&&(t.sourceIcon="state-icon icon-SYSTEM",t.sourceMsg=a.i18n.t("mail/source_system")),t.mailCipherPassword&&(t.mailCipherPassword=encodeURIComponent(t.mailCipherPassword)),this.$(".j-module-content").html(this.compile(e,t));var i=this.get("briefMode");this.set("briefMode",i),this._initDirectForward(),this._initScheduleSend(),this._initDetectSSPUrl(),this._initMailFlag(),this._initContactCard(),this.config.enableMailMemo&&this._initMailMemo(),this._initSentState(),this._initMeetingRequest(),this._initToolbar(),this.config.enableDeferMail&&this._initDeferTip()},_initMailFlag:function(){var e=this,t=g.getToolbarMenu("mail.menu.flag-color"),i=g.getToolbarMenu("mail.menu.label0-color");e.config.mailFlaggedColorCount>1&&n.merge(t["label0-color"],i.slice(0,e.config.mailFlaggedColorCount)),this.$("span[data-dropdown=flag-color]").dropdown({data:t,callback:function(t){e._handleMailTop(null,null,t)}})},_initContactCard:function(){var e=this;(e.config.supportOab||e.config.supportPab)&&e.$(".j-u-email").each(function(){e._updateContactCard({trigger:n(this),parent:e,emailAddress:n(this).attr("addr")})})},_initMailMemo:function(){var e=this,t=this.$(".j-mail-memo");t.find(".j-memo-box").memoBox({mid:e.state.param.mid,memo:this._params.mail.memo,parentNode:e.element,eventCallBack:function(){e.sendMessage(e._params.fromView,"view:refresh",{start:e._params.listStart})}})},_handleDecryptCAMail:function(){var e,t=this,i=n("[role=CAcomposePlugin]");0===i.length&&(e=this.compile(this.$("#CApluginInjectTpl").html()),i=n(e).appendTo(n("body"))),e=i.find("object")[1],y.getMessageData({mode:"text",mid:this.state.param.mid}).then(function(i){t.Smime=new b(e,i),t.Smime.invaild||(t.Smime.encrypted&&(n.notify.loading({body:a.i18n.t("mail/msg_handling_attach"),position:"top-center"}),t.Smime.decryptMail()&&(t._params.mail.content=t.Smime.mailContent,t._params.mail.isEncrypted=!0,t._params.mail.attachments=t.Smime.attachments,a.cache.setItem("caAttachments_"+t.state.param.mid,t.Smime.attachments),t.Smime.signed||(t.$(".j-mail-content").contents().find("body").html("<pre>"+t._params.mail.content+"</pre>"),t._handleAfterDecrypt(),t._handleCAattachment())),n.notify.loading("hide")),t.Smime.signed&&(n.notify.loading({body:a.i18n.t("mail/msg_handling_attach"),position:"top-center"}),l.confirm(a.i18n.t("mail/signed_info_confirm"),function(){var e=t.Smime.checkSign();t.Smime.encrypted||(t._params.mail.content=t.Smime.mailContent,t._params.mail.attachments=t.Smime.attachments,a.cache.setItem("caAttachments_"+t.state.param.mid,t.Smime.attachments),t.$(".j-mail-content").contents().find("body").html("<pre>"+t._params.mail.content+"</pre>"),t._handleAfterDecrypt()),e?(t._params.mail.isSigned=!0,t.$(".j-ca-notify").html(a.i18n.t("mail/cert_info",e))):alert(a.i18n.t("mail/msg_get_cert_fail")),t._handleCAattachment(),n.notify.loading("hide")},function(){n.notify.loading("hide")})))})},_handleAfterDecrypt:function(){this.$(".j-ca-notify").empty(),this._params.mail.isDecodeMail=!0,this._isPreviewLayout?(this.$(".j-ca-decrypt").attr("disabled",!0),this.$("[data-btn=reply]").attr("disabled",!1),this.$("[data-btn=replyall]").attr("disabled",!1),this.$("[data-btn=forward]").attr("disabled",!1)):this._updateToolbarContent()},_handleCAattachment:function(){var e=this._params.mail;y.formatMailAttachments(e,e.attachments,[],!0),this._initAttach(!0),this.$(".j-mail-content")[0].contentWindow.postMessage("resize",location.protocol+"//"+location.host)},_updateToolbarContent:function(){function e(){var e=n.$("#toolbartpl").html();r.html(n.compile(e,i)),s.addClass(o)}function t(){if(a.detector.isDetachMode())return void s.addClass(o);var e=n.$("#footerToolbarTpl").html();i.config.enableQuickReply&&i.isDecodeMail!==!1?s.addClass("f-fr"):s.removeClass("f-fr"),s.removeClass(o).html(n.compile(e,i))}var n=this,i=this._params.mail;i.config.isCollectFolder=15==i.fid;var r=this.$(".j-toolbar"),s=this.$(".j-toolbar-footer"),o="f-dn";this._isPreviewLayout()?(t(),n.$(".j-toolbar").hide()):e()},_updateToolbarView:function(){var e={parent:this,currentPage:this._params.start,refresh:this.rerender};this._isPreviewLayout()?e.element=this.$(".j-toolbar-footer"):(e.total=this._params.total,e.limit=1,e.element=this.$(".j-toolbar")),this.toolbar&&this.toolbar.destroy(),this.toolbar=new f(e).render()},_initSentState:function(e){var t=this,i={rcptStatus:t._getRcptStatus()},r=t.config.deliveryStatusKeepDays,s=t.$("#sentstatetpl").html(),o=t.$(".j-sent-state");return i.rcptStatus.type?(o.mask(),void g.listDeliveryHistory({mid:t.state.param.mid,mboxa:t.state.param.mboxa}).then(function(l){var c,d,u,p,f,m=t._params.mail;0===l.length?(c=h(m.sentDate).format("YYYY-MM-DD"),d=h().diff(c,"days"),i.sendingMsg=d>r?a.messageFormat.format(a.i18n.t("mbox/sent_state_outdated"),r):a.i18n.t("mbox/sent_state_try_later")):(i.deliverys=l,u=a.messageFormat.format(a.i18n.t("mbox/stat_msg_detail1"),'<a data-type="mail_sent_state_all" href="javascript:void(0)">'+l.length+"</a>"),p=a.i18n.t("mbox/stat_msg_detail2"),f={},n.each(l,function(e,n){var i,r,s,o;i=n.result%100,r="mbox/mail_sent_state_"+n.result,s=a.i18n.t(r),o="mail_sent_state_"+n.result,!n.to_name&&n.to&&(n.to_name=n.to.split("@")[0]),n.rclResult?(s=a.i18n.t("mbox/mail_rcl_state_"+n.rclResult),o="mail_rcl_state_"+n.rclResult):(t.config.disableAuditInDeliveryStatus&&-1!==r.indexOf("mail_sent_state_60")&&(r="mbox/mail_sent_state_0",o="mail_sent_state_0"),s=a.i18n.t(r)),r===s&&(o="mail_sent_state_"+i,s=a.i18n.t("mbox/mail_sent_state_"+i)),n.displayText=s,n.dsTextKey=o,f[o]?f[o].total=f[o].total+1:f[o]={total:1,dsText:a.i18n.t("mbox/"+o)}}),n.each(f,function(e,t){var n="&nbsp;&nbsp;"+a.messageFormat.format(p,['<a data-type="'+e+'" href="javascript:void(0)">'+t.total+"</a>",""]);u+=n+t.dsText+","})),i.msgDetail=u&&u.replace(/,$/,""),t._params.stateData=i,o.html(t.compile(s,i)).removeClass("f-dn"),t._initStateTable(),e&&o.find("a[data-type=showSentDetail]").click(),o.mask("hide")})):!1},_initStateTable:function(e){var t=this,i=t.$(".j-sent-state"),a=t.$("#sentstatetabletpl").html(),r=t._params.stateData,s=r&&r.deliverys||[],o=[];e?n.each(s,function(t,n){n.dsTextKey===e&&o.push(n)}):o=s.slice(),o.length>0&&(i.find(".sent-detail").html(t.compile(a,{deliverys:o})),t._initStateTablePagination(o)),i.off("click.sentState").on("click.sentState","a[data-type]",function(e){e.preventDefault();var a,r=n(this),s=r.data("type");switch((0===s.indexOf("mail_sent_state")||0===s.indexOf("mail_rcl_state"))&&(a=s,s="mail_sent_state"),s){case"showSentDetail":r.addClass("f-dn"),i.find(".j-sent-detail").removeClass("f-dn").end().find(".sent-detail").removeClass("f-dn").end().find(".j-sent-pagination").removeClass("f-dn");break;case"hideSentDetail":r.closest(".j-sent-detail").addClass("f-dn"),i.find(".j-sent-detail-show").removeClass("f-dn").end().find(".sent-detail").addClass("f-dn").end().find(".j-sent-pagination").addClass("f-dn");break;case"refreshSentDetail":t._initSentState(!0);break;case"mail_sent_state":t._initStateTable("mail_sent_state_all"===a?"":a),i.find("a[data-type=showSentDetail]").click()}})},_initStateTablePagination:function(e){var t=this,i=t.$(".j-sent-state");e.length>10?(i.find(".j-sent-pagination").pagination({total:e.length,limit:10,round:!0,prevText:a.i18n.t("common/prev_page"),nextText:a.i18n.t("common/next_page"),menu:!1,callback:function(e){var t=10*e,a=i.find(".sent-state-table tr.j-delivery-item"),r=[],s=[];a.each(function(e){t>e||e>t+9?r.push(this):s.push(this)}),n(r).addClass("f-dn"),n(s).removeClass("f-dn")}}),i.find(".sent-state-table").find("tr.j-delivery-item:gt(9)").addClass("f-dn")):i.find(".j-sent-pagination").empty()},_initMeetingRequest:function(){var e,t,n,i,r,s=this,o=this._params.mail,l=[],c=m.getConfig("user.allemails");o.calendar&&(t=o.calendar.meetingRequest,t?(e={condictions:[{field:"UID",operator:"=",operand:t.UID}],windowSize:1},v.searchCalEvents(e).then(function(e){if(e&&e.length>0){if(n=e[0],o.calendar.isExpired=n.name!==t.name||n.location!==t.location||n.start!==t.start||n.duration!==t.duration||n.allDayEvent!==t.allDayEvent||(n.body||"")!==(t.body||""),o.calendar.isExpired&&(o.calendar.subjectFeatured=a.i18n.t("mail/meeting_request_subject_featured_update")),"reply"===o.calendar.meetingRequestMethod){for(t.attendees=[],r=0;r<n.attendees.length;r++)i=n.attendees[r],t.attendees.push(i),5>r&&l.push(i);t.attendees.length>=6&&(t.partAttendees=l,t.stillAttendees=a.i18n.t("cal/msg_stillattendees").replace("{0}",t.attendees.length-5))}}else{for(r=0;r<t.attendees.length;r++){i=t.attendees[r];for(var d=0;d<c.length&&a.Email.parseAddress(i.email)!==c[d].addr;d++);if(d<c.length)break}(r<t.attendees.length||"cancel"===o.calendar.meetingRequestMethod)&&(o.calendar.isExpired=!0,o.calendar.enableMeetingAction=!1,o.calendar.eventDetails=a.i18n.t("cal/event_detail_info"),o.calendar.isMeetingRequest||(o.calendar.subjectFeatured=a.i18n.t("mail/meeting_request_subject_featured_cancel")))}s.$(".j-meeting-request").html(s.compile(s.$("#meetingRequestTpl").html(),o.calendar))})):s.$(".j-meeting-request").html(s.compile(s.$("#meetingRequestTpl").html(),o.calendar)))},_handleMailNotFound:function(e){var t=this;l.alert(e,function(){a.detector.isDetachMode()?window.close():(t.sendMessage(t._params.fromView,"view:refresh",{start:t._params.listStart}),m.getUser().preview_layout?n("#previewLayoutRead").find(".j-mail-read").remove().end().find(".j-email-unchecked").show():t.sendMessage("mail","view:close",{target:t.state.param.pView}))})},_handleReadReceipt:function(e,t){var i=n(t).data("action"),a=n(t).closest(".j-read-receipt"),r=a.find("#receiptAlways").is(":checked");"send"===i?(this._handleReadReceiptSend(!0),r&&m.updateUser({op_readreceipt:2})):"cancel"===i&&m.updateUser({op_readreceipt:1}),a.remove()},_handleSSPUrl:function(e,t){var i=n(t).data("action"),r=this,s=r.$(".j-mail-content"),o=s.attr("src");switch(i){case"original":s.attr("src",o+"&filterLinks=false&filterImages=false");break;case"spam":r.toolbar.trigger("mail:remove",g.getFoldersMap().junk);break;case"delete":l.confirm(a.i18n.t("mbox/sspurl_confirm_delete"),function(){r.toolbar.trigger("mail:remove",g.getFoldersMap().trash)});break;case"close":r.$(".j-sspurl").remove()}},_handleReadReceiptSend:function(e){g.sendReadReceipt({id:this.state.param.mid,dispositionInfo:{mode:"automatic",type:"displayed"}}).then(function(){e&&n.notify.success(a.i18n.t("mail/read_send_receipt_success"))},function(){e&&n.notify.error(a.i18n.t("mail/read_send_receipt_fail"))})},_handleRecallMail:function(){var e=this;e.recallBox&&e.recallBox.destroy(),(e.recallBox=new c({mid:e._params.mid,mboxa:e.state.param.mboxa})).show()},_handleDestroyAutoDelMail:function(){var e=this;l.confirm(a.i18n.t("mbox/autoDel_sysDialog_message"),function(){g.destroyAutoDelMail({mid:e._params.mid}).then(function(){e.render()})})},_handleMailTop:function(e,t,i){var a;switch(t?a=n(t).data("type"):i&&(a=i.value.split(":")[0]),e&&(e.preventDefault(),e.stopPropagation()),a){case"label0":case"mark":this._handleMarkMail(i);break;case"dealings":this._handleMailDealings();break;case"mail_event":this._handleMailEvent();break;case"toggleBrief":this._handleToggleMailBrief();break;case"toggleContact":this._handleToggleContact(t)}},_handleMailEvent:function(){var e=this,t=e._params.mail;this.sendMessage("dispatcher","history:add",{module:"calendar",param:{mid:this.state.param.mid,historyUrl:encodeURIComponent("calendar")}});var i=setInterval(function(){var e=n(".j-calendar iframe");if(e.length>0){clearInterval(i);var r=[];n.each([t.from,t.to,t.cc,t.bcc],function(e,t){t&&n.each(t,function(e,t){var i=a.Email.parseAddress(t);-1===n.inArray(i,r)&&(r[r.length]=i)})}),e.attr("src",a.url.addUrlParams("cal/eventEdit.jsp",{sid:m.getSid(),func:"add",name:t.subject,attendees:encodeURIComponent(r.join(","))}))}},100)},_handleMarkMail:function(e){var t,n,i=this,a=this.state.param;0===e.value.indexOf("mark")?t=e.value.split(":")[1]:(t=e.value,n=e.value.split(":")[1]),g.markMails("read",a.mid,{flag:t,mboxa:a.mboxa||""}).then(function(){var r={};t=0===t.indexOf("label0")?"flagged":t,"flagged"===t?(n=n||0,r.flagged=!0):"noflagged"===t&&(r.flagged=!1),g.showMarkNotify(!0,!0,t,e.name),i.trigger("mail:mark",{type:t,label0:n}),("unread"===t||"read"===t)&&(i.sendMessage("mail","folder:refresh",{ids:a.fid}),r.read="read"===t),i.sendMessage(i._params.fromView,"view:refresh",{mid:a.mid,label0:n,flags:r})},function(){g.showMarkNotify(!0,!1,t,e.name)})},_handleMailDealings:function(){var e=this._params.mail.from,t={vid:"search",dealings:a.Email.parseAddress("array"===n.type(e)?e[0]:e)};this.sendMessage("dispatcher","history:add",{module:"mail.search",param:t}),a.detector.isDetachMode()&&location.reload()},_handleToggleMailBrief:function(){var e=this.get("briefMode");this.set("briefMode",!e)},_handleToggleContact:function(e){var t=n(e).closest(".j-contacts");t.hide().siblings(".j-contacts").show()},_handleMailMemo:function(){var e=this,t=this.$(".j-mail-memo"),n=this.$(".j-full-info");n.is(":visible")||e.$(".j-mail-top a[data-type=toggleBrief]").click(),t.removeClass("f-dn").find(".j-memo-box").removeClass("f-dn").find(".j-memo-edit").removeClass("f-dn").andSelf().find(".j-memo-msg").addClass("f-dn")},_handleScrollTo:function(){this._postMessageToFrame(!0)},_handleMeetingModify:function(e,t){var n,i=this,r=i.$(t).data("action");switch(r){case"modify":i.$(".j-meeting-btn").show(),i.$(t).parent().addClass("f-dn"),n=a.i18n.t("mail/select_modify_state").replace("{0}",i.$(".j-participation-display b").html()),i.$(".j-accept-state").html(n).show();break;case"toggleAttendees":var s=i.$(t).closest(".j-attendees");s.hide().siblings(".j-attendees").show();break;case"tentative":i._handleReplyMeetingRequest(2);break;case"accept":i._handleReplyMeetingRequest(3);break;case"decline":i._handleReplyMeetingRequest(4);break;case"addCal":i._handleAddToMyCal();break;case"deleteCal":i._handleDelFromMyCal();break;case"viewCal":i.sendMessage("dispatcher","history:add",{module:"calendar",param:{historyUrl:encodeURIComponent("calendar"),id:i.$(".j-view-cal").data("calUid"),view:"MONTH",func:"resp"}});break;case"goCal":i.sendMessage("dispatcher","history:add",{module:"calendar",param:{historyUrl:encodeURIComponent("calendar"),fid:1,selectedDate:i.$(".j-go-cal").data("caldate"),view:"MONTH"}});break;case"forwardCal":g.getComposeInfo({ctype:"forward",mid:i.state.param.mid,to:i.$(".j-forward-cal").data("organizer")}).then(function(e){i.sendMessage("mail","view:change",{module:"mail.compose",param:{id:e.id}})})}},_handleReplyMeetingRequest:function(e){var t=this,n={id:t.state.param.mid,userAttendeeStatus:e},i={2:a.i18n.t("mail/op_tentative"),3:a.i18n.t("mail/op_accept"),4:a.i18n.t("mail/op_decline")};l.confirm(a.i18n.t("mail/event_confirm_participation").replace("{0}",i[e]),function(){v.replyMeetingRequest(n).then(function(){t.$(".j-accept-state").hide().prev().removeClass("f-dn"),t.$(".j-participation-display").html(a.i18n.t("cal/event_participation_display").replace("{0}",i[e])),t.$(".j-participation-display b").html(i[e]).show(),t.$(".j-meeting-btn").hide(),t.$(".j-modify-msg").html(4===e?a.i18n.t("cal/event_participation_deleted"):a.i18n.t("cal/event_participation_added")).show()})})},_handleAddToMyCal:function(){var e=this;l.confirm(a.i18n.t("cal/event_confirm_participation_added"),function(){v.addToMyCal({id:e.state.param.mid}).then(function(t){t&&"FA_INVALID_REQUEST"===t.code?(n.notify.error(a.i18n.t("cal/event_participation_illegal")),a.i18n.t("cal/event_participation_illegal")):t&&"FA_INVALID_ATTENDEE"===t.code?n.notify.error(a.i18n.t("cal/event_participation_cancel")):t&&t.eventId&&(n.notify.success(a.i18n.t("cal/event_participation_added")),e.$(".j-add-cal").addClass("f-dn").siblings(".j-view-cal,.j-del-cal").removeClass("f-dn"))})})},_handleDelFromMyCal:function(){var e=this;l.confirm(a.i18n.t("cal/event_confirm_participation_delete"),function(){v.delFromMyCal({id:e.state.param.mid}).then(function(t){t&&"FA_INVALID_REQUEST"===t.code?(n.notify.error(a.i18n.t("cal/event_participation_illegal")),a.i18n.t("cal/event_participation_illegal")):t&&"FA_INVALID_ATTENDEE"===t.code?n.notify.error(a.i18n.t("cal/event_participation_cancel")):t&&t.declined&&(n.notify.success(a.i18n.t("cal/event_participation_deleted")),e.$(".j-add-cal").removeClass("f-dn").siblings(".j-view-cal,.j-del-cal").addClass("f-dn"))})})},_handleDecryptMessage:function(){var e=this,t={id:e.state.param.mid,part:e.state.param.part,autoName:!0,password:e.$("#password").val(),mboxa:e.state.param.mboxa};e.$("#password").val()?y.decryptMessage(t).then(function(){e.state.param.mailCipherPassword=t.password,e.render()},function(t){t&&"FA_MAIL_NOT_FOUND"===t.code?e._handleMailNotFound(t.message):t&&t.message&&e.$(".j-decryption-error").html(t.message).show()}):e.$(".j-decryption-error").html(a.i18n.t("mbox/read_mail_err_password_empty")).show()},_handleShowAuditDetails:function(e,t){var i=n(t).attr("encodekey")||"",r=n(t).attr("mid")||"";y.getHitRulesInfo(i,r).then(function(e){var t="";n.each(e||[],function(e,n){t+="["+n.ruleName+"]</br>"+n.ruleDetail+"</br>"}),l.alert(t,n.noop(),{title:a.i18n.t("mail/lbl_ruleInfosBox_title")})})},_handleSaveToNetFolder:function(e,t){for(var n=this,i=this.state.param.mid,a=n.$(t).data("id").toString().split("&"),r=[],s=0,o=a.length;o>s;s++)a[s]&&r.push(i+"/"+a[s]);new d({files:r}).show()},_handleSaveToExternalFolder:function(e,t){for(var n=this,i=this.state.param.mid,a=n.$(t).data("id").toString().split("&"),r=n.$(t).data("filename")||"",s=[],o=0,l=a.length;l>o;o++)a[o]&&s.push(i+"/"+a[o]);u.saveFilesToXNF(s,r).show()},_handleQuickReply:function(e,t){function i(){
c.find(".quick-reply-item").slideUp(200),c.find(".j-reply-default,.j-footer-btn").slideDown(200),this.$(".j-main").removeClass("mail-reply-open")}var r,s=n(t),o=this,c=this.$(".j-quick-reply"),d=c.find("textarea"),u=s.data("type"),p=o._params.mail,h="send"===u||"cancel"===u,f={};switch(u){case"open-quick-reply":c.find(".quick-reply-item,.j-footer-btn").slideUp(200),c.find(".j-reply-form").slideDown(200).find("textarea").focus(),this.$(".j-main").addClass("mail-reply-open");break;case"cancel":i();break;case"compose":l.confirm(a.i18n.t("mail/confirm_reply_all"),function(){a.detector.isDetachMode()?window.open("./detach.jsp?sid="+encodeURIComponent(m.getSid())+"#mail.compose?mid="+encodeURIComponent(p.id)+"&ctype=replyall"):(g.getComposeInfo({ctype:"replyall",mid:p.id}).then(function(e){o.sendMessage("mail","view:change",{module:"mail.compose",param:{id:e.id}})}),a.detector.isDetachMode()&&location.reload())});break;case"send":if(r=d.val()){c.find(".j-reply-form").slideUp(200),c.find(".j-reply-sending").show(),this.$(".j-main").removeClass("mail-reply-open"),f.quoteHTMLStart="<pre>"+r+"</pre>"+p.quoteHTMLStart,f.quoteTextStart=r+p.quoteTextStart,f.id=p.id,f.mboxa=this.state.param.mboxa||"",f.flagLinkAttached=p.trsAttachments.length>0;var v,_=p.from;if(v=_[0].indexOf("<")>0?_[0].substring(_[0].indexOf("<")+1,_[0].indexOf(">")):_[0],m.getUser().email==v){c.find(".j-reply-fail").html(a.i18n.t("mail/confirm_reply_error")).show().end().find(".j-reply-success").hide(),c.find(".quick-reply-item").slideUp(200),c.find(".j-reply-result").slideDown(200);break}g.quickReplyMessage(f).then(function(){d.val(""),c.find(".j-reply-success").show().end().find(".j-reply-fail").hide(),c.find(".quick-reply-item").slideUp(200),c.find(".j-reply-result").slideDown(200),o.sendMessage("mail.list","view:refresh")},function(e){c.find(".j-reply-fail").html(e).show().end().find(".j-reply-success").hide(),c.find(".quick-reply-item").slideUp(200),c.find(".j-reply-result").slideDown(200)})}else l.alert(a.i18n.t("mail/confirm_input_content"))}this.$(".j-quick-reply [data-type]").off("mousedown").on("mousedown",function(e){e.preventDefault()}),d.off("blur").on("blur",function(){h||i()})},_getRcptStatus:function(){var e=this,t=e._params.mail,n=t.flags,i=t.rclStatus,r="";return 3===i?r="RCPT_RECALLED_SUCC":5===i?r="RCPT_RECALLED_PART":n&&e.config.enableDeliveryStatus&&(n.rcptRead?r=n.rcptFailed?"RCPT_READ_FL":"RCPT_READ":n.rcptSucceed?r=n.rcptFailed?"RCPT_SUCC_FL":"RCPT_SUCC":n.rcptFailed?r="RCPT_FAIL":n.rcptQueued&&h(t.receivedDate).unix()>=h(e.config.deliveryStatusBeginTime).unix()&&(r="RCPT_QUEUED")),{type:r,message:a.i18n.t("main/alt_m_"+r)}},_initDeferDialog:function(e){e.stopPropagation(),this.config.enableDeferMail&&(this.deferDialog=new o({parentNode:this.element,parentView:this,mid:this.state.param.mid,mboxa:this.state.param.mboxa}))},_initDeferTip:function(){var e=this;e.$(".j-defer").each(function(){var t=n(this);new o({parentView:e,tipTpl:!0,trigger:n(this),mid:e.state.param.mid,deferDate:t.attr("deferDate"),mboxa:e.state.param.mboxa})})},_onRenderBriefMode:function(e){var t=this.$(".j-short-info"),n=this.$(".j-full-info"),i=this.$('.j-mail-top [data-type="toggleBrief"]');e?n.hide()&&t.show()&&i.find(".iconfont").removeClass("iconup").addClass("icondown"):t.hide()&&n.show()&&i.find(".iconfont").removeClass("icondown").addClass("iconup")},_updateContactCard:function(e){var t=this,i=null;n.each(t.widgets.contactCards,function(t,n){return e.trigger.is(n.get("trigger"))?(i=n,!1):void 0}),i&&i.destroy(),i=new p(e),t.widgets.contactCards.push(i)}});i.module({name:"mail.read",template:e("text!template/module/mail/read.tpl.html")},T)}),define("module/mail/search/service",["require","exports","module","util/index","jquery","../service"],function(e,t){function n(e){var t=s.Deferred();return e?(o.searchMailList(e).then(function(e){o.getFolders(!1,!0,!1).then(function(n){var a=e["var"];e.groupings=i(e.groupings,n),s.each(a,function(t,i){var a=(i.to||"").split(",")[0],l=r.Email.parseAddress("3"==i.fid?a:i.from),c=r.Email.parseTrueName("3"==i.fid?a:i.from);o.formatMail(i),i.fromEmail=l,i.fromName=c||l.substring(0,l.lastIndexOf("@")),e.mboxa&&-1!==e.mboxa.indexOf("@")&&(i.fid=i.fid+e.mboxa),s.each(n,function(e,t){return t.id==i.fid?(i.folderName=t.name,!1):void 0})}),e["var"]=a,t.resolve(e)},function(){t.reject()})},function(){t.reject()}),t.promise()):t.reject()}function i(e,t){var n=[];return!e||s.isEmptyObject(e)?n:(n.push(a("fromAddress",e.fromAddress)),n.push(a("fid",e.fid,t)),n.push(a("receivedDate",e.receivedDate)),n.push(a("priority",e.priority)),n.push(a("attachType",e["flags.attached"])),n.push(a("read",e["flags.read"])),n.push(a("flagType",e["flags.flagged"])),n)}function a(e,t,n){var i={};switch(e){case"fromAddress":s.each(t,function(e,t){var n=r.Email.parseAddress(t.val),i=r.Email.parseTrueName(t.val);t.emailAddr=n,t.name=i||n.substring(0,n.lastIndexOf("@"))}),i={type:"fromAddress",name:r.i18n.t("mbox/grouping_from_address"),list:t};break;case"fid":s.each(t,function(e,t){s.each(n,function(e,n){return n.id==t.val?(t.name=n.name,!1):void 0})}),i={type:"fid",name:r.i18n.t("mbox/grouping_fid"),list:t};break;case"receivedDate":s.each(t,function(e,t){t.name=r.i18n.t("mbox/grouping_sentDate_"+t.val+"_")}),i={type:"receivedDate",name:r.i18n.t("mbox/grouping_send_date"),list:t};break;case"priority":s.each(t,function(e,t){t.name=r.i18n.t("mbox/grouping_priority_"+t.val)}),i={type:"priority",name:r.i18n.t("mbox/grouping_priority"),list:t};break;case"attachType":s.each(t,function(e,t){t.name=r.i18n.t("mbox/grouping_attached_"+t.val)}),i={type:"attachType",name:r.i18n.t("mbox/grouping_flags_attached"),list:t};break;case"read":s.each(t,function(e,t){t.name=r.i18n.t("mbox/grouping_read_"+t.val)}),i={type:"read",name:r.i18n.t("mbox/grouping_flags_read"),list:t};break;case"flagType":s.each(t,function(e,t){t.name=r.i18n.t("mbox/grouping_flagged_"+t.val)}),i={type:"flagType",name:r.i18n.t("mbox/grouping_flags_flagged"),list:t}}return i}var r=e("util/index"),s=e("jquery"),o=e("../service");t.getMailList=n}),define("components/requirejs-text/text!template/module/mail/search.tpl.html",[],function(){return'<div class="m-mlsearch m-mllist">\r\n    {{#raw}}\r\n    <script id="toolbartpl" type="text/x-handlebars-template">\r\n        <div class="m-mllist-row">\r\n            <div class="j-module-top">\r\n                <div class="j-select-all-msg message-tip u-alert-warning"></div>\r\n                <div class="toolbar j-toolbar">\r\n                    <div class="u-btns" data-dropdown="select">\r\n                <span class="u-btn u-btn-default j-selectmail">\r\n                    <input type="checkbox" name="checkAll" />\r\n                    <span class="iconfont icondown"></span>\r\n                </span>\r\n                    </div>\r\n\r\n                    <div class="f-ib f-dn j-tgbtns">\r\n                        [[#if enableDelete]]\r\n                        <span class="u-btn u-btn-default j-maildelete">{{i18n "common/op_delete"}}</span>\r\n                        [[/if]]\r\n                        <div class="u-btns">\r\n                            [[#if enableUpdateMailStatus]]\r\n                            [[#if enableMoveTo]]\r\n                            <span class="u-btn u-btn-default" data-dropdown="move">{{i18n "common/op_move"}} <span class="iconfont icondown"></span></span>\r\n                            [[/if]]\r\n                            <span class="u-btn u-btn-default" data-dropdown="mark">{{i18n "common/op_mark"}} <span class="iconfont icondown"></span></span>\r\n                            [[/if]]\r\n                            [[#if enableSendMail]]\r\n                            <span class="u-btn u-btn-default" data-dropdown="more">{{i18n "common/op_more"}} <span class="iconfont icondown"></span></span>\r\n                            [[/if]]\r\n                        </div>\r\n                    </div>\r\n\r\n                    <span class="u-btn u-btn-default u-btn-round f-fr j-setting"><i class="iconfont iconset"></i></span>\r\n                    <div id="pagination" class="f-fr"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </script>\r\n\r\n    <script id="containertpl" type="text/x-handlebars-template">\r\n        <div class="m-mllist-row mllist-list-row">\r\n            <div class="list-bg"></div>\r\n            <div class="j-maillist mllist-list c-mail-list u-scroll"></div>\r\n            <div class="j-nlist nlist-wrap"></div>\r\n        </div>\r\n    </script>\r\n\r\n    <script id="listtpl" type="text/x-handlebars-template">\r\n        <div class="ctr-content j-content">\r\n            <div class="list-title j-listtt">\r\n                <span>[[i18n "mail/search_result" count=total]]</span>\r\n            </div>\r\n\r\n            <div class="list-body">\r\n                <table class="u-table [[#if list_style]] user-fs12[[/if]]">\r\n                    <tbody>\r\n                    [[#each list]]\r\n                    <tr class="j-mail[[#if flags.read]] read[[else]] unread[[/if]][[#if flags.flagged]] flagged label0-[[label0]][[/if]][[#and ../displaySummary summary]] display-summary[[/and]]"\r\n                        mid="[[id]]" fid="[[fid]]" [[#if flags.deferHandle]]deferDate="[[defer]]"[[/if]] >\r\n                        <td class="active-border"></td>\r\n                        <td class="check-col"><input type="checkbox" name="mid" data-draft="[[flags.draft]]" value="[[id]]" from="[[from]]"/></td>\r\n                        <td class="ico"><i class="iconfont [[icon]]"></i><i class="iconfont [[priorityIcon]]"></i></td>\r\n                        <td class="from" data-email="[[hemail fromEmail \'addr\']]">[[fromName]]</td>\r\n                        <td class="flag">[[#if ../../config.enableMailFlagged]]<i class="j-flag iconfont[[#if flags.flagged]] iconflatcolor[[else]] iconflat[[/if]]"></i>[[/if]]</td>\r\n                        <td class="subject">\r\n                            <span class="text-gray f-fwn">[\\{{folderName}}]</span>\r\n                            [[#if memo]]<span class="j-memo-tip" data-memo="[[memo]]"><i class="iconfont iconremarks"></i></span>[[/if]]\r\n                            <span title="[[#if subject]][[subject]][[else]][[i18n \'mail/empty_subject\']][[/if]]">\r\n                                [[#unless subject]]\r\n                                    [[i18n "mail/empty_subject"]]\r\n                                [[else]]\r\n                                    [[#if subjectPrefixFormatted.isSubtract]]\r\n                                        [[[ highlightSubject subjectPrefixFormatted.prefixes ../../../pattern ]]]\r\n                                        <b class="j-subtract-prefix-subject subtract-prefix-subject" data-subject="[[subject]]">... </b>\r\n                                        [[[ highlightSubject subjectPrefixFormatted.right ../../../pattern ]]]\r\n                                    [[else]]\r\n                                        [[[ highlightSubject subject ../../../pattern ]]]\r\n                                    [[/if]]\r\n                                [[/unless]]\r\n                            </span>\r\n                            [[#and ../displaySummary summary]]<div class="summary highlight f-ellipsis ">[[[summary]]]</div>[[/and]]\r\n                        </td>\r\n                        <td class="defer">\r\n                            [[#if ../../config.enableDeferMail]]\r\n                            [[#if flags.deferHandle]]\r\n                            <i [[defer]] title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="j-defer state-icon icon-mDEFER"></i>\r\n                            [[else]]\r\n                            <i title="[[i18n \'mail/list_set_defer\']]" class="j-undefer iconfont iconclock"></i>\r\n                            [[/if]]\r\n                            [[/if]]\r\n                        </td>\r\n                        <td class="attach"><i class="iconfont[[#if flags.attached]] iconacc[[/if]]"></i></td>\r\n                        <td class="time">[[formatReceivedDate]]</td>\r\n                        [[#if display_size]]<td class="size">[[display_size]]</td>[[/if]]\r\n                    </tr>\r\n                    [[/each]]\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    </script>\r\n\r\n    <script id="asidetpl" type="text/x-handlebars-template">\r\n        <div class="ctr-aside j-aside">\r\n            <div class="u-box">\r\n                <div class="u-box-head">\r\n                    <h3 class="u-box-head-title">[[i18n "mail/groupings_title" count=total]]</h3>\r\n                </div>\r\n                <div class="u-box-container">\r\n                    [[#if conditions]]\r\n                    <div class="u-box-content">\r\n                        <ul class="u-list z-selected j-cdtselected">\r\n                            [[#each conditions]]\r\n                            <li type="[[type]]" val="[[val]]">\r\n                                <a href="javascript:void(0);" title="[[name]]">[[name]]</a>\r\n                                <i class="iconfont icontabclose"></i>\r\n                            </li>\r\n                            [[/each]]\r\n                        </ul>\r\n                    </div>\r\n                    [[/if]]\r\n\r\n                    [[#each groupings]]\r\n                    <div class="u-box u-box-info">\r\n                        <div class="u-box-head j-group-toggle">\r\n                            <h3 class="u-box-head-title"><i class="iconfont icondown"></i> [[name]]</h3>\r\n                        </div>\r\n                        <div class="u-box-container">\r\n                            <div class="u-box-content">\r\n                                <ul class="u-list j-cdt" type="[[type]]">\r\n                                    [[#each list]]\r\n                                    <li class="[[#compare @index \'>\' 4]]f-dn[[/compare]]">\r\n                                        <a data-action="search" href="javascript:void(0);" title="[[#if emailAddr]][[emailAddr]][[else]][[name]][[/if]] ([[cnt]])"\r\n                                           val="[[val]]" name="[[name]]">[[name]] ([[cnt]])</a>\r\n                                    </li>\r\n                                    [[#compare @index \'==\' 5]]\r\n                                    <li><a data-action="more" href="javascript:void(0);">[[i18n "mbox/grouping_more"]]</a></li>\r\n                                    [[/compare]]\r\n                                    [[/each]]\r\n                                </ul>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    [[/each]]\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </script>\r\n\r\n    <script id="nlisttpl" type="text/x-handlebars-template">\r\n        <div class="nlist">\r\n            <div class="h3">[[[i18n "mail/search_result_empty" desc=desc]]]</div>\r\n            [[#if showTip]]\r\n            <div>[[i18n "mail/search_tip"]]</div>\r\n            <ul class="u-list">\r\n                <li>1. [[i18n "mail/search_change"]]</li>\r\n                <li>2. [[i18n "mail/search_advance"]]</li>\r\n            </ul>\r\n            [[/if]]\r\n        </div>\r\n    </script>\r\n\r\n    {{/raw}}\r\n</div>'}),define("module/mail/search/index",["require","i18n!mail,mbox,common","../../../component/memobox","jquery","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","../../../configurable/index","../../../util/index","component/maildeferbox","component/contactcard","../toolbar","../../common/globalService","../service","./service","moment","text!template/module/mail/search.tpl.html"],function(e){e("i18n!mail,mbox,common"),e("../../../component/memobox");var t=e("jquery"),n=e("cui/core/view/view"),i=e("cui/core/view/viewmanager"),a=e("cui/util/templatable/templatable"),r=e("../../../configurable/index"),s=e("../../../util/index"),o=e("component/maildeferbox"),l=e("component/contactcard"),c=e("../toolbar"),d=e("../../common/globalService"),u=e("../service"),p=e("./service"),h=e("moment"),f=n.extend({Implements:a,state:null,toolbar:null,widgets:{memoTip:null,contactCards:[]},events:{"click .j-subtract-prefix-subject":"_handleFullSubject","click tr.j-mail":"_handleReadOrCompose","click i.j-flag":"_handleFlagMail","click i.j-undefer":"_initDeferDialog"},setup:function(){this.state=d.getCurrentState(),this.config=r("mail.common",this),"function"===t.type(this.config.mboxaOverwrite)&&this.config.mboxaOverwrite(),this._params=t.extend(!0,{conditions:[]},this.state.param)},render:function(){f.superclass.render.call(this),this._updateMailList({initialize:!0}),this._initModuleEvents()},destroy:function(){this.toolbar&&this.toolbar.destroy(),t.each(this.widgets.contactCards,function(e,t){t.destroy()}),this.widgets.contactCards=[]},_initModuleEvents:function(){var e=this;e.offMessage("view:refresh").onMessage("view:refresh",function(n){var i=n?n.message:"",a=n?n.from:"";-1!==a.indexOf("mail.read:")||"mail"===a&&(e.state=i,e._params=t.extend(!0,{conditions:[]},e.state.param)),e._updateMailList({initialize:!0})})},_updateMailList:function(e){var n=this,i={},a=d.getUser();e=t.extend(n._params,{limit:a.maxlist},e,{refresh:e.resetPagination!==!1}),t.notify.loading(),this.config=r("mail.common",this),e.mboxa&&u.getMailBoxShareInfoById(e.mboxa).then(function(e){i.enableSendMail=e.send,i.enableDelete=e.rw,i.enableUpdateMailStatus=e.rw}),p.getMailList(e).then(function(t){return t.total<=0&&n.toolbar&&n.toolbar.trigger("mail:select","none"),t.total>0&&(e.start||0)>=t.total?(n._params.start=Math.max((t.total/t.limit-1)*t.limit,0),e.start=n._params.start,void n._updateMailList(e)):void(t.total>0?(n._params.total=t.total,n._params.limit=t.limit,n.state.param.folderName=s.i18n.t("main/mail_search"),n._renderMailList(t,i),n._initCheckbox(),e.initialize?(n._initToolbar(t.total,t.limit),delete n._params.initialize):n.toolbar&&e.resetPagination&&(n.toolbar.trigger("pagination:init",t.total,t.limit),delete n._params.resetPagination),n._initMemoTip(),n.config.enableDeferMail&&n._initDeferTip()):e.conditions.length>0?n._renderNAccurateMailList(t):n._renderNMailList())}).always(function(){t.notify.loading("hide")})},_renderMailList:function(e,n){var i,a,r=d.getUser(),s=this.$("#toolbartpl").html(),o=this.$("#containertpl").html(),l=this.$("#listtpl").html(),c=this.$("#asidetpl").html(),u="";i={conditions:this._params.conditions,groupings:this._filterGroups(e.groupings),list:e["var"],total:e.total,pattern:this.state.param.pattern,displaySummary:this.config.enableListBriefText&&r.list_brief_text&&this.state.param.pattern,list_style:r.list_style},o=t(o).find(".j-maillist").append(this.compile(c,i)+this.compile(l,i)).end(),this._params.initialize?(console.log(this.config.enableUpdateMailStatus),a=t.extend({},this.config,n),u=this.compile(s,a),this.element.children("div").remove().end().append(u).append(o)):this.$(".j-maillist").html(o.html()),this._initListPagination(),this._bindConditionHandler(),(this.config.supportPab||this.config.supportOab)&&this._initContactCard()},_initToolbar:function(e,t){this.toolbar=new c({element:this.$(".j-toolbar"),parent:this,total:e,limit:t,refresh:this._updateMailList}).render()},_initCheckbox:function(){var e=this,n=e.$("div.j-maillist");return n.customRadioCheckbox(),n.off("click.checkbox").on("click.checkbox",".checkbox",function(n){n.stopPropagation(),t(this).hasClass("checkbox-checked")?t(this).closest("tr").addClass("mail-selected"):t(this).closest("tr").removeClass("mail-selected"),e.toolbar.trigger("mail:select","check")}),e.state.param.selectAll?void e.toolbar.trigger("mail:select","all"):void(e.toolbar&&e.toolbar.trigger("mail:select","check"))},_initContactCard:function(){var e=this;e.$(".j-mail .from,.j-mail .to").each(function(){e._updateContactCard({parent:e,trigger:t(this),emailAddress:t(this).data("email"),pointPos:"20%",delay:800})})},_initMemoTip:function(){var e=this;return e.$(".j-memo-tip").length<1?!1:void e.$(".j-memo-tip").each(function(){var n=t(this).data("memo"),i=t(this).closest("tr.j-mail").attr("mid"),a=t(this).closest("tr.j-mail").attr("readthread");t(this).memoBox({mid:i,memo:n,tip:!0,parentNode:e.element,eventCallBack:function(){var t=this.get("memo");e.sendMessage((a?"mail.thread:":"mail.read:")+i,"read:mark",{type:"memo",memo:t})}})})},_initDeferTip:function(){var e=this;return e.$(".j-defer").length<1?!1:void e.$(".j-defer").each(function(){var n=t(this).closest("tr");new o({parentView:e,tipTpl:!0,trigger:t(this),mid:n.attr("mid"),deferDate:n.attr("deferDate")})})},_initDeferDialog:function(e,n){e.stopPropagation();var i=this,a=t(n).closest("tr"),r=a.attr("mid");i.config.enableDeferMail&&new o({parentNode:i.element,parentView:i,mid:r})},_renderNMailList:function(){var e=this.$("#nlisttpl").html();this.element.children("div").remove(),this.element.append(this.compile(e,{desc:this._getSearchTips(),showTip:!0}))},_renderNAccurateMailList:function(e){var t,n,i=this.$("#nlisttpl").html(),a=this.$("#asidetpl").html();t={conditions:this._params.conditions,groupings:this._filterGroups(e.groupings),total:e.total},n=this.compile(a,t)+this.compile(i,{desc:this._getSearchTips()}),this.$(".j-maillist").html(n),this._bindConditionHandler()},_filterGroups:function(e){t.each(this._params.conditions,function(n,i){t.each(e,function(t,n){return n.type===i.type?(e.splice(t,1),!1):void 0})});for(var n=e.length-1;n>=0;n--)e[n].list&&0!==e[n].list.length||e.splice(n,1);return e},_getSearchTips:function(){var e,n,i,a=this._params,r=u.makeSearchCondition(this._params),o={},l="";if(r.pattern&&(l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_content_contains")+'<span class="mark">"'+s.html.encode(r.pattern)+'"</span>'),r.subject&&(l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_subject_contains")+'<span class="mark">"'+s.html.encode(r.subject)+'"</span>'),r.fid&&!t.isEmptyObject(e=u.getCacheFolder(r.fid))&&(o.fid=!0,l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_advance_fid",{desc:'<span class="mark">"'+s.html.encode(e.name)+'"</span>'})),r.from&&(o.from=!0,l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_advance_from",{desc:'<span class="mark">"'+s.html.encode(r.from)+'"</span>'})),r.fromAddress&&(o.fromAddress=!0,l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_advance_from",{desc:'<span class="mark">"'+s.html.encode("pab"===r.fromType?r.fromEmail||"":r.fromAddress)+'"</span>'})),r.to&&(l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_advance_to",{desc:'<span class="mark">"'+s.html.encode(r.to)+'"</span>'})),r.sentDate){switch(l+=l.length>0?", ":"",r.sentDate){case"1":n=s.i18n.t("mbox/sendDate_option_oneday");break;case"3":n=s.i18n.t("mbox/sendDate_option_threeday");break;case"1w":n=s.i18n.t("mbox/sendDate_option_oneweek");break;case"1m":n=s.i18n.t("mbox/sendDate_option_onemonth");break;case"3m":n=s.i18n.t("mbox/sendDate_option_threemonth");break;case"6m":n=s.i18n.t("mbox/sendDate_option_halfyear");break;case"1y":n=s.i18n.t("mbox/sendDate_option_oneyear");break;default:i=r.sentDate.split(":"),n=2===i.length?s.i18n.t("mail/search_advance_sentDate_fromto",{from:i[0],to:h(i[1],"YYYY-MM-DD").subtract(1,"days").format("YYYY-MM-DD")}):r.sentDate}l+=s.i18n.t("mail/search_advance_sentDate",{desc:'<span class="mark">"'+n+'"</span>'})}if(r.flagType)switch(l+=l.length>0?", ":"",r.flagType){case"flagged":l+='<span class="mark">'+s.i18n.t("mbox/flagged_option_true")+"</span>";break;case"noflagged":l+='<span class="mark">'+s.i18n.t("mbox/flagged_option_false")+"</span>";break;default:0===r.flagType.indexOf("label0:")&&(i=r.flagType.split(":"),l+=s.i18n.t("mail/search_advance_flag",{desc:'<span class="mark">'+s.i18n.t("mbox/flagged_option_color"+i[1])+"</span>"}))}if(r.priority&&(o.priority=!0,l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_advance_priority",{desc:'<span class="mark">'+s.i18n.t("mbox/grouping_priority_"+r.priority)+"</span>"})),r.size)switch(l+=l.length>0?", ":"",r.size){case"0:102400":l+=s.i18n.t("mail/search_advance_size",{desc:'<span class="mark">'+s.i18n.t("mbox/mail_size_1")+"</span>"});break;case"102400:10485760":l+=s.i18n.t("mail/search_advance_size",{desc:'<span class="mark">'+s.i18n.t("mbox/mail_size_2")+"</span>"});break;case"10485760":l+=s.i18n.t("mail/search_advance_size",{desc:'<span class="mark">'+s.i18n.t("mbox/mail_size_3")+"</span>"})}return t.each(a.conditions,function(e,t){switch(t.type){case"fromAddress":o.from||o.fromAddress||(l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_advance_from",{desc:'<span class="mark">"'+s.html.encode(t.name)+'"</span>'}));break;case"fid":o.fid||(l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_advance_fid",{desc:'<span class="mark">"'+s.html.encode(t.name)+'"</span>'}));break;case"receivedDate":l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_advance_date",{desc:'<span class="mark">"'+s.html.encode(t.name)+'"</span>'});break;case"priority":o.priority||(l+=l.length>0?", ":"",l+=s.i18n.t("mail/search_advance_priority",{desc:'<span class="mark">"'+s.html.encode(t.name)+'"</span>'}))}}),l},_bindConditionHandler:function(){var e=this;e.$("ul.j-cdt").on("click",'a[data-action="search"]',function(n){n.preventDefault(),n.stopPropagation();var i=t(this).closest("ul").attr("type"),a=t(this).attr("val"),r=t(this).attr("name");"flagType"===i?a=t.parseJSON(a)?"flagged":"noflagged":"attachType"===i&&(a=t.parseJSON(a)?"attached":"noAttach"),e._params.conditions.push({type:i,name:r,val:a}),e._params[i]=a,e._updateMailList({resetPagination:!0,start:0})}),e.$(".j-group-toggle").on("click",function(e){var n=t(this).find(".iconfont"),i=t(this).next(".u-box-container"),a=i.find('ul.j-cdt a[data-action="more"]');n.hasClass("icondown")?(n.removeClass("icondown").addClass("iconup"),i.slideUp()):(n.removeClass("iconup").addClass("icondown"),i.slideDown(),a.show().parent().nextAll("li").hide()),e.preventDefault(),e.stopPropagation()}),e.$("ul.j-cdt").on("click",'a[data-action="more"]',function(e){t(this).hide().parent().nextAll("li").slideDown(),e.preventDefault(),e.stopPropagation()}),e.$("ul.j-cdtselected").on("click","i",function(n){n.preventDefault(),n.stopPropagation();var i=t(this).closest("li"),a=i.attr("type"),r=i.attr("val");t.each(e._params.conditions,function(t,n){return a==n.type&&n.val==r?(e._params.conditions.splice(t,1),!1):void 0}),e.state.param.hasOwnProperty(a)?e._params[a]=e.state.param[a]||"":delete e._params[a],e._updateMailList({resetPagination:!0,start:0})})},_handleFullSubject:function(e){e.preventDefault(),e.stopPropagation();var n=t(e.target),i=n.attr("data-subject"),a=n.closest("span");a.html(this.templateHelpers.highlightSubject(i,this.state.param.pattern))},_handleReadOrCompose:function(e,n){var i=this,a=t(n).attr("mid"),r=i.state.param.fid||t(n).attr("fid"),s=u.getCacheSearchMailList()["var"],o={},l={},c={};t.each(s,function(e,t){return t.id===a?(o=t,l.start=e,!1):void 0}),void 0!=l.start&&(l.start=l.start+this._params.start),this.config.enableCompose&&o.flags&&o.flags.draft?(u.markMails("search",a,{flag:"read"}).then(function(e){e&&i.sendMessage("mail","folder:refresh",{ids:r})}),c={mboxa:i._params.mboxa||"",mid:a,tabTitle:o.subject,condition:i._params,ctype:"draft",replace:!0},i.sendMessage("mail","view:change",{module:"mail.compose",param:c})):(l=t.extend({mboxa:i._params.mboxa||"",fid:r,mid:a,tabTitle:o.subject,pView:"search",condition:i._params},l),i.sendMessage("mail","view:change",{module:"mail.read",param:l}))},_handleFlagMail:function(e,n){e.preventDefault(),e.stopPropagation();var i=t(n),a=i.closest("tr"),r=a.hasClass("flagged");r?this.toolbar.trigger("mail:mark",a.attr("mid"),"noflagged",{}):this.toolbar.trigger("mail:mark",a.attr("mid"),"flagged",{name:s.i18n.t("common/op_flagged")})},_initListPagination:function(){var e=this,n=this.$(".j-maillist .j-content"),i=t("<div>",{"class":"mllist-pagination"}),a=this._params.total||0,r=this._params.limit||10,s=this._params.start||0,o=s?s/r:0;i.html('<div class="mllist-pagination-bg"></div><div class="mllist-pagination-content"></div>'),n.append(i),i.find(".mllist-pagination-content").pagination({total:a,limit:r,currentPage:o,round:!0,prevText:'<span class="iconfont iconprevious"></span>',nextText:'<span class="iconfont iconnext"></span>',menu:!0,menuAlignCenter:!0,callback:function(t){e._updateMailList({start:t*r,resetPagination:!0})}})},_updateContactCard:function(e){var n=this,i=null;t.each(n.widgets.contactCards,function(t,n){return e.trigger.is(n.get("trigger"))?(i=n,!1):void 0}),i&&i.destroy(),i=new l(e),n.widgets.contactCards.push(i)},templateHelpers:{highlightSubject:function(e,t){return e=s.html.encode(e),null!=t&&t.length?e.replace(new RegExp(s.html.encode(t),"gi"),function(e){return['<span class="subject-highlight">',e,"</span>"].join("")}):e},replaceDefer:function(e,t){return s.i18n.t(t).replace("{0}",e)}}});i.module({name:"mail.search",template:e("text!template/module/mail/search.tpl.html")},f)}),define("widget/pin/pin",["require","jquery"],function(e){var t=e("jquery"),n={init:function(e){return this.each(function(){var n=t(this),i=t.extend(!0,t.fn.pin.defaults,e);n.data("pin.settings",i),n.attr("role","jqueryPin"),n.pin("initEvent")})},initEvent:function(){var e,n=t(this),i=n.data("pin.settings")||{},a=i.scrollElement,r=i.delayTime;a.on("scroll.pin",function(){e&&clearTimeout(e),n.hide(),e=setTimeout(function(){n.pin("setPosition"),n.fadeIn()},r)}),t(window).on("resize.pin",function(){n.pin("setPosition")}),n.pin("setPosition")},setPosition:function(){var e=t(this),n=e.data("pin.settings")||{},i=n.marginElement?e.prevAll(n.marginElement).outerHeight():n.marginTop,a=e.parents(n.parentElement)||e.parent(),r=t(window).outerHeight(),s=a.outerHeight(),o=a.offset()?a.offset().top:"",l=e.outerHeight();t.isEmptyObject(n)||(o+s>=r?e.css({bottom:s+o-r}):e.css({bottom:0}),o+l+i>r&&e.css({bottom:s-i-l}))},destroy:function(){var e=t(this),n=e.data("pin.settings")||{},i=n.scrollElement;i&&i.off("scroll.pin"),e.removeData("pin.settings").removeAttr("role"),t(window).off("resize.pin")}};t.fn.pin=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):t.isPlainObject(e)?n.init.apply(this,arguments):void t.error("Method"+e+"does not exist on jquery.pin")},t.fn.pin.defaults={marginTop:0,delayTime:300,scrollElement:t(window)}}),define("components/requirejs-text/text!template/module/mail/thread.tpl.html",[],function(){return'<section class="m-thread j-mail-read">\r\n\r\n    <!---->\r\n    <header class="toolbar f-cf f-dn j-toolbar"></header>\r\n    <!---->\r\n    <div id="threadTitle" class="thread-title f-cf"></div>\r\n    <div id="threadList" class="j-u-scroll thread-list u-scroll"></div>\r\n\r\n    <!--  -->\r\n    {{#raw}}\r\n    <script id="toolbarMenuTpl" type="text/x-handlebars-template">\r\n        <div id="pagination" class="u-page u-page-round f-fr"></div>\r\n        <span class="u-btn u-btn-default" data-btn="delete">{{i18n "common/op_delete_thread"}}</span>\r\n        <div class="u-btns">\r\n            <span class="u-btn u-btn-default" data-dropdown="move">{{i18n "common/op_move"}}<span class="iconfont icondown"></span></span>\r\n            <span class="u-btn u-btn-default" data-dropdown="mark">{{i18n "common/op_mark"}}<span class="iconfont icondown"></span></span>\r\n        </div>\r\n        <span class="u-btn u-btn-default j-toggle-thread" data-type="expand">{{i18n "common/op_expand_all"}}</span>\r\n        <span class="u-btn u-btn-default" data-dropdown="thread-more">{{i18n "common/op_more"}}<span class="iconfont icondown"></span></span>\r\n    </script>\r\n\r\n    <!---->\r\n    <script id="threadTitleTpl" type="text/x-handlebars-template">\r\n        <h2 class="[[#if flags.flagged]] flagged label0-[[label0]][[/if]] f-ellipsis">\r\n            <span class="icon"><i class="j-sourceIcon iconfont [[sourceIcon]]" title="[[sourceMsg]]"></i></span>\r\n            [[subject]]\r\n        </h2>\r\n        <div class="tool">\r\n            [[#if enableMailFlagged]]\r\n            <span class="mark-op mail-flagged f-pr" data-dropdown="flag-color">\r\n                <i class="iconfont[[#if flags.flagged]] iconflatcolor flagged label0-[[label0]][[else]] iconflat[[/if]]"\r\n                   title="[[i18n \'mbox/mail_flag_flagged_true\']]"></i>\r\n                <i class="iconfont icondown"></i>\r\n            </span>\r\n            [[/if]]\r\n\r\n            [[#if enableMailDefer]]\r\n            <span class="j-defer f-csp" data-mid="[[id]]" deferDate="[[defer]]">\r\n                [[#if flags.deferHandle]]\r\n                <i title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="deferred state-icon icon-mDEFER"></i>\r\n                [[else]]\r\n                <i title="[[i18n \'mail/list_set_defer\']]" class="iconfont iconclock"></i>\r\n                [[/if]]\r\n            </span>\r\n            [[/if]]\r\n            <span class="j-newtab f-pr">\r\n                <a class="newtab iconfont iconnewtab" href="./detach.jsp?sid=[[sid]]#mail.thread?mid=[[id]]&fid=[[fid]]&mboxa=[[mboxa]]&start=[[start]]" target="_blank" title=\'[[i18n "mbox/mail_blank"]]\'></a>\r\n            </span>\r\n        </div>\r\n    </script>\r\n\r\n    <!---->\r\n    <script id="threadListTpl" type="text/x-handlebars-template">\r\n        [[#each data]]\r\n            [[#if ../hideOtherThread]]\r\n            [[#compare @index \'==\' ../../hideThreadCount]]\r\n                [[#if ../../../hideThreadCount]]\r\n                <div class="toggle-other-thread j-toggle-other-thread">\r\n                    <a class="toggle-btn j-toggle-item" data-type="hideItem" href="javascript:void(0)">\r\n                        [[i18n "mail/show_hidden_toggle_mail" count=../../../../hideThreadCount]]\r\n                    </a>\r\n                    <div class="double-line"></div><div class="double-line"></div>\r\n                </div>\r\n                [[/if]]\r\n            [[/compare]]\r\n            [[/if]]\r\n            <div class="j-thread-item thread-item f-cf [[#if ../hideOtherThread]][[#compare @index \'>=\' ../../hideThreadIndex]]f-dn other-thread[[/compare]][[/if]]"\r\n                 data-mid="[[id]]" lastMessage="[[#if lastMessage]]true[[/if]]">\r\n                <div class="arrow [[#if isFromCurUser]]arrow-right[[else ]]arrow-left[[/if]]"><em class="arrow-em"></em><span class="arrow-span"></span></div>\r\n                <div class="left f-cf">\r\n                    <span class="from f-ib f-ellipsis grid-col3">\r\n                        [[#if delegatedSender]]\r\n                        <span class="delegate-mail" title="[[i18n \'prop:mail/read_delegate_send\' 0=delegatedSender]]">[[i18n "mail/read_delegate_mail"]]</span>\r\n                        [[/if]]\r\n                        [[#if isStranger]]\r\n                        <span class="icon-stranger"></span>\r\n                        [[/if]]\r\n                        <strong>[[#if formatFrom.true_name]][[formatFrom.true_name]][[else]][[formatFrom.emailAddress]][[/if]]</strong>\r\n                    </span>\r\n                    <span class="summary f-ib f-ellipsis grid-col9">[[summary]]</span>\r\n                </div>\r\n                <div class="right">\r\n                    <div class="f-fr f-tar">\r\n                        [[#or flags.attached flags.linkAttached]]\r\n                        <span class="attached"><i class="iconfont iconacc"></i></span>\r\n                        [[/or]]\r\n                        <span class="date f-ellipsis">[[sentDate]]</span>\r\n                    </div>\r\n                    <div class="item-flags-wrap f-fr">\r\n                        <div class="item-flags">\r\n                            [[#if enableMailFlagged]]\r\n                            <span class="u-flag j-flag" data-value="[[#if flags.flagged]]true[[else]]false[[/if]]" data-mid="[[id]]">\r\n                                [[#if flags.flagged]]\r\n                                <i title="[[i18n \'mail/list_cancel_flag\']]" class="flagged iconfont iconflatcolor label0-[[label0]]"></i>\r\n                                [[else]]\r\n                                <i title="[[i18n \'mail/list_set_flag\']]" class="iconfont iconflat"></i>\r\n                                [[/if]]\r\n                            </span>\r\n                            [[/if]]\r\n\r\n                            [[#if enableMailDefer]]\r\n                            <span class="j-defer" data-value="[[#if flags.deferHandle]]true[[else]]false[[/if]]" data-mid="[[id]]" deferDate="[[defer]]">\r\n                                [[#if flags.deferHandle]]\r\n                                <i title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="deferred state-icon icon-mDEFER"></i>\r\n                                [[else]]\r\n                                <i title="[[i18n \'mail/list_set_defer\']]" class="iconfont iconclock"></i>\r\n                                [[/if]]\r\n                            </span>\r\n                            [[/if]]\r\n                        </div>\r\n                        &nbsp;\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="j-mail-info thread-item-info f-dn" data-mid="[[id]]"></div>\r\n        [[/each]]\r\n    </script>\r\n\r\n    <!---->\r\n    <script id="threadInfoTpl" type="text/x-handlebars-template">\r\n        <div class="mail-top j-mail-top">\r\n            <div class="arrow [[#if isFromCurUser]]arrow-right[[else ]]arrow-left[[/if]]"><em class="arrow-em"></em><span class="arrow-span"></span></div>\r\n            <div class="f-cf head">\r\n                <div class="f-ellipsis head-left j-toggle-item" data-type="curItem">\r\n                    [[#if delegatedSender]]\r\n                    <span class="delegate-mail" title="[[i18n \'prop:mail/read_delegate_send\' 0=delegatedSender]]">[[i18n "mail/read_delegate_mail"]]</span>\r\n                    [[/if]]\r\n                    [[#each from]]\r\n                    <strong class="mail-form u-email-tip" addr="[[hemail this \'addr\']]">[[[strangerIconHtml this]]][[hemail this \'both\']]</strong>\r\n                    [[/each]]\r\n\r\n                    [[#if delegatedSender]]\r\n                    <span>([[i18n "prop:mail/read_delegate_send" 0=delegatedSender]]</span>)\r\n                    [[/if]]\r\n\r\n                    [[#if isSenderMode]]([[[senderMessage]]])[[/if]]\r\n                    <!---->\r\n                    <span class="j-short-info">\r\n                        <span class="send-to">[[i18n "mbox/send_to"]]</span>\r\n                        <a href="javascript:void(0)">[[to]]</a>\r\n                    </span>\r\n                </div>\r\n                <div class="f-fr head-right">\r\n                    [[#if enableMailFlagged]]\r\n                        <span class="u-flag j-flag f-csp" data-mid="[[id]]">\r\n                            [[#if flags.flagged]]\r\n                            <i title="[[i18n \'mail/list_cancel_flag\']]" class="flagged iconfont iconflatcolor label0-[[label0]]"></i>\r\n                            [[else]]\r\n                            <i title="[[i18n \'mail/list_set_flag\']]" class="iconfont iconflat"></i>\r\n                            [[/if]]\r\n                        </span>\r\n                    [[/if]]\r\n\r\n                    [[#if enableMailDefer]]\r\n                    <span class="j-defer f-pr f-csp" data-mid="[[id]]" deferDate="[[defer]]">\r\n                        [[#if flags.deferHandle]]\r\n                            <i title="[[replaceDefer defer \'mail/list_handle_defer\']]" class="deferred state-icon icon-mDEFER"></i>\r\n                        [[else]]\r\n                            <i title="[[i18n \'mail/list_set_defer\']]" class="iconfont iconclock"></i>\r\n                        [[/if]]\r\n                    </span>\r\n                    [[/if]]\r\n\r\n                    [[#if enableDealings]]\r\n                    <a class="dealings iconfont iconemailcontacts j-dealings" data-mid="[[id]]" href="javascript:void(0)" title=\'[[i18n "mbox/mail_dealings"]]\'></a>\r\n                    [[/if]]\r\n\r\n                    [[#if config.enableMailMemo]]\r\n                        <span class="j-memo-tip f-ib[[#unless memo]] f-dn[[/unless]]" data-memo="[[memo]]"><i class="iconfont iconremarks"></i></span>\r\n                    [[/if]]\r\n\r\n                    <a class="j-attach-wrap attach-icon f-dn j-view-attach" title="[[i18n \'mbox/mail_viewatta\']]" href="javascript:void(0)">\r\n                        <i class="iconfont iconacc"></i>(<span class="j-attach-desc">[[totalAttachs]]</span>)\r\n                    </a>\r\n\r\n                    <span>[[sentDate]]</span>\r\n                    <a class="iconfont icondown" href="javascript:void(0)" data-type="toggleBrief"></a>\r\n                </div>\r\n            </div>\r\n\r\n            <!---->\r\n            <div class="grid-row full-info j-full-info f-dn">\r\n                <div class="grid-col12">\r\n                    <table class="u-table u-table-row">\r\n                        <tr>\r\n                            <td class="info-item">[[[i18n "mbox/mail_subject"]]] :</td>\r\n                            <td>\r\n                                [[#if composeExtra.showOneRcpt]]\r\n                                <span class="doc-icon doc-one-rcpt">[[i18n "mail/mail_onercpt"]]</span>\r\n                                [[/if]]\r\n                                [[subject]]\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class="info-item">[[i18n "mbox/mail_to"]] :</td>\r\n                            <td>\r\n                                [[#if partto]]\r\n                                <div class="j-contacts">\r\n                                    [[#each partto.contacts]]\r\n                                    <span class="u-email u-email-tip" addr="[[hemail this \'addr\']]">\r\n                                        <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                        <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                    </span>\r\n\r\n                                    [[#unless @last]]\r\n                                    <span class="divider">,</span>\r\n                                    [[/unless]]\r\n\r\n                                    [[/each]]\r\n                                    <span>.. <a href="javascript:void(0)" data-type="toggleContact">[[partto.stillContacts]]</a></span>\r\n                                </div>\r\n                                [[/if]]\r\n\r\n                                <div class="j-contacts [[#if partto]]f-dn[[/if]]">\r\n                                    [[#each to]]\r\n                                     <span class="u-email u-email-tip" addr="[[hemail this \'addr\']]">\r\n                                        <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                        <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                     </span>\r\n\r\n                                    [[#unless @last]]\r\n                                    <span class="divider">,</span>\r\n                                    [[/unless]]\r\n\r\n                                    [[/each]]\r\n                                    [[#if partto]]\r\n                                    <span><a href="javascript:void(0)" data-type="toggleContact">[[i18n "mail/mail_hidemsg"]]</a></span>\r\n                                    [[/if]]\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                        [[#if cc]]\r\n                        <tr>\r\n                            <td class="info-item">[[[i18n "mbox/mail_cc"]]] :</td>\r\n                            <td>\r\n                                [[#if partcc]]\r\n                                <div class="j-contacts">\r\n                                    [[#each partcc.contacts]]\r\n                                     <span class="u-email u-email-tip" addr="[[hemail this \'addr\']]">\r\n                                        <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                        <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                     </span>\r\n\r\n                                    [[#unless @last]]\r\n                                    <span class="divider">,</span>\r\n                                    [[/unless]]\r\n\r\n                                    [[/each]]\r\n                                    <span>.. <a href="javascript:void(0)" data-type="toggleContact">[[partcc.stillContacts]]</a></span>\r\n                                </div>\r\n                                [[/if]]\r\n\r\n                                <div class="j-contacts [[#if partcc]]f-dn[[/if]]">\r\n                                    [[#each cc]]\r\n                                     <span class="u-email u-email-tip" addr="[[hemail this \'addr\']]">\r\n                                        <span class="name">[[hemail this \'nameOnly\']]</span>\r\n                                        <span class="address">[[hemail this \'addrWithQuote\']]</span>\r\n                                     </span>\r\n\r\n                                    [[#unless @last]]\r\n                                    <span class="divider">,</span>\r\n                                    [[/unless]]\r\n\r\n                                    [[/each]]\r\n                                    [[#if partcc]]\r\n                                    <span><a href="javascript:void(0)" data-type="toggleContact">[[i18n "mail/mail_hidemsg"]]</a></span>\r\n                                    [[/if]]\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                        [[/if]]\r\n                        [[#if totalAttachs]]\r\n                        <tr class="j-attach-wrap j-long-info"></tr>\r\n                        [[/if]]\r\n                        [[#if config.enableMailMemo]]\r\n                        <tr id="mailMemo" class="[[#unless memo]]f-dn[[/unless]] j-mail-memo">\r\n                            <td class="info-item">[[i18n "mail/memo"]] :</td>\r\n                            <td class="j-memo-box"></td>\r\n                        </tr>\r\n                        [[/if]]\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div id="readContent" class="mail-content-read">\r\n            <div class="j-read-alert" data-mid="[[mid]]"></div>\r\n            <!---->\r\n            [[#if calendar]]<div class="j-meeting-request meeting-request" data-mid="[[mid]]"></div>[[/if]]\r\n\r\n            <!---->\r\n            [[#if mailCipherEncrypted]]\r\n            <div class="mail-cipher-encrypted j-mailCipherEncrypted" data-mid="[[mid]]">\r\n                [[#if mailCipherPassword]]\r\n                <div class="decryption-success">\r\n                    <span class="iconfont iconunlock"></span>\r\n                    [[i18n "mbox/read_mail_cipher_decrypted_tip"]]\r\n                </div>\r\n                [[else]]\r\n                <div class="no-decryption">\r\n                    <div class="lock-item"><span class="iconfont iconlock"></span></div>\r\n                    <div class="action-item">\r\n                        <input type="password" placeholder=\'[[i18n "mail/read_mail_password_prompt"]]\' class="u-input" name="password" id="password" maxlength="6" />\r\n                    </div>\r\n                    <div class="decryption-msg">\r\n                        [[! showEncpwd]]\r\n                        <span class="j-decryption-error decryption-error f-dn"></span>\r\n                    </div>\r\n                    <div class="action-item">\r\n                        <span class="u-btn u-btn-primary j-decrypt-submit">[[i18n "main/bt_submit"]]</span>\r\n                    </div>\r\n                    <div class="label-item">[[[cipherEncryptedMsg]]]</div>\r\n                    <div class="label-item">[[i18n "mail/read_mail_cipher_encrypted_tip_1"]]</div>\r\n                </div>\r\n                [[/if]]\r\n            </div>\r\n            [[/if]]\r\n\r\n            <!---->\r\n            <div class="mail-content[[#if calendar]] calendar[[/if]]">\r\n                <iframe width="100%" height="100%" id="mail-[[iframeId]]" class="j-mail-content" frameborder="0" sandbox="allow-scripts allow-popups"\r\n                        src="jsp/viewMailHTML.jsp?mid=[[encodeUriComponent mid]]&mailCipherPassword=[[mailCipherPassword]]&partId=0&isSearch=&priority=&supportSMIME=&striptTrs=true&iframeId=[[iframeId]]&sspurl=[[sspurl]]&isThread=true">\r\n                </iframe>\r\n            </div>\r\n\r\n            <!---->\r\n            <div class="mail-attachments-wrap j-mail-attachments-wrap"></div>\r\n        </div>\r\n\r\n        <!---->\r\n        <!--webmail/addon/EnableQuickReply-->\r\n        <footer data-mid="[[mid]]"\r\n                class="quick-reply j-quick-reply [[#and config.enableReplyWithAttachments hasAttachment]]quick-reply-withAttachments[[/and]]">\r\n            [[#if config.enableQuickReply]]\r\n            <div class="quick-reply-default quick-reply-item j-reply-default" data-type="open-quick-reply">[[i18n "mail/quick_reply_to"]]</div>\r\n            <form class="quick-reply-form quick-reply-item j-reply-form f-dn" action="">\r\n                <textarea name="replyContent" class="reply-textarea" rows="6"></textarea>\r\n                <span class="u-btn u-btn-primary" data-type="send">[[i18n "common/send"]]</span>\r\n                <span class="u-btn u-btn-default" data-type="cancel">[[i18n "common/cancel"]]</span>\r\n                [[#if config.enableReply]]\r\n                <span class="f-fr"><a href="javascript:void(0)" data-type="compose">[[i18n "mbox/switch_to_full_mode"]]</a></span>\r\n                [[/if]]\r\n            </form>\r\n            <div class="quick-reply-item f-dn j-reply-sending">\r\n                <span class="reply-state reply-sending">[[i18n "mbox/reply_sending"]]</span>\r\n            </div>\r\n            <div class="quick-reply-item f-dn j-reply-result">\r\n                <span class="reply-state reply-success j-reply-success">[[i18n "mbox/reply_succ"]]</span>\r\n                <span class="reply-state reply-fail j-reply-fail">[[i18n "mbox/reply_fail"]]</span>\r\n                <a href="javascript:void(0)" data-type="open-quick-reply">[[i18n "mbox/reply_again"]]</a>\r\n            </div>\r\n            [[/if]]\r\n\r\n            <div class="j-footer-btn  u-btns [[#if config.enableQuickReply]] f-fr[[/if]]">\r\n                <span class="u-btn u-btn-default" data-action="delete">[[i18n "common/op_delete"]]</span>\r\n                [[#if config.enableReply]]\r\n                    [[#and config.enableReplyWithAttachments hasAttachment]]\r\n                    <span class="u-btn u-btn-default" data-dropdown="reply">[[i18n "common/op_reply"]]<span class="iconfont icondown"></span></span>\r\n                    <span class="u-btn u-btn-default" data-dropdown="reply-all">[[i18n "common/op_replyall"]]<span class="iconfont icondown"></span></span>\r\n                    [[else]]\r\n                    <span class="u-btn u-btn-default" data-action="reply">[[i18n "common/op_reply"]]</span>\r\n                    <span class="u-btn u-btn-default" data-action="replyall">[[i18n "common/op_replyall"]]</span>\r\n                    [[/and]]\r\n                [[/if]]\r\n                [[#if config.enableForward]]\r\n                <span class="u-btn u-btn-default" data-action="forward">[[i18n "common/op_forward"]]</span>\r\n                [[/if]]\r\n                <span class="u-btn u-btn-default" data-dropdown="read-more">[[i18n "common/op_more"]]<span class="iconfont icondown"></span></span>\r\n            </div>\r\n        </footer>\r\n    </script>\r\n\r\n    <!---->\r\n    <script id="mailFilterTpl"  type="text/x-handlebars-template">\r\n        <div class="filter-dialog j-filter  f-cf">\r\n            <div class="filter-item">[[i18n "common/mail_fast_filter_tip"]]</div>\r\n            <div class="filter-item">\r\n                <label class="filter-label">[[i18n "mbox/mail_from"]] :</label>\r\n                <span class="f-wwb ">[[from]]</span>\r\n            </div>\r\n            <div class="filter-item">\r\n                <label class="filter-label" for="folder">[[i18n "common/op_move"]] :</label>\r\n                <select id="folder" name="folder">\r\n                    <option value="0">[[i18n "main/fdr_root"]]</option>\r\n                    [[#each folders]]\r\n                    <option value="[[id]]">[[name]]</option>\r\n                    [[/each]]\r\n                    <optgroup>\r\n                        <option value="newFolder">[[i18n "common/new_folder"]]</option>\r\n                    </optgroup>\r\n                </select>\r\n            </div>\r\n            <div class="filter-item create-folder f-dn">\r\n                <label class="filter-label" for="folderName">[[i18n "common/folder_name"]] :</label>\r\n                <input type="text" class="u-input" id="folderName" name="folderName" />\r\n            </div>\r\n            <div class="filter-item create-folder f-dn">\r\n                <label class="filter-label" for="folderParent">[[i18n "common/position"]] :</label>\r\n                <select id="folderParent" name="folderParent" >\r\n                    <option value="0">[[i18n "main/fdr_root"]]</option>\r\n                    [[#each folders]]\r\n                    <option value="[[id]]">[[name]]</option>\r\n                    [[/each]]\r\n                </select>\r\n            </div>\r\n            <div class="filter-rules f-cf">\r\n                <input type="checkbox" name="toAllEmails" id="toAllEmails"/><label for="toAllEmails">[[i18n "common/to_all_emails"]]</label>\r\n            </div>\r\n            <div class="filter-item">\r\n                [[i18n "common/create_new_filter"]]\r\n                <a class="hyperlinks j-filter-page" href="javascript:void(0)">\r\n                    [[i18n "common/create_new_filter_URL"]]\r\n                </a>\r\n            </div>\r\n        </div>\r\n    </script>\r\n\r\n    <script id="meetingRequestTpl" type="text/x-handlebar-template">\r\n        <strong class="f-db meeting-item">[[[replyStatusDisplay]]]</strong>\r\n\r\n        <div class="meeting-box f-cf [[#unless enableMeetingAction]]meeting-box-disabled[[/unless]]">\r\n            <h4 class="meeting-box-decorate"></h4>\r\n            <div class="meeting-header">\r\n                <div class="subject f-ellipsis">[[meetingRequest.name]]</div>\r\n                <div class="details">[[eventDetails]]</div>\r\n            </div>\r\n            <div class="meeting-content">\r\n                <table>\r\n                    <tbody>\r\n                    [[#if allDayEventDate]]\r\n                    <tr class="date-info">\r\n                        <td><span class="item-icon"></span></td>\r\n                        <td class="meeting-item">[[i18n "cal/info_event_date"]]:</td>\r\n                        <td>\r\n                            [[#if isMembers]]\r\n                            <a href="javascript:void(0)" class="j-go-cal" data-action="goCal" data-caldate="[[startDateYMD]]">[[allDayEventDate]]</a>\r\n                            [[else]]\r\n                            [[allDayEventDate]]\r\n                            [[/if]]\r\n                        </td>\r\n                    </tr>\r\n                    [[/if]]\r\n                    <tr class="time-info">\r\n                        <td><span class="item-icon"></span></td>\r\n                        <td class="meeting-item">[[i18n "cal/info_event_time"]]:</td>\r\n                        <td>[[#if timeZone]][[timeZone]][[/if]] [[eventTime]]\r\n                            [[#if isMembers]]\r\n                            <a href="javascript:void(0)" class="j-go-cal" data-action="goCal" data-caldate="[[startDateYMD]]">[[eventTime]]</a>\r\n                            [[else]]\r\n                            [[eventTime]]\r\n                            [[/if]]\r\n                        </td>\r\n                    </tr>\r\n                    <tr class="place-info">\r\n                        <td><span class="item-icon"></span></td>\r\n                        <td class="meeting-item">[[i18n "cal/info_event_place"]]:</td>\r\n                        <td>[[meetingRequest.location]]</td>\r\n                    </tr>\r\n                    <tr class="description-info">\r\n                        <td><span class="item-icon"></span></td>\r\n                        <td class="meeting-item">[[i18n "cal/info_event_description"]]:</td>\r\n                        <td >[[meetingRequest.body]]</td>\r\n                    </tr>\r\n                    <tr class="attendees-info">\r\n                        <td><span class="item-icon"></span></td>\r\n                        <td class="meeting-item">[[i18n "cal/info_event_attendees"]]:</td>\r\n                        <td >\r\n                            <a href="mailto:[[hemail meetingRequest.organizer \'addr\']]" title="[[meetingRequest.organizer]]">\r\n                                [[hemail meetingRequest.organizer "name"]]\r\n                            </a>\r\n                            ([[i18n "cal/info_event_organizer"]])\r\n                            [[#if meetingRequest.partAttendees]]\r\n                            <div class="part-attendees j-attendees">\r\n                                [[#each meetingRequest.partAttendees]]\r\n                                <a href="mailto:[[hemail this.email \'addr\']]" title="[[this.email]]">[[hemail this.email "name"]]</a>,\r\n                                [[/each]]\r\n                                ...\r\n                                <a class="f-db" href="javascript:void(0)" data-action="toggleAttendees">[[meetingRequest.stillAttendees]]</a>\r\n                            </div>\r\n                            [[/if]]\r\n                            <div class="all-attendees [[#if meetingRequest.partAttendees]]f-dn[[/if]] j-attendees">\r\n                                [[#each meetingRequest.attendees]]\r\n                                <a href="mailto:[[hemail this.email \'addr\']]" title="[[this.email]]">[[hemail this.email "name"]]</a>,\r\n                                [[/each]]\r\n                                [[#if meetingRequest.partAttendees]]\r\n                                <a class="f-db"  href="javascript:void(0)" data-action="toggleAttendees">[[i18n "cal/msg_hidemsg"]]</a>\r\n                                [[/if]]\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n            <div class="meeting-footer f-cf">\r\n                [[#if enableMeetingAction]]\r\n                <!---->\r\n                <div class="f-fl participation-display">\r\n                    <i class="iconfont iconinformation"></i>\r\n                    <div class="details [[#unless participationDisplay]]f-dn[[/unless]]">\r\n                        <span class="j-participation-display">[[[participationDisplay]]]</span>\r\n                        <span class="j-modify-msg"></span>\r\n                        <a href="javascript:void(0)" data-action="modify" >[[i18n "mail/op_modify"]]</a>\r\n                    </div>\r\n                    <span class="j-accept-state accept-state [[#if participationDisplay]]f-dn[[/if]]">[[i18n \'mail/accept_invitation\']]</span>\r\n                </div>\r\n\r\n                <div class="j-meeting-btn f-fr [[#if participationDisplay]]f-dn[[/if]] meeting-btns">\r\n                    <span class="u-btn u-btn-primary u-btn-accept" data-action="accept">[[i18n "mail/op_accept"]]</span>\r\n                    <span class="u-btn u-btn-primary u-btn-tentative" data-action="tentative">[[i18n "mail/op_tentative"]]</span>\r\n                    <span class="u-btn u-btn-default u-btn-decline" data-action="decline">[[i18n "mail/op_decline"]]</span>\r\n                </div>\r\n                [[/if]]\r\n                [[#unless isMembers]]\r\n                <div id="actionLinkTR">\r\n                    <div class="f-fl participation-display">\r\n                        <i class="iconfont iconinformation"></i>\r\n                        <a href="javascript:void(0)" class="j-view-cal [[#unless calUid]] f-dn[[/unless]]" data-action="viewCal" data-calUid="calUid">\r\n                            [[i18n \'cal/info_event_participation_toview\']]\r\n                        </a>\r\n                    </div>\r\n                    <div class="f-fr meeting-btns">\r\n                        <span class="j-add-cal u-btn u-btn-primary[[#if calUid]] f-dn[[/if]]" data-action="addCal">\r\n                            [[i18n \'cal/info_event_participation_toadd\']]\r\n                        </span>\r\n                            [[#if meetingRequest.organizer]]\r\n                        <span class="j-forward-cal u-btn u-btn-primary" data-action="forwardCal" data-organizer="[[meetingRequest.organizer]]">\r\n                            [[i18n \'cal/info_event_participation_introduct\']]\r\n                        </span>\r\n                            [[/if]]\r\n                        <span class="j-del-cal u-btn u-btn-default[[#unless calUid]] f-dn[[/unless]]" data-action="deleteCal">\r\n                            [[i18n \'cal/event_participation_del\']]\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n                [[/unless]]\r\n            </div>\r\n        </div>\r\n    </script>\r\n\r\n    <!---->\r\n    <script id="sspurltpl" type="text/x-handlebars-template">\r\n        <div class="u-alert u-alert-warning u-alert-dismissible j-sspurl">\r\n            <span class="close iconfont icondelword" data-action="close"></span>\r\n            <span>[[[i18n "mbox/sspurl_message_tips"]]]</span>\r\n            <a class="link" data-action="original" href="javascript:void(0)">[[i18n "mbox/sspurl_message_original"]]</a>\r\n            [[#unless isJunk]]\r\n            <a class="link" data-action="spam" href="javascript:void(0)">[[i18n "mbox/sspurl_message_spam"]]</a>\r\n            [[/unless]]\r\n            [[#unless isTrash]]\r\n            <a class="link" data-action="delete" href="javascript:void(0)"> [[i18n "common/op_delete"]]</a>\r\n            [[/unless]]\r\n        </div>\r\n    </script>\r\n\r\n    {{/raw}}\r\n\r\n</section>\r\n\r\n';
}),define("module/mail/thread/index",["require","i18n!common,mail,mbox,main,mail,faces","jquery.scrollTo","../../../widget/pin/pin","../../../component/memobox","jquery","cui/core/view/viewmanager","../../../util/index","cui/ui/select/select","cui/ui/dialog/confirmbox","cui/util/history/hash","../../../component/filetonfbox","../../../component/xnffilebox","../../../component/userauth2","../../../component/maildeferbox","../../../component/contactcard","../../../configurable/index","../toolbar","../../common/globalService","module/contact/service","../../setting/service","../../calendar/service","../service","../read/service","../readbase","text!template/module/mail/thread.tpl.html"],function(e){function t(e,t){var n,i={flagged:Math.pow(2,10)-1,unflagged:Math.pow(2,10)};return e=!!e,t=parseInt(t,10),n=e?isNaN(t)||0>t||t>8?i.flagged:Math.pow(2,t):i.unflagged}e("i18n!common,mail,mbox,main,mail,faces"),e("jquery.scrollTo"),e("../../../widget/pin/pin"),e("../../../component/memobox");var n=e("jquery"),i=e("cui/core/view/viewmanager"),a=e("../../../util/index"),r=e("cui/ui/select/select"),s=e("cui/ui/dialog/confirmbox"),o=e("cui/util/history/hash"),l=e("../../../component/filetonfbox"),c=e("../../../component/xnffilebox"),d=e("../../../component/userauth2"),u=e("../../../component/maildeferbox"),p=e("../../../component/contactcard"),h=e("../../../configurable/index"),f=e("../toolbar"),m=e("../../common/globalService"),g=e("module/contact/service"),v=e("../../setting/service"),_=e("../../calendar/service"),y=e("../service"),b=e("../read/service"),w=e("../readbase"),M=w.extend({events:{"click .j-toggle-thread[data-type]":"_toggleAllThreadList","click #threadList .j-thread-item":"_handleReadCurMailMessage","click #threadList .j-toggle-item[data-type]":"_handleShowThreadItem","click #threadList .j-thread-item .j-flag":"_handleMailItemFlag","click #threadList .j-thread-item .j-defer":"_handleMailItemDefer","click #threadList .j-mail-info .j-mail-top .j-dealings":"_handleMailItemDealings","click #threadList .j-mail-info .j-mail-top .j-flag":"_handleMailItemFlag","click #threadList .j-mail-info .j-mail-top .j-defer":"_handleMailItemDefer","click #threadTitle .j-defer":"_handleMailItemDefer","click .j-mail-top a[data-type]":"_handleMailReadTop","click .j-sspurl [data-action]":"_handleSSPUrl","click .j-view-attach":"_handleScrollToAttaches","click .j-saveToNetFolder":"_handleSaveToNetFolder","click .j-saveToExtFolder":"_handleSaveToExternalFolder","click .j-quick-reply [data-type]":"_handleQuickReply","click .j-meeting-request [data-action]":"_handleMeetingModify","click .j-decrypt-submit":"_handleDecryptMessage","click .j-footer-btn [data-action]":function(e,t){var n=this,i=n.$(t),r=i.data("action"),o=i.parents(".j-quick-reply").data("mid");"delete"===r?n._handleMoveMail({id:4},o):"replyall"===r?s.confirm(a.i18n.t("mail/confirm_reply_all"),function(){n._handleComposeMail(r,o)}):n._handleComposeMail(r,o)}},widgets:{contactCards:[]},initProps:function(){var e=m.getCurrentState();this.set("name","mail.thread:"+(e.param.id||e.param.mid))},setup:function(){var e;this.state=m.getCurrentState(),this.state.param.fid=parseInt(this.state.param.fid,10),e=this.state.param.mid,this.state.param.pView=this.state.param.pView||"list",(isNaN(this.state.param.fid)||!e)&&n.error("fid or mid is empty"),this._params={fromView:"mail."+this.state.param.pView,threadList:[],threadIndex:void 0,mail:{},threadFrom:[],mids:[]},this.element.attr("mid",e),this.config=h("mail.common",this),"function"===n.type(this.config.mboxaOverwrite)&&this.config.mboxaOverwrite(),this._initModuleEvent()},render:function(){var e=this;M.superclass.render.call(this),n.when(e._generateCookieSid(),e._initPrevAndNext()).then(n.proxy(this._initMailInfo,this)).done(function(t){e._initToolbar(),e._initThreadTop(),e._initThreadList(t),e._initBackTop(!0)}).fail(function(t){t&&"FA_MAIL_NOT_FOUND"==t.code?e._handleMailNotFound(t.message):n.notify.error(a.i18n.t("mail/read_init_fail"))})},rerender:function(e){var t,r,s,l,c=m.getUser();if(!this._params.threadList||0===this._params.threadList.length)return this.sendMessage("mail","view:close",{target:"list"});if(e.start-this._params.start>=0?(t=this._params.threadIndex+1,this._params.threadList[t]||(e.start=e.start-1,t=this._params.threadIndex-1)):t=this._params.threadIndex-1,r=this._params.threadList[t],!r)return this.sendMessage("mail","view:close",{target:"list"});if(l=1==c.display_list&&r.threadMessageCount>=2?"mail.thread":"mail.read",s={module:l,param:{fid:this.state.param.fid,mid:r.id||"",start:e.start}},s.param.historyUrl=o.stringifyHash(s),s.param=n.extend(s.param,{id:s.param.mid,pView:this.state.param.pView,tabTitle:" ",replaceId:"thread:"+this.state.param.mid}),a.detector.isDetachMode())return this.sendMessage("dispatcher","history:add",s),location.reload();if(c.preview_layout){var d=this.element.parents("#previewLayoutRead"),u=new i.module(s.module);d.find("section.j-mail-read").remove(),d.find(".j-email-unchecked").hide(),m.setCurrentState(s),u.render(d)}else this.sendMessage("mail","view:change",s)},_generateCookieSid:function(){var e=n.Deferred();return m.generateSidCookie().then(function(){e.resolve()},function(){e.reject()}),e.promise()},_receiveViewMailIframeMessage:null,_postMessageToFrame:null,_initModuleEvent:function(){var e=this;this._receiveViewMailIframeMessage=n.proxy(function(t){var i=t.originalEvent?t.originalEvent.data:t.data||"";if(i&&(i=JSON.parse(i),n.isPlainObject(i)&&"attachmentsRefer"===i.type)){var a,r,s=i.attachments,o=i.mid,l=i.iframeId;if(a=e.threadMail&&e.threadMail[o],null==a)return!1;if(r=e.$('.j-mail-info[data-mid="'+o+'"][data-frameid="'+l+'"]'),!r.length)return!1;b.formatMailAttachments(a,s,i.inLineTrsAttachments.concat(a.trsAttachments)),e._initAttach(a.id)}},this),this._postMessageToFrame=n.proxy(function(){var e=JSON.stringify({type:"resize",resize:!0,isThread:!0});setTimeout(function(){this.$(".j-mail-content").each(function(){var t=n(this)[0].contentWindow;t&&t.postMessage(e,"*")})},0)},this),this._resizeFrameWidth=n.proxy(function(){this.$(".j-mail-content").width("100%")},this),n(window).on("message.thread",this._receiveViewMailIframeMessage),n(window).on("resize",this._postMessageToFrame),e.offMessage("view:refresh").onMessage("view:refresh",function(){e._initThreadTop()}),this.on("mail:mark",function(t){var n=!1,i={};switch(t.type){case"unread":n=!0,i.read=!1;break;case"flagged":e._updateThreadInfoSyncToMailInfo("flags.flagged",{flags:{flagged:!0},label0:t.label0||0});break;case"noflagged":e._updateThreadInfoSyncToMailInfo("flags.flagged",{flags:{flagged:!1}});break;case"urgent":e._updateThreadInfoSyncToMailInfo("priority",{priority:1}),e._initToolbar();break;case"general":e._updateThreadInfoSyncToMailInfo("priority",{priority:3}),e._initToolbar();break;case"slow":e._updateThreadInfoSyncToMailInfo("priority",{priority:5}),e._initToolbar();break;case"vip":e._updateThreadInfoSyncToMailInfo("flags.vip",{flags:{vip:!0}}),e._initToolbar();break;case"novip":e._updateThreadInfoSyncToMailInfo("flags.vip",{flags:{vip:!1}}),e._initToolbar();break;case"top":e._updateThreadInfoSyncToMailInfo("flags.top",{flags:{top:!0}}),e._initToolbar(),e._params.listStart=0;break;case"notop":e._updateThreadInfoSyncToMailInfo("flags.top",{flags:{top:!1}}),e._initToolbar();break;case"memo":var a=t.mid,r=e.$('.j-mail-info[data-mid="'+a+'"]');e._updateMailInfo(a,{memo:t.memo}),e._initMailMemo(a,r)}e.sendMessage(e._params.fromView,"view:refresh",{flags:i,start:e._params.listStart}),n&&e.sendMessage("mail","view:close",{target:"list"})}),e.offMessage("view:active").onMessage("view:active",function(t){e.toolbar&&e.toolbar._initPagination(),e._initContactCard((t.message||{}).vid)}),e.offMessage("read:mark").onMessage("read:mark",function(t){e.trigger("mail:mark",t.message)}),e.offMessage("mail:op").onMessage("mail:op",function(t){if(t.message){var n=t.message.action;switch(n){case"delete":case"prev":case"next":e.toolbar&&e.toolbar.trigger("mail:op",n);break;case"reply":case"replyall":s.confirm(a.i18n.t("mail/confirm_reply_all"),function(){e._handleComposeMail(n)});break;case"forward":e._handleComposeMail(n);break;case"quickreply":e._handleQuickReply(null,e.$(".j-quick-reply [data-type=send]"))}}})},_initPrevAndNext:function(){var e=n.Deferred(),t=this,i=n.extend({},this.state.param);return n.extend(this._params,i),void 0==i.start?(n.extend(t._params,{start:0,total:0}),e.resolve()):(i.topFirst=t.config.enableTopMail||!1,i.start=i.start>0?i.start-1:0,i.limit=3,y.getListData(i.pView,i).then(function(a){t._params.threadList=a.list,t._params.total=a.total,n.each(a.list,function(e,n){return n.id===i.mid?(t._params.mail=n,t._params.threadIndex=e,!1):void 0}),n.isEmptyObject(t._params.mail)&&(t._params.total=0),"undefined"==n.type(t._params.threadIndex)&&(t._params.threadIndex=1,t._params.total=a.total),e.resolve()},function(){e.reject()}),e.promise())},_initMailInfo:function(){var e=this,t=n.Deferred();return n.notify.loading(),b.getThreadMessageInfos({id:e.state.param.mid}).then(function(n){e.state.param.threadCount=n.length,e._setThreadMailInfo(n),t.resolve(n)},function(n){n&&"FA_NEED_AUTH2"===n.code&&d.box({successCb:function(){e.render()},cancelCb:function(){e.sendMessage("mail","view:close")},tip:a.i18n.t("common/lbl_user_auth2_thread_tip")}),t.reject(n)}).always(function(){n.notify.loading("hide")}),t.promise()},_isPreviewLayout:function(){var e=m.getUser();return!a.detector.isDetachMode()&&e.preview_layout},_initToolbar:function(){var e=this.$("#toolbarMenuTpl").html();return this._isPreviewLayout()?!1:(this.$(".j-toolbar").removeClass("f-dn").html(this.compile(e,this._params.mail)),void(this.toolbar=new f({element:this.$(".j-toolbar"),parent:this,total:this._params.total,currentPage:this._params.start,limit:1,refresh:this.rerender}).render()))},_setThreadMailInfo:function(e){var t,i,a=this,r=[],s=a.config,o=s.enableMailFlagged,l=s.enableDeferMail,c=!this.state.param.part&&s.enableMailDealings&&s.permWebmailMailSearch;this.threadMail={},e=e||[];for(var d=0;d<e.length;d++)t=e[d],i=t.id,r.push(t.from),a._params.mids.push(i),this.threadMail[i]||(t.enableMailFlagged=o,t.enableMailDefer=l,t.enableDealings=c,t.curPageIndex=d,t.preMid=e[d-1]?e[d-1].id:"",this.threadMail[i]=t);n.isEmptyObject(a._params.mail)&&(a._params.mail=this._getCurMailInfo(a.state.param.mid)),a._params.mail=n.extend(!0,{enableMailFlagged:o,enableMailDefer:l,enableDealings:c},a._params.mail),a._params.threadFrom=n.unique(r)},_updateThreadInfoSyncFromMailInfo:function(){var e,t,n,i=this,a=this._params.mail,r=this._params.mids.length,s=r-1;for(t={flagged:a.flags&&a.flags.flagged,label0:a.label0,deferHandle:a.flags&&a.flags.deferHandle,defer:a.defer},e={flagged:!1,deferHandle:!1},a.flags.flagged=!1,a.label0=0;s>=0&&(!e.flagged||!e.deferHandle);s--)n=this.threadMail[this._params.mids[s]],e.flagged||n.flags.flagged&&(a.flags.flagged=e.flagged=!0,a.label0=n.label0),e.deferHandle||(e.deferHandle=!0,a.flags.deferHandle=!!n.flags.deferHandle,a.defer=n.defer);(t.flagged!=a.flags.flagged||t.label0!=a.label0||t.deferHandle!=a.deferHandle||t.defer!=a.defer)&&(i.sendMessage(i._params.fromView,"view:refresh",{mid:this.state.param.mid,label0:a.label0,defer:a.defer,flags:{flagged:a.flags.flagged,deferHandle:a.flags.deferHandle}}),this._initThreadTop())},_updateThreadInfoSyncToMailInfo:function(e,t){var i,a,r=this;n.extend(!0,this._params.mail,t),this._initThreadTop(),i=this._params.mail,"flags.flagged"===e?(a={flags:{flagged:i.flags&&i.flags.flagged},label0:i.label0},a.flags.flagged?this._updateMailInfoFlagsSyncToUI(this.state.param.mid,"flagged",a):n.each(this._params.mids,function(e,t){r._updateMailInfoFlagsSyncToUI(t,"flagged",a)})):"flags.deferHandle"===e?(a={flags:{deferHandle:i.flags&&i.flags.deferHandle},defer:i.defer},this._updateMailInfoFlagsSyncToUI(this.state.param.mid,"deferHandle",a)):this._updateMailInfo(this.state.param.mid,t)},_getCurMailInfo:function(e){return e=e||"",this.threadMail?this.threadMail[e]:""},_updateMailInfo:function(e,t){this.threadMail?n.extend(!0,this.threadMail[e],t):(this.threadMail={},this.threadMail[e]=t)},_updateMailInfoFlagsSyncToUI:function(e,t,n){this._updateMailInfo(e,n),this._renderMailItemFlags(this._getCurMailInfo(e),t)},_initThreadTop:function(){var e=this.state.param.mid,t=this._params.mail;t.flags&&t.flags.system&&(t.sourceIcon="state-icon icon-SYSTEM",t.sourceMsg=a.i18n.t("mail/source_system")),t.sid=m.getSid(),this._isPreviewLayout()&&this.sendMessage(this._params.fromView,"view:refresh",{mid:e,action:"reactive"}),this.sendMessage("mail","tab:change",{id:"thread:"+e,title:t.subject||a.i18n.t("mail/empty_subject")}),this.$("#threadTitle").html(this.compile(this.$("#threadTitleTpl").html(),t)),this._initFlagColorMenu()},_initThreadList:function(e){var i,a=this,r=!1,s=a.$("#threadList"),o=e.length,l={data:e,unReadCount:0},c=this.state.param.filterFlags,d=-1;l.data.forEach(function(e){e.isStranger=y.isStranger(e.formatFrom.emailAddress)||y.isStranger(e.sender)}),c&&c.hasOwnProperty("flagged")&&(d=t(c.flagged,c.label0)),d>=0?l.hideOtherThread=!1:o>=6&&(n.each(e,function(e,t){t.flags&&!t.flags.read&&l.unReadCount++}),l.hideOtherThread=!0,l.hideThreadIndex=l.unReadCount>=2?0:2,l.hideThreadCount=l.unReadCount>=2?o-l.unReadCount:o-3),s.html(this.compile(this.$("#threadListTpl").html(),l)),i=s.find(".j-thread-item"),d>=0?n.each(e.reverse(),function(e,n){var r=n.flags?t(n.flags.flagged,n.label0):-1,s=o-1-e,l=i.eq(s),c=l.next(".j-mail-info");return n.flags&&(d&r)>0?(i.eq(s).removeClass("other-thread"),a._initThreadMailInfo(l.data("mid")).then(function(){a._doScrollToElement(c)}),!1):void 0}):n.each(e,function(e,t){t.flags&&!t.flags.read&&(r=!0),(r||e==o-1)&&(i.eq(e).removeClass("other-thread"),a._initThreadMailInfo(i.eq(e).data("mid")))})},_initThreadMailInfo:function(e){var t=this,i=m.getUser(),r=t._getCurMailInfo(e),s={mid:e,part:t.state.param.part||"",mailCipherPassword:r.mailCipherPassword||""},o=n.Deferred();return r.isLoaded?(t._renderMailInfo(e,!0),!1):(b.readMessage(s).then(function(n){n.config=t.config,n.mid=e,n.iframeId=+new Date,n.sid=m.getSid(),n.memo=r.memo,n.isFromCurUser=a.Email.parseAddress(n.from[0])==i.email,t.fromrcpts=n.rcpts,r.flags&&!r.flags.read&&(t.sendMessage(t._params.fromView,"view:refresh",{mid:t.state.param.mid,flags:{read:!0}}),t.sendMessage("mail","folder:refresh",{type:"all"})),n.flags.read=!0,n.isLoaded=!0,n.mailCipherEncrypted&&(n.cipherEncryptedMsg=a.i18n.t("mbox/read_mail_cipher_encrypted_tip").replace("{0}",'<span class="highlight ">"'+a.html.encode(a.Email.parseTrueName(n.from[0])||n.from[0])+'"</span>')),t._updateMailInfo(e,n),t._renderMailInfo(e),o.resolve(n)}),o.promise())},_renderMailInfo:function(e,t){var i=this,a=i._getCurMailInfo(e),r=i.$('.j-mail-info[data-mid="'+e+'"]'),s=r.prev(".j-thread-item");if(t)return r.show(),s.hide(),void i.$(".j-quick-reply").each(function(){n(this).pin("setPosition")});r.attr("data-frameid",a.iframeId),r.html(i.compile(i.$("#threadInfoTpl").html(),a)).show(),s.hide();var o=m.getConfig("mail.defaultreadbriefmode");1==o||r.find(".j-full-info").is(":visible")||r.find(".j-mail-top a[data-type=toggleBrief]").click(),i._initContactCard(r),i.config.enableMailMemo&&i._initMailMemo(a.mid,r),a.sspurl&&i._initDetectSSPUrl(r),a.calendar&&i._initMeetingRequest(a.calendar,r),i._initMoreMenu(a.mid,r),r.find(".j-quick-reply").pin({scrollElement:i.$(".j-u-scroll"),parentElement:".j-mail-info",marginElement:".j-mail-top"})},_initContactCard:function(e){var t,i,a=this;e="string"===n.type(e)?a.$('.j-mail-info[data-mid="'+e+'"]'):e,(a.config.supportPab||a.config.supportOab)&&e.find(".u-email-tip").each(function(){t=n(this),i=n(this).attr("addr"),a._updateContactCard({trigger:t,parent:a,emailAddress:i})})},_initMailMemo:function(e,t){var i=this,a=i._getCurMailInfo(e),r={mid:e,memo:a?a.memo:"",parentNode:t,eventCallBack:function(){i.trigger("mail:mark",{type:"memo",memo:this.get("memo"),mid:e}),i.sendMessage(i._params.fromView,"view:refresh",{start:i._params.listStart})}};t.find(".j-memo-tip").each(function(){n(this).memoBox(n.extend({tip:!0},r))}),t.find(".j-memo-box").memoBox(r)},_initDetectSSPUrl:function(e){var t=this,n=t.state.param.fid,i=y.getFoldersMap(),a=t.$("#sspurltpl").html();e.find(".j-read-alert").append(this.compile(a,{isJunk:n==i.junk,isTrash:n==i.trash}))},_initMeetingRequest:function(e,t){t.find(".j-meeting-request").html(this.compile(this.$("#meetingRequestTpl").html(),e))},_initFlagColorMenu:function(){var e=this,t=this.config.mailFlaggedColorCount,i=y.getToolbarMenu("mail.menu.flag-color"),a=y.getToolbarMenu("mail.menu.label0-color");t>1&&n.merge(i["label0-color"],a.slice(0,t)),e.$('[data-dropdown="flag-color"]').not('[role="dropdown"]').each(function(){n(this).dropdown({data:i,callback:function(t){e._handleToolbarMenu(t)}})})},_initMoreMenu:function(e,t){var i=this,a=t.find("[data-dropdown]");a.not("[role=dropdown]").each(function(){var t=n(this).attr("data-dropdown");n(this).dropdown({parent:"body",data:"read-more"==t?i._getMoreMenuData(e):y.getToolbarMenu("mail.menu."+t),callback:function(t){i._handleToolbarMenu(t,"",e)}})}),i.$("#threadList.u-scroll").on("scroll",function(){a.dropdown("hide")})},_getMoreMenuData:function(e){var t,i,a=this,r=y.getToolbarMenu("mail.menu.read-more")||[],s=0;if(a.moreMenuData)return a.moreMenuData;for(t=a._getCurMailInfo(e)||{};s<r.other.length;s++){if(i=r.other[s],"more:forward"===i.value&&n.isArray(i.children)&&i.children.length&&n.each(i.children.splice(0),function(e,n){if(n.value)switch(n.value){case"forward:forwardd":a.config.enableForwardd&&i.children.push(n);break;case"forward:forwarda":a.config.enableForward&&!t.sMimeServerEncrypted&&i.children.push(n);break;default:a.config.enableForward&&i.children.push(n)}}),"more:mail_event"==i.value&&!a.config.enableScheduleInvitation){r.other.splice(s,1);break}"more:delete"==i.value&&r.other.splice(s,1)}for(s=0;s<r.filter.length;s++)if(i=r.filter[s],"more:notJunk"===i.value||"more:report"===i.value&&!a.config.enableSpamForwhand){r.filter.splice(s,1);break}return a.moreMenuData=r,r},_handleMailNotFound:function(e){var t=this;s.alert(e,function(){a.detector.isDetachMode()?window.close():(t.sendMessage(t._params.fromView,"view:refresh",{start:t._params.listStart}),m.getUser().preview_layout?n("#previewLayoutRead").find(".j-mail-read").remove().end().find(".j-email-unchecked").show():t.sendMessage("mail","view:close",{target:t.state.param.pView}))})},_handleToolbarMenu:function(e,t,n){var i;switch(e=e||{},e.value=e.value||t,t=e.value.split(":"),i=t[1],t=t[0]){case"reply":this._handleComposeMail(i,n);break;case"move":this._handleMoveMail(e,n);break;case"label0":case"mark":this._handleMarkMail(t,i,e);break;case"forward":this._handleComposeMail(i,n);break;case"viewMail":this._handleViewMail(i,n);break;case"encoding":this._handleEncodingMail(i,n);break;case"more":this._handleToolbarMoreOperate(i,e,n)}},_handleRealDeleteMail:function(e){var t=this;e&&s.confirm(a.i18n.t("mail/confirm_purge_mail"),function(){y.realDeleteMails({mids:e,expandThreadMid:!1}).then(function(){n.notify.success(a.i18n.t("mbox/del_message_succ")),t._handleDeleteMoveNext(e)})})},_handleMoveMail:function(e,t){var i=this,r=y.getFoldersMap();t=t||i.state.param.mid,t&&y.updateMailAttrs("move",{fid:e.id,mid:t,expandThreadMid:!1}).then(function(){var s=e.id==r.trash?"mail/msg_delete_mail":"mail/msg_move_mail";n.notify.success(a.i18n.t(s,{count:1})),i._handleDeleteMoveNext(t)})},_handleDeleteMoveNext:function(e){var t=this,n=m.getUser(),i=m.getCurrentState(),r=t._getCurMailInfo(e),s=e===t.state.param.mid;if(t.sendMessage(t._params.fromView,"view:refresh","all"),!s)return t.render();if(r.preMid){if(i.param.id=i.param.mid=r.preMid,i.param.historyUrl=o.stringifyHash({module:i.module,param:{fid:i.param.fid,mid:i.param.mid||"",start:i.param.start}}),a.detector.isDetachMode())return t.sendMessage("dispatcher","history:add",i),location.reload();n.preview_layout?t.sendMessage("mail.previewlayout","previewlayout:read",i):(i.param.replaceId="thread:"+this.state.param.mid,t.sendMessage("mail","view:change",i))}else a.detector.isDetachMode()||n.preview_layout||0!==n.afterdel?t.rerender({start:t._params.start+1,resetPagination:!1}):t.sendMessage("mail","view:close",{target:"list"})},_handleMarkMail:function(e,t,n){var i,a,r=this,s=this.state.param;0===n.value.indexOf("mark")?t=n.value.split(":")[1]:(t=n.value,a=n.value.split(":")[1]),i={flag:t},"noflagged"==t?i.expandThreadMid=!0:("flagged"==t||-1!=t.indexOf("label0"))&&(i.expandThreadMid=!1),y.markMails("read",s.mid,i).then(function(){var e={};t=0===t.indexOf("label0")?"flagged":t,"flagged"===t?(a=a||0,e.flagged=!0):"noflagged"===t&&(e.flagged=!1),y.showMarkNotify(!0,!0,t,n.name),r.trigger("mail:mark",{type:t,label0:a}),"unread"===t||"read"===t?(r.sendMessage("mail","folder:refresh",{ids:s.fid}),"read"===t&&(e.read=!0,r.sendMessage("mail","view:close",{id:"read:"+r.state.param.mid,target:"list"}))):r._initThreadTop(),r.sendMessage(r._params.fromView,"view:refresh",{mid:s.mid,label0:a,flags:e})},function(){y.showMarkNotify(!0,!1,t,n.name)})},_handleViewMail:function(e,t){var n=m.getSid();t=t||this.state.param.mid,"header"==e?window.open("mbox/viewheader.jsp?sid="+n+"&mid="+t+"&partId=0"):"source"==e&&window.open("mbox/readdata.jsp?sid="+n+"&mid="+t+"&mode=text&part=0")},_handleEncodingMail:function(e,t){t=t||this.state.param.mid;var n=this.threadMail[t],i=this.$("#mail-"+n.iframeId),a=i.attr("src").split("&encoding=")[0];i.attr("src",a+"&encoding="+e)},_handleToolbarMoreOperate:function(e,t,n){n=n||this.state.param.mid;var i=this,a=i.state.param.fid,r=m.getSid();switch(e){case"mailDownload":location.href="mbox/readdata.jsp?mid="+n+"&mode=download&part=0";break;case"print":window.open("../public/mailprint.jsp?sid="+r+"&fid="+a+"&nav_type=system&inbox=true&webReadOnly=0&offset=0&mid="+n+"&scheduledate=&sender=");break;case"delete":i._handleMoveMail({id:4},n);break;case"realdelete":i._handleRealDeleteMail(n);break;case"reject":i._handleRejectMail(n);break;case"filter":i._handleFilterMail(n);break;case"mail_event":i._handleMailEvent(n);break;case"report":i._handleReportMail(n);break;case"addToAddressbook":i._handleAddAllToAddressbook();break;case"mailMemo":i._handleMailMemo(n);break;case"sendagain":i._handleComposeMail(e,n)}},_handleFilterMail:function(e){e=e||this.state.param.mid;var t=this,i="filterConfirmBox"+e;t[i]?t[i].show():y.getFolders(!1,!0,!0).then(function(o){t[i]=new s({parentNode:t.element,title:a.i18n.t("common/op_filter"),message:t.compile(t.$("#mailFilterTpl").html(),{from:a.Email.parseAddress(t._getCurMailInfo(e).from[0]),folders:o}),onConfirm:function(){var n=this.element,i=n.find("#folder").val(),a=n.find("#folderName").val(),r=parseInt(n.find("#folderParent").val(),10);"newFolder"===i&&a?v.createFolders([{name:a,parent:r}]).then(function(i){i&&"S_OK"==i.code&&(t.sendMessage("mail","folder:refresh",{type:"all"}),t._handleFilterAndMoveToFolder(n.find("#toAllEmails").is(":checked"),i["var"][0],e))}):t._handleFilterAndMoveToFolder(n.find("#toAllEmails").is(":checked"),parseInt(i,10),e),this.hide()}}),t[i].after("show",function(){var e,a=this.element,s={parentNode:a.find(".j-filter"),trigger:a.find("#folder"),classPrefix:"u-select",width:"222"};t[i].hasInited||(a.customRadioCheckbox(),e=new r(s).render(),e.after("select",function(){"newFolder"===e.get("value")?a.find(".create-folder").removeClass("f-dn"):a.find(".create-folder").addClass("f-dn")}),new r(n.extend(s,{trigger:a.find("#folderParent")})).render(),a.find(".j-filter-page").on("click",function(){t[i].hide(),t.sendMessage("dispatcher","history:add",{module:"setting.filter.letter",param:{}})}),t[i].hasInited=!0)}).show()})},_handleFilterAndMoveToFolder:function(e,t,n){var i=this,r=i._getCurMailInfo(n),s=a.Email.parseAddress(r.from[0]),o=[{field:"from",disabled:!1,operator:"=",operand:s,ignoreCase:!0,forAddress:!0,forIAddress:!1,listOfValues:!0}],l=[{type:"move",disabled:!1,target:t},{disabled:!0,type:"flags",value:{flagged:!0}}],c=[{disabled:!1,"continue":!1,operator:"and",name:"rule_autoCreate_"+Math.ceil(100*Math.random()+100)+"_from_"+s,condictions:o,actions:l}];v.addMailRule({items:c}).then(function(a){e?y.updateMailAttrs("rule",{mid:[],rule:"@"+a}).then(function(){i.sendMessage("mail.list","view:refresh")}):i._handleMoveMail({id:t},n)})},_handleReportMail:function(e){e=e||this.state.param.mid;var t=this,i="reportBox"+e;t[i]?t[i].show():(t[i]=new s({parentNode:t.element,trigger:"",title:a.i18n.t("main/sys_info"),message:a.i18n.t("mbox/reportJunk_dialogBody"),onConfirm:function(){y.updateMailAttrs("rule",{mid:[e],attrs:{fid:5},reportType:"spam"}).then(function(){n.notify.success(a.i18n.t("mail/msg_move_mail",{count:1})),t._handleDeleteMoveNext(e)}),this.element.find("#addToRefuseList").is(":checked")&&t._handleSaveToListInfo("refuselist",a.Email.parseAddress(t._getCurMailInfo(e).from[0])),this.hide()}}),t[i].show())},_handleMailMemo:function(e){var t=this,n=t.$('.j-mail-info[data-mid="'+e+'"]'),i=n.find(".j-full-info"),a=n.find(".j-mail-memo");i.is(":visible")||t.$(".j-mail-top a[data-type=toggleBrief]").click(),a.removeClass("f-dn").find(".j-memo-box").removeClass("f-dn").find(".j-memo-edit").removeClass("f-dn").andSelf().find(".j-memo-msg").addClass("f-dn")},_handleComposeMail:function(e,t){var i=this,r={mid:t||i.state.param.mid};switch(e){case"reply":case"replyall":case"reply-attach":case"replyall-attach":case"forward":case"forwardd":case"forwarda":r.ctype=e;break;case"sendagain":r.ctype="edit";break;default:return!1}y.getComposeInfo("forwardd"===e?{ctype:"normal"}:r).then(function(t){i.sendMessage("mail","view:change",{module:"mail.compose",param:"forwardd"===e?n.extend(r,{id:t.id}):{id:t.id}})}),a.detector.isDetachMode()&&location.reload()},_handleRejectMail:function(e){var t=this,n="reject"+e,i=a.Email.parseAddress(t._getCurMailInfo(e).from[0]);t[n]?t[n].show():t[n]=new s({parentNode:t.element,title:a.i18n.t("main/sys_info"),message:a.i18n.t("mail/msg_confirm_reject_mail"),onConfirm:function(){t._handleSaveToListInfo("refuselist",i),this.hide()}}).show()},_handleSaveToListInfo:function(e,t){var i=this,r={},s=m.getUser(),o=s.refuselist?s.refuselist.replace(/, /g,",").split(","):[],l=s.safelist?s.safelist.replace(/, /g,",").split(","):[],c=s[e]?s[e].split(","):[],d=!1,u=!1;if(t==s.email&&"refuselist"==e)return void n.notify.warning(a.i18n.t("mbox/reject_by_mailfrom_fail"));if(t){if(d=-1!==n.inArray(t,o),u=-1!==n.inArray(t,l),d)return n.notify.warning(a.i18n.t("mail/msg_errMailExistInBlackList").replace("{0}",t)),!1;if(u)return n.notify.warning(a.i18n.t("mail/msg_errMailExistInWhiteList").replace("{0}",t)),!1;c.push(t),r[e]=c.join(","),m.updateUser(r,!0).then(function(){n.notify.success(a.i18n.t("refuselist"==e?"mbox/reject_by_mailfrom_succeed":"mbox/addToSafeList_succeed")),i.sendMessage("refuselist"==e?"setting.security.blacklist":"setting.security.whitelist","list:reload")})}},_handleAddAllToAddressbook:function(){var e,t,i=this,r=i.fromrcpts||[];return r&&0!=r.length?void g.createOrUpdatePabContacts(r).then(function(i){var r=i.added||[],s=i.existed||[],o=r.length,l=s.length;o>0?(e=o>=3?r.splice(0,2).join(",")+",...":r.join(","),n.notify.success(a.messageFormat.format(a.i18n.t("common/added_user_address"),e))):l>0&&(t=l>=3?s.splice(0,2).join(",")+",...":s.join(","),n.notify.warning(a.messageFormat.format(a.i18n.t("common/aready_exists_address"),t)))},function(){n.notify.error(a.i18n.t("common/add_user_address_fail"))}):!1},_handleSSPUrl:function(e,t){var i=this,r=n(t).data("action"),o=n(t).parents(".j-mail-info"),l=o.find(".j-mail-content"),c=o.data("mid"),d=l.attr("src");switch(r){case"original":l.attr("src",d+"&filterLinks=false&filterImages=false");break;case"spam":i._handleMoveMail({id:y.getFoldersMap().junk},c);break;case"delete":s.confirm(a.i18n.t("mbox/sspurl_confirm_delete"),function(){i._handleMoveMail({id:y.getFoldersMap().trash},c)});break;case"close":o.find(".j-sspurl").remove()}},_handleMailEvent:function(e){e=e||this.state.param.mid;var t=this._getCurMailInfo(e);this.sendMessage("dispatcher","history:add",{module:"calendar",param:{mid:e,historyUrl:encodeURIComponent("calendar")}});var i=setInterval(function(){var e=n(".j-calendar iframe");if(e.length>0){clearInterval(i);var r=[];n.each([t.from,t.to,t.cc,t.bcc],function(e,t){t&&n.each(t,function(e,t){var i=a.Email.parseAddress(t);-1===n.inArray(t,i)&&(r[r.length]=i)})}),e.attr("src",a.url.addUrlParams("cal/eventEdit.jsp",{sid:m.getSid(),func:"add",name:t.subject,attendees:encodeURIComponent(r.join(","))}))}},100)},_toggleAllThreadList:function(e,t){var i=this,r=n(t).data("type");"expand"==r?(n(t).data("type","collapse").html(a.i18n.t("common/op_collapse_all")),i.$(".j-toggle-other-thread").hide(),i.$("#threadList .j-thread-item").each(function(){i._initThreadMailInfo(n(this).data("mid"))})):"collapse"==r&&(n(t).data("type","expand").html(a.i18n.t("common/op_expand_all")),i.$("#threadList .j-mail-info").hide().siblings(".j-thread-item").show(),i.$(".j-toggle-other-thread").show().siblings(".other-thread").hide())},_handleReadCurMailMessage:function(e,t){this._initThreadMailInfo(this.$(t).data("mid"))},_handleShowThreadItem:function(e,t){var i=n(t).data("type");"curItem"==i?this.$(t).parents(".j-mail-info").hide().prev(".j-thread-item").show():"hideItem"==i&&this.$(t).parents(".j-toggle-other-thread").hide().siblings(".other-thread").show(),this.$(".j-quick-reply").each(function(){n(this).pin("setPosition")})},_handleScrollToAttaches:function(e,t){var i=n(t).parents(".j-mail-info");this._doScrollToElement(i.find(".j-mail-attachments-wrap"))},_handleMailReadTop:function(e,t,i){var a;switch(t?a=n(t).data("type"):i&&(a=i.value.split(":")[0]),e&&(e.preventDefault(),e.stopPropagation()),a){case"toggleBrief":this._handleToggleMailBrief(t);break;case"toggleContact":this._handleToggleContact(t)}},_handleToggleMailBrief:function(e){var t=n(e).parents(".j-mail-top"),i=t.find(".j-short-info"),a=t.find(".j-full-info"),r=t.find(".j-memo-tip");i.is(":visible")?(i.hide(),r.addClass("f-dn"),a.show(),n(e).removeClass("icondown").addClass("iconup")):(a.hide(),i.show(),r.data("memo")&&r.removeClass("f-dn"),n(e).removeClass("iconup").addClass("icondown")),this.$(".j-quick-reply").each(function(){n(this).pin("setPosition")})},_handleToggleContact:function(e){n(e).closest(".j-contacts").hide().siblings(".j-contacts").show()},_handleMeetingModify:function(e,t){var n,i=this,r=i.$(t).data("action"),s=i.$(t).parents(".j-meeting-request"),o=s.data("mid")||i.state.param.mid;switch(r){case"modify":s.find(".j-meeting-btn").show(),i.$(t).parent().addClass("f-dn"),n=a.i18n.t("mail/select_modify_state").replace("{0}",s.find(".j-participation-display b").html()),s.find(".j-accept-state").html(n).show();break;case"toggleAttendees":i.$(t).closest(".j-attendees").hide().siblings(".j-attendees").show();break;case"tentative":i._handleReplyMeetingRequest(s,2);break;case"accept":i._handleReplyMeetingRequest(s,3);break;case"decline":i._handleReplyMeetingRequest(s,4);break;case"addCal":i._handleAddToMyCal(s);break;case"deleteCal":i._handleDelFromMyCal(s);break;case"viewCal":i.sendMessage("dispatcher","history:add",{module:"calendar",param:{historyUrl:encodeURIComponent("calendar"),id:s.find(".j-view-cal").data("calUid"),view:"MONTH",func:"resp"}});break;case"forwardCal":y.getComposeInfo({ctype:"forward",mid:o,to:s.find(".j-forward-cal").data("organizer")}).then(function(e){i.sendMessage("mail","view:change",{module:"mail.compose",param:{id:e.id}})})}},_handleReplyMeetingRequest:function(e,t){var n=this,i={id:e.data("mid")||n.state.param.mid,userAttendeeStatus:t},r={2:a.i18n.t("mail/op_tentative"),3:a.i18n.t("mail/op_accept"),4:a.i18n.t("mail/op_decline")};s.confirm(a.i18n.t("mail/event_confirm_participation").replace("{0}",r[t]),function(){_.replyMeetingRequest(i).then(function(){var n=e.find(".j-participation-display");n.html(a.i18n.t("cal/event_participation_display").replace("{0}",r[t])),n.find("b").html(r[t]).show(),e.find(".j-accept-state").hide().prev().removeClass("f-dn"),
e.find(".j-meeting-btn").hide(),e.find(".j-modify-msg").html(4===t?a.i18n.t("cal/event_participation_deleted"):a.i18n.t("cal/event_participation_added")).show()})})},_handleAddToMyCal:function(e){var t=this,i=e.data("mid")||t.state.param.mid;s.confirm(a.i18n.t("cal/event_confirm_participation_added"),function(){_.addToMyCal({id:i}).then(function(t){t&&"FA_INVALID_REQUEST"==t.code?(n.notify.error(a.i18n.t("cal/event_participation_illegal")),a.i18n.t("cal/event_participation_illegal")):t&&"FA_INVALID_ATTENDEE"==t.code?n.notify.error(a.i18n.t("cal/event_participation_cancel")):t&&t.eventId&&(n.notify.success(a.i18n.t("cal/event_participation_added")),e.find(".j-add-cal").addClass("f-dn").siblings(".j-view-cal,.j-del-cal").removeClass("f-dn"))})})},_handleDelFromMyCal:function(e){var t=this,i=e.data("mid")||t.state.param.mid;s.confirm(a.i18n.t("cal/event_confirm_participation_delete"),function(){_.delFromMyCal({id:i}).then(function(t){t&&"FA_INVALID_REQUEST"==t.code?(n.notify.error(a.i18n.t("cal/event_participation_illegal")),a.i18n.t("cal/event_participation_illegal")):t&&"FA_INVALID_ATTENDEE"==t.code?n.notify.error(a.i18n.t("cal/event_participation_cancel")):t&&t.declined&&(n.notify.success(a.i18n.t("cal/event_participation_deleted")),e.find(".j-add-cal").removeClass("f-dn").siblings(".j-view-cal,.j-del-cal").addClass("f-dn"))})})},_handleDecryptMessage:function(e,t){var n=this,i=n.$(t).parents(".j-mailCipherEncrypted"),r=i.find(".j-decryption-error"),s=i.data("mid")||n.state.param.mid,o=i.find("#password").val(),l={id:s,part:n.state.param.part,autoName:!0,password:o};o?b.decryptMessage(l).then(function(){n._updateMailInfo(s,{mailCipherPassword:o,isLoaded:!1,attachments:{}}),n._updateMailInfo(s,{attachments:[]}),n._initThreadMailInfo(s)},function(e){e&&"FA_MAIL_NOT_FOUND"==e.code?n._handleMailNotFound(e.message):e&&e.message&&r.html(e.message).show()}):r.html(a.i18n.t("mbox/read_mail_err_password_empty")).show()},_handleSaveToNetFolder:function(e,t){for(var n=this,i=n.$(t).data("mid")||this.state.param.mid,a=n.$(t).data("id").toString().split("&"),r=[],s=0,o=a.length;o>s;s++)a[s]&&r.push(i+"/"+a[s]);new l({files:r}).show()},_handleSaveToExternalFolder:function(e,t){for(var n=this,i=this.state.param.mid,a=n.$(t).data("id").toString().split("&"),r=n.$(t).data("filename")||"",s=[],o=0,l=a.length;l>o;o++)a[o]&&s.push(i+"/"+a[o]);c.saveFilesToXNF(s,r).show()},_handleQuickReply:function(e,t){function i(){l.find(".quick-reply-item").slideUp(200),l.find(".j-reply-default,.j-footer-btn").slideDown(200),this.$(".j-quick-reply").each(function(){n(this).pin("setPosition")})}var r,o=n(t),l=n(t).parents(".j-quick-reply"),c=l.find("textarea"),d=o.data("type"),u=this._getCurMailInfo(l.data("mid")),p="send"===d||"cancel"===d,h={},f=this;switch(d){case"open-quick-reply":l.find(".quick-reply-item,.j-footer-btn").slideUp(200),l.find(".j-reply-form").slideDown(200).find("textarea").focus();break;case"cancel":i();break;case"compose":s.confirm(a.i18n.t("mail/confirm_reply_all"),function(){y.getComposeInfo({ctype:"replyall",mid:u.id}).then(function(e){f.sendMessage("mail","view:change",{module:"mail.compose",param:{id:e.id}})})});break;case"send":if(r=c.val()){l.find(".quick-reply-item").slideUp(200),l.find(".j-reply-sending").show(),h.quoteHTMLStart="<pre>"+r+"</pre>"+u.quoteHTMLStart,h.quoteTextStart=r+u.quoteTextStart,h.id=u.id,h.flagLinkAttached=u.trsAttachments.length>0;var g,v=u.from;if(g=v[0].indexOf("<")>0?v[0].substring(v[0].indexOf("<")+1,v[0].indexOf(">")):v[0],m.getUser().email==g){l.find(".j-reply-fail").html(a.i18n.t("mail/confirm_reply_error")).show().end().find(".j-reply-success").hide(),l.find(".quick-reply-item").slideUp(200),l.find(".j-reply-result").slideDown(200);break}y.quickReplyMessage(h).then(function(){c.val(""),l.find(".j-reply-sending,.j-reply-fail").hide(),l.find(".j-reply-success").show(),l.find(".j-reply-result").slideDown(200)},function(e){l.find(".j-reply-sending,.j-reply-success").hide(),l.find(".j-reply-fail").html(e).show(),l.find(".j-reply-result").slideDown(200)})}else s.alert(a.i18n.t("mail/confirm_input_content"))}l.find("[data-type]").off("mousedown").on("mousedown",function(e){e.preventDefault()}),c.off("blur").on("blur",function(){p||i()})},_handleMailItemDealings:function(e){var t,i,r,s=n(e.currentTarget),o=s.data("mid");return e.preventDefault(),e.stopPropagation(),o&&(t=this._getCurMailInfo(o))?(i=t.from,r={vid:"search",dealings:a.Email.parseAddress("array"===n.type(i)?i[0]:i)},this.sendMessage("dispatcher","history:add",{module:"mail.search",param:r}),void(a.detector.isDetachMode()&&location.reload())):!1},_handleMailItemDefer:function(e){var t=this,i=n(e.currentTarget),a=i.data("mid"),r=i.find("i.deferred").length>0;return e.preventDefault(),e.stopPropagation(),a?void(r?(new u({parentView:t,tipTpl:!0,trigger:i,mid:a,deferDate:i.attr("deferDate"),successCb:function(e){t._updateMailInfoFlagsSyncToUI(a,"deferHandle",{defer:e.defer,flags:{deferHandle:e.flags.deferHandle}}),t._updateThreadInfoSyncFromMailInfo()}}),i.click()):t.config.enableDeferMail&&new u({parentNode:t.element,parentView:t,mid:a,successCb:function(e){t._updateMailInfoFlagsSyncToUI(a,"deferHandle",{defer:e.defer,flags:{deferHandle:e.flags.deferHandle}}),t._updateThreadInfoSyncFromMailInfo()}})):!1},_handleMailItemFlag:function(e){var t=this,i=this.state.param,r=n(e.currentTarget),s=r.data("mid"),o=r.find("i.flagged").length>0,l={expandThreadMid:!1,mboxa:i.mboxa,fromFid:i.fid};return e.preventDefault(),e.stopPropagation(),s?(o?l.flag="noflagged":l.flag="flagged",void y.markMails("read",s,l).then(function(){var e={flags:{}};o?(e.flags.flagged=!1,y.showMarkNotify(!0,!0,"noflagged")):(e.flags.flagged=!0,e.label0=0,y.showMarkNotify(!0,!0,"flagged",a.i18n.t("common/op_flagged"))),t._updateMailInfoFlagsSyncToUI(s,"flagged",e),t._updateThreadInfoSyncFromMailInfo()})):!1},_renderMailItemFlags:function(e,t){var i,r=this,s={};return e&&t?(i=e.flags[t],"flagged"==t?(s.domClass=".j-flag",i?(s.model={title:a.i18n.t("mail/list_cancel_flag"),label0:e.label0},s.tpl='<i title="{{title}}" class="flagged iconfont iconflatcolor label0-{{label0}}"></i>'):(s.model={title:a.i18n.t("mail/list_set_flag")},s.tpl='<i title="{{title}}" class="iconfont iconflat"></i>')):"deferHandle"==t&&(s.domClass=".j-defer",i?(s.model={title:r.templateHelpers.replaceDefer("defer","mail/list_handle_defer")},s.tpl='<i title="{{title}}" class="deferred state-icon icon-mDEFER"></i>'):(s.model={title:a.i18n.t("mail/list_set_defer")},s.tpl='<i title="{{title}}" class="iconfont iconclock"></i>')),void this.$('.j-thread-item[data-mid="'+e.id+'"], .j-mail-info[data-mid="'+e.id+'"]').each(function(){var e=n(this),t=e.find(s.domClass);t.html(""),t.attr("data-value",i.toString()).html(r.compile(s.tpl,s.model))})):!1},_doScrollToElement:function(e,t){return!e||e.length<=0?!1:(t=parseInt(t,10),isNaN(t)&&(t=800),void this.$(".j-u-scroll").scrollTo(e,t))},_updateContactCard:function(e){var t=this,i=null;n.each(t.widgets.contactCards,function(t,n){return e.trigger.is(n.get("trigger"))?(i=n,!1):void 0}),i&&i.destroy(),i=new p(e),t.widgets.contactCards.push(i)},destroy:function(){n(window).off("message.thread",this._receiveViewMailIframeMessage),n(window).off("resize",this._postMessageToFrame),this.$(".j-quick-reply").each(function(){n(this).pin("destroy")}),this.$("[role=dropdown]").each(function(){n(this).dropdown("destroy")}),M.superclass.destroy.call(this),n.each(this.widgets.contactCards,function(e,t){t.destroy()}),this.widgets.contactCards=[]}});i.module({name:"mail.thread",template:e("text!template/module/mail/thread.tpl.html")},M)}),define("cui/util/easing/easing",["require","jquery"],function(e){var t=e("jquery"),n=Math.PI,i=Math.pow,a=Math.sin,r=1.70158,s={easeNone:function(e){return e},easeIn:function(e){return e*e},easeOut:function(e){return(2-e)*e},easeBoth:function(e){return(e*=2)<1?.5*e*e:.5*(1- --e*(e-2))},easeInStrong:function(e){return e*e*e*e},easeOutStrong:function(e){return 1- --e*e*e*e},easeBothStrong:function(e){return(e*=2)<1?.5*e*e*e*e:.5*(2-(e-=2)*e*e*e)},backIn:function(e){return 1===e&&(e-=.001),e*e*((r+1)*e-r)},backOut:function(e){return(e-=1)*e*((r+1)*e+r)+1},backBoth:function(e){var t=r,n=(t*=1.525)+1;return(e*=2)<1?.5*(e*e*(n*e-t)):.5*((e-=2)*e*(n*e+t)+2)},elasticIn:function(e){var t=.3,r=t/4;return 0===e||1===e?e:-(i(2,10*(e-=1))*a((e-r)*(2*n)/t))},elasticOut:function(e){var t=.3,r=t/4;return 0===e||1===e?e:i(2,-10*e)*a((e-r)*(2*n)/t)+1},elasticBoth:function(e){var t=.45,r=t/4;return 0===e||2===(e*=2)?e:1>e?-.5*(i(2,10*(e-=1))*a((e-r)*(2*n)/t)):i(2,-10*(e-=1))*a((e-r)*(2*n)/t)*.5+1},bounceIn:function(e){return 1-s.bounceOut(1-e)},bounceOut:function(e){var t,n=7.5625;return t=1/2.75>e?n*e*e:2/2.75>e?n*(e-=1.5/2.75)*e+.75:2.5/2.75>e?n*(e-=2.25/2.75)*e+.9375:n*(e-=2.625/2.75)*e+.984375},bounceBoth:function(e){return.5>e?.5*s.bounceIn(2*e):.5*s.bounceOut(2*e-1)+.5}};return t.extend(t.easing,s),s}),define("cui/ui/switchable/plugins/effects",["require","jquery","../../../util/easing/easing"],function(e){var t=e("jquery");e("../../../util/easing/easing");var n="scrollx",i="scrolly",a="fade",r={attrs:{effect:"none",easing:"linear",duration:500},isNeeded:function(){return"none"!==this.get("effect")},install:function(){var e=this.get("panels");e.show();var i=this.get("effect"),r=this.get("step"),o=t.isFunction(i);if(o||0!==i.indexOf("scroll")){if(!o&&i===a){var l=this.get("activeIndex"),c=l*r,d=c+r-1;e.each(function(e,n){var i=e>=c&&d>=e;t(n).css({opacity:i?1:0,position:"absolute",zIndex:i?9:1})})}}else{var u=this.content,p=e.eq(0);u.css("position","relative"),"static"===u.parent().css("position")&&u.parent().css("position","relative"),i===n&&(e.css("float","left"),u.width("35791197px"));var h=this.get("viewSize");if(h[0]||(h[0]=p.outerWidth()*r,h[1]=p.outerHeight()*r,this.set("viewSize",h)),!h[0])throw new Error("Please specify viewSize manually")}this._switchPanel=function(e){var n=this.get("effect"),i=t.isFunction(n)?n:s[n];i.call(this,e)}}},s={fade:function(e){if(this.get("step")>1)throw new Error('Effect "fade" only supports step === 1');var t=e.fromPanels.eq(0),n=e.toPanels.eq(0);if(this.anim&&this.anim.stop(!1,!0),n.css("opacity",1),n.show(),e.fromIndex>-1){var i=this,a=this.get("duration"),r=this.get("easing");this.anim=t.animate({opacity:0},a,r,function(){i.anim=null,n.css("zIndex",9),t.css("zIndex",1),t.css("display","none")})}else n.css("zIndex",9)},scroll:function(e){var t=this.get("effect")===n,i=this.get("viewSize")[t?0:1]*e.toIndex,a={};if(a[t?"left":"top"]=-i+"px",this.anim&&this.anim.stop(),e.fromIndex>-1){var r=this,s=this.get("duration"),o=this.get("easing");this.anim=this.content.animate(a,s,o,function(){r.anim=null})}else this.content.css(a)}};return s[i]=s.scroll,s[n]=s.scroll,r.Effects=s,r}),define("cui/ui/switchable/plugins/autoplay",["require","jquery"],function(e){function t(e,t){function n(){n.stop(),i=setTimeout(e,t)}t=t||200;var i;return n.stop=function(){i&&(clearTimeout(i),i=0)},n}function n(e){var t=a.scrollTop(),n=t+a.height(),i=e.offset().top,r=i+e.height();return n>i&&r>t}var i=e("jquery"),a=i(window),r={attrs:{autoplay:!1,interval:5e3},isNeeded:function(){return this.get("autoplay")},install:function(){function e(){i(),c.paused=!1,r=setInterval(function(){c.paused||c.next()},l)}function i(){r&&(clearInterval(r),r=null),c.paused=!0}var r,s=this.element,o="."+this.cid,l=this.get("interval"),c=this;e(),this.stop=i,this.start=e,this._scrollDetect=t(function(){c[n(s)?"start":"stop"]()}),a.on("scroll"+o,this._scrollDetect),this.element.hover(i,e)},destroy:function(){var e="."+this.cid;this.stop&&this.stop(),this._scrollDetect&&(this._scrollDetect.stop(),a.off("scroll"+e))}};return r}),define("cui/ui/switchable/plugins/circular",["require","exports","module","jquery","./effects"],function(e,t){function n(e,t,n){var i=this.get("step"),r=this.get("length"),s=e?r-1:0,o=s*i,l=(s+1)*i,c=e?n:-n*r,d=e?-n*r:n*r,u=a(this.get("panels").get().slice(o,l));return u.css("position","relative"),u.css(t,d+"px"),c}function i(e,t,n){var i=this.get("step"),r=this.get("length"),s=e?r-1:0,o=s*i,l=(s+1)*i,c=a(this.get("panels").get().slice(o,l));c.css("position",""),c.css(t,""),this.content.css(t,e?-n*(r-1):"")}var a=e("jquery"),r=e("./effects"),s="scrollx",o="scrolly";r=r.Effects,r.scrollCircular=function(e){var t=e.toIndex,a=e.fromIndex,r=this._scrollType===s,o=r?"left":"top",l=this.get("viewSize")[r?0:1],c=-l*t,d={};if(d[o]=c+"px",a>-1){this.anim&&this.anim.stop(!1,!0);var u=this.get("length"),p=0===a&&t===u-1,h=a===u-1&&0===t,f=void 0===this._isBackward?a>t:this._isBackward,m=f&&p||!f&&h;m&&(c=n.call(this,f,o,l),d[o]=c+"px");var g=this.get("duration"),v=this.get("easing"),_=this;this.anim=this.content.animate(d,g,v,function(){_.anim=null,m&&i.call(_,f,o,l)})}else this.content.css(d)},t.isNeeded=function(){var e=this.get("effect"),t=this.get("circular");return t&&(e===s||e===o)},t.install=function(){this._scrollType=this.get("effect"),this.set("effect","scrollCircular")}}),define("cui/ui/switchable/switchable",["require","jquery","../../core/widget/widget","./plugins/effects","./plugins/autoplay","./plugins/circular"],function(e){function t(e,t,n,a){for(var r=i("<ul>"),s=0;e>s;s++){var o=s===t?n:"";i("<li>",{"class":o,html:s+1}).appendTo(r)}return a?r.children():r}function n(e){return{UI_SWITCHABLE:e||"",NAV_CLASS:e?e+"-nav":"",CONTENT_CLASS:e?e+"-content":"",TRIGGER_CLASS:e?e+"-trigger":"",PANEL_CLASS:e?e+"-panel":"",PREV_BTN_CLASS:e?e+"-prev-btn":"",NEXT_BTN_CLASS:e?e+"-next-btn":""}}var i=e("jquery"),a=e("../../core/widget/widget"),r=e("./plugins/effects"),s=e("./plugins/autoplay"),o=e("./plugins/circular"),l=a.extend({attrs:{triggers:{value:[],getter:function(e){return i(e)}},panels:{value:[],getter:function(e){return i(e)}},classPrefix:"u-switchable",hasTriggers:!0,triggerType:"hover",delay:100,activeIndex:{value:0,setter:function(e){return parseInt(e)||0}},step:1,length:{readOnly:!0,getter:function(){return Math.ceil(this.get("panels").length/this.get("step"))}},viewSize:[],triggerViewSize:[],panelViewSize:[],activeTriggerClass:{getter:function(e){return e?e:this.get("classPrefix")+"-active"}}},setup:function(){this._initConstClass(),this._initElement();var e=this._getDatasetRole();this._initPanels(e),this._initTriggers(e),this._bindTriggers(),this._initPlugins(),this.render()},_initConstClass:function(){this.CONST=n(this.get("classPrefix"))},_initElement:function(){this.element.addClass(this.CONST.UI_SWITCHABLE)},_getDatasetRole:function(){var e=this,t={},n=["trigger","panel","nav","content"];return i.each(n,function(n,i){var a=e.$("[data-role="+i+"]");a.length&&(t[i]=a)}),t},_initPanels:function(e){var t=this.get("panels"),n=this.get("panelViewSize");if(t.length>0||(e.panel?this.set("panels",t=e.panel):e.content&&(this.set("panels",t=e.content.find("> *")),this.content=e.content)),0===t.length)throw new Error("panels.length is ZERO");n[0]&&t.css({width:n[0],height:n[1]}),this.content||(this.content=t.parent()),this.content.addClass(this.CONST.CONTENT_CLASS),this.get("panels").addClass(this.CONST.PANEL_CLASS)},_initTriggers:function(e){var n=this.get("triggers"),a=this.get("triggerViewSize");n.length>0||(e.trigger?this.set("triggers",n=e.trigger):e.nav?(n=e.nav.find("> *"),0===n.length&&(n=t(this.get("length"),this.get("activeIndex"),this.get("activeTriggerClass"),!0).appendTo(e.nav)),this.set("triggers",n),this.nav=e.nav):this.get("hasTriggers")&&(this.nav=t(this.get("length"),this.get("activeIndex"),this.get("activeTriggerClass")).appendTo(this.element),this.set("triggers",n=this.nav.children()))),a[0]&&n.css({width:a[0],height:a[1]}),!this.nav&&n.length&&(this.nav=n.parent()),this.nav&&this.nav.addClass(this.CONST.NAV_CLASS),n.addClass(this.CONST.TRIGGER_CLASS).each(function(e,t){i(t).data("value",e)})},_bindTriggers:function(){function e(e){n._onFocusTrigger(e.type,i(this).data("value"))}function t(){clearTimeout(n._switchTimer)}var n=this,a=this.get("triggers");"click"===this.get("triggerType")?a.click(e):a.hover(e,t)},_onFocusTrigger:function(e,t){var n=this;"click"===e?this.switchTo(t):this._switchTimer=setTimeout(function(){n.switchTo(t)},this.get("delay"))},_initPlugins:function(){this._plugins=[],this._plug(r),this._plug(s),this._plug(o)},switchTo:function(e){this.set("activeIndex",e)},_onRenderActiveIndex:function(e,t){this._switchTo(e,t)},_onRenderPanelViewSize:function(e,t){var n=this.get("panels"),i=this.get("viewSize"),a=this.get("step"),r=n.eq(0);t&&e&&(n.css({width:e[0],height:e[1]}),i[0]=r.outerWidth()*a,i[1]=r.outerHeight()*a,this.set("viewSize",i),this.next())},_onRenderTriggerViewSize:function(e,t){var n=this.get("triggers");e&&t&&n.css({width:e[0],height:e[1]})},_switchTo:function(e,t){this.trigger("switch",e,t),this._switchTrigger(e,t),this._switchPanel(this._getPanelInfo(e,t)),this.trigger("switched",e,t),this._isBackward=void 0},_switchTrigger:function(e,t){var n=this.get("triggers");n.length<1||(n.eq(t).removeClass(this.get("activeTriggerClass")),n.eq(e).addClass(this.get("activeTriggerClass")))},_switchPanel:function(e){e.fromPanels.hide(),e.toPanels.show()},_getPanelInfo:function(e,t){var n,a,r=this.get("panels").get(),s=this.get("step");return t>-1&&(n=r.slice(t*s,(t+1)*s)),a=r.slice(e*s,(e+1)*s),{toIndex:e,fromIndex:t,toPanels:i(a),fromPanels:i(n)}},prev:function(){this._isBackward=!0;var e=this.get("activeIndex"),t=(e-1+this.get("length"))%this.get("length");this.switchTo(t)},next:function(){this._isBackward=!1;var e=this.get("activeIndex"),t=(e+1)%this.get("length");this.switchTo(t)},_plug:function(e){var t=e.attrs;if(t)for(var n in t)!t.hasOwnProperty(n)||n in this.attrs||this.set(n,t[n]);e.isNeeded.call(this)&&(e.install&&e.install.call(this),this._plugins.push(e))},destroy:function(){var e=this;i.each(this._plugins,function(t,n){n.destroy&&n.destroy.call(e)}),l.superclass.destroy.call(this)}});return l}),define("cui/ui/switchable/slide",["require","exports","module","./switchable"],function(e,t,n){var i=e("./switchable");n.exports=i.extend({attrs:{autoplay:!0,circular:!0}})}),define("module/mail/welcome/service",["require","jquery","moment","../../common/globalService","../../setting/service","../service","../../../util/index","../../../util/common-controls"],function(e){function t(){var e,t,n=h.getUser(),i=p(),a=60*i.hours()+i.minutes(),r=[300,570,720,810,1080,1380];return r[0]<a&&a<=r[1]?e=m.i18n.t("main/greet_0930"):r[1]<a&&a<=r[2]?e=m.i18n.t("main/greet_1200"):r[2]<a&&a<=r[3]?e=m.i18n.t("main/greet_1330"):r[3]<a&&a<=r[4]?e=m.i18n.t("main/greet_1800"):r[4]<a&&a<=r[5]?e=m.i18n.t("main/greet_2300"):(r[5]<a||a<=r[0])&&(e=m.i18n.t("main/greet_0500")),t=n.true_name||m.Email.parseTrueName(n.email)||m.Email.parseAddress(n.email),e=m.messageFormat.format(e,t)}function n(){var e,t=h.getConfig("user.lastdate"),n=h.getConfig("user.lastip"),i=m.i18n.t("main/last_login_date");return t=p(t,"YYYY-MM-DD HH:mm:ss",g.localeMM()).format("LLLLS"),e={lastLoginDate:m.messageFormat.format(i,t),lastLoginIP:n||""}}function i(e){var t=u.Deferred(),n=f.getFoldersMap(),i={};return f.getFolders(e,!0).then(function(e){var a=0,r=0!=h.getUser().display_list?"unreadThreadCount":"unreadMessageCount",s=h.getConfig("setting.messagesize"),o=h.getConfig("setting.limitmessagesize"),l=h.getConfig("setting.messagecount"),c=h.getConfig("setting.limitmessagecount"),p=h.getConfig("setting.archivemessagecount"),f=h.getConfig("setting.archivemessagesize"),g=h.getConfig("setting.archivelitequota");u.each(e,function(e,t){t.id!==n.trash&&t.stats&&(a+=t.stats[r]||0)}),i.unreadMessageCount=a,s=s?parseInt(s,10):0,o=o?parseInt(o,10):1,i.messageSize=m.size.bytesToSize(s,2),i.limitMessageSize=m.size.bytesToSize(o,2),i.messageSizePercent=Math.round(s/o*100),l=l?parseInt(l,10):0,c=c?parseInt(c,10):1,i.messageCount=l,i.limitMessageCount=c,i.messageCountPercent=Math.round(l/c*100)/100,i.messageSizePercent>=100?i.warningMessageSize=m.i18n.t("main/mbox_warn_hquota"):i.messageSizePercent>=80?(i.warningMessageSize=m.i18n.t("main/mbox_warn_squota"),d()&&(i.canEmptySpam=m.i18n.t("main/mbox_empty_spam"))):i.messageCountPercent>=80&&(i.warningMessageSize=m.messageFormat.format(m.i18n.t("main/mbox_warn_count"),i.messageCountPercent+"%")),i.supportArchiveLite=!1,i.supportArchiveLite&&(p=p?parseInt(p,10):0,f=f?parseInt(f,10):0,g=g?parseInt(g,10):1,i.archiveMessageCountInfo=m.messageFormat.format(m.i18n.t("main/al_stats_info"),p),i.archiveMessageSize=m.size.bytesToSize(f,2),i.archiveLiteQuota=m.size.bytesToSize(g,2),i.archiveMessageSizePercent=Math.round(f/g*100)/100,i.archiveMessageSizePercent>=100?i.warningArchiveMessageSize=m.i18n.t("main/arch_warn_hquota"):i.archiveMessageSizePercent>=80&&(i.warningArchiveMessageSize=m.messageFormat.format(m.i18n.t("main/arch_warn_squota"),m.i18n.t("main/arch_warn_clean")))),t.resolve(i)},function(){t.reject()}),t.promise()}function a(){var e=u.Deferred(),t=[];return u.when(l(),c()).then(function(n,i){u.isEmptyObject(n)||t.push(n),u.isEmptyObject(i)||t.push(i),e.resolve(t)},function(){e.reject()}),e.promise()}function r(){var e=u.Deferred(),t=m.cache.getItemWithLocal("location")||"";return m.xhr.simpleCall({contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:m.xhr.getRequestURL({url:"/XT5/jsp/mail.jsp",query:{func:"getWeather",sid:h.getSid(),location:t}})},function(t){var n,i,a,r,s=t.weather;n=s.results[0],i=n.weather_data[0],r=i.dayPictureUrl.substring(i.dayPictureUrl.lastIndexOf("/")+1),r=g.assetPath("style/img/weather/"+r),a=n.currentCity,i.pictureUrl=r,i.currentCity=a,m.cache.setItemWithLocal("location",t.location,432e5),e.resolve(i)},function(){e.reject()}),e.promise()}function s(){var e=u.Deferred(),t=f.getCacheFolderByName(m.i18n.t("main/mbox_spam")).id;return m.xhr.simpleCall({query:{func:"mbox:emptyFolder",sid:h.getSid()},data:{id:t,permanently:!0}},function(t){e.resolve(t)},function(){e.reject()}),e.promise()}function o(e){var t=u.Deferred();return m.xhr.simpleCall({query:{func:"user:migratePOPAccount",sid:h.getSid()},data:e,preprocess:!1},function(e){t.resolve(e)},function(){t.reject()}),t.promise()}function l(){var e=u.Deferred();return m.xhr.simpleCall({query:{func:"global:getWelcomePageBulletin",sid:h.getSid()}},function(t){var n=t[0];n?n.type="bulletin":n={},e.resolve(n)},function(){e.reject()}),e.promise()}function c(){var e=u.Deferred();return m.xhr.simpleCall({query:{func:"global:getWelcomePageEmbedExternalColumn",sid:h.getSid()}},function(t){var n=t[0];u.isEmptyObject(n)||(n.type="external",n.subject=n.subject||n.title),e.resolve(n)},function(){e.reject()}),e.promise()}function d(){var e=!1,t=f.getCacheFolderByName(m.i18n.t("main/mbox_spam"));return t.stats.messageCount>0&&(e=!0),e}var u=e("jquery"),p=e("moment"),h=e("../../common/globalService"),f=(e("../../setting/service"),e("../service")),m=e("../../../util/index"),g=e("../../../util/common-controls");return{getGreetings:t,getLastLoginInfo:n,getMboxInfo:i,getBulletins:a,getWeather:r,emptySpam:s,migratePOPAccount:o}}),define("components/requirejs-text/text!template/module/mail/welcome.tpl.html",[],function(){return'<div class="m-mlwelcome">\r\n  <div class="container">\r\n    <div class="header j-header"></div>\r\n    <div class="main j-main"></div>\r\n  </div><!-- end container -->\r\n  <div class="footer small text-gray">{{{i18n "main/copyright"}}}</div>\r\n\r\n  {{#raw}}\r\n  <script id="autoreptpl" type="text/x-handlebars-template">\r\n    <span class="close iconfont icondelword j-close"></span>\r\n    [[[i18n "common/welcome_auto_reply_tip"]]]\r\n  </script>\r\n\r\n  <script id="abstracttpl" type="text/x-handlebars-template">\r\n    <div class="panel-sbj"><div class="tag skin-primary-bg"></div>[[greetings]]</div>\r\n    [[#if autoReplyWelcomeTip]]\r\n    <div class="panel-autorep u-alert u-alert-warning">[[[autoReplyWelcomeTip]]]</div>\r\n    [[/if]]\r\n    <div class="panel-cnt">\r\n      <div class="abstract">\r\n        <div class="avatar">\r\n          <a href="javascript:void(0);" class="u-img u-img-round">\r\n            <img alt="avatar" class="j-avatar">\r\n          </a>\r\n        </div>\r\n        <div class="info">\r\n          <ul class="u-list u-list-horizontal j-link-trigger">\r\n            <li>\r\n              <span class="headings">[[i18n "main/mbox_main_title"]]:</span>\r\n              [[#compare unreadMessageCount \'!=\' 0]]\r\n              <a href="javascript:void(0);" class="link" data-trigger="mail.unread"><span class="mark">[[unreadMessageCount]]</span> [[i18n "mbox/unread_message_count"]]</a>\r\n              [[/compare]]\r\n              [[#if enableAutoReply]]\r\n              <span class="notify">{{i18n "mail/msg_autoreply_on"}}</span>\r\n              <a href="javascript:void(0);" class="link" data-trigger="setting.delivery.autoreply"> <span class="link">{{i18n "common/op_set"}}</span></a>\r\n              [[/if]]\r\n            </li>\r\n          </ul>\r\n          <ul class="u-list u-list-horizontal">\r\n            <li>\r\n              <span>[[i18n "main/mbox_capacity_size_total"]]: </span>\r\n              <div class="u-progress u-progress-success">\r\n                <div class="u-progress-bar" style="width: [[messageSizePercent]]%;"></div>\r\n              </div>\r\n              <span class="text-success">[[messageSize]] / [[limitMessageSize]]</span>\r\n            </li>\r\n            <li>\r\n              <a href="javascript:void(0);" class="link" data-trigger="setting.folder.folder">[[i18n "main/mbox_mng"]]</a>\r\n            </li>\r\n            [[#if warningMessageSize]]\r\n            <li><a href="javascript:void(0);" class="link text-error">[[warningMessageSize]]</a></li>\r\n            [[/if]]\r\n            [[#if canEmptySpam]]\r\n            <li>\r\n              <a href="javascript:void(0);" id="emptySpam" class="link" >[[canEmptySpam]]</a>\r\n            </li>\r\n            [[/if]]\r\n          </ul>\r\n          <ul class="u-list u-list-horizontal">\r\n            <li>[[lastLoginDate]]</li>\r\n            <li>[[lastLoginIP]]</li>\r\n            <li><a href="javascript:void(0);" data-trigger="logs.login">[[i18n "main/ip_detail"]]</a></li>\r\n            [[#if needMigrateTips]]\r\n            <li>|</li>\r\n            <li>[[i18n "main/h2_migration_content"]]</li>\r\n            <li><a href="javascript:void(0);" data-trigger="migration.import" data-id="[[migrateAccountId]]">[[i18n "main/h2_migration_import_immediately"]]</a></li>\r\n            [[/if]]\r\n          </ul>\r\n          [[#if supportArchiveLite]]\r\n          <ul class="u-list u-list-horizontal">\r\n            <li>[[i18n "main/mbox_main_title"]]: [[archiveMessageCountInfo]]</li>\r\n            <li><a href="javascript:void(0);" class="link">[[i18n "main/al_save_email"]]</a></li>\r\n            <li><a href="javascript:void(0);" class="link">[[i18n "main/al_mail_search"]]</a></li>\r\n            <li>|</li>\r\n            <li>\r\n              <span>[[i18n "main/arch_capacity_size_total"]]: </span>\r\n              <div class="u-progress u-progress-error">\r\n                <div class="u-progress-bar" style="width: [[archiveMessageSizePercent]]%;"></div>\r\n              </div>\r\n              <span class="text-success">[[archiveMessageSize]] / [[archiveLiteQuota]]</span>\r\n            </li>\r\n            [[#if warningArchiveMessageSize]]\r\n            <li><a href="javascript:void(0);" class="link text-error">[[warningArchiveMessageSize]]</a></li>\r\n            [[/if]]\r\n          </ul>\r\n          [[/if]]\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </script>\r\n\r\n  <script id="weathertpl" type="text/x-handlebars-template">\r\n    <div class="weather">\r\n      <div class="weadesc">\r\n        <div class="temp">[[temperature]]</div>\r\n        <span>[[weather]]/[[wind]]</span>\r\n        <span class="place">[[currentCity]]</span>\r\n      </div>\r\n      <div class="weaimg">\r\n        <img src="[[pictureUrl]]" alt="weather" />\r\n      </div>\r\n    </div>\r\n  </script>\r\n\r\n  <script id="bulletintpl" type="text/x-handlebar-template">\r\n    <div class="panel-sbj"><div class="tag skin-primary-bg"></div>[[subject]]</div>\r\n    <div class="panel-cnt">\r\n      [[#compare type "==" "bulletin"]]\r\n      [[#if text]]\r\n      <div class="content f-pre">[[text]]</div>\r\n      [[else]]\r\n      <div class="content">[[[html]]]</div>\r\n      [[/if]]\r\n      [[/compare]]\r\n\r\n      [[#compare type "==" "external"]]\r\n      <div class="content f-oh">\r\n        <iframe src="[[url]]" frameborder="0"></iframe>\r\n      </div>\r\n      [[/compare]]\r\n\r\n      [[#compare type "==" "news"]]\r\n      <div class="content">\r\n        <ul class="u-list u-list-img">\r\n          [[#each news]]\r\n          <li>\r\n            <div class="u-img u-img-border">\r\n              <img src="[[url]]" alt="">\r\n            </div>\r\n            <div class="u-img-text">\r\n              <div class="u-img-date">[[date]]</div>\r\n              <a href="javascript:void(0);" class="u-img-title">[[subject]]</a>\r\n              <div class="u-img-desc">[[content]]</div>\r\n            </div>\r\n          </li>\r\n          [[/each]]\r\n        </ul>\r\n      </div>\r\n      [[/compare]]\r\n    </div>\r\n  </script>\r\n\r\n  <script id="bulletinstpl" type="text/x-handlebars-template">\r\n    <div class="bulletins">\r\n      [[#compare bulletins.length ">" 1]]\r\n      <div class="u-slide j-slide">\r\n        <ul class="u-slide-content" data-role="content">\r\n          [[#each bulletins]]\r\n          <li class="u-slide-panel">\r\n            [[#include parent=..]] [[[bulletin this]]] [[/include]]\r\n          </li>\r\n          [[/each]]\r\n        </ul>\r\n        <ul class="u-slide-nav" data-role="nav">\r\n          [[#each bulletins]]\r\n          <li class="u-slide-trigger j-slide-trigger"></li>\r\n          [[/each]]\r\n        </ul>\r\n      </div>\r\n      [[else]]\r\n      [[#include]] [[[bulletin bulletins]]] [[/include]]\r\n      [[/compare]]\r\n    </div>\r\n  </script>\r\n\r\n  <script id="featurestpl" type="text/x-handlebars-template">\r\n    <div class="features j-features">\r\n      <div class="panel-sbj">\r\n        <div class="tag skin-primary-bg"></div>\r\n        [[i18n "main/h2_news_title"]]\r\n      </div>\r\n      <div class="panel-cnt">\r\n        <ul class="u-list u-list-img">\r\n          [[#if enableSelfService]]\r\n          <li>\r\n            <div class="u-img icon-feature icon-check"></div>\r\n            <div class="u-img-text">\r\n              <a href="javascript:void(0);" class="u-img-title" data-trigger="logs">[[i18n "main/h2_news_self_service"]]</a>\r\n              <div class="u-img-desc">[[[i18n "main/h2_news_self_service_tip_featured"]]]</div>\r\n            </div>\r\n          </li>\r\n          [[/if]]\r\n          [[#if enableTrs]]\r\n          <li>\r\n            <div class="u-img icon-feature icon-file"></div>\r\n            <div class="u-img-text">\r\n              <a href="javascript:void(0);" class="u-img-title" data-trigger="file.transitcenter">[[i18n "main/h2_news_ts"]]</a>\r\n              <div class="u-img-desc">[[[i18n "main/h2_news_ts_tip_featured"]]]</div>\r\n            </div>\r\n          </li>\r\n          [[/if]]\r\n          [[#if enableCal]]\r\n          <li>\r\n            <div class="u-img icon-feature icon-schedule"></div>\r\n            <div class="u-img-text">\r\n              <a href="javascript:void(0);" class="u-img-title" data-trigger="calendar">[[i18n "main/h2_news_calendar"]]</a>\r\n              <div class="u-img-desc">[[[i18n "main/h2_news_calendar_tip"]]]</div>\r\n            </div>\r\n          </li>\r\n          [[/if]]\r\n          [[#if enablePlugin]]\r\n          <li>\r\n            <div class="u-img icon-feature icon-client"></div>\r\n            <div class="u-img-text">\r\n              <a href="http://software.icoremail.net/coremail-plugin/download.html" target="_blank" class="u-img-title">[[i18n "main/h2_news_plugin"]]</a>\r\n              <div class="u-img-desc">[[[i18n "main/h2_news_plugin_tip"]]]</div>\r\n            </div>\r\n          </li>\r\n          [[/if]]\r\n          <li>\r\n            <div class="u-img icon-feature icon-lock"></div>\r\n            <div class="u-img-text">\r\n              <a href="javascript:void(0);" class="u-img-title" data-trigger="setting.security.auth2lock">[[i18n "main/h2_news_key"]]</a>\r\n              <div class="u-img-desc">[[[i18n "main/h2_news_key_tip"]]]</div>\r\n            </div>\r\n          </li>\r\n        </ul>\r\n\r\n        <div class="app">\r\n          <img src="//mt.icoremail.net/cab/qrcode.png" alt="qrcode">\r\n          <div class="img-text">\r\n            <a href="https://itunes.apple.com/cn/app/coremail/id696333662?mt=8" target="_blank">\r\n              <span class="iconfont iconapple"></span>\r\n              iPhone\r\n            </a>\r\n            <a href="http://mt.icoremail.net/down.myapp.com/coremail.apk" target="_blank">\r\n              <span class="iconfont iconanroid"></span>\r\n              Android\r\n            </a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </script>\r\n\r\n  <script id="migratefailtpl" type="text/x-handlebars-template">\r\n    <div class="migrate-dialog">\r\n      [[#compare resultCode "==" "FA_BAD_PASSWORD"]]\r\n      <span class=\'fRed\'>[[i18n "main/migration_badPassword"]]</span><br/>\r\n      [[/compare]]\r\n      <span>[[i18n "main/migration_authFail"]]</span><br/>\r\n      <input type="password" id="migrationPass" class="u-input" />\r\n    </div>\r\n  </script>\r\n\r\n  <script id="migrateoktpl" type="text/x-handlebars-template">\r\n    <div class="migrate-dialog">\r\n      [[i18n "main/migration_startMigrate"]] <a href="javascript:void(0);" class="link" id="progress">[[i18n "main/migration_progress"]]</a>\r\n    </div>\r\n  </script>\r\n  {{/raw}}\r\n</div>';
}),define("module/mail/welcome/index",["require","i18n!main,mail,mbox","jquery","handlebars","cui/core/view/view","cui/core/view/viewmanager","cui/util/templatable/templatable","cui/ui/switchable/slide","../../../util/index","../../common/globalService","./service","../service","../../../component/confirmbox","text!template/module/mail/welcome.tpl.html"],function(e){function t(e){function t(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])}var n={};return t(this),t(e.hash),e.fn(n)}function n(e){var t=this.parent,n=t?t.view:this.view,i=n.$("#bulletintpl").html();return t?a.compile(i)(e):a.compile(i)(e[0])}e("i18n!main,mail,mbox");var i=e("jquery"),a=e("handlebars"),r=e("cui/core/view/view"),s=e("cui/core/view/viewmanager"),o=e("cui/util/templatable/templatable"),l=e("cui/ui/switchable/slide"),c=e("../../../util/index"),d=e("../../common/globalService"),u=e("./service"),p=e("../service"),h=e("../../../component/confirmbox"),f=r.extend({Implements:o,widgets:{slide:null},state:null,events:{"click .container [data-trigger]":"_handleLinkTrigger"},templateHelpers:{include:t,bulletin:n},setup:function(){this.state=d.getCurrentState()},render:function(){var e=this;f.superclass.render.call(e),e._renderHeader(),e._renderMain(),e._initModuleMessage()},destroy:function(){this.widgets.slide&&this.widgets.slide.destroy(),i(window).off("resize.welcome"),f.superclass.destroy.call(this)},_renderHeader:function(e){var t=this,n=this.$(".j-header"),a=this.$("#abstracttpl").html(),r=this.$("#autoreptpl").html(),s=this.$("#weathertpl").html();e=e||!1,i.when(u.getGreetings(),u.getLastLoginInfo(),u.getMboxInfo(e),p.getAutoReplyInfo()).then(function(e,o,l,c){n.html("");var p={greetings:e,needMigrateTips:d.getConfig("user.needmigratetips"),migrateAccountId:d.getConfig("user.migrateaccountid")};o.lastLoginDate=o.lastLoginDate&&o.lastLoginDate.replace("Invalid date",""),c.showAutoReplyTips&&(p.autoReplyWelcomeTip=t.compile(r)),i.extend(p,o,l,c),n.append(t.compile(a,p)),c.showAutoReplyTips&&t._initAutoReplyWelcomeTip(),d.getUserAvatar().then(function(e){n.find(".j-avatar").attr("src",e)}),l.canEmptySpam&&t._handleEmptySpam(),u.getWeather().then(function(e){n.find(".panel-cnt").eq(0).append(t.compile(s,e))})},function(){})},_initAutoReplyWelcomeTip:function(){var e=this,t=this.$(".panel-autorep");t.find(".j-close").on("click",function(){t.hide()}),t.find("a").on("click",function(){d.updateUser({autorepmode:0},!0).then(function(){e.sendMessage("setting.delivery.autoreply","view:change",{}),t.hide(),i.notify(c.i18n.t("main/auto_reply_close_success"))})})},_renderMain:function(){var e,t,n=this,i=n.$(".j-main"),a=n.$("#bulletinstpl").html(),r=n.$("#featurestpl").html();i.append(n.compile(r,{enableSelfService:d.getConfig("user.enableselfservice"),enableCal:d.getConfig("calendar.enable"),enableTrs:d.getConfig("file.ispermittrs"),enablePlugin:c.detector.os&&"windows"===c.detector.os.name})),e=i.find(".j-features"),t=function(){e.addClass("z-expand")},d.getConfig("user.enablebulletins")?u.getBulletins().then(function(e){return 0===e.length?void t():(i.prepend(n.compile(a,{bulletins:e,view:n})),void(e.length>1&&n._initBulletSlide(e.length)))},function(){t()}):t()},_initBulletSlide:function(e){var t=this,n=t.$(".j-slide");t.widgets.slide=new l({element:".j-slide",classPrefix:"u-slide",effect:"scrollx",triggerViewSize:[n.width()/e,4],panelViewSize:[n.width(),n.height()]}),i(window).off("resize.welcome").on("resize.welcome",function(){t._refreshBulletinSlide()}),setTimeout(function(){t._refreshBulletinSlide()},500)},_refreshBulletinSlide:function(){var e,t,n,i=this.$(".j-slide"),a=i.find(".j-slide-trigger").length;e=i.data("slideSize"),t=i.width(),n=i.height(),!this.widgets.slide||e&&e.width===t&&e.height===n||(this.widgets.slide.set("triggerViewSize",[t/a,4]),this.widgets.slide.set("panelViewSize",[t,n]),i.data("slideSize",{width:t,height:n}))},_initModuleMessage:function(){var e=this;this.onMessage("slide:refresh",function(){e._refreshBulletinSlide()},null),this.onMessage("view:refresh",function(){e._renderHeader()},null),this.onMessage("view:active",function(){e._renderHeader()},null)},_handleLinkTrigger:function(e,t){var n,a=this,r=p.getFoldersMap(),s=i(t),o=s.data("trigger");o&&("mail.unread"==o?(n={module:"mail.search",param:p.makeSearchCondition({id:r.unread,read:!1})},n.param.vid="search",a.sendMessage("dispatcher","history:add",n)):"migration.import"==o?a._startMigration({id:parseInt(s.data("id")),item:{autoSync:!1},autoUpdate:!0}):(n={module:o,param:{}},d.setCurrentState(n),a.sendMessage("dispatcher","history:add",n)))},_startMigration:function(e){var t=this,n=t.$("#migratefailtpl").html(),a=t.$("#migrateoktpl").html();u.migratePOPAccount(e).then(function(r){if("S_OK"===r.code){d.updateConfig("user.needmigratetips",!1);var s=new h({message:t.compile(a),title:c.i18n.t("main/h2_migration_title"),cancelTpl:!1,closeTpl:!1,onConfirm:function(){t._renderHeader(),this.hide()}}).show().after("hide",function(){this.destroy()});i("#progress").click(function(){s.hide(),t._renderHeader(),t.sendMessage("dispatcher","history:add",{module:"setting.advance.pop",param:{action:"progress",id:e.id}})})}else h.confirm(t.compile(n,{resultCode:r.code}),function(){var n=i("#migrationPass").val();t._startMigration({id:e.id,item:{autoSync:!1,password:n},autoUpdate:!0})},function(){},{title:c.i18n.t("main/h2_migration_title")})})},_handleEmptySpam:function(){var e=this;i(document).off("click","#emptySpam").on("click","#emptySpam",function(){h.confirm(c.i18n.t("main/empty_spam_confirm"),i.noop(),i.noop(),{onConfirm:function(){u.emptySpam().then(function(){var t=p.getCacheFolderByName(c.i18n.t("main/mbox_spam")).id;e.sendMessage("mail","folder:refresh",{ids:t}),e._renderHeader(!0)}),this.hide()},onCancel:function(){this.hide()}})})}});s.module({name:"mail.welcome",template:e("text!template/module/mail/welcome.tpl.html")},f)});
//# sourceMappingURL=main.js.map